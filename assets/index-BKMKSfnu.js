var VS=Object.defineProperty;var zS=(n,e,t)=>e in n?VS(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var T=(n,e,t)=>zS(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();function g3(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Wh={exports:{}},eo={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pb;function HS(){if(pb)return eo;pb=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,s,a){var l=null;if(a!==void 0&&(l=""+a),s.key!==void 0&&(l=""+s.key),"key"in s){a={};for(var u in s)u!=="key"&&(a[u]=s[u])}else a=s;return s=a.ref,{$$typeof:n,type:i,key:l,ref:s!==void 0?s:null,props:a}}return eo.Fragment=e,eo.jsx=t,eo.jsxs=t,eo}var mb;function jS(){return mb||(mb=1,Wh.exports=HS()),Wh.exports}var xe=jS(),$h={exports:{}},Ee={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _b;function WS(){if(_b)return Ee;_b=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),_=Symbol.iterator;function y(O){return O===null||typeof O!="object"?null:(O=_&&O[_]||O["@@iterator"],typeof O=="function"?O:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,R={};function C(O,G,le){this.props=O,this.context=G,this.refs=R,this.updater=le||v}C.prototype.isReactComponent={},C.prototype.setState=function(O,G){if(typeof O!="object"&&typeof O!="function"&&O!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,O,G,"setState")},C.prototype.forceUpdate=function(O){this.updater.enqueueForceUpdate(this,O,"forceUpdate")};function z(){}z.prototype=C.prototype;function H(O,G,le){this.props=O,this.context=G,this.refs=R,this.updater=le||v}var M=H.prototype=new z;M.constructor=H,A(M,C.prototype),M.isPureReactComponent=!0;var k=Array.isArray,L={H:null,A:null,T:null,S:null,V:null},X=Object.prototype.hasOwnProperty;function ce(O,G,le,ae,oe,ge){return le=ge.ref,{$$typeof:n,type:O,key:G,ref:le!==void 0?le:null,props:ge}}function re(O,G){return ce(O.type,G,void 0,void 0,void 0,O.props)}function ne(O){return typeof O=="object"&&O!==null&&O.$$typeof===n}function he(O){var G={"=":"=0",":":"=2"};return"$"+O.replace(/[=:]/g,function(le){return G[le]})}var te=/\/+/g;function me(O,G){return typeof O=="object"&&O!==null&&O.key!=null?he(""+O.key):G.toString(36)}function Ae(){}function _e(O){switch(O.status){case"fulfilled":return O.value;case"rejected":throw O.reason;default:switch(typeof O.status=="string"?O.then(Ae,Ae):(O.status="pending",O.then(function(G){O.status==="pending"&&(O.status="fulfilled",O.value=G)},function(G){O.status==="pending"&&(O.status="rejected",O.reason=G)})),O.status){case"fulfilled":return O.value;case"rejected":throw O.reason}}throw O}function Be(O,G,le,ae,oe){var ge=typeof O;(ge==="undefined"||ge==="boolean")&&(O=null);var fe=!1;if(O===null)fe=!0;else switch(ge){case"bigint":case"string":case"number":fe=!0;break;case"object":switch(O.$$typeof){case n:case e:fe=!0;break;case p:return fe=O._init,Be(fe(O._payload),G,le,ae,oe)}}if(fe)return oe=oe(O),fe=ae===""?"."+me(O,0):ae,k(oe)?(le="",fe!=null&&(le=fe.replace(te,"$&/")+"/"),Be(oe,G,le,"",function(_t){return _t})):oe!=null&&(ne(oe)&&(oe=re(oe,le+(oe.key==null||O&&O.key===oe.key?"":(""+oe.key).replace(te,"$&/")+"/")+fe)),G.push(oe)),1;fe=0;var Je=ae===""?".":ae+":";if(k(O))for(var De=0;De<O.length;De++)ae=O[De],ge=Je+me(ae,De),fe+=Be(ae,G,le,ge,oe);else if(De=y(O),typeof De=="function")for(O=De.call(O),De=0;!(ae=O.next()).done;)ae=ae.value,ge=Je+me(ae,De++),fe+=Be(ae,G,le,ge,oe);else if(ge==="object"){if(typeof O.then=="function")return Be(_e(O),G,le,ae,oe);throw G=String(O),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(O).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.")}return fe}function Y(O,G,le){if(O==null)return O;var ae=[],oe=0;return Be(O,ae,"","",function(ge){return G.call(le,ge,oe++)}),ae}function ie(O){if(O._status===-1){var G=O._result;G=G(),G.then(function(le){(O._status===0||O._status===-1)&&(O._status=1,O._result=le)},function(le){(O._status===0||O._status===-1)&&(O._status=2,O._result=le)}),O._status===-1&&(O._status=0,O._result=G)}if(O._status===1)return O._result.default;throw O._result}var de=typeof reportError=="function"?reportError:function(O){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var G=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof O=="object"&&O!==null&&typeof O.message=="string"?String(O.message):String(O),error:O});if(!window.dispatchEvent(G))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",O);return}console.error(O)};function we(){}return Ee.Children={map:Y,forEach:function(O,G,le){Y(O,function(){G.apply(this,arguments)},le)},count:function(O){var G=0;return Y(O,function(){G++}),G},toArray:function(O){return Y(O,function(G){return G})||[]},only:function(O){if(!ne(O))throw Error("React.Children.only expected to receive a single React element child.");return O}},Ee.Component=C,Ee.Fragment=t,Ee.Profiler=s,Ee.PureComponent=H,Ee.StrictMode=i,Ee.Suspense=h,Ee.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=L,Ee.__COMPILER_RUNTIME={__proto__:null,c:function(O){return L.H.useMemoCache(O)}},Ee.cache=function(O){return function(){return O.apply(null,arguments)}},Ee.cloneElement=function(O,G,le){if(O==null)throw Error("The argument must be a React element, but you passed "+O+".");var ae=A({},O.props),oe=O.key,ge=void 0;if(G!=null)for(fe in G.ref!==void 0&&(ge=void 0),G.key!==void 0&&(oe=""+G.key),G)!X.call(G,fe)||fe==="key"||fe==="__self"||fe==="__source"||fe==="ref"&&G.ref===void 0||(ae[fe]=G[fe]);var fe=arguments.length-2;if(fe===1)ae.children=le;else if(1<fe){for(var Je=Array(fe),De=0;De<fe;De++)Je[De]=arguments[De+2];ae.children=Je}return ce(O.type,oe,void 0,void 0,ge,ae)},Ee.createContext=function(O){return O={$$typeof:l,_currentValue:O,_currentValue2:O,_threadCount:0,Provider:null,Consumer:null},O.Provider=O,O.Consumer={$$typeof:a,_context:O},O},Ee.createElement=function(O,G,le){var ae,oe={},ge=null;if(G!=null)for(ae in G.key!==void 0&&(ge=""+G.key),G)X.call(G,ae)&&ae!=="key"&&ae!=="__self"&&ae!=="__source"&&(oe[ae]=G[ae]);var fe=arguments.length-2;if(fe===1)oe.children=le;else if(1<fe){for(var Je=Array(fe),De=0;De<fe;De++)Je[De]=arguments[De+2];oe.children=Je}if(O&&O.defaultProps)for(ae in fe=O.defaultProps,fe)oe[ae]===void 0&&(oe[ae]=fe[ae]);return ce(O,ge,void 0,void 0,null,oe)},Ee.createRef=function(){return{current:null}},Ee.forwardRef=function(O){return{$$typeof:u,render:O}},Ee.isValidElement=ne,Ee.lazy=function(O){return{$$typeof:p,_payload:{_status:-1,_result:O},_init:ie}},Ee.memo=function(O,G){return{$$typeof:d,type:O,compare:G===void 0?null:G}},Ee.startTransition=function(O){var G=L.T,le={};L.T=le;try{var ae=O(),oe=L.S;oe!==null&&oe(le,ae),typeof ae=="object"&&ae!==null&&typeof ae.then=="function"&&ae.then(we,de)}catch(ge){de(ge)}finally{L.T=G}},Ee.unstable_useCacheRefresh=function(){return L.H.useCacheRefresh()},Ee.use=function(O){return L.H.use(O)},Ee.useActionState=function(O,G,le){return L.H.useActionState(O,G,le)},Ee.useCallback=function(O,G){return L.H.useCallback(O,G)},Ee.useContext=function(O){return L.H.useContext(O)},Ee.useDebugValue=function(){},Ee.useDeferredValue=function(O,G){return L.H.useDeferredValue(O,G)},Ee.useEffect=function(O,G,le){var ae=L.H;if(typeof le=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return ae.useEffect(O,G)},Ee.useId=function(){return L.H.useId()},Ee.useImperativeHandle=function(O,G,le){return L.H.useImperativeHandle(O,G,le)},Ee.useInsertionEffect=function(O,G){return L.H.useInsertionEffect(O,G)},Ee.useLayoutEffect=function(O,G){return L.H.useLayoutEffect(O,G)},Ee.useMemo=function(O,G){return L.H.useMemo(O,G)},Ee.useOptimistic=function(O,G){return L.H.useOptimistic(O,G)},Ee.useReducer=function(O,G,le){return L.H.useReducer(O,G,le)},Ee.useRef=function(O){return L.H.useRef(O)},Ee.useState=function(O){return L.H.useState(O)},Ee.useSyncExternalStore=function(O,G,le){return L.H.useSyncExternalStore(O,G,le)},Ee.useTransition=function(){return L.H.useTransition()},Ee.version="19.1.0",Ee}var yb;function Pg(){return yb||(yb=1,$h.exports=WS()),$h.exports}var J=Pg(),Xh={exports:{}},to={},Yh={exports:{}},qh={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bb;function $S(){return bb||(bb=1,function(n){function e(Y,ie){var de=Y.length;Y.push(ie);e:for(;0<de;){var we=de-1>>>1,O=Y[we];if(0<s(O,ie))Y[we]=ie,Y[de]=O,de=we;else break e}}function t(Y){return Y.length===0?null:Y[0]}function i(Y){if(Y.length===0)return null;var ie=Y[0],de=Y.pop();if(de!==ie){Y[0]=de;e:for(var we=0,O=Y.length,G=O>>>1;we<G;){var le=2*(we+1)-1,ae=Y[le],oe=le+1,ge=Y[oe];if(0>s(ae,de))oe<O&&0>s(ge,ae)?(Y[we]=ge,Y[oe]=de,we=oe):(Y[we]=ae,Y[le]=de,we=le);else if(oe<O&&0>s(ge,de))Y[we]=ge,Y[oe]=de,we=oe;else break e}}return ie}function s(Y,ie){var de=Y.sortIndex-ie.sortIndex;return de!==0?de:Y.id-ie.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var l=Date,u=l.now();n.unstable_now=function(){return l.now()-u}}var h=[],d=[],p=1,_=null,y=3,v=!1,A=!1,R=!1,C=!1,z=typeof setTimeout=="function"?setTimeout:null,H=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function k(Y){for(var ie=t(d);ie!==null;){if(ie.callback===null)i(d);else if(ie.startTime<=Y)i(d),ie.sortIndex=ie.expirationTime,e(h,ie);else break;ie=t(d)}}function L(Y){if(R=!1,k(Y),!A)if(t(h)!==null)A=!0,X||(X=!0,me());else{var ie=t(d);ie!==null&&Be(L,ie.startTime-Y)}}var X=!1,ce=-1,re=5,ne=-1;function he(){return C?!0:!(n.unstable_now()-ne<re)}function te(){if(C=!1,X){var Y=n.unstable_now();ne=Y;var ie=!0;try{e:{A=!1,R&&(R=!1,H(ce),ce=-1),v=!0;var de=y;try{t:{for(k(Y),_=t(h);_!==null&&!(_.expirationTime>Y&&he());){var we=_.callback;if(typeof we=="function"){_.callback=null,y=_.priorityLevel;var O=we(_.expirationTime<=Y);if(Y=n.unstable_now(),typeof O=="function"){_.callback=O,k(Y),ie=!0;break t}_===t(h)&&i(h),k(Y)}else i(h);_=t(h)}if(_!==null)ie=!0;else{var G=t(d);G!==null&&Be(L,G.startTime-Y),ie=!1}}break e}finally{_=null,y=de,v=!1}ie=void 0}}finally{ie?me():X=!1}}}var me;if(typeof M=="function")me=function(){M(te)};else if(typeof MessageChannel<"u"){var Ae=new MessageChannel,_e=Ae.port2;Ae.port1.onmessage=te,me=function(){_e.postMessage(null)}}else me=function(){z(te,0)};function Be(Y,ie){ce=z(function(){Y(n.unstable_now())},ie)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Y){Y.callback=null},n.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):re=0<Y?Math.floor(1e3/Y):5},n.unstable_getCurrentPriorityLevel=function(){return y},n.unstable_next=function(Y){switch(y){case 1:case 2:case 3:var ie=3;break;default:ie=y}var de=y;y=ie;try{return Y()}finally{y=de}},n.unstable_requestPaint=function(){C=!0},n.unstable_runWithPriority=function(Y,ie){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var de=y;y=Y;try{return ie()}finally{y=de}},n.unstable_scheduleCallback=function(Y,ie,de){var we=n.unstable_now();switch(typeof de=="object"&&de!==null?(de=de.delay,de=typeof de=="number"&&0<de?we+de:we):de=we,Y){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=de+O,Y={id:p++,callback:ie,priorityLevel:Y,startTime:de,expirationTime:O,sortIndex:-1},de>we?(Y.sortIndex=de,e(d,Y),t(h)===null&&Y===t(d)&&(R?(H(ce),ce=-1):R=!0,Be(L,de-we))):(Y.sortIndex=O,e(h,Y),A||v||(A=!0,X||(X=!0,me()))),Y},n.unstable_shouldYield=he,n.unstable_wrapCallback=function(Y){var ie=y;return function(){var de=y;y=ie;try{return Y.apply(this,arguments)}finally{y=de}}}}(qh)),qh}var vb;function XS(){return vb||(vb=1,Yh.exports=$S()),Yh.exports}var Kh={exports:{}},Ot={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tb;function YS(){if(Tb)return Ot;Tb=1;var n=Pg();function e(h){var d="https://react.dev/errors/"+h;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)d+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function a(h,d,p){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:_==null?null:""+_,children:h,containerInfo:d,implementation:p}}var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(h,d){if(h==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return Ot.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Ot.createPortal=function(h,d){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return a(h,d,null,p)},Ot.flushSync=function(h){var d=l.T,p=i.p;try{if(l.T=null,i.p=2,h)return h()}finally{l.T=d,i.p=p,i.d.f()}},Ot.preconnect=function(h,d){typeof h=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,i.d.C(h,d))},Ot.prefetchDNS=function(h){typeof h=="string"&&i.d.D(h)},Ot.preinit=function(h,d){if(typeof h=="string"&&d&&typeof d.as=="string"){var p=d.as,_=u(p,d.crossOrigin),y=typeof d.integrity=="string"?d.integrity:void 0,v=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;p==="style"?i.d.S(h,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:_,integrity:y,fetchPriority:v}):p==="script"&&i.d.X(h,{crossOrigin:_,integrity:y,fetchPriority:v,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},Ot.preinitModule=function(h,d){if(typeof h=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var p=u(d.as,d.crossOrigin);i.d.M(h,{crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&i.d.M(h)},Ot.preload=function(h,d){if(typeof h=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var p=d.as,_=u(p,d.crossOrigin);i.d.L(h,p,{crossOrigin:_,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},Ot.preloadModule=function(h,d){if(typeof h=="string")if(d){var p=u(d.as,d.crossOrigin);i.d.m(h,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else i.d.m(h)},Ot.requestFormReset=function(h){i.d.r(h)},Ot.unstable_batchedUpdates=function(h,d){return h(d)},Ot.useFormState=function(h,d,p){return l.H.useFormState(h,d,p)},Ot.useFormStatus=function(){return l.H.useHostTransitionStatus()},Ot.version="19.1.0",Ot}var xb;function p3(){if(xb)return Kh.exports;xb=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Kh.exports=YS(),Kh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sb;function qS(){if(Sb)return to;Sb=1;var n=XS(),e=Pg(),t=p3();function i(r){var o="https://react.dev/errors/"+r;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)o+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function a(r){var o=r,c=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,(o.flags&4098)!==0&&(c=o.return),r=o.return;while(r)}return o.tag===3?c:null}function l(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function u(r){if(a(r)!==r)throw Error(i(188))}function h(r){var o=r.alternate;if(!o){if(o=a(r),o===null)throw Error(i(188));return o!==r?null:r}for(var c=r,f=o;;){var g=c.return;if(g===null)break;var m=g.alternate;if(m===null){if(f=g.return,f!==null){c=f;continue}break}if(g.child===m.child){for(m=g.child;m;){if(m===c)return u(g),r;if(m===f)return u(g),o;m=m.sibling}throw Error(i(188))}if(c.return!==f.return)c=g,f=m;else{for(var b=!1,x=g.child;x;){if(x===c){b=!0,c=g,f=m;break}if(x===f){b=!0,f=g,c=m;break}x=x.sibling}if(!b){for(x=m.child;x;){if(x===c){b=!0,c=m,f=g;break}if(x===f){b=!0,f=m,c=g;break}x=x.sibling}if(!b)throw Error(i(189))}}if(c.alternate!==f)throw Error(i(190))}if(c.tag!==3)throw Error(i(188));return c.stateNode.current===c?r:o}function d(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r;for(r=r.child;r!==null;){if(o=d(r),o!==null)return o;r=r.sibling}return null}var p=Object.assign,_=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),R=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),H=Symbol.for("react.consumer"),M=Symbol.for("react.context"),k=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),X=Symbol.for("react.suspense_list"),ce=Symbol.for("react.memo"),re=Symbol.for("react.lazy"),ne=Symbol.for("react.activity"),he=Symbol.for("react.memo_cache_sentinel"),te=Symbol.iterator;function me(r){return r===null||typeof r!="object"?null:(r=te&&r[te]||r["@@iterator"],typeof r=="function"?r:null)}var Ae=Symbol.for("react.client.reference");function _e(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===Ae?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case A:return"Fragment";case C:return"Profiler";case R:return"StrictMode";case L:return"Suspense";case X:return"SuspenseList";case ne:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case v:return"Portal";case M:return(r.displayName||"Context")+".Provider";case H:return(r._context.displayName||"Context")+".Consumer";case k:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case ce:return o=r.displayName||null,o!==null?o:_e(r.type)||"Memo";case re:o=r._payload,r=r._init;try{return _e(r(o))}catch{}}return null}var Be=Array.isArray,Y=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ie=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,de={pending:!1,data:null,method:null,action:null},we=[],O=-1;function G(r){return{current:r}}function le(r){0>O||(r.current=we[O],we[O]=null,O--)}function ae(r,o){O++,we[O]=r.current,r.current=o}var oe=G(null),ge=G(null),fe=G(null),Je=G(null);function De(r,o){switch(ae(fe,o),ae(ge,r),ae(oe,null),o.nodeType){case 9:case 11:r=(r=o.documentElement)&&(r=r.namespaceURI)?jy(r):0;break;default:if(r=o.tagName,o=o.namespaceURI)o=jy(o),r=Wy(o,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}le(oe),ae(oe,r)}function _t(){le(oe),le(ge),le(fe)}function gi(r){r.memoizedState!==null&&ae(Je,r);var o=oe.current,c=Wy(o,r.type);o!==c&&(ae(ge,r),ae(oe,c))}function $t(r){ge.current===r&&(le(oe),le(ge)),Je.current===r&&(le(Je),Ka._currentValue=de)}var es=Object.prototype.hasOwnProperty,ts=n.unstable_scheduleCallback,Iu=n.unstable_cancelCallback,yT=n.unstable_shouldYield,bT=n.unstable_requestPaint,Mn=n.unstable_now,vT=n.unstable_getCurrentPriorityLevel,Sp=n.unstable_ImmediatePriority,Ap=n.unstable_UserBlockingPriority,Bo=n.unstable_NormalPriority,TT=n.unstable_LowPriority,wp=n.unstable_IdlePriority,xT=n.log,ST=n.unstable_setDisableYieldValue,ia=null,Xt=null;function pi(r){if(typeof xT=="function"&&ST(r),Xt&&typeof Xt.setStrictMode=="function")try{Xt.setStrictMode(ia,r)}catch{}}var Yt=Math.clz32?Math.clz32:ET,AT=Math.log,wT=Math.LN2;function ET(r){return r>>>=0,r===0?32:31-(AT(r)/wT|0)|0}var Lo=256,Fo=4194304;function ns(r){var o=r&42;if(o!==0)return o;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Vo(r,o,c){var f=r.pendingLanes;if(f===0)return 0;var g=0,m=r.suspendedLanes,b=r.pingedLanes;r=r.warmLanes;var x=f&134217727;return x!==0?(f=x&~m,f!==0?g=ns(f):(b&=x,b!==0?g=ns(b):c||(c=x&~r,c!==0&&(g=ns(c))))):(x=f&~m,x!==0?g=ns(x):b!==0?g=ns(b):c||(c=f&~r,c!==0&&(g=ns(c)))),g===0?0:o!==0&&o!==g&&(o&m)===0&&(m=g&-g,c=o&-o,m>=c||m===32&&(c&4194048)!==0)?o:g}function sa(r,o){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&o)===0}function RT(r,o){switch(r){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ep(){var r=Lo;return Lo<<=1,(Lo&4194048)===0&&(Lo=256),r}function Rp(){var r=Fo;return Fo<<=1,(Fo&62914560)===0&&(Fo=4194304),r}function Nu(r){for(var o=[],c=0;31>c;c++)o.push(r);return o}function ra(r,o){r.pendingLanes|=o,o!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function CT(r,o,c,f,g,m){var b=r.pendingLanes;r.pendingLanes=c,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=c,r.entangledLanes&=c,r.errorRecoveryDisabledLanes&=c,r.shellSuspendCounter=0;var x=r.entanglements,E=r.expirationTimes,j=r.hiddenUpdates;for(c=b&~c;0<c;){var q=31-Yt(c),Q=1<<q;x[q]=0,E[q]=-1;var W=j[q];if(W!==null)for(j[q]=null,q=0;q<W.length;q++){var $=W[q];$!==null&&($.lane&=-536870913)}c&=~Q}f!==0&&Cp(r,f,0),m!==0&&g===0&&r.tag!==0&&(r.suspendedLanes|=m&~(b&~o))}function Cp(r,o,c){r.pendingLanes|=o,r.suspendedLanes&=~o;var f=31-Yt(o);r.entangledLanes|=o,r.entanglements[f]=r.entanglements[f]|1073741824|c&4194090}function Mp(r,o){var c=r.entangledLanes|=o;for(r=r.entanglements;c;){var f=31-Yt(c),g=1<<f;g&o|r[f]&o&&(r[f]|=o),c&=~g}}function Pu(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Du(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function Op(){var r=ie.p;return r!==0?r:(r=window.event,r===void 0?32:cb(r.type))}function MT(r,o){var c=ie.p;try{return ie.p=r,o()}finally{ie.p=c}}var mi=Math.random().toString(36).slice(2),Ct="__reactFiber$"+mi,Lt="__reactProps$"+mi,Fs="__reactContainer$"+mi,ku="__reactEvents$"+mi,OT="__reactListeners$"+mi,IT="__reactHandles$"+mi,Ip="__reactResources$"+mi,aa="__reactMarker$"+mi;function Uu(r){delete r[Ct],delete r[Lt],delete r[ku],delete r[OT],delete r[IT]}function Vs(r){var o=r[Ct];if(o)return o;for(var c=r.parentNode;c;){if(o=c[Fs]||c[Ct]){if(c=o.alternate,o.child!==null||c!==null&&c.child!==null)for(r=qy(r);r!==null;){if(c=r[Ct])return c;r=qy(r)}return o}r=c,c=r.parentNode}return null}function zs(r){if(r=r[Ct]||r[Fs]){var o=r.tag;if(o===5||o===6||o===13||o===26||o===27||o===3)return r}return null}function oa(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r.stateNode;throw Error(i(33))}function Hs(r){var o=r[Ip];return o||(o=r[Ip]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function yt(r){r[aa]=!0}var Np=new Set,Pp={};function is(r,o){js(r,o),js(r+"Capture",o)}function js(r,o){for(Pp[r]=o,r=0;r<o.length;r++)Np.add(o[r])}var NT=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Dp={},kp={};function PT(r){return es.call(kp,r)?!0:es.call(Dp,r)?!1:NT.test(r)?kp[r]=!0:(Dp[r]=!0,!1)}function zo(r,o,c){if(PT(o))if(c===null)r.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":r.removeAttribute(o);return;case"boolean":var f=o.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){r.removeAttribute(o);return}}r.setAttribute(o,""+c)}}function Ho(r,o,c){if(c===null)r.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(o);return}r.setAttribute(o,""+c)}}function Xn(r,o,c,f){if(f===null)r.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(c);return}r.setAttributeNS(o,c,""+f)}}var Bu,Up;function Ws(r){if(Bu===void 0)try{throw Error()}catch(c){var o=c.stack.trim().match(/\n( *(at )?)/);Bu=o&&o[1]||"",Up=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Bu+r+Up}var Lu=!1;function Fu(r,o){if(!r||Lu)return"";Lu=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(o){var Q=function(){throw Error()};if(Object.defineProperty(Q.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Q,[])}catch($){var W=$}Reflect.construct(r,[],Q)}else{try{Q.call()}catch($){W=$}r.call(Q.prototype)}}else{try{throw Error()}catch($){W=$}(Q=r())&&typeof Q.catch=="function"&&Q.catch(function(){})}}catch($){if($&&W&&typeof $.stack=="string")return[$.stack,W.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=f.DetermineComponentFrameRoot(),b=m[0],x=m[1];if(b&&x){var E=b.split(`
`),j=x.split(`
`);for(g=f=0;f<E.length&&!E[f].includes("DetermineComponentFrameRoot");)f++;for(;g<j.length&&!j[g].includes("DetermineComponentFrameRoot");)g++;if(f===E.length||g===j.length)for(f=E.length-1,g=j.length-1;1<=f&&0<=g&&E[f]!==j[g];)g--;for(;1<=f&&0<=g;f--,g--)if(E[f]!==j[g]){if(f!==1||g!==1)do if(f--,g--,0>g||E[f]!==j[g]){var q=`
`+E[f].replace(" at new "," at ");return r.displayName&&q.includes("<anonymous>")&&(q=q.replace("<anonymous>",r.displayName)),q}while(1<=f&&0<=g);break}}}finally{Lu=!1,Error.prepareStackTrace=c}return(c=r?r.displayName||r.name:"")?Ws(c):""}function DT(r){switch(r.tag){case 26:case 27:case 5:return Ws(r.type);case 16:return Ws("Lazy");case 13:return Ws("Suspense");case 19:return Ws("SuspenseList");case 0:case 15:return Fu(r.type,!1);case 11:return Fu(r.type.render,!1);case 1:return Fu(r.type,!0);case 31:return Ws("Activity");default:return""}}function Bp(r){try{var o="";do o+=DT(r),r=r.return;while(r);return o}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}function rn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Lp(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function kT(r){var o=Lp(r)?"checked":"value",c=Object.getOwnPropertyDescriptor(r.constructor.prototype,o),f=""+r[o];if(!r.hasOwnProperty(o)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var g=c.get,m=c.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return g.call(this)},set:function(b){f=""+b,m.call(this,b)}}),Object.defineProperty(r,o,{enumerable:c.enumerable}),{getValue:function(){return f},setValue:function(b){f=""+b},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function jo(r){r._valueTracker||(r._valueTracker=kT(r))}function Fp(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var c=o.getValue(),f="";return r&&(f=Lp(r)?r.checked?"true":"false":r.value),r=f,r!==c?(o.setValue(r),!0):!1}function Wo(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var UT=/[\n"\\]/g;function an(r){return r.replace(UT,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Vu(r,o,c,f,g,m,b,x){r.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?r.type=b:r.removeAttribute("type"),o!=null?b==="number"?(o===0&&r.value===""||r.value!=o)&&(r.value=""+rn(o)):r.value!==""+rn(o)&&(r.value=""+rn(o)):b!=="submit"&&b!=="reset"||r.removeAttribute("value"),o!=null?zu(r,b,rn(o)):c!=null?zu(r,b,rn(c)):f!=null&&r.removeAttribute("value"),g==null&&m!=null&&(r.defaultChecked=!!m),g!=null&&(r.checked=g&&typeof g!="function"&&typeof g!="symbol"),x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?r.name=""+rn(x):r.removeAttribute("name")}function Vp(r,o,c,f,g,m,b,x){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(r.type=m),o!=null||c!=null){if(!(m!=="submit"&&m!=="reset"||o!=null))return;c=c!=null?""+rn(c):"",o=o!=null?""+rn(o):c,x||o===r.value||(r.value=o),r.defaultValue=o}f=f??g,f=typeof f!="function"&&typeof f!="symbol"&&!!f,r.checked=x?r.checked:!!f,r.defaultChecked=!!f,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(r.name=b)}function zu(r,o,c){o==="number"&&Wo(r.ownerDocument)===r||r.defaultValue===""+c||(r.defaultValue=""+c)}function $s(r,o,c,f){if(r=r.options,o){o={};for(var g=0;g<c.length;g++)o["$"+c[g]]=!0;for(c=0;c<r.length;c++)g=o.hasOwnProperty("$"+r[c].value),r[c].selected!==g&&(r[c].selected=g),g&&f&&(r[c].defaultSelected=!0)}else{for(c=""+rn(c),o=null,g=0;g<r.length;g++){if(r[g].value===c){r[g].selected=!0,f&&(r[g].defaultSelected=!0);return}o!==null||r[g].disabled||(o=r[g])}o!==null&&(o.selected=!0)}}function zp(r,o,c){if(o!=null&&(o=""+rn(o),o!==r.value&&(r.value=o),c==null)){r.defaultValue!==o&&(r.defaultValue=o);return}r.defaultValue=c!=null?""+rn(c):""}function Hp(r,o,c,f){if(o==null){if(f!=null){if(c!=null)throw Error(i(92));if(Be(f)){if(1<f.length)throw Error(i(93));f=f[0]}c=f}c==null&&(c=""),o=c}c=rn(o),r.defaultValue=c,f=r.textContent,f===c&&f!==""&&f!==null&&(r.value=f)}function Xs(r,o){if(o){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=o;return}}r.textContent=o}var BT=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function jp(r,o,c){var f=o.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?f?r.setProperty(o,""):o==="float"?r.cssFloat="":r[o]="":f?r.setProperty(o,c):typeof c!="number"||c===0||BT.has(o)?o==="float"?r.cssFloat=c:r[o]=(""+c).trim():r[o]=c+"px"}function Wp(r,o,c){if(o!=null&&typeof o!="object")throw Error(i(62));if(r=r.style,c!=null){for(var f in c)!c.hasOwnProperty(f)||o!=null&&o.hasOwnProperty(f)||(f.indexOf("--")===0?r.setProperty(f,""):f==="float"?r.cssFloat="":r[f]="");for(var g in o)f=o[g],o.hasOwnProperty(g)&&c[g]!==f&&jp(r,g,f)}else for(var m in o)o.hasOwnProperty(m)&&jp(r,m,o[m])}function Hu(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var LT=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),FT=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function $o(r){return FT.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}var ju=null;function Wu(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Ys=null,qs=null;function $p(r){var o=zs(r);if(o&&(r=o.stateNode)){var c=r[Lt]||null;e:switch(r=o.stateNode,o.type){case"input":if(Vu(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),o=c.name,c.type==="radio"&&o!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+an(""+o)+'"][type="radio"]'),o=0;o<c.length;o++){var f=c[o];if(f!==r&&f.form===r.form){var g=f[Lt]||null;if(!g)throw Error(i(90));Vu(f,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(o=0;o<c.length;o++)f=c[o],f.form===r.form&&Fp(f)}break e;case"textarea":zp(r,c.value,c.defaultValue);break e;case"select":o=c.value,o!=null&&$s(r,!!c.multiple,o,!1)}}}var $u=!1;function Xp(r,o,c){if($u)return r(o,c);$u=!0;try{var f=r(o);return f}finally{if($u=!1,(Ys!==null||qs!==null)&&(Ol(),Ys&&(o=Ys,r=qs,qs=Ys=null,$p(o),r)))for(o=0;o<r.length;o++)$p(r[o])}}function la(r,o){var c=r.stateNode;if(c===null)return null;var f=c[Lt]||null;if(f===null)return null;c=f[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(r=r.type,f=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!f;break e;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(i(231,o,typeof c));return c}var Yn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Xu=!1;if(Yn)try{var ca={};Object.defineProperty(ca,"passive",{get:function(){Xu=!0}}),window.addEventListener("test",ca,ca),window.removeEventListener("test",ca,ca)}catch{Xu=!1}var _i=null,Yu=null,Xo=null;function Yp(){if(Xo)return Xo;var r,o=Yu,c=o.length,f,g="value"in _i?_i.value:_i.textContent,m=g.length;for(r=0;r<c&&o[r]===g[r];r++);var b=c-r;for(f=1;f<=b&&o[c-f]===g[m-f];f++);return Xo=g.slice(r,1<f?1-f:void 0)}function Yo(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function qo(){return!0}function qp(){return!1}function Ft(r){function o(c,f,g,m,b){this._reactName=c,this._targetInst=g,this.type=f,this.nativeEvent=m,this.target=b,this.currentTarget=null;for(var x in r)r.hasOwnProperty(x)&&(c=r[x],this[x]=c?c(m):m[x]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?qo:qp,this.isPropagationStopped=qp,this}return p(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=qo)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=qo)},persist:function(){},isPersistent:qo}),o}var ss={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ko=Ft(ss),ua=p({},ss,{view:0,detail:0}),VT=Ft(ua),qu,Ku,fa,Zo=p({},ua,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Qu,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==fa&&(fa&&r.type==="mousemove"?(qu=r.screenX-fa.screenX,Ku=r.screenY-fa.screenY):Ku=qu=0,fa=r),qu)},movementY:function(r){return"movementY"in r?r.movementY:Ku}}),Kp=Ft(Zo),zT=p({},Zo,{dataTransfer:0}),HT=Ft(zT),jT=p({},ua,{relatedTarget:0}),Zu=Ft(jT),WT=p({},ss,{animationName:0,elapsedTime:0,pseudoElement:0}),$T=Ft(WT),XT=p({},ss,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),YT=Ft(XT),qT=p({},ss,{data:0}),Zp=Ft(qT),KT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ZT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},QT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function GT(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=QT[r])?!!o[r]:!1}function Qu(){return GT}var JT=p({},ua,{key:function(r){if(r.key){var o=KT[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=Yo(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?ZT[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Qu,charCode:function(r){return r.type==="keypress"?Yo(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Yo(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),ex=Ft(JT),tx=p({},Zo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Qp=Ft(tx),nx=p({},ua,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Qu}),ix=Ft(nx),sx=p({},ss,{propertyName:0,elapsedTime:0,pseudoElement:0}),rx=Ft(sx),ax=p({},Zo,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),ox=Ft(ax),lx=p({},ss,{newState:0,oldState:0}),cx=Ft(lx),ux=[9,13,27,32],Gu=Yn&&"CompositionEvent"in window,ha=null;Yn&&"documentMode"in document&&(ha=document.documentMode);var fx=Yn&&"TextEvent"in window&&!ha,Gp=Yn&&(!Gu||ha&&8<ha&&11>=ha),Jp=" ",em=!1;function tm(r,o){switch(r){case"keyup":return ux.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function nm(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Ks=!1;function hx(r,o){switch(r){case"compositionend":return nm(o);case"keypress":return o.which!==32?null:(em=!0,Jp);case"textInput":return r=o.data,r===Jp&&em?null:r;default:return null}}function dx(r,o){if(Ks)return r==="compositionend"||!Gu&&tm(r,o)?(r=Yp(),Xo=Yu=_i=null,Ks=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return Gp&&o.locale!=="ko"?null:o.data;default:return null}}var gx={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function im(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!gx[r.type]:o==="textarea"}function sm(r,o,c,f){Ys?qs?qs.push(f):qs=[f]:Ys=f,o=Ul(o,"onChange"),0<o.length&&(c=new Ko("onChange","change",null,c,f),r.push({event:c,listeners:o}))}var da=null,ga=null;function px(r){Ly(r,0)}function Qo(r){var o=oa(r);if(Fp(o))return r}function rm(r,o){if(r==="change")return o}var am=!1;if(Yn){var Ju;if(Yn){var ef="oninput"in document;if(!ef){var om=document.createElement("div");om.setAttribute("oninput","return;"),ef=typeof om.oninput=="function"}Ju=ef}else Ju=!1;am=Ju&&(!document.documentMode||9<document.documentMode)}function lm(){da&&(da.detachEvent("onpropertychange",cm),ga=da=null)}function cm(r){if(r.propertyName==="value"&&Qo(ga)){var o=[];sm(o,ga,r,Wu(r)),Xp(px,o)}}function mx(r,o,c){r==="focusin"?(lm(),da=o,ga=c,da.attachEvent("onpropertychange",cm)):r==="focusout"&&lm()}function _x(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Qo(ga)}function yx(r,o){if(r==="click")return Qo(o)}function bx(r,o){if(r==="input"||r==="change")return Qo(o)}function vx(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var qt=typeof Object.is=="function"?Object.is:vx;function pa(r,o){if(qt(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var c=Object.keys(r),f=Object.keys(o);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var g=c[f];if(!es.call(o,g)||!qt(r[g],o[g]))return!1}return!0}function um(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function fm(r,o){var c=um(r);r=0;for(var f;c;){if(c.nodeType===3){if(f=r+c.textContent.length,r<=o&&f>=o)return{node:c,offset:o-r};r=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=um(c)}}function hm(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?hm(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function dm(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var o=Wo(r.document);o instanceof r.HTMLIFrameElement;){try{var c=typeof o.contentWindow.location.href=="string"}catch{c=!1}if(c)r=o.contentWindow;else break;o=Wo(r.document)}return o}function tf(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}var Tx=Yn&&"documentMode"in document&&11>=document.documentMode,Zs=null,nf=null,ma=null,sf=!1;function gm(r,o,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;sf||Zs==null||Zs!==Wo(f)||(f=Zs,"selectionStart"in f&&tf(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),ma&&pa(ma,f)||(ma=f,f=Ul(nf,"onSelect"),0<f.length&&(o=new Ko("onSelect","select",null,o,c),r.push({event:o,listeners:f}),o.target=Zs)))}function rs(r,o){var c={};return c[r.toLowerCase()]=o.toLowerCase(),c["Webkit"+r]="webkit"+o,c["Moz"+r]="moz"+o,c}var Qs={animationend:rs("Animation","AnimationEnd"),animationiteration:rs("Animation","AnimationIteration"),animationstart:rs("Animation","AnimationStart"),transitionrun:rs("Transition","TransitionRun"),transitionstart:rs("Transition","TransitionStart"),transitioncancel:rs("Transition","TransitionCancel"),transitionend:rs("Transition","TransitionEnd")},rf={},pm={};Yn&&(pm=document.createElement("div").style,"AnimationEvent"in window||(delete Qs.animationend.animation,delete Qs.animationiteration.animation,delete Qs.animationstart.animation),"TransitionEvent"in window||delete Qs.transitionend.transition);function as(r){if(rf[r])return rf[r];if(!Qs[r])return r;var o=Qs[r],c;for(c in o)if(o.hasOwnProperty(c)&&c in pm)return rf[r]=o[c];return r}var mm=as("animationend"),_m=as("animationiteration"),ym=as("animationstart"),xx=as("transitionrun"),Sx=as("transitionstart"),Ax=as("transitioncancel"),bm=as("transitionend"),vm=new Map,af="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");af.push("scrollEnd");function Tn(r,o){vm.set(r,o),is(o,[r])}var Tm=new WeakMap;function on(r,o){if(typeof r=="object"&&r!==null){var c=Tm.get(r);return c!==void 0?c:(o={value:r,source:o,stack:Bp(o)},Tm.set(r,o),o)}return{value:r,source:o,stack:Bp(o)}}var ln=[],Gs=0,of=0;function Go(){for(var r=Gs,o=of=Gs=0;o<r;){var c=ln[o];ln[o++]=null;var f=ln[o];ln[o++]=null;var g=ln[o];ln[o++]=null;var m=ln[o];if(ln[o++]=null,f!==null&&g!==null){var b=f.pending;b===null?g.next=g:(g.next=b.next,b.next=g),f.pending=g}m!==0&&xm(c,g,m)}}function Jo(r,o,c,f){ln[Gs++]=r,ln[Gs++]=o,ln[Gs++]=c,ln[Gs++]=f,of|=f,r.lanes|=f,r=r.alternate,r!==null&&(r.lanes|=f)}function lf(r,o,c,f){return Jo(r,o,c,f),el(r)}function Js(r,o){return Jo(r,null,null,o),el(r)}function xm(r,o,c){r.lanes|=c;var f=r.alternate;f!==null&&(f.lanes|=c);for(var g=!1,m=r.return;m!==null;)m.childLanes|=c,f=m.alternate,f!==null&&(f.childLanes|=c),m.tag===22&&(r=m.stateNode,r===null||r._visibility&1||(g=!0)),r=m,m=m.return;return r.tag===3?(m=r.stateNode,g&&o!==null&&(g=31-Yt(c),r=m.hiddenUpdates,f=r[g],f===null?r[g]=[o]:f.push(o),o.lane=c|536870912),m):null}function el(r){if(50<za)throw za=0,gh=null,Error(i(185));for(var o=r.return;o!==null;)r=o,o=r.return;return r.tag===3?r.stateNode:null}var er={};function wx(r,o,c,f){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kt(r,o,c,f){return new wx(r,o,c,f)}function cf(r){return r=r.prototype,!(!r||!r.isReactComponent)}function qn(r,o){var c=r.alternate;return c===null?(c=Kt(r.tag,o,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=o,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&65011712,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,o=r.dependencies,c.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c.refCleanup=r.refCleanup,c}function Sm(r,o){r.flags&=65011714;var c=r.alternate;return c===null?(r.childLanes=0,r.lanes=o,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=c.childLanes,r.lanes=c.lanes,r.child=c.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=c.memoizedProps,r.memoizedState=c.memoizedState,r.updateQueue=c.updateQueue,r.type=c.type,o=c.dependencies,r.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),r}function tl(r,o,c,f,g,m){var b=0;if(f=r,typeof r=="function")cf(r)&&(b=1);else if(typeof r=="string")b=RS(r,c,oe.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case ne:return r=Kt(31,c,o,g),r.elementType=ne,r.lanes=m,r;case A:return os(c.children,g,m,o);case R:b=8,g|=24;break;case C:return r=Kt(12,c,o,g|2),r.elementType=C,r.lanes=m,r;case L:return r=Kt(13,c,o,g),r.elementType=L,r.lanes=m,r;case X:return r=Kt(19,c,o,g),r.elementType=X,r.lanes=m,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case z:case M:b=10;break e;case H:b=9;break e;case k:b=11;break e;case ce:b=14;break e;case re:b=16,f=null;break e}b=29,c=Error(i(130,r===null?"null":typeof r,"")),f=null}return o=Kt(b,c,o,g),o.elementType=r,o.type=f,o.lanes=m,o}function os(r,o,c,f){return r=Kt(7,r,f,o),r.lanes=c,r}function uf(r,o,c){return r=Kt(6,r,null,o),r.lanes=c,r}function ff(r,o,c){return o=Kt(4,r.children!==null?r.children:[],r.key,o),o.lanes=c,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}var tr=[],nr=0,nl=null,il=0,cn=[],un=0,ls=null,Kn=1,Zn="";function cs(r,o){tr[nr++]=il,tr[nr++]=nl,nl=r,il=o}function Am(r,o,c){cn[un++]=Kn,cn[un++]=Zn,cn[un++]=ls,ls=r;var f=Kn;r=Zn;var g=32-Yt(f)-1;f&=~(1<<g),c+=1;var m=32-Yt(o)+g;if(30<m){var b=g-g%5;m=(f&(1<<b)-1).toString(32),f>>=b,g-=b,Kn=1<<32-Yt(o)+g|c<<g|f,Zn=m+r}else Kn=1<<m|c<<g|f,Zn=r}function hf(r){r.return!==null&&(cs(r,1),Am(r,1,0))}function df(r){for(;r===nl;)nl=tr[--nr],tr[nr]=null,il=tr[--nr],tr[nr]=null;for(;r===ls;)ls=cn[--un],cn[un]=null,Zn=cn[--un],cn[un]=null,Kn=cn[--un],cn[un]=null}var Ut=null,tt=null,ke=!1,us=null,On=!1,gf=Error(i(519));function fs(r){var o=Error(i(418,""));throw ba(on(o,r)),gf}function wm(r){var o=r.stateNode,c=r.type,f=r.memoizedProps;switch(o[Ct]=r,o[Lt]=f,c){case"dialog":Oe("cancel",o),Oe("close",o);break;case"iframe":case"object":case"embed":Oe("load",o);break;case"video":case"audio":for(c=0;c<ja.length;c++)Oe(ja[c],o);break;case"source":Oe("error",o);break;case"img":case"image":case"link":Oe("error",o),Oe("load",o);break;case"details":Oe("toggle",o);break;case"input":Oe("invalid",o),Vp(o,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0),jo(o);break;case"select":Oe("invalid",o);break;case"textarea":Oe("invalid",o),Hp(o,f.value,f.defaultValue,f.children),jo(o)}c=f.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||o.textContent===""+c||f.suppressHydrationWarning===!0||Hy(o.textContent,c)?(f.popover!=null&&(Oe("beforetoggle",o),Oe("toggle",o)),f.onScroll!=null&&Oe("scroll",o),f.onScrollEnd!=null&&Oe("scrollend",o),f.onClick!=null&&(o.onclick=Bl),o=!0):o=!1,o||fs(r)}function Em(r){for(Ut=r.return;Ut;)switch(Ut.tag){case 5:case 13:On=!1;return;case 27:case 3:On=!0;return;default:Ut=Ut.return}}function _a(r){if(r!==Ut)return!1;if(!ke)return Em(r),ke=!0,!1;var o=r.tag,c;if((c=o!==3&&o!==27)&&((c=o===5)&&(c=r.type,c=!(c!=="form"&&c!=="button")||Oh(r.type,r.memoizedProps)),c=!c),c&&tt&&fs(r),Em(r),o===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));e:{for(r=r.nextSibling,o=0;r;){if(r.nodeType===8)if(c=r.data,c==="/$"){if(o===0){tt=Sn(r.nextSibling);break e}o--}else c!=="$"&&c!=="$!"&&c!=="$?"||o++;r=r.nextSibling}tt=null}}else o===27?(o=tt,Pi(r.type)?(r=Dh,Dh=null,tt=r):tt=o):tt=Ut?Sn(r.stateNode.nextSibling):null;return!0}function ya(){tt=Ut=null,ke=!1}function Rm(){var r=us;return r!==null&&(Ht===null?Ht=r:Ht.push.apply(Ht,r),us=null),r}function ba(r){us===null?us=[r]:us.push(r)}var pf=G(null),hs=null,Qn=null;function yi(r,o,c){ae(pf,o._currentValue),o._currentValue=c}function Gn(r){r._currentValue=pf.current,le(pf)}function mf(r,o,c){for(;r!==null;){var f=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),r===c)break;r=r.return}}function _f(r,o,c,f){var g=r.child;for(g!==null&&(g.return=r);g!==null;){var m=g.dependencies;if(m!==null){var b=g.child;m=m.firstContext;e:for(;m!==null;){var x=m;m=g;for(var E=0;E<o.length;E++)if(x.context===o[E]){m.lanes|=c,x=m.alternate,x!==null&&(x.lanes|=c),mf(m.return,c,r),f||(b=null);break e}m=x.next}}else if(g.tag===18){if(b=g.return,b===null)throw Error(i(341));b.lanes|=c,m=b.alternate,m!==null&&(m.lanes|=c),mf(b,c,r),b=null}else b=g.child;if(b!==null)b.return=g;else for(b=g;b!==null;){if(b===r){b=null;break}if(g=b.sibling,g!==null){g.return=b.return,b=g;break}b=b.return}g=b}}function va(r,o,c,f){r=null;for(var g=o,m=!1;g!==null;){if(!m){if((g.flags&524288)!==0)m=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var b=g.alternate;if(b===null)throw Error(i(387));if(b=b.memoizedProps,b!==null){var x=g.type;qt(g.pendingProps.value,b.value)||(r!==null?r.push(x):r=[x])}}else if(g===Je.current){if(b=g.alternate,b===null)throw Error(i(387));b.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(r!==null?r.push(Ka):r=[Ka])}g=g.return}r!==null&&_f(o,r,c,f),o.flags|=262144}function sl(r){for(r=r.firstContext;r!==null;){if(!qt(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function ds(r){hs=r,Qn=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Mt(r){return Cm(hs,r)}function rl(r,o){return hs===null&&ds(r),Cm(r,o)}function Cm(r,o){var c=o._currentValue;if(o={context:o,memoizedValue:c,next:null},Qn===null){if(r===null)throw Error(i(308));Qn=o,r.dependencies={lanes:0,firstContext:o},r.flags|=524288}else Qn=Qn.next=o;return c}var Ex=typeof AbortController<"u"?AbortController:function(){var r=[],o=this.signal={aborted:!1,addEventListener:function(c,f){r.push(f)}};this.abort=function(){o.aborted=!0,r.forEach(function(c){return c()})}},Rx=n.unstable_scheduleCallback,Cx=n.unstable_NormalPriority,dt={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function yf(){return{controller:new Ex,data:new Map,refCount:0}}function Ta(r){r.refCount--,r.refCount===0&&Rx(Cx,function(){r.controller.abort()})}var xa=null,bf=0,ir=0,sr=null;function Mx(r,o){if(xa===null){var c=xa=[];bf=0,ir=Th(),sr={status:"pending",value:void 0,then:function(f){c.push(f)}}}return bf++,o.then(Mm,Mm),o}function Mm(){if(--bf===0&&xa!==null){sr!==null&&(sr.status="fulfilled");var r=xa;xa=null,ir=0,sr=null;for(var o=0;o<r.length;o++)(0,r[o])()}}function Ox(r,o){var c=[],f={status:"pending",value:null,reason:null,then:function(g){c.push(g)}};return r.then(function(){f.status="fulfilled",f.value=o;for(var g=0;g<c.length;g++)(0,c[g])(o)},function(g){for(f.status="rejected",f.reason=g,g=0;g<c.length;g++)(0,c[g])(void 0)}),f}var Om=Y.S;Y.S=function(r,o){typeof o=="object"&&o!==null&&typeof o.then=="function"&&Mx(r,o),Om!==null&&Om(r,o)};var gs=G(null);function vf(){var r=gs.current;return r!==null?r:Ke.pooledCache}function al(r,o){o===null?ae(gs,gs.current):ae(gs,o.pool)}function Im(){var r=vf();return r===null?null:{parent:dt._currentValue,pool:r}}var Sa=Error(i(460)),Nm=Error(i(474)),ol=Error(i(542)),Tf={then:function(){}};function Pm(r){return r=r.status,r==="fulfilled"||r==="rejected"}function ll(){}function Dm(r,o,c){switch(c=r[c],c===void 0?r.push(o):c!==o&&(o.then(ll,ll),o=c),o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,Um(r),r;default:if(typeof o.status=="string")o.then(ll,ll);else{if(r=Ke,r!==null&&100<r.shellSuspendCounter)throw Error(i(482));r=o,r.status="pending",r.then(function(f){if(o.status==="pending"){var g=o;g.status="fulfilled",g.value=f}},function(f){if(o.status==="pending"){var g=o;g.status="rejected",g.reason=f}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,Um(r),r}throw Aa=o,Sa}}var Aa=null;function km(){if(Aa===null)throw Error(i(459));var r=Aa;return Aa=null,r}function Um(r){if(r===Sa||r===ol)throw Error(i(483))}var bi=!1;function xf(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Sf(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function vi(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Ti(r,o,c){var f=r.updateQueue;if(f===null)return null;if(f=f.shared,(Ve&2)!==0){var g=f.pending;return g===null?o.next=o:(o.next=g.next,g.next=o),f.pending=o,o=el(r),xm(r,null,c),o}return Jo(r,f,o,c),el(r)}function wa(r,o,c){if(o=o.updateQueue,o!==null&&(o=o.shared,(c&4194048)!==0)){var f=o.lanes;f&=r.pendingLanes,c|=f,o.lanes=c,Mp(r,c)}}function Af(r,o){var c=r.updateQueue,f=r.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var g=null,m=null;if(c=c.firstBaseUpdate,c!==null){do{var b={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};m===null?g=m=b:m=m.next=b,c=c.next}while(c!==null);m===null?g=m=o:m=m.next=o}else g=m=o;c={baseState:f.baseState,firstBaseUpdate:g,lastBaseUpdate:m,shared:f.shared,callbacks:f.callbacks},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=o:r.next=o,c.lastBaseUpdate=o}var wf=!1;function Ea(){if(wf){var r=sr;if(r!==null)throw r}}function Ra(r,o,c,f){wf=!1;var g=r.updateQueue;bi=!1;var m=g.firstBaseUpdate,b=g.lastBaseUpdate,x=g.shared.pending;if(x!==null){g.shared.pending=null;var E=x,j=E.next;E.next=null,b===null?m=j:b.next=j,b=E;var q=r.alternate;q!==null&&(q=q.updateQueue,x=q.lastBaseUpdate,x!==b&&(x===null?q.firstBaseUpdate=j:x.next=j,q.lastBaseUpdate=E))}if(m!==null){var Q=g.baseState;b=0,q=j=E=null,x=m;do{var W=x.lane&-536870913,$=W!==x.lane;if($?(Ne&W)===W:(f&W)===W){W!==0&&W===ir&&(wf=!0),q!==null&&(q=q.next={lane:0,tag:x.tag,payload:x.payload,callback:null,next:null});e:{var Te=r,ye=x;W=o;var We=c;switch(ye.tag){case 1:if(Te=ye.payload,typeof Te=="function"){Q=Te.call(We,Q,W);break e}Q=Te;break e;case 3:Te.flags=Te.flags&-65537|128;case 0:if(Te=ye.payload,W=typeof Te=="function"?Te.call(We,Q,W):Te,W==null)break e;Q=p({},Q,W);break e;case 2:bi=!0}}W=x.callback,W!==null&&(r.flags|=64,$&&(r.flags|=8192),$=g.callbacks,$===null?g.callbacks=[W]:$.push(W))}else $={lane:W,tag:x.tag,payload:x.payload,callback:x.callback,next:null},q===null?(j=q=$,E=Q):q=q.next=$,b|=W;if(x=x.next,x===null){if(x=g.shared.pending,x===null)break;$=x,x=$.next,$.next=null,g.lastBaseUpdate=$,g.shared.pending=null}}while(!0);q===null&&(E=Q),g.baseState=E,g.firstBaseUpdate=j,g.lastBaseUpdate=q,m===null&&(g.shared.lanes=0),Mi|=b,r.lanes=b,r.memoizedState=Q}}function Bm(r,o){if(typeof r!="function")throw Error(i(191,r));r.call(o)}function Lm(r,o){var c=r.callbacks;if(c!==null)for(r.callbacks=null,r=0;r<c.length;r++)Bm(c[r],o)}var rr=G(null),cl=G(0);function Fm(r,o){r=ri,ae(cl,r),ae(rr,o),ri=r|o.baseLanes}function Ef(){ae(cl,ri),ae(rr,rr.current)}function Rf(){ri=cl.current,le(rr),le(cl)}var xi=0,Re=null,He=null,lt=null,ul=!1,ar=!1,ps=!1,fl=0,Ca=0,or=null,Ix=0;function at(){throw Error(i(321))}function Cf(r,o){if(o===null)return!1;for(var c=0;c<o.length&&c<r.length;c++)if(!qt(r[c],o[c]))return!1;return!0}function Mf(r,o,c,f,g,m){return xi=m,Re=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Y.H=r===null||r.memoizedState===null?x_:S_,ps=!1,m=c(f,g),ps=!1,ar&&(m=zm(o,c,f,g)),Vm(r),m}function Vm(r){Y.H=_l;var o=He!==null&&He.next!==null;if(xi=0,lt=He=Re=null,ul=!1,Ca=0,or=null,o)throw Error(i(300));r===null||bt||(r=r.dependencies,r!==null&&sl(r)&&(bt=!0))}function zm(r,o,c,f){Re=r;var g=0;do{if(ar&&(or=null),Ca=0,ar=!1,25<=g)throw Error(i(301));if(g+=1,lt=He=null,r.updateQueue!=null){var m=r.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}Y.H=Lx,m=o(c,f)}while(ar);return m}function Nx(){var r=Y.H,o=r.useState()[0];return o=typeof o.then=="function"?Ma(o):o,r=r.useState()[0],(He!==null?He.memoizedState:null)!==r&&(Re.flags|=1024),o}function Of(){var r=fl!==0;return fl=0,r}function If(r,o,c){o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~c}function Nf(r){if(ul){for(r=r.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}ul=!1}xi=0,lt=He=Re=null,ar=!1,Ca=fl=0,or=null}function Vt(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return lt===null?Re.memoizedState=lt=r:lt=lt.next=r,lt}function ct(){if(He===null){var r=Re.alternate;r=r!==null?r.memoizedState:null}else r=He.next;var o=lt===null?Re.memoizedState:lt.next;if(o!==null)lt=o,He=r;else{if(r===null)throw Re.alternate===null?Error(i(467)):Error(i(310));He=r,r={memoizedState:He.memoizedState,baseState:He.baseState,baseQueue:He.baseQueue,queue:He.queue,next:null},lt===null?Re.memoizedState=lt=r:lt=lt.next=r}return lt}function Pf(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ma(r){var o=Ca;return Ca+=1,or===null&&(or=[]),r=Dm(or,r,o),o=Re,(lt===null?o.memoizedState:lt.next)===null&&(o=o.alternate,Y.H=o===null||o.memoizedState===null?x_:S_),r}function hl(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Ma(r);if(r.$$typeof===M)return Mt(r)}throw Error(i(438,String(r)))}function Df(r){var o=null,c=Re.updateQueue;if(c!==null&&(o=c.memoCache),o==null){var f=Re.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(o={data:f.data.map(function(g){return g.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),c===null&&(c=Pf(),Re.updateQueue=c),c.memoCache=o,c=o.data[o.index],c===void 0)for(c=o.data[o.index]=Array(r),f=0;f<r;f++)c[f]=he;return o.index++,c}function Jn(r,o){return typeof o=="function"?o(r):o}function dl(r){var o=ct();return kf(o,He,r)}function kf(r,o,c){var f=r.queue;if(f===null)throw Error(i(311));f.lastRenderedReducer=c;var g=r.baseQueue,m=f.pending;if(m!==null){if(g!==null){var b=g.next;g.next=m.next,m.next=b}o.baseQueue=g=m,f.pending=null}if(m=r.baseState,g===null)r.memoizedState=m;else{o=g.next;var x=b=null,E=null,j=o,q=!1;do{var Q=j.lane&-536870913;if(Q!==j.lane?(Ne&Q)===Q:(xi&Q)===Q){var W=j.revertLane;if(W===0)E!==null&&(E=E.next={lane:0,revertLane:0,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null}),Q===ir&&(q=!0);else if((xi&W)===W){j=j.next,W===ir&&(q=!0);continue}else Q={lane:0,revertLane:j.revertLane,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null},E===null?(x=E=Q,b=m):E=E.next=Q,Re.lanes|=W,Mi|=W;Q=j.action,ps&&c(m,Q),m=j.hasEagerState?j.eagerState:c(m,Q)}else W={lane:Q,revertLane:j.revertLane,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null},E===null?(x=E=W,b=m):E=E.next=W,Re.lanes|=Q,Mi|=Q;j=j.next}while(j!==null&&j!==o);if(E===null?b=m:E.next=x,!qt(m,r.memoizedState)&&(bt=!0,q&&(c=sr,c!==null)))throw c;r.memoizedState=m,r.baseState=b,r.baseQueue=E,f.lastRenderedState=m}return g===null&&(f.lanes=0),[r.memoizedState,f.dispatch]}function Uf(r){var o=ct(),c=o.queue;if(c===null)throw Error(i(311));c.lastRenderedReducer=r;var f=c.dispatch,g=c.pending,m=o.memoizedState;if(g!==null){c.pending=null;var b=g=g.next;do m=r(m,b.action),b=b.next;while(b!==g);qt(m,o.memoizedState)||(bt=!0),o.memoizedState=m,o.baseQueue===null&&(o.baseState=m),c.lastRenderedState=m}return[m,f]}function Hm(r,o,c){var f=Re,g=ct(),m=ke;if(m){if(c===void 0)throw Error(i(407));c=c()}else c=o();var b=!qt((He||g).memoizedState,c);b&&(g.memoizedState=c,bt=!0),g=g.queue;var x=$m.bind(null,f,g,r);if(Oa(2048,8,x,[r]),g.getSnapshot!==o||b||lt!==null&&lt.memoizedState.tag&1){if(f.flags|=2048,lr(9,gl(),Wm.bind(null,f,g,c,o),null),Ke===null)throw Error(i(349));m||(xi&124)!==0||jm(f,o,c)}return c}function jm(r,o,c){r.flags|=16384,r={getSnapshot:o,value:c},o=Re.updateQueue,o===null?(o=Pf(),Re.updateQueue=o,o.stores=[r]):(c=o.stores,c===null?o.stores=[r]:c.push(r))}function Wm(r,o,c,f){o.value=c,o.getSnapshot=f,Xm(o)&&Ym(r)}function $m(r,o,c){return c(function(){Xm(o)&&Ym(r)})}function Xm(r){var o=r.getSnapshot;r=r.value;try{var c=o();return!qt(r,c)}catch{return!0}}function Ym(r){var o=Js(r,2);o!==null&&en(o,r,2)}function Bf(r){var o=Vt();if(typeof r=="function"){var c=r;if(r=c(),ps){pi(!0);try{c()}finally{pi(!1)}}}return o.memoizedState=o.baseState=r,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jn,lastRenderedState:r},o}function qm(r,o,c,f){return r.baseState=c,kf(r,He,typeof f=="function"?f:Jn)}function Px(r,o,c,f,g){if(ml(r))throw Error(i(485));if(r=o.action,r!==null){var m={payload:g,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){m.listeners.push(b)}};Y.T!==null?c(!0):m.isTransition=!1,f(m),c=o.pending,c===null?(m.next=o.pending=m,Km(o,m)):(m.next=c.next,o.pending=c.next=m)}}function Km(r,o){var c=o.action,f=o.payload,g=r.state;if(o.isTransition){var m=Y.T,b={};Y.T=b;try{var x=c(g,f),E=Y.S;E!==null&&E(b,x),Zm(r,o,x)}catch(j){Lf(r,o,j)}finally{Y.T=m}}else try{m=c(g,f),Zm(r,o,m)}catch(j){Lf(r,o,j)}}function Zm(r,o,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(f){Qm(r,o,f)},function(f){return Lf(r,o,f)}):Qm(r,o,c)}function Qm(r,o,c){o.status="fulfilled",o.value=c,Gm(o),r.state=c,o=r.pending,o!==null&&(c=o.next,c===o?r.pending=null:(c=c.next,o.next=c,Km(r,c)))}function Lf(r,o,c){var f=r.pending;if(r.pending=null,f!==null){f=f.next;do o.status="rejected",o.reason=c,Gm(o),o=o.next;while(o!==f)}r.action=null}function Gm(r){r=r.listeners;for(var o=0;o<r.length;o++)(0,r[o])()}function Jm(r,o){return o}function e_(r,o){if(ke){var c=Ke.formState;if(c!==null){e:{var f=Re;if(ke){if(tt){t:{for(var g=tt,m=On;g.nodeType!==8;){if(!m){g=null;break t}if(g=Sn(g.nextSibling),g===null){g=null;break t}}m=g.data,g=m==="F!"||m==="F"?g:null}if(g){tt=Sn(g.nextSibling),f=g.data==="F!";break e}}fs(f)}f=!1}f&&(o=c[0])}}return c=Vt(),c.memoizedState=c.baseState=o,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jm,lastRenderedState:o},c.queue=f,c=b_.bind(null,Re,f),f.dispatch=c,f=Bf(!1),m=jf.bind(null,Re,!1,f.queue),f=Vt(),g={state:o,dispatch:null,action:r,pending:null},f.queue=g,c=Px.bind(null,Re,g,m,c),g.dispatch=c,f.memoizedState=r,[o,c,!1]}function t_(r){var o=ct();return n_(o,He,r)}function n_(r,o,c){if(o=kf(r,o,Jm)[0],r=dl(Jn)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var f=Ma(o)}catch(b){throw b===Sa?ol:b}else f=o;o=ct();var g=o.queue,m=g.dispatch;return c!==o.memoizedState&&(Re.flags|=2048,lr(9,gl(),Dx.bind(null,g,c),null)),[f,m,r]}function Dx(r,o){r.action=o}function i_(r){var o=ct(),c=He;if(c!==null)return n_(o,c,r);ct(),o=o.memoizedState,c=ct();var f=c.queue.dispatch;return c.memoizedState=r,[o,f,!1]}function lr(r,o,c,f){return r={tag:r,create:c,deps:f,inst:o,next:null},o=Re.updateQueue,o===null&&(o=Pf(),Re.updateQueue=o),c=o.lastEffect,c===null?o.lastEffect=r.next=r:(f=c.next,c.next=r,r.next=f,o.lastEffect=r),r}function gl(){return{destroy:void 0,resource:void 0}}function s_(){return ct().memoizedState}function pl(r,o,c,f){var g=Vt();f=f===void 0?null:f,Re.flags|=r,g.memoizedState=lr(1|o,gl(),c,f)}function Oa(r,o,c,f){var g=ct();f=f===void 0?null:f;var m=g.memoizedState.inst;He!==null&&f!==null&&Cf(f,He.memoizedState.deps)?g.memoizedState=lr(o,m,c,f):(Re.flags|=r,g.memoizedState=lr(1|o,m,c,f))}function r_(r,o){pl(8390656,8,r,o)}function a_(r,o){Oa(2048,8,r,o)}function o_(r,o){return Oa(4,2,r,o)}function l_(r,o){return Oa(4,4,r,o)}function c_(r,o){if(typeof o=="function"){r=r();var c=o(r);return function(){typeof c=="function"?c():o(null)}}if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function u_(r,o,c){c=c!=null?c.concat([r]):null,Oa(4,4,c_.bind(null,o,r),c)}function Ff(){}function f_(r,o){var c=ct();o=o===void 0?null:o;var f=c.memoizedState;return o!==null&&Cf(o,f[1])?f[0]:(c.memoizedState=[r,o],r)}function h_(r,o){var c=ct();o=o===void 0?null:o;var f=c.memoizedState;if(o!==null&&Cf(o,f[1]))return f[0];if(f=r(),ps){pi(!0);try{r()}finally{pi(!1)}}return c.memoizedState=[f,o],f}function Vf(r,o,c){return c===void 0||(xi&1073741824)!==0?r.memoizedState=o:(r.memoizedState=c,r=py(),Re.lanes|=r,Mi|=r,c)}function d_(r,o,c,f){return qt(c,o)?c:rr.current!==null?(r=Vf(r,c,f),qt(r,o)||(bt=!0),r):(xi&42)===0?(bt=!0,r.memoizedState=c):(r=py(),Re.lanes|=r,Mi|=r,o)}function g_(r,o,c,f,g){var m=ie.p;ie.p=m!==0&&8>m?m:8;var b=Y.T,x={};Y.T=x,jf(r,!1,o,c);try{var E=g(),j=Y.S;if(j!==null&&j(x,E),E!==null&&typeof E=="object"&&typeof E.then=="function"){var q=Ox(E,f);Ia(r,o,q,Jt(r))}else Ia(r,o,f,Jt(r))}catch(Q){Ia(r,o,{then:function(){},status:"rejected",reason:Q},Jt())}finally{ie.p=m,Y.T=b}}function kx(){}function zf(r,o,c,f){if(r.tag!==5)throw Error(i(476));var g=p_(r).queue;g_(r,g,o,de,c===null?kx:function(){return m_(r),c(f)})}function p_(r){var o=r.memoizedState;if(o!==null)return o;o={memoizedState:de,baseState:de,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jn,lastRenderedState:de},next:null};var c={};return o.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Jn,lastRenderedState:c},next:null},r.memoizedState=o,r=r.alternate,r!==null&&(r.memoizedState=o),o}function m_(r){var o=p_(r).next.queue;Ia(r,o,{},Jt())}function Hf(){return Mt(Ka)}function __(){return ct().memoizedState}function y_(){return ct().memoizedState}function Ux(r){for(var o=r.return;o!==null;){switch(o.tag){case 24:case 3:var c=Jt();r=vi(c);var f=Ti(o,r,c);f!==null&&(en(f,o,c),wa(f,o,c)),o={cache:yf()},r.payload=o;return}o=o.return}}function Bx(r,o,c){var f=Jt();c={lane:f,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null},ml(r)?v_(o,c):(c=lf(r,o,c,f),c!==null&&(en(c,r,f),T_(c,o,f)))}function b_(r,o,c){var f=Jt();Ia(r,o,c,f)}function Ia(r,o,c,f){var g={lane:f,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null};if(ml(r))v_(o,g);else{var m=r.alternate;if(r.lanes===0&&(m===null||m.lanes===0)&&(m=o.lastRenderedReducer,m!==null))try{var b=o.lastRenderedState,x=m(b,c);if(g.hasEagerState=!0,g.eagerState=x,qt(x,b))return Jo(r,o,g,0),Ke===null&&Go(),!1}catch{}finally{}if(c=lf(r,o,g,f),c!==null)return en(c,r,f),T_(c,o,f),!0}return!1}function jf(r,o,c,f){if(f={lane:2,revertLane:Th(),action:f,hasEagerState:!1,eagerState:null,next:null},ml(r)){if(o)throw Error(i(479))}else o=lf(r,c,f,2),o!==null&&en(o,r,2)}function ml(r){var o=r.alternate;return r===Re||o!==null&&o===Re}function v_(r,o){ar=ul=!0;var c=r.pending;c===null?o.next=o:(o.next=c.next,c.next=o),r.pending=o}function T_(r,o,c){if((c&4194048)!==0){var f=o.lanes;f&=r.pendingLanes,c|=f,o.lanes=c,Mp(r,c)}}var _l={readContext:Mt,use:hl,useCallback:at,useContext:at,useEffect:at,useImperativeHandle:at,useLayoutEffect:at,useInsertionEffect:at,useMemo:at,useReducer:at,useRef:at,useState:at,useDebugValue:at,useDeferredValue:at,useTransition:at,useSyncExternalStore:at,useId:at,useHostTransitionStatus:at,useFormState:at,useActionState:at,useOptimistic:at,useMemoCache:at,useCacheRefresh:at},x_={readContext:Mt,use:hl,useCallback:function(r,o){return Vt().memoizedState=[r,o===void 0?null:o],r},useContext:Mt,useEffect:r_,useImperativeHandle:function(r,o,c){c=c!=null?c.concat([r]):null,pl(4194308,4,c_.bind(null,o,r),c)},useLayoutEffect:function(r,o){return pl(4194308,4,r,o)},useInsertionEffect:function(r,o){pl(4,2,r,o)},useMemo:function(r,o){var c=Vt();o=o===void 0?null:o;var f=r();if(ps){pi(!0);try{r()}finally{pi(!1)}}return c.memoizedState=[f,o],f},useReducer:function(r,o,c){var f=Vt();if(c!==void 0){var g=c(o);if(ps){pi(!0);try{c(o)}finally{pi(!1)}}}else g=o;return f.memoizedState=f.baseState=g,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:g},f.queue=r,r=r.dispatch=Bx.bind(null,Re,r),[f.memoizedState,r]},useRef:function(r){var o=Vt();return r={current:r},o.memoizedState=r},useState:function(r){r=Bf(r);var o=r.queue,c=b_.bind(null,Re,o);return o.dispatch=c,[r.memoizedState,c]},useDebugValue:Ff,useDeferredValue:function(r,o){var c=Vt();return Vf(c,r,o)},useTransition:function(){var r=Bf(!1);return r=g_.bind(null,Re,r.queue,!0,!1),Vt().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,o,c){var f=Re,g=Vt();if(ke){if(c===void 0)throw Error(i(407));c=c()}else{if(c=o(),Ke===null)throw Error(i(349));(Ne&124)!==0||jm(f,o,c)}g.memoizedState=c;var m={value:c,getSnapshot:o};return g.queue=m,r_($m.bind(null,f,m,r),[r]),f.flags|=2048,lr(9,gl(),Wm.bind(null,f,m,c,o),null),c},useId:function(){var r=Vt(),o=Ke.identifierPrefix;if(ke){var c=Zn,f=Kn;c=(f&~(1<<32-Yt(f)-1)).toString(32)+c,o=""+o+"R"+c,c=fl++,0<c&&(o+="H"+c.toString(32)),o+=""}else c=Ix++,o=""+o+"r"+c.toString(32)+"";return r.memoizedState=o},useHostTransitionStatus:Hf,useFormState:e_,useActionState:e_,useOptimistic:function(r){var o=Vt();o.memoizedState=o.baseState=r;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=c,o=jf.bind(null,Re,!0,c),c.dispatch=o,[r,o]},useMemoCache:Df,useCacheRefresh:function(){return Vt().memoizedState=Ux.bind(null,Re)}},S_={readContext:Mt,use:hl,useCallback:f_,useContext:Mt,useEffect:a_,useImperativeHandle:u_,useInsertionEffect:o_,useLayoutEffect:l_,useMemo:h_,useReducer:dl,useRef:s_,useState:function(){return dl(Jn)},useDebugValue:Ff,useDeferredValue:function(r,o){var c=ct();return d_(c,He.memoizedState,r,o)},useTransition:function(){var r=dl(Jn)[0],o=ct().memoizedState;return[typeof r=="boolean"?r:Ma(r),o]},useSyncExternalStore:Hm,useId:__,useHostTransitionStatus:Hf,useFormState:t_,useActionState:t_,useOptimistic:function(r,o){var c=ct();return qm(c,He,r,o)},useMemoCache:Df,useCacheRefresh:y_},Lx={readContext:Mt,use:hl,useCallback:f_,useContext:Mt,useEffect:a_,useImperativeHandle:u_,useInsertionEffect:o_,useLayoutEffect:l_,useMemo:h_,useReducer:Uf,useRef:s_,useState:function(){return Uf(Jn)},useDebugValue:Ff,useDeferredValue:function(r,o){var c=ct();return He===null?Vf(c,r,o):d_(c,He.memoizedState,r,o)},useTransition:function(){var r=Uf(Jn)[0],o=ct().memoizedState;return[typeof r=="boolean"?r:Ma(r),o]},useSyncExternalStore:Hm,useId:__,useHostTransitionStatus:Hf,useFormState:i_,useActionState:i_,useOptimistic:function(r,o){var c=ct();return He!==null?qm(c,He,r,o):(c.baseState=r,[r,c.queue.dispatch])},useMemoCache:Df,useCacheRefresh:y_},cr=null,Na=0;function yl(r){var o=Na;return Na+=1,cr===null&&(cr=[]),Dm(cr,r,o)}function Pa(r,o){o=o.props.ref,r.ref=o!==void 0?o:null}function bl(r,o){throw o.$$typeof===_?Error(i(525)):(r=Object.prototype.toString.call(o),Error(i(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r)))}function A_(r){var o=r._init;return o(r._payload)}function w_(r){function o(U,I){if(r){var V=U.deletions;V===null?(U.deletions=[I],U.flags|=16):V.push(I)}}function c(U,I){if(!r)return null;for(;I!==null;)o(U,I),I=I.sibling;return null}function f(U){for(var I=new Map;U!==null;)U.key!==null?I.set(U.key,U):I.set(U.index,U),U=U.sibling;return I}function g(U,I){return U=qn(U,I),U.index=0,U.sibling=null,U}function m(U,I,V){return U.index=V,r?(V=U.alternate,V!==null?(V=V.index,V<I?(U.flags|=67108866,I):V):(U.flags|=67108866,I)):(U.flags|=1048576,I)}function b(U){return r&&U.alternate===null&&(U.flags|=67108866),U}function x(U,I,V,K){return I===null||I.tag!==6?(I=uf(V,U.mode,K),I.return=U,I):(I=g(I,V),I.return=U,I)}function E(U,I,V,K){var ue=V.type;return ue===A?q(U,I,V.props.children,K,V.key):I!==null&&(I.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===re&&A_(ue)===I.type)?(I=g(I,V.props),Pa(I,V),I.return=U,I):(I=tl(V.type,V.key,V.props,null,U.mode,K),Pa(I,V),I.return=U,I)}function j(U,I,V,K){return I===null||I.tag!==4||I.stateNode.containerInfo!==V.containerInfo||I.stateNode.implementation!==V.implementation?(I=ff(V,U.mode,K),I.return=U,I):(I=g(I,V.children||[]),I.return=U,I)}function q(U,I,V,K,ue){return I===null||I.tag!==7?(I=os(V,U.mode,K,ue),I.return=U,I):(I=g(I,V),I.return=U,I)}function Q(U,I,V){if(typeof I=="string"&&I!==""||typeof I=="number"||typeof I=="bigint")return I=uf(""+I,U.mode,V),I.return=U,I;if(typeof I=="object"&&I!==null){switch(I.$$typeof){case y:return V=tl(I.type,I.key,I.props,null,U.mode,V),Pa(V,I),V.return=U,V;case v:return I=ff(I,U.mode,V),I.return=U,I;case re:var K=I._init;return I=K(I._payload),Q(U,I,V)}if(Be(I)||me(I))return I=os(I,U.mode,V,null),I.return=U,I;if(typeof I.then=="function")return Q(U,yl(I),V);if(I.$$typeof===M)return Q(U,rl(U,I),V);bl(U,I)}return null}function W(U,I,V,K){var ue=I!==null?I.key:null;if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return ue!==null?null:x(U,I,""+V,K);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case y:return V.key===ue?E(U,I,V,K):null;case v:return V.key===ue?j(U,I,V,K):null;case re:return ue=V._init,V=ue(V._payload),W(U,I,V,K)}if(Be(V)||me(V))return ue!==null?null:q(U,I,V,K,null);if(typeof V.then=="function")return W(U,I,yl(V),K);if(V.$$typeof===M)return W(U,I,rl(U,V),K);bl(U,V)}return null}function $(U,I,V,K,ue){if(typeof K=="string"&&K!==""||typeof K=="number"||typeof K=="bigint")return U=U.get(V)||null,x(I,U,""+K,ue);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case y:return U=U.get(K.key===null?V:K.key)||null,E(I,U,K,ue);case v:return U=U.get(K.key===null?V:K.key)||null,j(I,U,K,ue);case re:var Ce=K._init;return K=Ce(K._payload),$(U,I,V,K,ue)}if(Be(K)||me(K))return U=U.get(V)||null,q(I,U,K,ue,null);if(typeof K.then=="function")return $(U,I,V,yl(K),ue);if(K.$$typeof===M)return $(U,I,V,rl(I,K),ue);bl(I,K)}return null}function Te(U,I,V,K){for(var ue=null,Ce=null,pe=I,be=I=0,Tt=null;pe!==null&&be<V.length;be++){pe.index>be?(Tt=pe,pe=null):Tt=pe.sibling;var Pe=W(U,pe,V[be],K);if(Pe===null){pe===null&&(pe=Tt);break}r&&pe&&Pe.alternate===null&&o(U,pe),I=m(Pe,I,be),Ce===null?ue=Pe:Ce.sibling=Pe,Ce=Pe,pe=Tt}if(be===V.length)return c(U,pe),ke&&cs(U,be),ue;if(pe===null){for(;be<V.length;be++)pe=Q(U,V[be],K),pe!==null&&(I=m(pe,I,be),Ce===null?ue=pe:Ce.sibling=pe,Ce=pe);return ke&&cs(U,be),ue}for(pe=f(pe);be<V.length;be++)Tt=$(pe,U,be,V[be],K),Tt!==null&&(r&&Tt.alternate!==null&&pe.delete(Tt.key===null?be:Tt.key),I=m(Tt,I,be),Ce===null?ue=Tt:Ce.sibling=Tt,Ce=Tt);return r&&pe.forEach(function(Li){return o(U,Li)}),ke&&cs(U,be),ue}function ye(U,I,V,K){if(V==null)throw Error(i(151));for(var ue=null,Ce=null,pe=I,be=I=0,Tt=null,Pe=V.next();pe!==null&&!Pe.done;be++,Pe=V.next()){pe.index>be?(Tt=pe,pe=null):Tt=pe.sibling;var Li=W(U,pe,Pe.value,K);if(Li===null){pe===null&&(pe=Tt);break}r&&pe&&Li.alternate===null&&o(U,pe),I=m(Li,I,be),Ce===null?ue=Li:Ce.sibling=Li,Ce=Li,pe=Tt}if(Pe.done)return c(U,pe),ke&&cs(U,be),ue;if(pe===null){for(;!Pe.done;be++,Pe=V.next())Pe=Q(U,Pe.value,K),Pe!==null&&(I=m(Pe,I,be),Ce===null?ue=Pe:Ce.sibling=Pe,Ce=Pe);return ke&&cs(U,be),ue}for(pe=f(pe);!Pe.done;be++,Pe=V.next())Pe=$(pe,U,be,Pe.value,K),Pe!==null&&(r&&Pe.alternate!==null&&pe.delete(Pe.key===null?be:Pe.key),I=m(Pe,I,be),Ce===null?ue=Pe:Ce.sibling=Pe,Ce=Pe);return r&&pe.forEach(function(FS){return o(U,FS)}),ke&&cs(U,be),ue}function We(U,I,V,K){if(typeof V=="object"&&V!==null&&V.type===A&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case y:e:{for(var ue=V.key;I!==null;){if(I.key===ue){if(ue=V.type,ue===A){if(I.tag===7){c(U,I.sibling),K=g(I,V.props.children),K.return=U,U=K;break e}}else if(I.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===re&&A_(ue)===I.type){c(U,I.sibling),K=g(I,V.props),Pa(K,V),K.return=U,U=K;break e}c(U,I);break}else o(U,I);I=I.sibling}V.type===A?(K=os(V.props.children,U.mode,K,V.key),K.return=U,U=K):(K=tl(V.type,V.key,V.props,null,U.mode,K),Pa(K,V),K.return=U,U=K)}return b(U);case v:e:{for(ue=V.key;I!==null;){if(I.key===ue)if(I.tag===4&&I.stateNode.containerInfo===V.containerInfo&&I.stateNode.implementation===V.implementation){c(U,I.sibling),K=g(I,V.children||[]),K.return=U,U=K;break e}else{c(U,I);break}else o(U,I);I=I.sibling}K=ff(V,U.mode,K),K.return=U,U=K}return b(U);case re:return ue=V._init,V=ue(V._payload),We(U,I,V,K)}if(Be(V))return Te(U,I,V,K);if(me(V)){if(ue=me(V),typeof ue!="function")throw Error(i(150));return V=ue.call(V),ye(U,I,V,K)}if(typeof V.then=="function")return We(U,I,yl(V),K);if(V.$$typeof===M)return We(U,I,rl(U,V),K);bl(U,V)}return typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint"?(V=""+V,I!==null&&I.tag===6?(c(U,I.sibling),K=g(I,V),K.return=U,U=K):(c(U,I),K=uf(V,U.mode,K),K.return=U,U=K),b(U)):c(U,I)}return function(U,I,V,K){try{Na=0;var ue=We(U,I,V,K);return cr=null,ue}catch(pe){if(pe===Sa||pe===ol)throw pe;var Ce=Kt(29,pe,null,U.mode);return Ce.lanes=K,Ce.return=U,Ce}finally{}}}var ur=w_(!0),E_=w_(!1),fn=G(null),In=null;function Si(r){var o=r.alternate;ae(gt,gt.current&1),ae(fn,r),In===null&&(o===null||rr.current!==null||o.memoizedState!==null)&&(In=r)}function R_(r){if(r.tag===22){if(ae(gt,gt.current),ae(fn,r),In===null){var o=r.alternate;o!==null&&o.memoizedState!==null&&(In=r)}}else Ai()}function Ai(){ae(gt,gt.current),ae(fn,fn.current)}function ei(r){le(fn),In===r&&(In=null),le(gt)}var gt=G(0);function vl(r){for(var o=r;o!==null;){if(o.tag===13){var c=o.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||Ph(c)))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}function Wf(r,o,c,f){o=r.memoizedState,c=c(f,o),c=c==null?o:p({},o,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var $f={enqueueSetState:function(r,o,c){r=r._reactInternals;var f=Jt(),g=vi(f);g.payload=o,c!=null&&(g.callback=c),o=Ti(r,g,f),o!==null&&(en(o,r,f),wa(o,r,f))},enqueueReplaceState:function(r,o,c){r=r._reactInternals;var f=Jt(),g=vi(f);g.tag=1,g.payload=o,c!=null&&(g.callback=c),o=Ti(r,g,f),o!==null&&(en(o,r,f),wa(o,r,f))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var c=Jt(),f=vi(c);f.tag=2,o!=null&&(f.callback=o),o=Ti(r,f,c),o!==null&&(en(o,r,c),wa(o,r,c))}};function C_(r,o,c,f,g,m,b){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(f,m,b):o.prototype&&o.prototype.isPureReactComponent?!pa(c,f)||!pa(g,m):!0}function M_(r,o,c,f){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(c,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(c,f),o.state!==r&&$f.enqueueReplaceState(o,o.state,null)}function ms(r,o){var c=o;if("ref"in o){c={};for(var f in o)f!=="ref"&&(c[f]=o[f])}if(r=r.defaultProps){c===o&&(c=p({},c));for(var g in r)c[g]===void 0&&(c[g]=r[g])}return c}var Tl=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)};function O_(r){Tl(r)}function I_(r){console.error(r)}function N_(r){Tl(r)}function xl(r,o){try{var c=r.onUncaughtError;c(o.value,{componentStack:o.stack})}catch(f){setTimeout(function(){throw f})}}function P_(r,o,c){try{var f=r.onCaughtError;f(c.value,{componentStack:c.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function Xf(r,o,c){return c=vi(c),c.tag=3,c.payload={element:null},c.callback=function(){xl(r,o)},c}function D_(r){return r=vi(r),r.tag=3,r}function k_(r,o,c,f){var g=c.type.getDerivedStateFromError;if(typeof g=="function"){var m=f.value;r.payload=function(){return g(m)},r.callback=function(){P_(o,c,f)}}var b=c.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(r.callback=function(){P_(o,c,f),typeof g!="function"&&(Oi===null?Oi=new Set([this]):Oi.add(this));var x=f.stack;this.componentDidCatch(f.value,{componentStack:x!==null?x:""})})}function Fx(r,o,c,f,g){if(c.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(o=c.alternate,o!==null&&va(o,c,g,!0),c=fn.current,c!==null){switch(c.tag){case 13:return In===null?mh():c.alternate===null&&nt===0&&(nt=3),c.flags&=-257,c.flags|=65536,c.lanes=g,f===Tf?c.flags|=16384:(o=c.updateQueue,o===null?c.updateQueue=new Set([f]):o.add(f),yh(r,f,g)),!1;case 22:return c.flags|=65536,f===Tf?c.flags|=16384:(o=c.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([f])},c.updateQueue=o):(c=o.retryQueue,c===null?o.retryQueue=new Set([f]):c.add(f)),yh(r,f,g)),!1}throw Error(i(435,c.tag))}return yh(r,f,g),mh(),!1}if(ke)return o=fn.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=g,f!==gf&&(r=Error(i(422),{cause:f}),ba(on(r,c)))):(f!==gf&&(o=Error(i(423),{cause:f}),ba(on(o,c))),r=r.current.alternate,r.flags|=65536,g&=-g,r.lanes|=g,f=on(f,c),g=Xf(r.stateNode,f,g),Af(r,g),nt!==4&&(nt=2)),!1;var m=Error(i(520),{cause:f});if(m=on(m,c),Va===null?Va=[m]:Va.push(m),nt!==4&&(nt=2),o===null)return!0;f=on(f,c),c=o;do{switch(c.tag){case 3:return c.flags|=65536,r=g&-g,c.lanes|=r,r=Xf(c.stateNode,f,r),Af(c,r),!1;case 1:if(o=c.type,m=c.stateNode,(c.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Oi===null||!Oi.has(m))))return c.flags|=65536,g&=-g,c.lanes|=g,g=D_(g),k_(g,r,c,f),Af(c,g),!1}c=c.return}while(c!==null);return!1}var U_=Error(i(461)),bt=!1;function St(r,o,c,f){o.child=r===null?E_(o,null,c,f):ur(o,r.child,c,f)}function B_(r,o,c,f,g){c=c.render;var m=o.ref;if("ref"in f){var b={};for(var x in f)x!=="ref"&&(b[x]=f[x])}else b=f;return ds(o),f=Mf(r,o,c,b,m,g),x=Of(),r!==null&&!bt?(If(r,o,g),ti(r,o,g)):(ke&&x&&hf(o),o.flags|=1,St(r,o,f,g),o.child)}function L_(r,o,c,f,g){if(r===null){var m=c.type;return typeof m=="function"&&!cf(m)&&m.defaultProps===void 0&&c.compare===null?(o.tag=15,o.type=m,F_(r,o,m,f,g)):(r=tl(c.type,null,f,o,o.mode,g),r.ref=o.ref,r.return=o,o.child=r)}if(m=r.child,!eh(r,g)){var b=m.memoizedProps;if(c=c.compare,c=c!==null?c:pa,c(b,f)&&r.ref===o.ref)return ti(r,o,g)}return o.flags|=1,r=qn(m,f),r.ref=o.ref,r.return=o,o.child=r}function F_(r,o,c,f,g){if(r!==null){var m=r.memoizedProps;if(pa(m,f)&&r.ref===o.ref)if(bt=!1,o.pendingProps=f=m,eh(r,g))(r.flags&131072)!==0&&(bt=!0);else return o.lanes=r.lanes,ti(r,o,g)}return Yf(r,o,c,f,g)}function V_(r,o,c){var f=o.pendingProps,g=f.children,m=r!==null?r.memoizedState:null;if(f.mode==="hidden"){if((o.flags&128)!==0){if(f=m!==null?m.baseLanes|c:c,r!==null){for(g=o.child=r.child,m=0;g!==null;)m=m|g.lanes|g.childLanes,g=g.sibling;o.childLanes=m&~f}else o.childLanes=0,o.child=null;return z_(r,o,f,c)}if((c&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},r!==null&&al(o,m!==null?m.cachePool:null),m!==null?Fm(o,m):Ef(),R_(o);else return o.lanes=o.childLanes=536870912,z_(r,o,m!==null?m.baseLanes|c:c,c)}else m!==null?(al(o,m.cachePool),Fm(o,m),Ai(),o.memoizedState=null):(r!==null&&al(o,null),Ef(),Ai());return St(r,o,g,c),o.child}function z_(r,o,c,f){var g=vf();return g=g===null?null:{parent:dt._currentValue,pool:g},o.memoizedState={baseLanes:c,cachePool:g},r!==null&&al(o,null),Ef(),R_(o),r!==null&&va(r,o,f,!0),null}function Sl(r,o){var c=o.ref;if(c===null)r!==null&&r.ref!==null&&(o.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(i(284));(r===null||r.ref!==c)&&(o.flags|=4194816)}}function Yf(r,o,c,f,g){return ds(o),c=Mf(r,o,c,f,void 0,g),f=Of(),r!==null&&!bt?(If(r,o,g),ti(r,o,g)):(ke&&f&&hf(o),o.flags|=1,St(r,o,c,g),o.child)}function H_(r,o,c,f,g,m){return ds(o),o.updateQueue=null,c=zm(o,f,c,g),Vm(r),f=Of(),r!==null&&!bt?(If(r,o,m),ti(r,o,m)):(ke&&f&&hf(o),o.flags|=1,St(r,o,c,m),o.child)}function j_(r,o,c,f,g){if(ds(o),o.stateNode===null){var m=er,b=c.contextType;typeof b=="object"&&b!==null&&(m=Mt(b)),m=new c(f,m),o.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=$f,o.stateNode=m,m._reactInternals=o,m=o.stateNode,m.props=f,m.state=o.memoizedState,m.refs={},xf(o),b=c.contextType,m.context=typeof b=="object"&&b!==null?Mt(b):er,m.state=o.memoizedState,b=c.getDerivedStateFromProps,typeof b=="function"&&(Wf(o,c,b,f),m.state=o.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(b=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),b!==m.state&&$f.enqueueReplaceState(m,m.state,null),Ra(o,f,m,g),Ea(),m.state=o.memoizedState),typeof m.componentDidMount=="function"&&(o.flags|=4194308),f=!0}else if(r===null){m=o.stateNode;var x=o.memoizedProps,E=ms(c,x);m.props=E;var j=m.context,q=c.contextType;b=er,typeof q=="object"&&q!==null&&(b=Mt(q));var Q=c.getDerivedStateFromProps;q=typeof Q=="function"||typeof m.getSnapshotBeforeUpdate=="function",x=o.pendingProps!==x,q||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(x||j!==b)&&M_(o,m,f,b),bi=!1;var W=o.memoizedState;m.state=W,Ra(o,f,m,g),Ea(),j=o.memoizedState,x||W!==j||bi?(typeof Q=="function"&&(Wf(o,c,Q,f),j=o.memoizedState),(E=bi||C_(o,c,E,f,W,j,b))?(q||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(o.flags|=4194308)):(typeof m.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=j),m.props=f,m.state=j,m.context=b,f=E):(typeof m.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{m=o.stateNode,Sf(r,o),b=o.memoizedProps,q=ms(c,b),m.props=q,Q=o.pendingProps,W=m.context,j=c.contextType,E=er,typeof j=="object"&&j!==null&&(E=Mt(j)),x=c.getDerivedStateFromProps,(j=typeof x=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(b!==Q||W!==E)&&M_(o,m,f,E),bi=!1,W=o.memoizedState,m.state=W,Ra(o,f,m,g),Ea();var $=o.memoizedState;b!==Q||W!==$||bi||r!==null&&r.dependencies!==null&&sl(r.dependencies)?(typeof x=="function"&&(Wf(o,c,x,f),$=o.memoizedState),(q=bi||C_(o,c,q,f,W,$,E)||r!==null&&r.dependencies!==null&&sl(r.dependencies))?(j||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(f,$,E),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(f,$,E)),typeof m.componentDidUpdate=="function"&&(o.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof m.componentDidUpdate!="function"||b===r.memoizedProps&&W===r.memoizedState||(o.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||b===r.memoizedProps&&W===r.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=$),m.props=f,m.state=$,m.context=E,f=q):(typeof m.componentDidUpdate!="function"||b===r.memoizedProps&&W===r.memoizedState||(o.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||b===r.memoizedProps&&W===r.memoizedState||(o.flags|=1024),f=!1)}return m=f,Sl(r,o),f=(o.flags&128)!==0,m||f?(m=o.stateNode,c=f&&typeof c.getDerivedStateFromError!="function"?null:m.render(),o.flags|=1,r!==null&&f?(o.child=ur(o,r.child,null,g),o.child=ur(o,null,c,g)):St(r,o,c,g),o.memoizedState=m.state,r=o.child):r=ti(r,o,g),r}function W_(r,o,c,f){return ya(),o.flags|=256,St(r,o,c,f),o.child}var qf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Kf(r){return{baseLanes:r,cachePool:Im()}}function Zf(r,o,c){return r=r!==null?r.childLanes&~c:0,o&&(r|=hn),r}function $_(r,o,c){var f=o.pendingProps,g=!1,m=(o.flags&128)!==0,b;if((b=m)||(b=r!==null&&r.memoizedState===null?!1:(gt.current&2)!==0),b&&(g=!0,o.flags&=-129),b=(o.flags&32)!==0,o.flags&=-33,r===null){if(ke){if(g?Si(o):Ai(),ke){var x=tt,E;if(E=x){e:{for(E=x,x=On;E.nodeType!==8;){if(!x){x=null;break e}if(E=Sn(E.nextSibling),E===null){x=null;break e}}x=E}x!==null?(o.memoizedState={dehydrated:x,treeContext:ls!==null?{id:Kn,overflow:Zn}:null,retryLane:536870912,hydrationErrors:null},E=Kt(18,null,null,0),E.stateNode=x,E.return=o,o.child=E,Ut=o,tt=null,E=!0):E=!1}E||fs(o)}if(x=o.memoizedState,x!==null&&(x=x.dehydrated,x!==null))return Ph(x)?o.lanes=32:o.lanes=536870912,null;ei(o)}return x=f.children,f=f.fallback,g?(Ai(),g=o.mode,x=Al({mode:"hidden",children:x},g),f=os(f,g,c,null),x.return=o,f.return=o,x.sibling=f,o.child=x,g=o.child,g.memoizedState=Kf(c),g.childLanes=Zf(r,b,c),o.memoizedState=qf,f):(Si(o),Qf(o,x))}if(E=r.memoizedState,E!==null&&(x=E.dehydrated,x!==null)){if(m)o.flags&256?(Si(o),o.flags&=-257,o=Gf(r,o,c)):o.memoizedState!==null?(Ai(),o.child=r.child,o.flags|=128,o=null):(Ai(),g=f.fallback,x=o.mode,f=Al({mode:"visible",children:f.children},x),g=os(g,x,c,null),g.flags|=2,f.return=o,g.return=o,f.sibling=g,o.child=f,ur(o,r.child,null,c),f=o.child,f.memoizedState=Kf(c),f.childLanes=Zf(r,b,c),o.memoizedState=qf,o=g);else if(Si(o),Ph(x)){if(b=x.nextSibling&&x.nextSibling.dataset,b)var j=b.dgst;b=j,f=Error(i(419)),f.stack="",f.digest=b,ba({value:f,source:null,stack:null}),o=Gf(r,o,c)}else if(bt||va(r,o,c,!1),b=(c&r.childLanes)!==0,bt||b){if(b=Ke,b!==null&&(f=c&-c,f=(f&42)!==0?1:Pu(f),f=(f&(b.suspendedLanes|c))!==0?0:f,f!==0&&f!==E.retryLane))throw E.retryLane=f,Js(r,f),en(b,r,f),U_;x.data==="$?"||mh(),o=Gf(r,o,c)}else x.data==="$?"?(o.flags|=192,o.child=r.child,o=null):(r=E.treeContext,tt=Sn(x.nextSibling),Ut=o,ke=!0,us=null,On=!1,r!==null&&(cn[un++]=Kn,cn[un++]=Zn,cn[un++]=ls,Kn=r.id,Zn=r.overflow,ls=o),o=Qf(o,f.children),o.flags|=4096);return o}return g?(Ai(),g=f.fallback,x=o.mode,E=r.child,j=E.sibling,f=qn(E,{mode:"hidden",children:f.children}),f.subtreeFlags=E.subtreeFlags&65011712,j!==null?g=qn(j,g):(g=os(g,x,c,null),g.flags|=2),g.return=o,f.return=o,f.sibling=g,o.child=f,f=g,g=o.child,x=r.child.memoizedState,x===null?x=Kf(c):(E=x.cachePool,E!==null?(j=dt._currentValue,E=E.parent!==j?{parent:j,pool:j}:E):E=Im(),x={baseLanes:x.baseLanes|c,cachePool:E}),g.memoizedState=x,g.childLanes=Zf(r,b,c),o.memoizedState=qf,f):(Si(o),c=r.child,r=c.sibling,c=qn(c,{mode:"visible",children:f.children}),c.return=o,c.sibling=null,r!==null&&(b=o.deletions,b===null?(o.deletions=[r],o.flags|=16):b.push(r)),o.child=c,o.memoizedState=null,c)}function Qf(r,o){return o=Al({mode:"visible",children:o},r.mode),o.return=r,r.child=o}function Al(r,o){return r=Kt(22,r,null,o),r.lanes=0,r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},r}function Gf(r,o,c){return ur(o,r.child,null,c),r=Qf(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function X_(r,o,c){r.lanes|=o;var f=r.alternate;f!==null&&(f.lanes|=o),mf(r.return,o,c)}function Jf(r,o,c,f,g){var m=r.memoizedState;m===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:g}:(m.isBackwards=o,m.rendering=null,m.renderingStartTime=0,m.last=f,m.tail=c,m.tailMode=g)}function Y_(r,o,c){var f=o.pendingProps,g=f.revealOrder,m=f.tail;if(St(r,o,f.children,c),f=gt.current,(f&2)!==0)f=f&1|2,o.flags|=128;else{if(r!==null&&(r.flags&128)!==0)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&X_(r,c,o);else if(r.tag===19)X_(r,c,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}f&=1}switch(ae(gt,f),g){case"forwards":for(c=o.child,g=null;c!==null;)r=c.alternate,r!==null&&vl(r)===null&&(g=c),c=c.sibling;c=g,c===null?(g=o.child,o.child=null):(g=c.sibling,c.sibling=null),Jf(o,!1,g,c,m);break;case"backwards":for(c=null,g=o.child,o.child=null;g!==null;){if(r=g.alternate,r!==null&&vl(r)===null){o.child=g;break}r=g.sibling,g.sibling=c,c=g,g=r}Jf(o,!0,c,null,m);break;case"together":Jf(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function ti(r,o,c){if(r!==null&&(o.dependencies=r.dependencies),Mi|=o.lanes,(c&o.childLanes)===0)if(r!==null){if(va(r,o,c,!1),(c&o.childLanes)===0)return null}else return null;if(r!==null&&o.child!==r.child)throw Error(i(153));if(o.child!==null){for(r=o.child,c=qn(r,r.pendingProps),o.child=c,c.return=o;r.sibling!==null;)r=r.sibling,c=c.sibling=qn(r,r.pendingProps),c.return=o;c.sibling=null}return o.child}function eh(r,o){return(r.lanes&o)!==0?!0:(r=r.dependencies,!!(r!==null&&sl(r)))}function Vx(r,o,c){switch(o.tag){case 3:De(o,o.stateNode.containerInfo),yi(o,dt,r.memoizedState.cache),ya();break;case 27:case 5:gi(o);break;case 4:De(o,o.stateNode.containerInfo);break;case 10:yi(o,o.type,o.memoizedProps.value);break;case 13:var f=o.memoizedState;if(f!==null)return f.dehydrated!==null?(Si(o),o.flags|=128,null):(c&o.child.childLanes)!==0?$_(r,o,c):(Si(o),r=ti(r,o,c),r!==null?r.sibling:null);Si(o);break;case 19:var g=(r.flags&128)!==0;if(f=(c&o.childLanes)!==0,f||(va(r,o,c,!1),f=(c&o.childLanes)!==0),g){if(f)return Y_(r,o,c);o.flags|=128}if(g=o.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),ae(gt,gt.current),f)break;return null;case 22:case 23:return o.lanes=0,V_(r,o,c);case 24:yi(o,dt,r.memoizedState.cache)}return ti(r,o,c)}function q_(r,o,c){if(r!==null)if(r.memoizedProps!==o.pendingProps)bt=!0;else{if(!eh(r,c)&&(o.flags&128)===0)return bt=!1,Vx(r,o,c);bt=(r.flags&131072)!==0}else bt=!1,ke&&(o.flags&1048576)!==0&&Am(o,il,o.index);switch(o.lanes=0,o.tag){case 16:e:{r=o.pendingProps;var f=o.elementType,g=f._init;if(f=g(f._payload),o.type=f,typeof f=="function")cf(f)?(r=ms(f,r),o.tag=1,o=j_(null,o,f,r,c)):(o.tag=0,o=Yf(null,o,f,r,c));else{if(f!=null){if(g=f.$$typeof,g===k){o.tag=11,o=B_(null,o,f,r,c);break e}else if(g===ce){o.tag=14,o=L_(null,o,f,r,c);break e}}throw o=_e(f)||f,Error(i(306,o,""))}}return o;case 0:return Yf(r,o,o.type,o.pendingProps,c);case 1:return f=o.type,g=ms(f,o.pendingProps),j_(r,o,f,g,c);case 3:e:{if(De(o,o.stateNode.containerInfo),r===null)throw Error(i(387));f=o.pendingProps;var m=o.memoizedState;g=m.element,Sf(r,o),Ra(o,f,null,c);var b=o.memoizedState;if(f=b.cache,yi(o,dt,f),f!==m.cache&&_f(o,[dt],c,!0),Ea(),f=b.element,m.isDehydrated)if(m={element:f,isDehydrated:!1,cache:b.cache},o.updateQueue.baseState=m,o.memoizedState=m,o.flags&256){o=W_(r,o,f,c);break e}else if(f!==g){g=on(Error(i(424)),o),ba(g),o=W_(r,o,f,c);break e}else{switch(r=o.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(tt=Sn(r.firstChild),Ut=o,ke=!0,us=null,On=!0,c=E_(o,null,f,c),o.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(ya(),f===g){o=ti(r,o,c);break e}St(r,o,f,c)}o=o.child}return o;case 26:return Sl(r,o),r===null?(c=Gy(o.type,null,o.pendingProps,null))?o.memoizedState=c:ke||(c=o.type,r=o.pendingProps,f=Ll(fe.current).createElement(c),f[Ct]=o,f[Lt]=r,wt(f,c,r),yt(f),o.stateNode=f):o.memoizedState=Gy(o.type,r.memoizedProps,o.pendingProps,r.memoizedState),null;case 27:return gi(o),r===null&&ke&&(f=o.stateNode=Ky(o.type,o.pendingProps,fe.current),Ut=o,On=!0,g=tt,Pi(o.type)?(Dh=g,tt=Sn(f.firstChild)):tt=g),St(r,o,o.pendingProps.children,c),Sl(r,o),r===null&&(o.flags|=4194304),o.child;case 5:return r===null&&ke&&((g=f=tt)&&(f=gS(f,o.type,o.pendingProps,On),f!==null?(o.stateNode=f,Ut=o,tt=Sn(f.firstChild),On=!1,g=!0):g=!1),g||fs(o)),gi(o),g=o.type,m=o.pendingProps,b=r!==null?r.memoizedProps:null,f=m.children,Oh(g,m)?f=null:b!==null&&Oh(g,b)&&(o.flags|=32),o.memoizedState!==null&&(g=Mf(r,o,Nx,null,null,c),Ka._currentValue=g),Sl(r,o),St(r,o,f,c),o.child;case 6:return r===null&&ke&&((r=c=tt)&&(c=pS(c,o.pendingProps,On),c!==null?(o.stateNode=c,Ut=o,tt=null,r=!0):r=!1),r||fs(o)),null;case 13:return $_(r,o,c);case 4:return De(o,o.stateNode.containerInfo),f=o.pendingProps,r===null?o.child=ur(o,null,f,c):St(r,o,f,c),o.child;case 11:return B_(r,o,o.type,o.pendingProps,c);case 7:return St(r,o,o.pendingProps,c),o.child;case 8:return St(r,o,o.pendingProps.children,c),o.child;case 12:return St(r,o,o.pendingProps.children,c),o.child;case 10:return f=o.pendingProps,yi(o,o.type,f.value),St(r,o,f.children,c),o.child;case 9:return g=o.type._context,f=o.pendingProps.children,ds(o),g=Mt(g),f=f(g),o.flags|=1,St(r,o,f,c),o.child;case 14:return L_(r,o,o.type,o.pendingProps,c);case 15:return F_(r,o,o.type,o.pendingProps,c);case 19:return Y_(r,o,c);case 31:return f=o.pendingProps,c=o.mode,f={mode:f.mode,children:f.children},r===null?(c=Al(f,c),c.ref=o.ref,o.child=c,c.return=o,o=c):(c=qn(r.child,f),c.ref=o.ref,o.child=c,c.return=o,o=c),o;case 22:return V_(r,o,c);case 24:return ds(o),f=Mt(dt),r===null?(g=vf(),g===null&&(g=Ke,m=yf(),g.pooledCache=m,m.refCount++,m!==null&&(g.pooledCacheLanes|=c),g=m),o.memoizedState={parent:f,cache:g},xf(o),yi(o,dt,g)):((r.lanes&c)!==0&&(Sf(r,o),Ra(o,null,null,c),Ea()),g=r.memoizedState,m=o.memoizedState,g.parent!==f?(g={parent:f,cache:f},o.memoizedState=g,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=g),yi(o,dt,f)):(f=m.cache,yi(o,dt,f),f!==g.cache&&_f(o,[dt],c,!0))),St(r,o,o.pendingProps.children,c),o.child;case 29:throw o.pendingProps}throw Error(i(156,o.tag))}function ni(r){r.flags|=4}function K_(r,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!ib(o)){if(o=fn.current,o!==null&&((Ne&4194048)===Ne?In!==null:(Ne&62914560)!==Ne&&(Ne&536870912)===0||o!==In))throw Aa=Tf,Nm;r.flags|=8192}}function wl(r,o){o!==null&&(r.flags|=4),r.flags&16384&&(o=r.tag!==22?Rp():536870912,r.lanes|=o,gr|=o)}function Da(r,o){if(!ke)switch(r.tailMode){case"hidden":o=r.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:f.sibling=null}}function et(r){var o=r.alternate!==null&&r.alternate.child===r.child,c=0,f=0;if(o)for(var g=r.child;g!==null;)c|=g.lanes|g.childLanes,f|=g.subtreeFlags&65011712,f|=g.flags&65011712,g.return=r,g=g.sibling;else for(g=r.child;g!==null;)c|=g.lanes|g.childLanes,f|=g.subtreeFlags,f|=g.flags,g.return=r,g=g.sibling;return r.subtreeFlags|=f,r.childLanes=c,o}function zx(r,o,c){var f=o.pendingProps;switch(df(o),o.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return et(o),null;case 1:return et(o),null;case 3:return c=o.stateNode,f=null,r!==null&&(f=r.memoizedState.cache),o.memoizedState.cache!==f&&(o.flags|=2048),Gn(dt),_t(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(_a(o)?ni(o):r===null||r.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,Rm())),et(o),null;case 26:return c=o.memoizedState,r===null?(ni(o),c!==null?(et(o),K_(o,c)):(et(o),o.flags&=-16777217)):c?c!==r.memoizedState?(ni(o),et(o),K_(o,c)):(et(o),o.flags&=-16777217):(r.memoizedProps!==f&&ni(o),et(o),o.flags&=-16777217),null;case 27:$t(o),c=fe.current;var g=o.type;if(r!==null&&o.stateNode!=null)r.memoizedProps!==f&&ni(o);else{if(!f){if(o.stateNode===null)throw Error(i(166));return et(o),null}r=oe.current,_a(o)?wm(o):(r=Ky(g,f,c),o.stateNode=r,ni(o))}return et(o),null;case 5:if($t(o),c=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==f&&ni(o);else{if(!f){if(o.stateNode===null)throw Error(i(166));return et(o),null}if(r=oe.current,_a(o))wm(o);else{switch(g=Ll(fe.current),r){case 1:r=g.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:r=g.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":r=g.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":r=g.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":r=g.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild);break;case"select":r=typeof f.is=="string"?g.createElement("select",{is:f.is}):g.createElement("select"),f.multiple?r.multiple=!0:f.size&&(r.size=f.size);break;default:r=typeof f.is=="string"?g.createElement(c,{is:f.is}):g.createElement(c)}}r[Ct]=o,r[Lt]=f;e:for(g=o.child;g!==null;){if(g.tag===5||g.tag===6)r.appendChild(g.stateNode);else if(g.tag!==4&&g.tag!==27&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===o)break e;for(;g.sibling===null;){if(g.return===null||g.return===o)break e;g=g.return}g.sibling.return=g.return,g=g.sibling}o.stateNode=r;e:switch(wt(r,c,f),c){case"button":case"input":case"select":case"textarea":r=!!f.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&ni(o)}}return et(o),o.flags&=-16777217,null;case 6:if(r&&o.stateNode!=null)r.memoizedProps!==f&&ni(o);else{if(typeof f!="string"&&o.stateNode===null)throw Error(i(166));if(r=fe.current,_a(o)){if(r=o.stateNode,c=o.memoizedProps,f=null,g=Ut,g!==null)switch(g.tag){case 27:case 5:f=g.memoizedProps}r[Ct]=o,r=!!(r.nodeValue===c||f!==null&&f.suppressHydrationWarning===!0||Hy(r.nodeValue,c)),r||fs(o)}else r=Ll(r).createTextNode(f),r[Ct]=o,o.stateNode=r}return et(o),null;case 13:if(f=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(g=_a(o),f!==null&&f.dehydrated!==null){if(r===null){if(!g)throw Error(i(318));if(g=o.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(i(317));g[Ct]=o}else ya(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;et(o),g=!1}else g=Rm(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=g),g=!0;if(!g)return o.flags&256?(ei(o),o):(ei(o),null)}if(ei(o),(o.flags&128)!==0)return o.lanes=c,o;if(c=f!==null,r=r!==null&&r.memoizedState!==null,c){f=o.child,g=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(g=f.alternate.memoizedState.cachePool.pool);var m=null;f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(m=f.memoizedState.cachePool.pool),m!==g&&(f.flags|=2048)}return c!==r&&c&&(o.child.flags|=8192),wl(o,o.updateQueue),et(o),null;case 4:return _t(),r===null&&wh(o.stateNode.containerInfo),et(o),null;case 10:return Gn(o.type),et(o),null;case 19:if(le(gt),g=o.memoizedState,g===null)return et(o),null;if(f=(o.flags&128)!==0,m=g.rendering,m===null)if(f)Da(g,!1);else{if(nt!==0||r!==null&&(r.flags&128)!==0)for(r=o.child;r!==null;){if(m=vl(r),m!==null){for(o.flags|=128,Da(g,!1),r=m.updateQueue,o.updateQueue=r,wl(o,r),o.subtreeFlags=0,r=c,c=o.child;c!==null;)Sm(c,r),c=c.sibling;return ae(gt,gt.current&1|2),o.child}r=r.sibling}g.tail!==null&&Mn()>Cl&&(o.flags|=128,f=!0,Da(g,!1),o.lanes=4194304)}else{if(!f)if(r=vl(m),r!==null){if(o.flags|=128,f=!0,r=r.updateQueue,o.updateQueue=r,wl(o,r),Da(g,!0),g.tail===null&&g.tailMode==="hidden"&&!m.alternate&&!ke)return et(o),null}else 2*Mn()-g.renderingStartTime>Cl&&c!==536870912&&(o.flags|=128,f=!0,Da(g,!1),o.lanes=4194304);g.isBackwards?(m.sibling=o.child,o.child=m):(r=g.last,r!==null?r.sibling=m:o.child=m,g.last=m)}return g.tail!==null?(o=g.tail,g.rendering=o,g.tail=o.sibling,g.renderingStartTime=Mn(),o.sibling=null,r=gt.current,ae(gt,f?r&1|2:r&1),o):(et(o),null);case 22:case 23:return ei(o),Rf(),f=o.memoizedState!==null,r!==null?r.memoizedState!==null!==f&&(o.flags|=8192):f&&(o.flags|=8192),f?(c&536870912)!==0&&(o.flags&128)===0&&(et(o),o.subtreeFlags&6&&(o.flags|=8192)):et(o),c=o.updateQueue,c!==null&&wl(o,c.retryQueue),c=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),f=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),f!==c&&(o.flags|=2048),r!==null&&le(gs),null;case 24:return c=null,r!==null&&(c=r.memoizedState.cache),o.memoizedState.cache!==c&&(o.flags|=2048),Gn(dt),et(o),null;case 25:return null;case 30:return null}throw Error(i(156,o.tag))}function Hx(r,o){switch(df(o),o.tag){case 1:return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return Gn(dt),_t(),r=o.flags,(r&65536)!==0&&(r&128)===0?(o.flags=r&-65537|128,o):null;case 26:case 27:case 5:return $t(o),null;case 13:if(ei(o),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(i(340));ya()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return le(gt),null;case 4:return _t(),null;case 10:return Gn(o.type),null;case 22:case 23:return ei(o),Rf(),r!==null&&le(gs),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 24:return Gn(dt),null;case 25:return null;default:return null}}function Z_(r,o){switch(df(o),o.tag){case 3:Gn(dt),_t();break;case 26:case 27:case 5:$t(o);break;case 4:_t();break;case 13:ei(o);break;case 19:le(gt);break;case 10:Gn(o.type);break;case 22:case 23:ei(o),Rf(),r!==null&&le(gs);break;case 24:Gn(dt)}}function ka(r,o){try{var c=o.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var g=f.next;c=g;do{if((c.tag&r)===r){f=void 0;var m=c.create,b=c.inst;f=m(),b.destroy=f}c=c.next}while(c!==g)}}catch(x){Ye(o,o.return,x)}}function wi(r,o,c){try{var f=o.updateQueue,g=f!==null?f.lastEffect:null;if(g!==null){var m=g.next;f=m;do{if((f.tag&r)===r){var b=f.inst,x=b.destroy;if(x!==void 0){b.destroy=void 0,g=o;var E=c,j=x;try{j()}catch(q){Ye(g,E,q)}}}f=f.next}while(f!==m)}}catch(q){Ye(o,o.return,q)}}function Q_(r){var o=r.updateQueue;if(o!==null){var c=r.stateNode;try{Lm(o,c)}catch(f){Ye(r,r.return,f)}}}function G_(r,o,c){c.props=ms(r.type,r.memoizedProps),c.state=r.memoizedState;try{c.componentWillUnmount()}catch(f){Ye(r,o,f)}}function Ua(r,o){try{var c=r.ref;if(c!==null){switch(r.tag){case 26:case 27:case 5:var f=r.stateNode;break;case 30:f=r.stateNode;break;default:f=r.stateNode}typeof c=="function"?r.refCleanup=c(f):c.current=f}}catch(g){Ye(r,o,g)}}function Nn(r,o){var c=r.ref,f=r.refCleanup;if(c!==null)if(typeof f=="function")try{f()}catch(g){Ye(r,o,g)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(g){Ye(r,o,g)}else c.current=null}function J_(r){var o=r.type,c=r.memoizedProps,f=r.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":c.autoFocus&&f.focus();break e;case"img":c.src?f.src=c.src:c.srcSet&&(f.srcset=c.srcSet)}}catch(g){Ye(r,r.return,g)}}function th(r,o,c){try{var f=r.stateNode;cS(f,r.type,c,o),f[Lt]=o}catch(g){Ye(r,r.return,g)}}function ey(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&Pi(r.type)||r.tag===4}function nh(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||ey(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&Pi(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function ih(r,o,c){var f=r.tag;if(f===5||f===6)r=r.stateNode,o?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(r,o):(o=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,o.appendChild(r),c=c._reactRootContainer,c!=null||o.onclick!==null||(o.onclick=Bl));else if(f!==4&&(f===27&&Pi(r.type)&&(c=r.stateNode,o=null),r=r.child,r!==null))for(ih(r,o,c),r=r.sibling;r!==null;)ih(r,o,c),r=r.sibling}function El(r,o,c){var f=r.tag;if(f===5||f===6)r=r.stateNode,o?c.insertBefore(r,o):c.appendChild(r);else if(f!==4&&(f===27&&Pi(r.type)&&(c=r.stateNode),r=r.child,r!==null))for(El(r,o,c),r=r.sibling;r!==null;)El(r,o,c),r=r.sibling}function ty(r){var o=r.stateNode,c=r.memoizedProps;try{for(var f=r.type,g=o.attributes;g.length;)o.removeAttributeNode(g[0]);wt(o,f,c),o[Ct]=r,o[Lt]=c}catch(m){Ye(r,r.return,m)}}var ii=!1,ot=!1,sh=!1,ny=typeof WeakSet=="function"?WeakSet:Set,vt=null;function jx(r,o){if(r=r.containerInfo,Ch=Wl,r=dm(r),tf(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else e:{c=(c=r.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var g=f.anchorOffset,m=f.focusNode;f=f.focusOffset;try{c.nodeType,m.nodeType}catch{c=null;break e}var b=0,x=-1,E=-1,j=0,q=0,Q=r,W=null;t:for(;;){for(var $;Q!==c||g!==0&&Q.nodeType!==3||(x=b+g),Q!==m||f!==0&&Q.nodeType!==3||(E=b+f),Q.nodeType===3&&(b+=Q.nodeValue.length),($=Q.firstChild)!==null;)W=Q,Q=$;for(;;){if(Q===r)break t;if(W===c&&++j===g&&(x=b),W===m&&++q===f&&(E=b),($=Q.nextSibling)!==null)break;Q=W,W=Q.parentNode}Q=$}c=x===-1||E===-1?null:{start:x,end:E}}else c=null}c=c||{start:0,end:0}}else c=null;for(Mh={focusedElem:r,selectionRange:c},Wl=!1,vt=o;vt!==null;)if(o=vt,r=o.child,(o.subtreeFlags&1024)!==0&&r!==null)r.return=o,vt=r;else for(;vt!==null;){switch(o=vt,m=o.alternate,r=o.flags,o.tag){case 0:break;case 11:case 15:break;case 1:if((r&1024)!==0&&m!==null){r=void 0,c=o,g=m.memoizedProps,m=m.memoizedState,f=c.stateNode;try{var Te=ms(c.type,g,c.elementType===c.type);r=f.getSnapshotBeforeUpdate(Te,m),f.__reactInternalSnapshotBeforeUpdate=r}catch(ye){Ye(c,c.return,ye)}}break;case 3:if((r&1024)!==0){if(r=o.stateNode.containerInfo,c=r.nodeType,c===9)Nh(r);else if(c===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Nh(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(i(163))}if(r=o.sibling,r!==null){r.return=o.return,vt=r;break}vt=o.return}}function iy(r,o,c){var f=c.flags;switch(c.tag){case 0:case 11:case 15:Ei(r,c),f&4&&ka(5,c);break;case 1:if(Ei(r,c),f&4)if(r=c.stateNode,o===null)try{r.componentDidMount()}catch(b){Ye(c,c.return,b)}else{var g=ms(c.type,o.memoizedProps);o=o.memoizedState;try{r.componentDidUpdate(g,o,r.__reactInternalSnapshotBeforeUpdate)}catch(b){Ye(c,c.return,b)}}f&64&&Q_(c),f&512&&Ua(c,c.return);break;case 3:if(Ei(r,c),f&64&&(r=c.updateQueue,r!==null)){if(o=null,c.child!==null)switch(c.child.tag){case 27:case 5:o=c.child.stateNode;break;case 1:o=c.child.stateNode}try{Lm(r,o)}catch(b){Ye(c,c.return,b)}}break;case 27:o===null&&f&4&&ty(c);case 26:case 5:Ei(r,c),o===null&&f&4&&J_(c),f&512&&Ua(c,c.return);break;case 12:Ei(r,c);break;case 13:Ei(r,c),f&4&&ay(r,c),f&64&&(r=c.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(c=Gx.bind(null,c),mS(r,c))));break;case 22:if(f=c.memoizedState!==null||ii,!f){o=o!==null&&o.memoizedState!==null||ot,g=ii;var m=ot;ii=f,(ot=o)&&!m?Ri(r,c,(c.subtreeFlags&8772)!==0):Ei(r,c),ii=g,ot=m}break;case 30:break;default:Ei(r,c)}}function sy(r){var o=r.alternate;o!==null&&(r.alternate=null,sy(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&Uu(o)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var Ze=null,zt=!1;function si(r,o,c){for(c=c.child;c!==null;)ry(r,o,c),c=c.sibling}function ry(r,o,c){if(Xt&&typeof Xt.onCommitFiberUnmount=="function")try{Xt.onCommitFiberUnmount(ia,c)}catch{}switch(c.tag){case 26:ot||Nn(c,o),si(r,o,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:ot||Nn(c,o);var f=Ze,g=zt;Pi(c.type)&&(Ze=c.stateNode,zt=!1),si(r,o,c),$a(c.stateNode),Ze=f,zt=g;break;case 5:ot||Nn(c,o);case 6:if(f=Ze,g=zt,Ze=null,si(r,o,c),Ze=f,zt=g,Ze!==null)if(zt)try{(Ze.nodeType===9?Ze.body:Ze.nodeName==="HTML"?Ze.ownerDocument.body:Ze).removeChild(c.stateNode)}catch(m){Ye(c,o,m)}else try{Ze.removeChild(c.stateNode)}catch(m){Ye(c,o,m)}break;case 18:Ze!==null&&(zt?(r=Ze,Yy(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,c.stateNode),Ja(r)):Yy(Ze,c.stateNode));break;case 4:f=Ze,g=zt,Ze=c.stateNode.containerInfo,zt=!0,si(r,o,c),Ze=f,zt=g;break;case 0:case 11:case 14:case 15:ot||wi(2,c,o),ot||wi(4,c,o),si(r,o,c);break;case 1:ot||(Nn(c,o),f=c.stateNode,typeof f.componentWillUnmount=="function"&&G_(c,o,f)),si(r,o,c);break;case 21:si(r,o,c);break;case 22:ot=(f=ot)||c.memoizedState!==null,si(r,o,c),ot=f;break;default:si(r,o,c)}}function ay(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Ja(r)}catch(c){Ye(o,o.return,c)}}function Wx(r){switch(r.tag){case 13:case 19:var o=r.stateNode;return o===null&&(o=r.stateNode=new ny),o;case 22:return r=r.stateNode,o=r._retryCache,o===null&&(o=r._retryCache=new ny),o;default:throw Error(i(435,r.tag))}}function rh(r,o){var c=Wx(r);o.forEach(function(f){var g=Jx.bind(null,r,f);c.has(f)||(c.add(f),f.then(g,g))})}function Zt(r,o){var c=o.deletions;if(c!==null)for(var f=0;f<c.length;f++){var g=c[f],m=r,b=o,x=b;e:for(;x!==null;){switch(x.tag){case 27:if(Pi(x.type)){Ze=x.stateNode,zt=!1;break e}break;case 5:Ze=x.stateNode,zt=!1;break e;case 3:case 4:Ze=x.stateNode.containerInfo,zt=!0;break e}x=x.return}if(Ze===null)throw Error(i(160));ry(m,b,g),Ze=null,zt=!1,m=g.alternate,m!==null&&(m.return=null),g.return=null}if(o.subtreeFlags&13878)for(o=o.child;o!==null;)oy(o,r),o=o.sibling}var xn=null;function oy(r,o){var c=r.alternate,f=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:Zt(o,r),Qt(r),f&4&&(wi(3,r,r.return),ka(3,r),wi(5,r,r.return));break;case 1:Zt(o,r),Qt(r),f&512&&(ot||c===null||Nn(c,c.return)),f&64&&ii&&(r=r.updateQueue,r!==null&&(f=r.callbacks,f!==null&&(c=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=c===null?f:c.concat(f))));break;case 26:var g=xn;if(Zt(o,r),Qt(r),f&512&&(ot||c===null||Nn(c,c.return)),f&4){var m=c!==null?c.memoizedState:null;if(f=r.memoizedState,c===null)if(f===null)if(r.stateNode===null){e:{f=r.type,c=r.memoizedProps,g=g.ownerDocument||g;t:switch(f){case"title":m=g.getElementsByTagName("title")[0],(!m||m[aa]||m[Ct]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=g.createElement(f),g.head.insertBefore(m,g.querySelector("head > title"))),wt(m,f,c),m[Ct]=r,yt(m),f=m;break e;case"link":var b=tb("link","href",g).get(f+(c.href||""));if(b){for(var x=0;x<b.length;x++)if(m=b[x],m.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&m.getAttribute("rel")===(c.rel==null?null:c.rel)&&m.getAttribute("title")===(c.title==null?null:c.title)&&m.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){b.splice(x,1);break t}}m=g.createElement(f),wt(m,f,c),g.head.appendChild(m);break;case"meta":if(b=tb("meta","content",g).get(f+(c.content||""))){for(x=0;x<b.length;x++)if(m=b[x],m.getAttribute("content")===(c.content==null?null:""+c.content)&&m.getAttribute("name")===(c.name==null?null:c.name)&&m.getAttribute("property")===(c.property==null?null:c.property)&&m.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&m.getAttribute("charset")===(c.charSet==null?null:c.charSet)){b.splice(x,1);break t}}m=g.createElement(f),wt(m,f,c),g.head.appendChild(m);break;default:throw Error(i(468,f))}m[Ct]=r,yt(m),f=m}r.stateNode=f}else nb(g,r.type,r.stateNode);else r.stateNode=eb(g,f,r.memoizedProps);else m!==f?(m===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):m.count--,f===null?nb(g,r.type,r.stateNode):eb(g,f,r.memoizedProps)):f===null&&r.stateNode!==null&&th(r,r.memoizedProps,c.memoizedProps)}break;case 27:Zt(o,r),Qt(r),f&512&&(ot||c===null||Nn(c,c.return)),c!==null&&f&4&&th(r,r.memoizedProps,c.memoizedProps);break;case 5:if(Zt(o,r),Qt(r),f&512&&(ot||c===null||Nn(c,c.return)),r.flags&32){g=r.stateNode;try{Xs(g,"")}catch($){Ye(r,r.return,$)}}f&4&&r.stateNode!=null&&(g=r.memoizedProps,th(r,g,c!==null?c.memoizedProps:g)),f&1024&&(sh=!0);break;case 6:if(Zt(o,r),Qt(r),f&4){if(r.stateNode===null)throw Error(i(162));f=r.memoizedProps,c=r.stateNode;try{c.nodeValue=f}catch($){Ye(r,r.return,$)}}break;case 3:if(zl=null,g=xn,xn=Fl(o.containerInfo),Zt(o,r),xn=g,Qt(r),f&4&&c!==null&&c.memoizedState.isDehydrated)try{Ja(o.containerInfo)}catch($){Ye(r,r.return,$)}sh&&(sh=!1,ly(r));break;case 4:f=xn,xn=Fl(r.stateNode.containerInfo),Zt(o,r),Qt(r),xn=f;break;case 12:Zt(o,r),Qt(r);break;case 13:Zt(o,r),Qt(r),r.child.flags&8192&&r.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(fh=Mn()),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,rh(r,f)));break;case 22:g=r.memoizedState!==null;var E=c!==null&&c.memoizedState!==null,j=ii,q=ot;if(ii=j||g,ot=q||E,Zt(o,r),ot=q,ii=j,Qt(r),f&8192)e:for(o=r.stateNode,o._visibility=g?o._visibility&-2:o._visibility|1,g&&(c===null||E||ii||ot||_s(r)),c=null,o=r;;){if(o.tag===5||o.tag===26){if(c===null){E=c=o;try{if(m=E.stateNode,g)b=m.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none";else{x=E.stateNode;var Q=E.memoizedProps.style,W=Q!=null&&Q.hasOwnProperty("display")?Q.display:null;x.style.display=W==null||typeof W=="boolean"?"":(""+W).trim()}}catch($){Ye(E,E.return,$)}}}else if(o.tag===6){if(c===null){E=o;try{E.stateNode.nodeValue=g?"":E.memoizedProps}catch($){Ye(E,E.return,$)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===r)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;c===o&&(c=null),o=o.return}c===o&&(c=null),o.sibling.return=o.return,o=o.sibling}f&4&&(f=r.updateQueue,f!==null&&(c=f.retryQueue,c!==null&&(f.retryQueue=null,rh(r,c))));break;case 19:Zt(o,r),Qt(r),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,rh(r,f)));break;case 30:break;case 21:break;default:Zt(o,r),Qt(r)}}function Qt(r){var o=r.flags;if(o&2){try{for(var c,f=r.return;f!==null;){if(ey(f)){c=f;break}f=f.return}if(c==null)throw Error(i(160));switch(c.tag){case 27:var g=c.stateNode,m=nh(r);El(r,m,g);break;case 5:var b=c.stateNode;c.flags&32&&(Xs(b,""),c.flags&=-33);var x=nh(r);El(r,x,b);break;case 3:case 4:var E=c.stateNode.containerInfo,j=nh(r);ih(r,j,E);break;default:throw Error(i(161))}}catch(q){Ye(r,r.return,q)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function ly(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var o=r;ly(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),r=r.sibling}}function Ei(r,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)iy(r,o.alternate,o),o=o.sibling}function _s(r){for(r=r.child;r!==null;){var o=r;switch(o.tag){case 0:case 11:case 14:case 15:wi(4,o,o.return),_s(o);break;case 1:Nn(o,o.return);var c=o.stateNode;typeof c.componentWillUnmount=="function"&&G_(o,o.return,c),_s(o);break;case 27:$a(o.stateNode);case 26:case 5:Nn(o,o.return),_s(o);break;case 22:o.memoizedState===null&&_s(o);break;case 30:_s(o);break;default:_s(o)}r=r.sibling}}function Ri(r,o,c){for(c=c&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var f=o.alternate,g=r,m=o,b=m.flags;switch(m.tag){case 0:case 11:case 15:Ri(g,m,c),ka(4,m);break;case 1:if(Ri(g,m,c),f=m,g=f.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(j){Ye(f,f.return,j)}if(f=m,g=f.updateQueue,g!==null){var x=f.stateNode;try{var E=g.shared.hiddenCallbacks;if(E!==null)for(g.shared.hiddenCallbacks=null,g=0;g<E.length;g++)Bm(E[g],x)}catch(j){Ye(f,f.return,j)}}c&&b&64&&Q_(m),Ua(m,m.return);break;case 27:ty(m);case 26:case 5:Ri(g,m,c),c&&f===null&&b&4&&J_(m),Ua(m,m.return);break;case 12:Ri(g,m,c);break;case 13:Ri(g,m,c),c&&b&4&&ay(g,m);break;case 22:m.memoizedState===null&&Ri(g,m,c),Ua(m,m.return);break;case 30:break;default:Ri(g,m,c)}o=o.sibling}}function ah(r,o){var c=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),r=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(r=o.memoizedState.cachePool.pool),r!==c&&(r!=null&&r.refCount++,c!=null&&Ta(c))}function oh(r,o){r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&Ta(r))}function Pn(r,o,c,f){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)cy(r,o,c,f),o=o.sibling}function cy(r,o,c,f){var g=o.flags;switch(o.tag){case 0:case 11:case 15:Pn(r,o,c,f),g&2048&&ka(9,o);break;case 1:Pn(r,o,c,f);break;case 3:Pn(r,o,c,f),g&2048&&(r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&Ta(r)));break;case 12:if(g&2048){Pn(r,o,c,f),r=o.stateNode;try{var m=o.memoizedProps,b=m.id,x=m.onPostCommit;typeof x=="function"&&x(b,o.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(E){Ye(o,o.return,E)}}else Pn(r,o,c,f);break;case 13:Pn(r,o,c,f);break;case 23:break;case 22:m=o.stateNode,b=o.alternate,o.memoizedState!==null?m._visibility&2?Pn(r,o,c,f):Ba(r,o):m._visibility&2?Pn(r,o,c,f):(m._visibility|=2,fr(r,o,c,f,(o.subtreeFlags&10256)!==0)),g&2048&&ah(b,o);break;case 24:Pn(r,o,c,f),g&2048&&oh(o.alternate,o);break;default:Pn(r,o,c,f)}}function fr(r,o,c,f,g){for(g=g&&(o.subtreeFlags&10256)!==0,o=o.child;o!==null;){var m=r,b=o,x=c,E=f,j=b.flags;switch(b.tag){case 0:case 11:case 15:fr(m,b,x,E,g),ka(8,b);break;case 23:break;case 22:var q=b.stateNode;b.memoizedState!==null?q._visibility&2?fr(m,b,x,E,g):Ba(m,b):(q._visibility|=2,fr(m,b,x,E,g)),g&&j&2048&&ah(b.alternate,b);break;case 24:fr(m,b,x,E,g),g&&j&2048&&oh(b.alternate,b);break;default:fr(m,b,x,E,g)}o=o.sibling}}function Ba(r,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var c=r,f=o,g=f.flags;switch(f.tag){case 22:Ba(c,f),g&2048&&ah(f.alternate,f);break;case 24:Ba(c,f),g&2048&&oh(f.alternate,f);break;default:Ba(c,f)}o=o.sibling}}var La=8192;function hr(r){if(r.subtreeFlags&La)for(r=r.child;r!==null;)uy(r),r=r.sibling}function uy(r){switch(r.tag){case 26:hr(r),r.flags&La&&r.memoizedState!==null&&MS(xn,r.memoizedState,r.memoizedProps);break;case 5:hr(r);break;case 3:case 4:var o=xn;xn=Fl(r.stateNode.containerInfo),hr(r),xn=o;break;case 22:r.memoizedState===null&&(o=r.alternate,o!==null&&o.memoizedState!==null?(o=La,La=16777216,hr(r),La=o):hr(r));break;default:hr(r)}}function fy(r){var o=r.alternate;if(o!==null&&(r=o.child,r!==null)){o.child=null;do o=r.sibling,r.sibling=null,r=o;while(r!==null)}}function Fa(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var c=0;c<o.length;c++){var f=o[c];vt=f,dy(f,r)}fy(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)hy(r),r=r.sibling}function hy(r){switch(r.tag){case 0:case 11:case 15:Fa(r),r.flags&2048&&wi(9,r,r.return);break;case 3:Fa(r);break;case 12:Fa(r);break;case 22:var o=r.stateNode;r.memoizedState!==null&&o._visibility&2&&(r.return===null||r.return.tag!==13)?(o._visibility&=-3,Rl(r)):Fa(r);break;default:Fa(r)}}function Rl(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var c=0;c<o.length;c++){var f=o[c];vt=f,dy(f,r)}fy(r)}for(r=r.child;r!==null;){switch(o=r,o.tag){case 0:case 11:case 15:wi(8,o,o.return),Rl(o);break;case 22:c=o.stateNode,c._visibility&2&&(c._visibility&=-3,Rl(o));break;default:Rl(o)}r=r.sibling}}function dy(r,o){for(;vt!==null;){var c=vt;switch(c.tag){case 0:case 11:case 15:wi(8,c,o);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var f=c.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Ta(c.memoizedState.cache)}if(f=c.child,f!==null)f.return=c,vt=f;else e:for(c=r;vt!==null;){f=vt;var g=f.sibling,m=f.return;if(sy(f),f===c){vt=null;break e}if(g!==null){g.return=m,vt=g;break e}vt=m}}}var $x={getCacheForType:function(r){var o=Mt(dt),c=o.data.get(r);return c===void 0&&(c=r(),o.data.set(r,c)),c}},Xx=typeof WeakMap=="function"?WeakMap:Map,Ve=0,Ke=null,Me=null,Ne=0,ze=0,Gt=null,Ci=!1,dr=!1,lh=!1,ri=0,nt=0,Mi=0,ys=0,ch=0,hn=0,gr=0,Va=null,Ht=null,uh=!1,fh=0,Cl=1/0,Ml=null,Oi=null,At=0,Ii=null,pr=null,mr=0,hh=0,dh=null,gy=null,za=0,gh=null;function Jt(){if((Ve&2)!==0&&Ne!==0)return Ne&-Ne;if(Y.T!==null){var r=ir;return r!==0?r:Th()}return Op()}function py(){hn===0&&(hn=(Ne&536870912)===0||ke?Ep():536870912);var r=fn.current;return r!==null&&(r.flags|=32),hn}function en(r,o,c){(r===Ke&&(ze===2||ze===9)||r.cancelPendingCommit!==null)&&(_r(r,0),Ni(r,Ne,hn,!1)),ra(r,c),((Ve&2)===0||r!==Ke)&&(r===Ke&&((Ve&2)===0&&(ys|=c),nt===4&&Ni(r,Ne,hn,!1)),Dn(r))}function my(r,o,c){if((Ve&6)!==0)throw Error(i(327));var f=!c&&(o&124)===0&&(o&r.expiredLanes)===0||sa(r,o),g=f?Kx(r,o):_h(r,o,!0),m=f;do{if(g===0){dr&&!f&&Ni(r,o,0,!1);break}else{if(c=r.current.alternate,m&&!Yx(c)){g=_h(r,o,!1),m=!1;continue}if(g===2){if(m=o,r.errorRecoveryDisabledLanes&m)var b=0;else b=r.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){o=b;e:{var x=r;g=Va;var E=x.current.memoizedState.isDehydrated;if(E&&(_r(x,b).flags|=256),b=_h(x,b,!1),b!==2){if(lh&&!E){x.errorRecoveryDisabledLanes|=m,ys|=m,g=4;break e}m=Ht,Ht=g,m!==null&&(Ht===null?Ht=m:Ht.push.apply(Ht,m))}g=b}if(m=!1,g!==2)continue}}if(g===1){_r(r,0),Ni(r,o,0,!0);break}e:{switch(f=r,m=g,m){case 0:case 1:throw Error(i(345));case 4:if((o&4194048)!==o)break;case 6:Ni(f,o,hn,!Ci);break e;case 2:Ht=null;break;case 3:case 5:break;default:throw Error(i(329))}if((o&62914560)===o&&(g=fh+300-Mn(),10<g)){if(Ni(f,o,hn,!Ci),Vo(f,0,!0)!==0)break e;f.timeoutHandle=$y(_y.bind(null,f,c,Ht,Ml,uh,o,hn,ys,gr,Ci,m,2,-0,0),g);break e}_y(f,c,Ht,Ml,uh,o,hn,ys,gr,Ci,m,0,-0,0)}}break}while(!0);Dn(r)}function _y(r,o,c,f,g,m,b,x,E,j,q,Q,W,$){if(r.timeoutHandle=-1,Q=o.subtreeFlags,(Q&8192||(Q&16785408)===16785408)&&(qa={stylesheets:null,count:0,unsuspend:CS},uy(o),Q=OS(),Q!==null)){r.cancelPendingCommit=Q(Ay.bind(null,r,o,m,c,f,g,b,x,E,q,1,W,$)),Ni(r,m,b,!j);return}Ay(r,o,m,c,f,g,b,x,E)}function Yx(r){for(var o=r;;){var c=o.tag;if((c===0||c===11||c===15)&&o.flags&16384&&(c=o.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var f=0;f<c.length;f++){var g=c[f],m=g.getSnapshot;g=g.value;try{if(!qt(m(),g))return!1}catch{return!1}}if(c=o.child,o.subtreeFlags&16384&&c!==null)c.return=o,o=c;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Ni(r,o,c,f){o&=~ch,o&=~ys,r.suspendedLanes|=o,r.pingedLanes&=~o,f&&(r.warmLanes|=o),f=r.expirationTimes;for(var g=o;0<g;){var m=31-Yt(g),b=1<<m;f[m]=-1,g&=~b}c!==0&&Cp(r,c,o)}function Ol(){return(Ve&6)===0?(Ha(0),!1):!0}function ph(){if(Me!==null){if(ze===0)var r=Me.return;else r=Me,Qn=hs=null,Nf(r),cr=null,Na=0,r=Me;for(;r!==null;)Z_(r.alternate,r),r=r.return;Me=null}}function _r(r,o){var c=r.timeoutHandle;c!==-1&&(r.timeoutHandle=-1,fS(c)),c=r.cancelPendingCommit,c!==null&&(r.cancelPendingCommit=null,c()),ph(),Ke=r,Me=c=qn(r.current,null),Ne=o,ze=0,Gt=null,Ci=!1,dr=sa(r,o),lh=!1,gr=hn=ch=ys=Mi=nt=0,Ht=Va=null,uh=!1,(o&8)!==0&&(o|=o&32);var f=r.entangledLanes;if(f!==0)for(r=r.entanglements,f&=o;0<f;){var g=31-Yt(f),m=1<<g;o|=r[g],f&=~m}return ri=o,Go(),c}function yy(r,o){Re=null,Y.H=_l,o===Sa||o===ol?(o=km(),ze=3):o===Nm?(o=km(),ze=4):ze=o===U_?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,Gt=o,Me===null&&(nt=1,xl(r,on(o,r.current)))}function by(){var r=Y.H;return Y.H=_l,r===null?_l:r}function vy(){var r=Y.A;return Y.A=$x,r}function mh(){nt=4,Ci||(Ne&4194048)!==Ne&&fn.current!==null||(dr=!0),(Mi&134217727)===0&&(ys&134217727)===0||Ke===null||Ni(Ke,Ne,hn,!1)}function _h(r,o,c){var f=Ve;Ve|=2;var g=by(),m=vy();(Ke!==r||Ne!==o)&&(Ml=null,_r(r,o)),o=!1;var b=nt;e:do try{if(ze!==0&&Me!==null){var x=Me,E=Gt;switch(ze){case 8:ph(),b=6;break e;case 3:case 2:case 9:case 6:fn.current===null&&(o=!0);var j=ze;if(ze=0,Gt=null,yr(r,x,E,j),c&&dr){b=0;break e}break;default:j=ze,ze=0,Gt=null,yr(r,x,E,j)}}qx(),b=nt;break}catch(q){yy(r,q)}while(!0);return o&&r.shellSuspendCounter++,Qn=hs=null,Ve=f,Y.H=g,Y.A=m,Me===null&&(Ke=null,Ne=0,Go()),b}function qx(){for(;Me!==null;)Ty(Me)}function Kx(r,o){var c=Ve;Ve|=2;var f=by(),g=vy();Ke!==r||Ne!==o?(Ml=null,Cl=Mn()+500,_r(r,o)):dr=sa(r,o);e:do try{if(ze!==0&&Me!==null){o=Me;var m=Gt;t:switch(ze){case 1:ze=0,Gt=null,yr(r,o,m,1);break;case 2:case 9:if(Pm(m)){ze=0,Gt=null,xy(o);break}o=function(){ze!==2&&ze!==9||Ke!==r||(ze=7),Dn(r)},m.then(o,o);break e;case 3:ze=7;break e;case 4:ze=5;break e;case 7:Pm(m)?(ze=0,Gt=null,xy(o)):(ze=0,Gt=null,yr(r,o,m,7));break;case 5:var b=null;switch(Me.tag){case 26:b=Me.memoizedState;case 5:case 27:var x=Me;if(!b||ib(b)){ze=0,Gt=null;var E=x.sibling;if(E!==null)Me=E;else{var j=x.return;j!==null?(Me=j,Il(j)):Me=null}break t}}ze=0,Gt=null,yr(r,o,m,5);break;case 6:ze=0,Gt=null,yr(r,o,m,6);break;case 8:ph(),nt=6;break e;default:throw Error(i(462))}}Zx();break}catch(q){yy(r,q)}while(!0);return Qn=hs=null,Y.H=f,Y.A=g,Ve=c,Me!==null?0:(Ke=null,Ne=0,Go(),nt)}function Zx(){for(;Me!==null&&!yT();)Ty(Me)}function Ty(r){var o=q_(r.alternate,r,ri);r.memoizedProps=r.pendingProps,o===null?Il(r):Me=o}function xy(r){var o=r,c=o.alternate;switch(o.tag){case 15:case 0:o=H_(c,o,o.pendingProps,o.type,void 0,Ne);break;case 11:o=H_(c,o,o.pendingProps,o.type.render,o.ref,Ne);break;case 5:Nf(o);default:Z_(c,o),o=Me=Sm(o,ri),o=q_(c,o,ri)}r.memoizedProps=r.pendingProps,o===null?Il(r):Me=o}function yr(r,o,c,f){Qn=hs=null,Nf(o),cr=null,Na=0;var g=o.return;try{if(Fx(r,g,o,c,Ne)){nt=1,xl(r,on(c,r.current)),Me=null;return}}catch(m){if(g!==null)throw Me=g,m;nt=1,xl(r,on(c,r.current)),Me=null;return}o.flags&32768?(ke||f===1?r=!0:dr||(Ne&536870912)!==0?r=!1:(Ci=r=!0,(f===2||f===9||f===3||f===6)&&(f=fn.current,f!==null&&f.tag===13&&(f.flags|=16384))),Sy(o,r)):Il(o)}function Il(r){var o=r;do{if((o.flags&32768)!==0){Sy(o,Ci);return}r=o.return;var c=zx(o.alternate,o,ri);if(c!==null){Me=c;return}if(o=o.sibling,o!==null){Me=o;return}Me=o=r}while(o!==null);nt===0&&(nt=5)}function Sy(r,o){do{var c=Hx(r.alternate,r);if(c!==null){c.flags&=32767,Me=c;return}if(c=r.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!o&&(r=r.sibling,r!==null)){Me=r;return}Me=r=c}while(r!==null);nt=6,Me=null}function Ay(r,o,c,f,g,m,b,x,E){r.cancelPendingCommit=null;do Nl();while(At!==0);if((Ve&6)!==0)throw Error(i(327));if(o!==null){if(o===r.current)throw Error(i(177));if(m=o.lanes|o.childLanes,m|=of,CT(r,c,m,b,x,E),r===Ke&&(Me=Ke=null,Ne=0),pr=o,Ii=r,mr=c,hh=m,dh=g,gy=f,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,eS(Bo,function(){return My(),null})):(r.callbackNode=null,r.callbackPriority=0),f=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||f){f=Y.T,Y.T=null,g=ie.p,ie.p=2,b=Ve,Ve|=4;try{jx(r,o,c)}finally{Ve=b,ie.p=g,Y.T=f}}At=1,wy(),Ey(),Ry()}}function wy(){if(At===1){At=0;var r=Ii,o=pr,c=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||c){c=Y.T,Y.T=null;var f=ie.p;ie.p=2;var g=Ve;Ve|=4;try{oy(o,r);var m=Mh,b=dm(r.containerInfo),x=m.focusedElem,E=m.selectionRange;if(b!==x&&x&&x.ownerDocument&&hm(x.ownerDocument.documentElement,x)){if(E!==null&&tf(x)){var j=E.start,q=E.end;if(q===void 0&&(q=j),"selectionStart"in x)x.selectionStart=j,x.selectionEnd=Math.min(q,x.value.length);else{var Q=x.ownerDocument||document,W=Q&&Q.defaultView||window;if(W.getSelection){var $=W.getSelection(),Te=x.textContent.length,ye=Math.min(E.start,Te),We=E.end===void 0?ye:Math.min(E.end,Te);!$.extend&&ye>We&&(b=We,We=ye,ye=b);var U=fm(x,ye),I=fm(x,We);if(U&&I&&($.rangeCount!==1||$.anchorNode!==U.node||$.anchorOffset!==U.offset||$.focusNode!==I.node||$.focusOffset!==I.offset)){var V=Q.createRange();V.setStart(U.node,U.offset),$.removeAllRanges(),ye>We?($.addRange(V),$.extend(I.node,I.offset)):(V.setEnd(I.node,I.offset),$.addRange(V))}}}}for(Q=[],$=x;$=$.parentNode;)$.nodeType===1&&Q.push({element:$,left:$.scrollLeft,top:$.scrollTop});for(typeof x.focus=="function"&&x.focus(),x=0;x<Q.length;x++){var K=Q[x];K.element.scrollLeft=K.left,K.element.scrollTop=K.top}}Wl=!!Ch,Mh=Ch=null}finally{Ve=g,ie.p=f,Y.T=c}}r.current=o,At=2}}function Ey(){if(At===2){At=0;var r=Ii,o=pr,c=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||c){c=Y.T,Y.T=null;var f=ie.p;ie.p=2;var g=Ve;Ve|=4;try{iy(r,o.alternate,o)}finally{Ve=g,ie.p=f,Y.T=c}}At=3}}function Ry(){if(At===4||At===3){At=0,bT();var r=Ii,o=pr,c=mr,f=gy;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?At=5:(At=0,pr=Ii=null,Cy(r,r.pendingLanes));var g=r.pendingLanes;if(g===0&&(Oi=null),Du(c),o=o.stateNode,Xt&&typeof Xt.onCommitFiberRoot=="function")try{Xt.onCommitFiberRoot(ia,o,void 0,(o.current.flags&128)===128)}catch{}if(f!==null){o=Y.T,g=ie.p,ie.p=2,Y.T=null;try{for(var m=r.onRecoverableError,b=0;b<f.length;b++){var x=f[b];m(x.value,{componentStack:x.stack})}}finally{Y.T=o,ie.p=g}}(mr&3)!==0&&Nl(),Dn(r),g=r.pendingLanes,(c&4194090)!==0&&(g&42)!==0?r===gh?za++:(za=0,gh=r):za=0,Ha(0)}}function Cy(r,o){(r.pooledCacheLanes&=o)===0&&(o=r.pooledCache,o!=null&&(r.pooledCache=null,Ta(o)))}function Nl(r){return wy(),Ey(),Ry(),My()}function My(){if(At!==5)return!1;var r=Ii,o=hh;hh=0;var c=Du(mr),f=Y.T,g=ie.p;try{ie.p=32>c?32:c,Y.T=null,c=dh,dh=null;var m=Ii,b=mr;if(At=0,pr=Ii=null,mr=0,(Ve&6)!==0)throw Error(i(331));var x=Ve;if(Ve|=4,hy(m.current),cy(m,m.current,b,c),Ve=x,Ha(0,!1),Xt&&typeof Xt.onPostCommitFiberRoot=="function")try{Xt.onPostCommitFiberRoot(ia,m)}catch{}return!0}finally{ie.p=g,Y.T=f,Cy(r,o)}}function Oy(r,o,c){o=on(c,o),o=Xf(r.stateNode,o,2),r=Ti(r,o,2),r!==null&&(ra(r,2),Dn(r))}function Ye(r,o,c){if(r.tag===3)Oy(r,r,c);else for(;o!==null;){if(o.tag===3){Oy(o,r,c);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Oi===null||!Oi.has(f))){r=on(c,r),c=D_(2),f=Ti(o,c,2),f!==null&&(k_(c,f,o,r),ra(f,2),Dn(f));break}}o=o.return}}function yh(r,o,c){var f=r.pingCache;if(f===null){f=r.pingCache=new Xx;var g=new Set;f.set(o,g)}else g=f.get(o),g===void 0&&(g=new Set,f.set(o,g));g.has(c)||(lh=!0,g.add(c),r=Qx.bind(null,r,o,c),o.then(r,r))}function Qx(r,o,c){var f=r.pingCache;f!==null&&f.delete(o),r.pingedLanes|=r.suspendedLanes&c,r.warmLanes&=~c,Ke===r&&(Ne&c)===c&&(nt===4||nt===3&&(Ne&62914560)===Ne&&300>Mn()-fh?(Ve&2)===0&&_r(r,0):ch|=c,gr===Ne&&(gr=0)),Dn(r)}function Iy(r,o){o===0&&(o=Rp()),r=Js(r,o),r!==null&&(ra(r,o),Dn(r))}function Gx(r){var o=r.memoizedState,c=0;o!==null&&(c=o.retryLane),Iy(r,c)}function Jx(r,o){var c=0;switch(r.tag){case 13:var f=r.stateNode,g=r.memoizedState;g!==null&&(c=g.retryLane);break;case 19:f=r.stateNode;break;case 22:f=r.stateNode._retryCache;break;default:throw Error(i(314))}f!==null&&f.delete(o),Iy(r,c)}function eS(r,o){return ts(r,o)}var Pl=null,br=null,bh=!1,Dl=!1,vh=!1,bs=0;function Dn(r){r!==br&&r.next===null&&(br===null?Pl=br=r:br=br.next=r),Dl=!0,bh||(bh=!0,nS())}function Ha(r,o){if(!vh&&Dl){vh=!0;do for(var c=!1,f=Pl;f!==null;){if(r!==0){var g=f.pendingLanes;if(g===0)var m=0;else{var b=f.suspendedLanes,x=f.pingedLanes;m=(1<<31-Yt(42|r)+1)-1,m&=g&~(b&~x),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(c=!0,ky(f,m))}else m=Ne,m=Vo(f,f===Ke?m:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(m&3)===0||sa(f,m)||(c=!0,ky(f,m));f=f.next}while(c);vh=!1}}function tS(){Ny()}function Ny(){Dl=bh=!1;var r=0;bs!==0&&(uS()&&(r=bs),bs=0);for(var o=Mn(),c=null,f=Pl;f!==null;){var g=f.next,m=Py(f,o);m===0?(f.next=null,c===null?Pl=g:c.next=g,g===null&&(br=c)):(c=f,(r!==0||(m&3)!==0)&&(Dl=!0)),f=g}Ha(r)}function Py(r,o){for(var c=r.suspendedLanes,f=r.pingedLanes,g=r.expirationTimes,m=r.pendingLanes&-62914561;0<m;){var b=31-Yt(m),x=1<<b,E=g[b];E===-1?((x&c)===0||(x&f)!==0)&&(g[b]=RT(x,o)):E<=o&&(r.expiredLanes|=x),m&=~x}if(o=Ke,c=Ne,c=Vo(r,r===o?c:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),f=r.callbackNode,c===0||r===o&&(ze===2||ze===9)||r.cancelPendingCommit!==null)return f!==null&&f!==null&&Iu(f),r.callbackNode=null,r.callbackPriority=0;if((c&3)===0||sa(r,c)){if(o=c&-c,o===r.callbackPriority)return o;switch(f!==null&&Iu(f),Du(c)){case 2:case 8:c=Ap;break;case 32:c=Bo;break;case 268435456:c=wp;break;default:c=Bo}return f=Dy.bind(null,r),c=ts(c,f),r.callbackPriority=o,r.callbackNode=c,o}return f!==null&&f!==null&&Iu(f),r.callbackPriority=2,r.callbackNode=null,2}function Dy(r,o){if(At!==0&&At!==5)return r.callbackNode=null,r.callbackPriority=0,null;var c=r.callbackNode;if(Nl()&&r.callbackNode!==c)return null;var f=Ne;return f=Vo(r,r===Ke?f:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),f===0?null:(my(r,f,o),Py(r,Mn()),r.callbackNode!=null&&r.callbackNode===c?Dy.bind(null,r):null)}function ky(r,o){if(Nl())return null;my(r,o,!0)}function nS(){hS(function(){(Ve&6)!==0?ts(Sp,tS):Ny()})}function Th(){return bs===0&&(bs=Ep()),bs}function Uy(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:$o(""+r)}function By(r,o){var c=o.ownerDocument.createElement("input");return c.name=o.name,c.value=o.value,r.id&&c.setAttribute("form",r.id),o.parentNode.insertBefore(c,o),r=new FormData(r),c.parentNode.removeChild(c),r}function iS(r,o,c,f,g){if(o==="submit"&&c&&c.stateNode===g){var m=Uy((g[Lt]||null).action),b=f.submitter;b&&(o=(o=b[Lt]||null)?Uy(o.formAction):b.getAttribute("formAction"),o!==null&&(m=o,b=null));var x=new Ko("action","action",null,f,g);r.push({event:x,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(bs!==0){var E=b?By(g,b):new FormData(g);zf(c,{pending:!0,data:E,method:g.method,action:m},null,E)}}else typeof m=="function"&&(x.preventDefault(),E=b?By(g,b):new FormData(g),zf(c,{pending:!0,data:E,method:g.method,action:m},m,E))},currentTarget:g}]})}}for(var xh=0;xh<af.length;xh++){var Sh=af[xh],sS=Sh.toLowerCase(),rS=Sh[0].toUpperCase()+Sh.slice(1);Tn(sS,"on"+rS)}Tn(mm,"onAnimationEnd"),Tn(_m,"onAnimationIteration"),Tn(ym,"onAnimationStart"),Tn("dblclick","onDoubleClick"),Tn("focusin","onFocus"),Tn("focusout","onBlur"),Tn(xx,"onTransitionRun"),Tn(Sx,"onTransitionStart"),Tn(Ax,"onTransitionCancel"),Tn(bm,"onTransitionEnd"),js("onMouseEnter",["mouseout","mouseover"]),js("onMouseLeave",["mouseout","mouseover"]),js("onPointerEnter",["pointerout","pointerover"]),js("onPointerLeave",["pointerout","pointerover"]),is("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),is("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),is("onBeforeInput",["compositionend","keypress","textInput","paste"]),is("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),is("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),is("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ja="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),aS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ja));function Ly(r,o){o=(o&4)!==0;for(var c=0;c<r.length;c++){var f=r[c],g=f.event;f=f.listeners;e:{var m=void 0;if(o)for(var b=f.length-1;0<=b;b--){var x=f[b],E=x.instance,j=x.currentTarget;if(x=x.listener,E!==m&&g.isPropagationStopped())break e;m=x,g.currentTarget=j;try{m(g)}catch(q){Tl(q)}g.currentTarget=null,m=E}else for(b=0;b<f.length;b++){if(x=f[b],E=x.instance,j=x.currentTarget,x=x.listener,E!==m&&g.isPropagationStopped())break e;m=x,g.currentTarget=j;try{m(g)}catch(q){Tl(q)}g.currentTarget=null,m=E}}}}function Oe(r,o){var c=o[ku];c===void 0&&(c=o[ku]=new Set);var f=r+"__bubble";c.has(f)||(Fy(o,r,2,!1),c.add(f))}function Ah(r,o,c){var f=0;o&&(f|=4),Fy(c,r,f,o)}var kl="_reactListening"+Math.random().toString(36).slice(2);function wh(r){if(!r[kl]){r[kl]=!0,Np.forEach(function(c){c!=="selectionchange"&&(aS.has(c)||Ah(c,!1,r),Ah(c,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[kl]||(o[kl]=!0,Ah("selectionchange",!1,o))}}function Fy(r,o,c,f){switch(cb(o)){case 2:var g=PS;break;case 8:g=DS;break;default:g=Fh}c=g.bind(null,o,c,r),g=void 0,!Xu||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(g=!0),f?g!==void 0?r.addEventListener(o,c,{capture:!0,passive:g}):r.addEventListener(o,c,!0):g!==void 0?r.addEventListener(o,c,{passive:g}):r.addEventListener(o,c,!1)}function Eh(r,o,c,f,g){var m=f;if((o&1)===0&&(o&2)===0&&f!==null)e:for(;;){if(f===null)return;var b=f.tag;if(b===3||b===4){var x=f.stateNode.containerInfo;if(x===g)break;if(b===4)for(b=f.return;b!==null;){var E=b.tag;if((E===3||E===4)&&b.stateNode.containerInfo===g)return;b=b.return}for(;x!==null;){if(b=Vs(x),b===null)return;if(E=b.tag,E===5||E===6||E===26||E===27){f=m=b;continue e}x=x.parentNode}}f=f.return}Xp(function(){var j=m,q=Wu(c),Q=[];e:{var W=vm.get(r);if(W!==void 0){var $=Ko,Te=r;switch(r){case"keypress":if(Yo(c)===0)break e;case"keydown":case"keyup":$=ex;break;case"focusin":Te="focus",$=Zu;break;case"focusout":Te="blur",$=Zu;break;case"beforeblur":case"afterblur":$=Zu;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$=Kp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$=HT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$=ix;break;case mm:case _m:case ym:$=$T;break;case bm:$=rx;break;case"scroll":case"scrollend":$=VT;break;case"wheel":$=ox;break;case"copy":case"cut":case"paste":$=YT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$=Qp;break;case"toggle":case"beforetoggle":$=cx}var ye=(o&4)!==0,We=!ye&&(r==="scroll"||r==="scrollend"),U=ye?W!==null?W+"Capture":null:W;ye=[];for(var I=j,V;I!==null;){var K=I;if(V=K.stateNode,K=K.tag,K!==5&&K!==26&&K!==27||V===null||U===null||(K=la(I,U),K!=null&&ye.push(Wa(I,K,V))),We)break;I=I.return}0<ye.length&&(W=new $(W,Te,null,c,q),Q.push({event:W,listeners:ye}))}}if((o&7)===0){e:{if(W=r==="mouseover"||r==="pointerover",$=r==="mouseout"||r==="pointerout",W&&c!==ju&&(Te=c.relatedTarget||c.fromElement)&&(Vs(Te)||Te[Fs]))break e;if(($||W)&&(W=q.window===q?q:(W=q.ownerDocument)?W.defaultView||W.parentWindow:window,$?(Te=c.relatedTarget||c.toElement,$=j,Te=Te?Vs(Te):null,Te!==null&&(We=a(Te),ye=Te.tag,Te!==We||ye!==5&&ye!==27&&ye!==6)&&(Te=null)):($=null,Te=j),$!==Te)){if(ye=Kp,K="onMouseLeave",U="onMouseEnter",I="mouse",(r==="pointerout"||r==="pointerover")&&(ye=Qp,K="onPointerLeave",U="onPointerEnter",I="pointer"),We=$==null?W:oa($),V=Te==null?W:oa(Te),W=new ye(K,I+"leave",$,c,q),W.target=We,W.relatedTarget=V,K=null,Vs(q)===j&&(ye=new ye(U,I+"enter",Te,c,q),ye.target=V,ye.relatedTarget=We,K=ye),We=K,$&&Te)t:{for(ye=$,U=Te,I=0,V=ye;V;V=vr(V))I++;for(V=0,K=U;K;K=vr(K))V++;for(;0<I-V;)ye=vr(ye),I--;for(;0<V-I;)U=vr(U),V--;for(;I--;){if(ye===U||U!==null&&ye===U.alternate)break t;ye=vr(ye),U=vr(U)}ye=null}else ye=null;$!==null&&Vy(Q,W,$,ye,!1),Te!==null&&We!==null&&Vy(Q,We,Te,ye,!0)}}e:{if(W=j?oa(j):window,$=W.nodeName&&W.nodeName.toLowerCase(),$==="select"||$==="input"&&W.type==="file")var ue=rm;else if(im(W))if(am)ue=bx;else{ue=_x;var Ce=mx}else $=W.nodeName,!$||$.toLowerCase()!=="input"||W.type!=="checkbox"&&W.type!=="radio"?j&&Hu(j.elementType)&&(ue=rm):ue=yx;if(ue&&(ue=ue(r,j))){sm(Q,ue,c,q);break e}Ce&&Ce(r,W,j),r==="focusout"&&j&&W.type==="number"&&j.memoizedProps.value!=null&&zu(W,"number",W.value)}switch(Ce=j?oa(j):window,r){case"focusin":(im(Ce)||Ce.contentEditable==="true")&&(Zs=Ce,nf=j,ma=null);break;case"focusout":ma=nf=Zs=null;break;case"mousedown":sf=!0;break;case"contextmenu":case"mouseup":case"dragend":sf=!1,gm(Q,c,q);break;case"selectionchange":if(Tx)break;case"keydown":case"keyup":gm(Q,c,q)}var pe;if(Gu)e:{switch(r){case"compositionstart":var be="onCompositionStart";break e;case"compositionend":be="onCompositionEnd";break e;case"compositionupdate":be="onCompositionUpdate";break e}be=void 0}else Ks?tm(r,c)&&(be="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(be="onCompositionStart");be&&(Gp&&c.locale!=="ko"&&(Ks||be!=="onCompositionStart"?be==="onCompositionEnd"&&Ks&&(pe=Yp()):(_i=q,Yu="value"in _i?_i.value:_i.textContent,Ks=!0)),Ce=Ul(j,be),0<Ce.length&&(be=new Zp(be,r,null,c,q),Q.push({event:be,listeners:Ce}),pe?be.data=pe:(pe=nm(c),pe!==null&&(be.data=pe)))),(pe=fx?hx(r,c):dx(r,c))&&(be=Ul(j,"onBeforeInput"),0<be.length&&(Ce=new Zp("onBeforeInput","beforeinput",null,c,q),Q.push({event:Ce,listeners:be}),Ce.data=pe)),iS(Q,r,j,c,q)}Ly(Q,o)})}function Wa(r,o,c){return{instance:r,listener:o,currentTarget:c}}function Ul(r,o){for(var c=o+"Capture",f=[];r!==null;){var g=r,m=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||m===null||(g=la(r,c),g!=null&&f.unshift(Wa(r,g,m)),g=la(r,o),g!=null&&f.push(Wa(r,g,m))),r.tag===3)return f;r=r.return}return[]}function vr(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function Vy(r,o,c,f,g){for(var m=o._reactName,b=[];c!==null&&c!==f;){var x=c,E=x.alternate,j=x.stateNode;if(x=x.tag,E!==null&&E===f)break;x!==5&&x!==26&&x!==27||j===null||(E=j,g?(j=la(c,m),j!=null&&b.unshift(Wa(c,j,E))):g||(j=la(c,m),j!=null&&b.push(Wa(c,j,E)))),c=c.return}b.length!==0&&r.push({event:o,listeners:b})}var oS=/\r\n?/g,lS=/\u0000|\uFFFD/g;function zy(r){return(typeof r=="string"?r:""+r).replace(oS,`
`).replace(lS,"")}function Hy(r,o){return o=zy(o),zy(r)===o}function Bl(){}function je(r,o,c,f,g,m){switch(c){case"children":typeof f=="string"?o==="body"||o==="textarea"&&f===""||Xs(r,f):(typeof f=="number"||typeof f=="bigint")&&o!=="body"&&Xs(r,""+f);break;case"className":Ho(r,"class",f);break;case"tabIndex":Ho(r,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Ho(r,c,f);break;case"style":Wp(r,f,m);break;case"data":if(o!=="object"){Ho(r,"data",f);break}case"src":case"href":if(f===""&&(o!=="a"||c!=="href")){r.removeAttribute(c);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){r.removeAttribute(c);break}f=$o(""+f),r.setAttribute(c,f);break;case"action":case"formAction":if(typeof f=="function"){r.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(c==="formAction"?(o!=="input"&&je(r,o,"name",g.name,g,null),je(r,o,"formEncType",g.formEncType,g,null),je(r,o,"formMethod",g.formMethod,g,null),je(r,o,"formTarget",g.formTarget,g,null)):(je(r,o,"encType",g.encType,g,null),je(r,o,"method",g.method,g,null),je(r,o,"target",g.target,g,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){r.removeAttribute(c);break}f=$o(""+f),r.setAttribute(c,f);break;case"onClick":f!=null&&(r.onclick=Bl);break;case"onScroll":f!=null&&Oe("scroll",r);break;case"onScrollEnd":f!=null&&Oe("scrollend",r);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(i(61));if(c=f.__html,c!=null){if(g.children!=null)throw Error(i(60));r.innerHTML=c}}break;case"multiple":r.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":r.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){r.removeAttribute("xlink:href");break}c=$o(""+f),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(c,""+f):r.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(c,""):r.removeAttribute(c);break;case"capture":case"download":f===!0?r.setAttribute(c,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(c,f):r.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?r.setAttribute(c,f):r.removeAttribute(c);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?r.removeAttribute(c):r.setAttribute(c,f);break;case"popover":Oe("beforetoggle",r),Oe("toggle",r),zo(r,"popover",f);break;case"xlinkActuate":Xn(r,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Xn(r,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Xn(r,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Xn(r,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Xn(r,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Xn(r,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Xn(r,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Xn(r,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Xn(r,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":zo(r,"is",f);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=LT.get(c)||c,zo(r,c,f))}}function Rh(r,o,c,f,g,m){switch(c){case"style":Wp(r,f,m);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(i(61));if(c=f.__html,c!=null){if(g.children!=null)throw Error(i(60));r.innerHTML=c}}break;case"children":typeof f=="string"?Xs(r,f):(typeof f=="number"||typeof f=="bigint")&&Xs(r,""+f);break;case"onScroll":f!=null&&Oe("scroll",r);break;case"onScrollEnd":f!=null&&Oe("scrollend",r);break;case"onClick":f!=null&&(r.onclick=Bl);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Pp.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(g=c.endsWith("Capture"),o=c.slice(2,g?c.length-7:void 0),m=r[Lt]||null,m=m!=null?m[c]:null,typeof m=="function"&&r.removeEventListener(o,m,g),typeof f=="function")){typeof m!="function"&&m!==null&&(c in r?r[c]=null:r.hasAttribute(c)&&r.removeAttribute(c)),r.addEventListener(o,f,g);break e}c in r?r[c]=f:f===!0?r.setAttribute(c,""):zo(r,c,f)}}}function wt(r,o,c){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Oe("error",r),Oe("load",r);var f=!1,g=!1,m;for(m in c)if(c.hasOwnProperty(m)){var b=c[m];if(b!=null)switch(m){case"src":f=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,o));default:je(r,o,m,b,c,null)}}g&&je(r,o,"srcSet",c.srcSet,c,null),f&&je(r,o,"src",c.src,c,null);return;case"input":Oe("invalid",r);var x=m=b=g=null,E=null,j=null;for(f in c)if(c.hasOwnProperty(f)){var q=c[f];if(q!=null)switch(f){case"name":g=q;break;case"type":b=q;break;case"checked":E=q;break;case"defaultChecked":j=q;break;case"value":m=q;break;case"defaultValue":x=q;break;case"children":case"dangerouslySetInnerHTML":if(q!=null)throw Error(i(137,o));break;default:je(r,o,f,q,c,null)}}Vp(r,m,x,E,j,b,g,!1),jo(r);return;case"select":Oe("invalid",r),f=b=m=null;for(g in c)if(c.hasOwnProperty(g)&&(x=c[g],x!=null))switch(g){case"value":m=x;break;case"defaultValue":b=x;break;case"multiple":f=x;default:je(r,o,g,x,c,null)}o=m,c=b,r.multiple=!!f,o!=null?$s(r,!!f,o,!1):c!=null&&$s(r,!!f,c,!0);return;case"textarea":Oe("invalid",r),m=g=f=null;for(b in c)if(c.hasOwnProperty(b)&&(x=c[b],x!=null))switch(b){case"value":f=x;break;case"defaultValue":g=x;break;case"children":m=x;break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(i(91));break;default:je(r,o,b,x,c,null)}Hp(r,f,g,m),jo(r);return;case"option":for(E in c)if(c.hasOwnProperty(E)&&(f=c[E],f!=null))switch(E){case"selected":r.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:je(r,o,E,f,c,null)}return;case"dialog":Oe("beforetoggle",r),Oe("toggle",r),Oe("cancel",r),Oe("close",r);break;case"iframe":case"object":Oe("load",r);break;case"video":case"audio":for(f=0;f<ja.length;f++)Oe(ja[f],r);break;case"image":Oe("error",r),Oe("load",r);break;case"details":Oe("toggle",r);break;case"embed":case"source":case"link":Oe("error",r),Oe("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(j in c)if(c.hasOwnProperty(j)&&(f=c[j],f!=null))switch(j){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,o));default:je(r,o,j,f,c,null)}return;default:if(Hu(o)){for(q in c)c.hasOwnProperty(q)&&(f=c[q],f!==void 0&&Rh(r,o,q,f,c,void 0));return}}for(x in c)c.hasOwnProperty(x)&&(f=c[x],f!=null&&je(r,o,x,f,c,null))}function cS(r,o,c,f){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,m=null,b=null,x=null,E=null,j=null,q=null;for($ in c){var Q=c[$];if(c.hasOwnProperty($)&&Q!=null)switch($){case"checked":break;case"value":break;case"defaultValue":E=Q;default:f.hasOwnProperty($)||je(r,o,$,null,f,Q)}}for(var W in f){var $=f[W];if(Q=c[W],f.hasOwnProperty(W)&&($!=null||Q!=null))switch(W){case"type":m=$;break;case"name":g=$;break;case"checked":j=$;break;case"defaultChecked":q=$;break;case"value":b=$;break;case"defaultValue":x=$;break;case"children":case"dangerouslySetInnerHTML":if($!=null)throw Error(i(137,o));break;default:$!==Q&&je(r,o,W,$,f,Q)}}Vu(r,b,x,E,j,q,m,g);return;case"select":$=b=x=W=null;for(m in c)if(E=c[m],c.hasOwnProperty(m)&&E!=null)switch(m){case"value":break;case"multiple":$=E;default:f.hasOwnProperty(m)||je(r,o,m,null,f,E)}for(g in f)if(m=f[g],E=c[g],f.hasOwnProperty(g)&&(m!=null||E!=null))switch(g){case"value":W=m;break;case"defaultValue":x=m;break;case"multiple":b=m;default:m!==E&&je(r,o,g,m,f,E)}o=x,c=b,f=$,W!=null?$s(r,!!c,W,!1):!!f!=!!c&&(o!=null?$s(r,!!c,o,!0):$s(r,!!c,c?[]:"",!1));return;case"textarea":$=W=null;for(x in c)if(g=c[x],c.hasOwnProperty(x)&&g!=null&&!f.hasOwnProperty(x))switch(x){case"value":break;case"children":break;default:je(r,o,x,null,f,g)}for(b in f)if(g=f[b],m=c[b],f.hasOwnProperty(b)&&(g!=null||m!=null))switch(b){case"value":W=g;break;case"defaultValue":$=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(i(91));break;default:g!==m&&je(r,o,b,g,f,m)}zp(r,W,$);return;case"option":for(var Te in c)if(W=c[Te],c.hasOwnProperty(Te)&&W!=null&&!f.hasOwnProperty(Te))switch(Te){case"selected":r.selected=!1;break;default:je(r,o,Te,null,f,W)}for(E in f)if(W=f[E],$=c[E],f.hasOwnProperty(E)&&W!==$&&(W!=null||$!=null))switch(E){case"selected":r.selected=W&&typeof W!="function"&&typeof W!="symbol";break;default:je(r,o,E,W,f,$)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ye in c)W=c[ye],c.hasOwnProperty(ye)&&W!=null&&!f.hasOwnProperty(ye)&&je(r,o,ye,null,f,W);for(j in f)if(W=f[j],$=c[j],f.hasOwnProperty(j)&&W!==$&&(W!=null||$!=null))switch(j){case"children":case"dangerouslySetInnerHTML":if(W!=null)throw Error(i(137,o));break;default:je(r,o,j,W,f,$)}return;default:if(Hu(o)){for(var We in c)W=c[We],c.hasOwnProperty(We)&&W!==void 0&&!f.hasOwnProperty(We)&&Rh(r,o,We,void 0,f,W);for(q in f)W=f[q],$=c[q],!f.hasOwnProperty(q)||W===$||W===void 0&&$===void 0||Rh(r,o,q,W,f,$);return}}for(var U in c)W=c[U],c.hasOwnProperty(U)&&W!=null&&!f.hasOwnProperty(U)&&je(r,o,U,null,f,W);for(Q in f)W=f[Q],$=c[Q],!f.hasOwnProperty(Q)||W===$||W==null&&$==null||je(r,o,Q,W,f,$)}var Ch=null,Mh=null;function Ll(r){return r.nodeType===9?r:r.ownerDocument}function jy(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Wy(r,o){if(r===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&o==="foreignObject"?0:r}function Oh(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Ih=null;function uS(){var r=window.event;return r&&r.type==="popstate"?r===Ih?!1:(Ih=r,!0):(Ih=null,!1)}var $y=typeof setTimeout=="function"?setTimeout:void 0,fS=typeof clearTimeout=="function"?clearTimeout:void 0,Xy=typeof Promise=="function"?Promise:void 0,hS=typeof queueMicrotask=="function"?queueMicrotask:typeof Xy<"u"?function(r){return Xy.resolve(null).then(r).catch(dS)}:$y;function dS(r){setTimeout(function(){throw r})}function Pi(r){return r==="head"}function Yy(r,o){var c=o,f=0,g=0;do{var m=c.nextSibling;if(r.removeChild(c),m&&m.nodeType===8)if(c=m.data,c==="/$"){if(0<f&&8>f){c=f;var b=r.ownerDocument;if(c&1&&$a(b.documentElement),c&2&&$a(b.body),c&4)for(c=b.head,$a(c),b=c.firstChild;b;){var x=b.nextSibling,E=b.nodeName;b[aa]||E==="SCRIPT"||E==="STYLE"||E==="LINK"&&b.rel.toLowerCase()==="stylesheet"||c.removeChild(b),b=x}}if(g===0){r.removeChild(m),Ja(o);return}g--}else c==="$"||c==="$?"||c==="$!"?g++:f=c.charCodeAt(0)-48;else f=0;c=m}while(c);Ja(o)}function Nh(r){var o=r.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var c=o;switch(o=o.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Nh(c),Uu(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}r.removeChild(c)}}function gS(r,o,c,f){for(;r.nodeType===1;){var g=c;if(r.nodeName.toLowerCase()!==o.toLowerCase()){if(!f&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(f){if(!r[aa])switch(o){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(m=r.getAttribute("rel"),m==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(m!==g.rel||r.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||r.getAttribute("title")!==(g.title==null?null:g.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(m=r.getAttribute("src"),(m!==(g.src==null?null:g.src)||r.getAttribute("type")!==(g.type==null?null:g.type)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&m&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(o==="input"&&r.type==="hidden"){var m=g.name==null?null:""+g.name;if(g.type==="hidden"&&r.getAttribute("name")===m)return r}else return r;if(r=Sn(r.nextSibling),r===null)break}return null}function pS(r,o,c){if(o==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!c||(r=Sn(r.nextSibling),r===null))return null;return r}function Ph(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState==="complete"}function mS(r,o){var c=r.ownerDocument;if(r.data!=="$?"||c.readyState==="complete")o();else{var f=function(){o(),c.removeEventListener("DOMContentLoaded",f)};c.addEventListener("DOMContentLoaded",f),r._reactRetry=f}}function Sn(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?"||o==="F!"||o==="F")break;if(o==="/$")return null}}return r}var Dh=null;function qy(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"){if(o===0)return r;o--}else c==="/$"&&o++}r=r.previousSibling}return null}function Ky(r,o,c){switch(o=Ll(c),r){case"html":if(r=o.documentElement,!r)throw Error(i(452));return r;case"head":if(r=o.head,!r)throw Error(i(453));return r;case"body":if(r=o.body,!r)throw Error(i(454));return r;default:throw Error(i(451))}}function $a(r){for(var o=r.attributes;o.length;)r.removeAttributeNode(o[0]);Uu(r)}var dn=new Map,Zy=new Set;function Fl(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var ai=ie.d;ie.d={f:_S,r:yS,D:bS,C:vS,L:TS,m:xS,X:AS,S:SS,M:wS};function _S(){var r=ai.f(),o=Ol();return r||o}function yS(r){var o=zs(r);o!==null&&o.tag===5&&o.type==="form"?m_(o):ai.r(r)}var Tr=typeof document>"u"?null:document;function Qy(r,o,c){var f=Tr;if(f&&typeof o=="string"&&o){var g=an(o);g='link[rel="'+r+'"][href="'+g+'"]',typeof c=="string"&&(g+='[crossorigin="'+c+'"]'),Zy.has(g)||(Zy.add(g),r={rel:r,crossOrigin:c,href:o},f.querySelector(g)===null&&(o=f.createElement("link"),wt(o,"link",r),yt(o),f.head.appendChild(o)))}}function bS(r){ai.D(r),Qy("dns-prefetch",r,null)}function vS(r,o){ai.C(r,o),Qy("preconnect",r,o)}function TS(r,o,c){ai.L(r,o,c);var f=Tr;if(f&&r&&o){var g='link[rel="preload"][as="'+an(o)+'"]';o==="image"&&c&&c.imageSrcSet?(g+='[imagesrcset="'+an(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(g+='[imagesizes="'+an(c.imageSizes)+'"]')):g+='[href="'+an(r)+'"]';var m=g;switch(o){case"style":m=xr(r);break;case"script":m=Sr(r)}dn.has(m)||(r=p({rel:"preload",href:o==="image"&&c&&c.imageSrcSet?void 0:r,as:o},c),dn.set(m,r),f.querySelector(g)!==null||o==="style"&&f.querySelector(Xa(m))||o==="script"&&f.querySelector(Ya(m))||(o=f.createElement("link"),wt(o,"link",r),yt(o),f.head.appendChild(o)))}}function xS(r,o){ai.m(r,o);var c=Tr;if(c&&r){var f=o&&typeof o.as=="string"?o.as:"script",g='link[rel="modulepreload"][as="'+an(f)+'"][href="'+an(r)+'"]',m=g;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=Sr(r)}if(!dn.has(m)&&(r=p({rel:"modulepreload",href:r},o),dn.set(m,r),c.querySelector(g)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(Ya(m)))return}f=c.createElement("link"),wt(f,"link",r),yt(f),c.head.appendChild(f)}}}function SS(r,o,c){ai.S(r,o,c);var f=Tr;if(f&&r){var g=Hs(f).hoistableStyles,m=xr(r);o=o||"default";var b=g.get(m);if(!b){var x={loading:0,preload:null};if(b=f.querySelector(Xa(m)))x.loading=5;else{r=p({rel:"stylesheet",href:r,"data-precedence":o},c),(c=dn.get(m))&&kh(r,c);var E=b=f.createElement("link");yt(E),wt(E,"link",r),E._p=new Promise(function(j,q){E.onload=j,E.onerror=q}),E.addEventListener("load",function(){x.loading|=1}),E.addEventListener("error",function(){x.loading|=2}),x.loading|=4,Vl(b,o,f)}b={type:"stylesheet",instance:b,count:1,state:x},g.set(m,b)}}}function AS(r,o){ai.X(r,o);var c=Tr;if(c&&r){var f=Hs(c).hoistableScripts,g=Sr(r),m=f.get(g);m||(m=c.querySelector(Ya(g)),m||(r=p({src:r,async:!0},o),(o=dn.get(g))&&Uh(r,o),m=c.createElement("script"),yt(m),wt(m,"link",r),c.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},f.set(g,m))}}function wS(r,o){ai.M(r,o);var c=Tr;if(c&&r){var f=Hs(c).hoistableScripts,g=Sr(r),m=f.get(g);m||(m=c.querySelector(Ya(g)),m||(r=p({src:r,async:!0,type:"module"},o),(o=dn.get(g))&&Uh(r,o),m=c.createElement("script"),yt(m),wt(m,"link",r),c.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},f.set(g,m))}}function Gy(r,o,c,f){var g=(g=fe.current)?Fl(g):null;if(!g)throw Error(i(446));switch(r){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(o=xr(c.href),c=Hs(g).hoistableStyles,f=c.get(o),f||(f={type:"style",instance:null,count:0,state:null},c.set(o,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){r=xr(c.href);var m=Hs(g).hoistableStyles,b=m.get(r);if(b||(g=g.ownerDocument||g,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(r,b),(m=g.querySelector(Xa(r)))&&!m._p&&(b.instance=m,b.state.loading=5),dn.has(r)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},dn.set(r,c),m||ES(g,r,c,b.state))),o&&f===null)throw Error(i(528,""));return b}if(o&&f!==null)throw Error(i(529,""));return null;case"script":return o=c.async,c=c.src,typeof c=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Sr(c),c=Hs(g).hoistableScripts,f=c.get(o),f||(f={type:"script",instance:null,count:0,state:null},c.set(o,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,r))}}function xr(r){return'href="'+an(r)+'"'}function Xa(r){return'link[rel="stylesheet"]['+r+"]"}function Jy(r){return p({},r,{"data-precedence":r.precedence,precedence:null})}function ES(r,o,c,f){r.querySelector('link[rel="preload"][as="style"]['+o+"]")?f.loading=1:(o=r.createElement("link"),f.preload=o,o.addEventListener("load",function(){return f.loading|=1}),o.addEventListener("error",function(){return f.loading|=2}),wt(o,"link",c),yt(o),r.head.appendChild(o))}function Sr(r){return'[src="'+an(r)+'"]'}function Ya(r){return"script[async]"+r}function eb(r,o,c){if(o.count++,o.instance===null)switch(o.type){case"style":var f=r.querySelector('style[data-href~="'+an(c.href)+'"]');if(f)return o.instance=f,yt(f),f;var g=p({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return f=(r.ownerDocument||r).createElement("style"),yt(f),wt(f,"style",g),Vl(f,c.precedence,r),o.instance=f;case"stylesheet":g=xr(c.href);var m=r.querySelector(Xa(g));if(m)return o.state.loading|=4,o.instance=m,yt(m),m;f=Jy(c),(g=dn.get(g))&&kh(f,g),m=(r.ownerDocument||r).createElement("link"),yt(m);var b=m;return b._p=new Promise(function(x,E){b.onload=x,b.onerror=E}),wt(m,"link",f),o.state.loading|=4,Vl(m,c.precedence,r),o.instance=m;case"script":return m=Sr(c.src),(g=r.querySelector(Ya(m)))?(o.instance=g,yt(g),g):(f=c,(g=dn.get(m))&&(f=p({},c),Uh(f,g)),r=r.ownerDocument||r,g=r.createElement("script"),yt(g),wt(g,"link",f),r.head.appendChild(g),o.instance=g);case"void":return null;default:throw Error(i(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(f=o.instance,o.state.loading|=4,Vl(f,c.precedence,r));return o.instance}function Vl(r,o,c){for(var f=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=f.length?f[f.length-1]:null,m=g,b=0;b<f.length;b++){var x=f[b];if(x.dataset.precedence===o)m=x;else if(m!==g)break}m?m.parentNode.insertBefore(r,m.nextSibling):(o=c.nodeType===9?c.head:c,o.insertBefore(r,o.firstChild))}function kh(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.title==null&&(r.title=o.title)}function Uh(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.integrity==null&&(r.integrity=o.integrity)}var zl=null;function tb(r,o,c){if(zl===null){var f=new Map,g=zl=new Map;g.set(c,f)}else g=zl,f=g.get(c),f||(f=new Map,g.set(c,f));if(f.has(r))return f;for(f.set(r,null),c=c.getElementsByTagName(r),g=0;g<c.length;g++){var m=c[g];if(!(m[aa]||m[Ct]||r==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var b=m.getAttribute(o)||"";b=r+b;var x=f.get(b);x?x.push(m):f.set(b,[m])}}return f}function nb(r,o,c){r=r.ownerDocument||r,r.head.insertBefore(c,o==="title"?r.querySelector("head > title"):null)}function RS(r,o,c){if(c===1||o.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return r=o.disabled,typeof o.precedence=="string"&&r==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function ib(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}var qa=null;function CS(){}function MS(r,o,c){if(qa===null)throw Error(i(475));var f=qa;if(o.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var g=xr(c.href),m=r.querySelector(Xa(g));if(m){r=m._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(f.count++,f=Hl.bind(f),r.then(f,f)),o.state.loading|=4,o.instance=m,yt(m);return}m=r.ownerDocument||r,c=Jy(c),(g=dn.get(g))&&kh(c,g),m=m.createElement("link"),yt(m);var b=m;b._p=new Promise(function(x,E){b.onload=x,b.onerror=E}),wt(m,"link",c),o.instance=m}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(o,r),(r=o.state.preload)&&(o.state.loading&3)===0&&(f.count++,o=Hl.bind(f),r.addEventListener("load",o),r.addEventListener("error",o))}}function OS(){if(qa===null)throw Error(i(475));var r=qa;return r.stylesheets&&r.count===0&&Bh(r,r.stylesheets),0<r.count?function(o){var c=setTimeout(function(){if(r.stylesheets&&Bh(r,r.stylesheets),r.unsuspend){var f=r.unsuspend;r.unsuspend=null,f()}},6e4);return r.unsuspend=o,function(){r.unsuspend=null,clearTimeout(c)}}:null}function Hl(){if(this.count--,this.count===0){if(this.stylesheets)Bh(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var jl=null;function Bh(r,o){r.stylesheets=null,r.unsuspend!==null&&(r.count++,jl=new Map,o.forEach(IS,r),jl=null,Hl.call(r))}function IS(r,o){if(!(o.state.loading&4)){var c=jl.get(r);if(c)var f=c.get(null);else{c=new Map,jl.set(r,c);for(var g=r.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<g.length;m++){var b=g[m];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(c.set(b.dataset.precedence,b),f=b)}f&&c.set(null,f)}g=o.instance,b=g.getAttribute("data-precedence"),m=c.get(b)||f,m===f&&c.set(null,g),c.set(b,g),this.count++,f=Hl.bind(this),g.addEventListener("load",f),g.addEventListener("error",f),m?m.parentNode.insertBefore(g,m.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(g,r.firstChild)),o.state.loading|=4}}var Ka={$$typeof:M,Provider:null,Consumer:null,_currentValue:de,_currentValue2:de,_threadCount:0};function NS(r,o,c,f,g,m,b,x){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Nu(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Nu(0),this.hiddenUpdates=Nu(null),this.identifierPrefix=f,this.onUncaughtError=g,this.onCaughtError=m,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=x,this.incompleteTransitions=new Map}function sb(r,o,c,f,g,m,b,x,E,j,q,Q){return r=new NS(r,o,c,b,x,E,j,Q),o=1,m===!0&&(o|=24),m=Kt(3,null,null,o),r.current=m,m.stateNode=r,o=yf(),o.refCount++,r.pooledCache=o,o.refCount++,m.memoizedState={element:f,isDehydrated:c,cache:o},xf(m),r}function rb(r){return r?(r=er,r):er}function ab(r,o,c,f,g,m){g=rb(g),f.context===null?f.context=g:f.pendingContext=g,f=vi(o),f.payload={element:c},m=m===void 0?null:m,m!==null&&(f.callback=m),c=Ti(r,f,o),c!==null&&(en(c,r,o),wa(c,r,o))}function ob(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<o?c:o}}function Lh(r,o){ob(r,o),(r=r.alternate)&&ob(r,o)}function lb(r){if(r.tag===13){var o=Js(r,67108864);o!==null&&en(o,r,67108864),Lh(r,67108864)}}var Wl=!0;function PS(r,o,c,f){var g=Y.T;Y.T=null;var m=ie.p;try{ie.p=2,Fh(r,o,c,f)}finally{ie.p=m,Y.T=g}}function DS(r,o,c,f){var g=Y.T;Y.T=null;var m=ie.p;try{ie.p=8,Fh(r,o,c,f)}finally{ie.p=m,Y.T=g}}function Fh(r,o,c,f){if(Wl){var g=Vh(f);if(g===null)Eh(r,o,f,$l,c),ub(r,f);else if(US(g,r,o,c,f))f.stopPropagation();else if(ub(r,f),o&4&&-1<kS.indexOf(r)){for(;g!==null;){var m=zs(g);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var b=ns(m.pendingLanes);if(b!==0){var x=m;for(x.pendingLanes|=2,x.entangledLanes|=2;b;){var E=1<<31-Yt(b);x.entanglements[1]|=E,b&=~E}Dn(m),(Ve&6)===0&&(Cl=Mn()+500,Ha(0))}}break;case 13:x=Js(m,2),x!==null&&en(x,m,2),Ol(),Lh(m,2)}if(m=Vh(f),m===null&&Eh(r,o,f,$l,c),m===g)break;g=m}g!==null&&f.stopPropagation()}else Eh(r,o,f,null,c)}}function Vh(r){return r=Wu(r),zh(r)}var $l=null;function zh(r){if($l=null,r=Vs(r),r!==null){var o=a(r);if(o===null)r=null;else{var c=o.tag;if(c===13){if(r=l(o),r!==null)return r;r=null}else if(c===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null)}}return $l=r,null}function cb(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(vT()){case Sp:return 2;case Ap:return 8;case Bo:case TT:return 32;case wp:return 268435456;default:return 32}default:return 32}}var Hh=!1,Di=null,ki=null,Ui=null,Za=new Map,Qa=new Map,Bi=[],kS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ub(r,o){switch(r){case"focusin":case"focusout":Di=null;break;case"dragenter":case"dragleave":ki=null;break;case"mouseover":case"mouseout":Ui=null;break;case"pointerover":case"pointerout":Za.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Qa.delete(o.pointerId)}}function Ga(r,o,c,f,g,m){return r===null||r.nativeEvent!==m?(r={blockedOn:o,domEventName:c,eventSystemFlags:f,nativeEvent:m,targetContainers:[g]},o!==null&&(o=zs(o),o!==null&&lb(o)),r):(r.eventSystemFlags|=f,o=r.targetContainers,g!==null&&o.indexOf(g)===-1&&o.push(g),r)}function US(r,o,c,f,g){switch(o){case"focusin":return Di=Ga(Di,r,o,c,f,g),!0;case"dragenter":return ki=Ga(ki,r,o,c,f,g),!0;case"mouseover":return Ui=Ga(Ui,r,o,c,f,g),!0;case"pointerover":var m=g.pointerId;return Za.set(m,Ga(Za.get(m)||null,r,o,c,f,g)),!0;case"gotpointercapture":return m=g.pointerId,Qa.set(m,Ga(Qa.get(m)||null,r,o,c,f,g)),!0}return!1}function fb(r){var o=Vs(r.target);if(o!==null){var c=a(o);if(c!==null){if(o=c.tag,o===13){if(o=l(c),o!==null){r.blockedOn=o,MT(r.priority,function(){if(c.tag===13){var f=Jt();f=Pu(f);var g=Js(c,f);g!==null&&en(g,c,f),Lh(c,f)}});return}}else if(o===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Xl(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var c=Vh(r.nativeEvent);if(c===null){c=r.nativeEvent;var f=new c.constructor(c.type,c);ju=f,c.target.dispatchEvent(f),ju=null}else return o=zs(c),o!==null&&lb(o),r.blockedOn=c,!1;o.shift()}return!0}function hb(r,o,c){Xl(r)&&c.delete(o)}function BS(){Hh=!1,Di!==null&&Xl(Di)&&(Di=null),ki!==null&&Xl(ki)&&(ki=null),Ui!==null&&Xl(Ui)&&(Ui=null),Za.forEach(hb),Qa.forEach(hb)}function Yl(r,o){r.blockedOn===o&&(r.blockedOn=null,Hh||(Hh=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,BS)))}var ql=null;function db(r){ql!==r&&(ql=r,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){ql===r&&(ql=null);for(var o=0;o<r.length;o+=3){var c=r[o],f=r[o+1],g=r[o+2];if(typeof f!="function"){if(zh(f||c)===null)continue;break}var m=zs(c);m!==null&&(r.splice(o,3),o-=3,zf(m,{pending:!0,data:g,method:c.method,action:f},f,g))}}))}function Ja(r){function o(E){return Yl(E,r)}Di!==null&&Yl(Di,r),ki!==null&&Yl(ki,r),Ui!==null&&Yl(Ui,r),Za.forEach(o),Qa.forEach(o);for(var c=0;c<Bi.length;c++){var f=Bi[c];f.blockedOn===r&&(f.blockedOn=null)}for(;0<Bi.length&&(c=Bi[0],c.blockedOn===null);)fb(c),c.blockedOn===null&&Bi.shift();if(c=(r.ownerDocument||r).$$reactFormReplay,c!=null)for(f=0;f<c.length;f+=3){var g=c[f],m=c[f+1],b=g[Lt]||null;if(typeof m=="function")b||db(c);else if(b){var x=null;if(m&&m.hasAttribute("formAction")){if(g=m,b=m[Lt]||null)x=b.formAction;else if(zh(g)!==null)continue}else x=b.action;typeof x=="function"?c[f+1]=x:(c.splice(f,3),f-=3),db(c)}}}function jh(r){this._internalRoot=r}Kl.prototype.render=jh.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(i(409));var c=o.current,f=Jt();ab(c,f,r,o,null,null)},Kl.prototype.unmount=jh.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;ab(r.current,2,null,r,null,null),Ol(),o[Fs]=null}};function Kl(r){this._internalRoot=r}Kl.prototype.unstable_scheduleHydration=function(r){if(r){var o=Op();r={blockedOn:null,target:r,priority:o};for(var c=0;c<Bi.length&&o!==0&&o<Bi[c].priority;c++);Bi.splice(c,0,r),c===0&&fb(r)}};var gb=e.version;if(gb!=="19.1.0")throw Error(i(527,gb,"19.1.0"));ie.findDOMNode=function(r){var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(i(188)):(r=Object.keys(r).join(","),Error(i(268,r)));return r=h(o),r=r!==null?d(r):null,r=r===null?null:r.stateNode,r};var LS={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:Y,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zl.isDisabled&&Zl.supportsFiber)try{ia=Zl.inject(LS),Xt=Zl}catch{}}return to.createRoot=function(r,o){if(!s(r))throw Error(i(299));var c=!1,f="",g=O_,m=I_,b=N_,x=null;return o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onUncaughtError!==void 0&&(g=o.onUncaughtError),o.onCaughtError!==void 0&&(m=o.onCaughtError),o.onRecoverableError!==void 0&&(b=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(x=o.unstable_transitionCallbacks)),o=sb(r,1,!1,null,null,c,f,g,m,b,x,null),r[Fs]=o.current,wh(r),new jh(o)},to.hydrateRoot=function(r,o,c){if(!s(r))throw Error(i(299));var f=!1,g="",m=O_,b=I_,x=N_,E=null,j=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(m=c.onUncaughtError),c.onCaughtError!==void 0&&(b=c.onCaughtError),c.onRecoverableError!==void 0&&(x=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(E=c.unstable_transitionCallbacks),c.formState!==void 0&&(j=c.formState)),o=sb(r,1,!0,o,c??null,f,g,m,b,x,E,j),o.context=rb(null),c=o.current,f=Jt(),f=Pu(f),g=vi(f),g.callback=null,Ti(c,g,f),c=f,o.current.lanes=c,ra(o,c),Dn(o),r[Fs]=o.current,wh(r),new Kl(o)},to.version="19.1.0",to}var Ab;function KS(){if(Ab)return Xh.exports;Ab=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Xh.exports=qS(),Xh.exports}var ZS=KS();const QS=g3(ZS),GS="modulepreload",JS=function(n){return"/mobile-network-map/"+n},wb={},eA=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){let l=function(d){return Promise.all(d.map(p=>Promise.resolve(p).then(_=>({status:"fulfilled",value:_}),_=>({status:"rejected",reason:_}))))};document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),h=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));s=l(t.map(d=>{if(d=JS(d),d in wb)return;wb[d]=!0;const p=d.endsWith(".css"),_=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${_}`))return;const y=document.createElement("link");if(y.rel=p?"stylesheet":GS,p||(y.as="script"),y.crossOrigin="",y.href=d,h&&y.setAttribute("nonce",h),document.head.appendChild(y),p)return new Promise((v,A)=>{y.addEventListener("load",v),y.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(l){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l}return s.then(l=>{for(const u of l||[])u.status==="rejected"&&a(u.reason);return e().catch(a)})},tA=J.createContext(null);function nA(n,e){const t=Array.isArray(n)?n[0]:n?n.x:0,i=Array.isArray(n)?n[1]:n?n.y:0,s=Array.isArray(e)?e[0]:e?e.x:0,a=Array.isArray(e)?e[1]:e?e.y:0;return t===s&&i===a}function Ln(n,e){if(n===e)return!0;if(!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Ln(n[t],e[t]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(const s of t)if(!e.hasOwnProperty(s)||!Ln(n[s],e[s]))return!1;return!0}return!1}function Eb(n){return{longitude:n.center.lng,latitude:n.center.lat,zoom:n.zoom,pitch:n.pitch,bearing:n.bearing,padding:n.padding}}function Rb(n,e){const t=e.viewState||e,i={};if("longitude"in t&&"latitude"in t&&(t.longitude!==n.center.lng||t.latitude!==n.center.lat)){const s=n.center.constructor;i.center=new s(t.longitude,t.latitude)}return"zoom"in t&&t.zoom!==n.zoom&&(i.zoom=t.zoom),"bearing"in t&&t.bearing!==n.bearing&&(i.bearing=t.bearing),"pitch"in t&&t.pitch!==n.pitch&&(i.pitch=t.pitch),t.padding&&n.padding&&!Ln(t.padding,n.padding)&&(i.padding=t.padding),i}const iA=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Cb(n){if(!n)return null;if(typeof n=="string"||("toJS"in n&&(n=n.toJS()),!n.layers))return n;const e={};for(const i of n.layers)e[i.id]=i;const t=n.layers.map(i=>{let s=null;"interactive"in i&&(s=Object.assign({},i),delete s.interactive);const a=e[i.ref];if(a){s=s||Object.assign({},i),delete s.ref;for(const l of iA)l in a&&(s[l]=a[l])}return s||i});return{...n,layers:t}}const Mb={version:8,sources:{},layers:[]},Ob={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Ib={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Nb={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},sA=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],rA=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class jr{constructor(e,t,i){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=s=>{const a=this.props[Nb[s.type]];a?a(s):s.type==="error"&&console.error(s.error)},this._onCameraEvent=s=>{if(this._internalUpdate)return;s.viewState=this._propsedCameraUpdate||Eb(this._map.transform);const a=this.props[Ib[s.type]];a&&a(s)},this._onCameraUpdate=s=>this._internalUpdate?s:(this._propsedCameraUpdate=Eb(s),Rb(s,this.props)),this._onPointerEvent=s=>{(s.type==="mousemove"||s.type==="mouseout")&&this._updateHover(s);const a=this.props[Ob[s.type]];a&&(this.props.interactiveLayerIds&&s.type!=="mouseover"&&s.type!=="mouseout"&&(s.features=this._hoveredFeatures||this._queryRenderedFeatures(s.point)),a(s),delete s.features)},this._MapClass=e,this.props=t,this._initialize(i)}get map(){return this._map}setProps(e){const t=this.props;this.props=e;const i=this._updateSettings(e,t),s=this._updateSize(e),a=this._updateViewState(e);this._updateStyle(e,t),this._updateStyleComponents(e),this._updateHandlers(e,t),(i||s||a&&!this._map.isMoving())&&this.redraw()}static reuse(e,t){const i=jr.savedMaps.pop();if(!i)return null;const s=i.map,a=s.getContainer();for(t.className=a.className;a.childNodes.length>0;)t.appendChild(a.childNodes[0]);s._container=t;const l=s._resizeObserver;l&&(l.disconnect(),l.observe(t)),i.setProps({...e,styleDiffing:!1}),s.resize();const{initialViewState:u}=e;return u&&(u.bounds?s.fitBounds(u.bounds,{...u.fitBoundsOptions,duration:0}):i._updateViewState(u)),s.isStyleLoaded()?s.fire("load"):s.once("style.load",()=>s.fire("load")),s._update(),i}_initialize(e){const{props:t}=this,{mapStyle:i=Mb}=t,s={...t,...t.initialViewState,container:e,style:Cb(i)},a=s.initialViewState||s.viewState||s;if(Object.assign(s,{center:[a.longitude||0,a.latitude||0],zoom:a.zoom||0,pitch:a.pitch||0,bearing:a.bearing||0}),t.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,t.gl)}const l=new this._MapClass(s);a.padding&&l.setPadding(a.padding),t.cursor&&(l.getCanvas().style.cursor=t.cursor),l.transformCameraUpdate=this._onCameraUpdate,l.on("style.load",()=>{var u;this._styleComponents={light:l.getLight(),sky:l.getSky(),projection:(u=l.getProjection)==null?void 0:u.call(l),terrain:l.getTerrain()},this._updateStyleComponents(this.props)}),l.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const u in Ob)l.on(u,this._onPointerEvent);for(const u in Ib)l.on(u,this._onCameraEvent);for(const u in Nb)l.on(u,this._onEvent);this._map=l}recycle(){const t=this.map.getContainer().querySelector("[mapboxgl-children]");t==null||t.remove(),jr.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_updateSize(e){const{viewState:t}=e;if(t){const i=this._map;if(t.width!==i.transform.width||t.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e){const t=this._map,i=t.transform;if(!t.isMoving()){const a=Rb(i,e);if(Object.keys(a).length>0)return this._internalUpdate=!0,t.jumpTo(a),this._internalUpdate=!1,!0}return!1}_updateSettings(e,t){const i=this._map;let s=!1;for(const a of sA)if(a in e&&!Ln(e[a],t[a])){s=!0;const l=i[`set${a[0].toUpperCase()}${a.slice(1)}`];l==null||l.call(i,e[a])}return s}_updateStyle(e,t){if(e.cursor!==t.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==t.mapStyle){const{mapStyle:i=Mb,styleDiffing:s=!0}=e,a={diff:s};"localIdeographFontFamily"in e&&(a.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(Cb(i),a)}}_updateStyleComponents({light:e,projection:t,sky:i,terrain:s}){var u,h;const a=this._map,l=this._styleComponents;a.style._loaded&&(e&&!Ln(e,l.light)&&(l.light=e,a.setLight(e)),t&&!Ln(t,l.projection)&&t!==((u=l.projection)==null?void 0:u.type)&&(l.projection=typeof t=="string"?{type:t}:t,(h=a.setProjection)==null||h.call(a,l.projection)),i&&!Ln(i,l.sky)&&(l.sky=i,a.setSky(i)),s!==void 0&&!Ln(s,l.terrain)&&(!s||a.getSource(s.source))&&(l.terrain=s,a.setTerrain(s)))}_updateHandlers(e,t){const i=this._map;for(const s of rA){const a=e[s]??!0,l=t[s]??!0;Ln(a,l)||(a?i[s].enable(a):i[s].disable())}}_queryRenderedFeatures(e){const t=this._map,{interactiveLayerIds:i=[]}=this.props;try{return t.queryRenderedFeatures(e,{layers:i.filter(t.getLayer.bind(t))})}catch{return[]}}_updateHover(e){var s;const{props:t}=this;if(t.interactiveLayerIds&&(t.onMouseMove||t.onMouseEnter||t.onMouseLeave)){const a=e.type,l=((s=this._hoveredFeatures)==null?void 0:s.length)>0,u=this._queryRenderedFeatures(e.point),h=u.length>0;!h&&l&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=u,h&&!l&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=a}else this._hoveredFeatures=null}}jr.savedMaps=[];const aA=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function oA(n){if(!n)return null;const e=n.map,t={getMap:()=>e};for(const i of lA(e))!(i in t)&&!aA.includes(i)&&(t[i]=e[i].bind(e));return t}function lA(n){const e=new Set;let t=n;for(;t;){for(const i of Object.getOwnPropertyNames(t))i[0]!=="_"&&typeof n[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);t=Object.getPrototypeOf(t)}return Array.from(e)}const cA=typeof document<"u"?J.useLayoutEffect:J.useEffect;function uA(n,e){const{RTLTextPlugin:t,maxParallelImageRequests:i,workerCount:s,workerUrl:a}=e;if(t&&n.getRTLTextPluginStatus&&n.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:l,lazy:u=!0}=typeof t=="string"?{pluginUrl:t}:t;n.setRTLTextPlugin(l,h=>{h&&console.error(h)},u)}i!==void 0&&n.setMaxParallelImageRequests(i),s!==void 0&&n.setWorkerCount(s),a!==void 0&&n.setWorkerUrl(a)}const bu=J.createContext(null);function fA(n,e){const t=J.useContext(tA),[i,s]=J.useState(null),a=J.useRef(),{current:l}=J.useRef({mapLib:null,map:null});J.useEffect(()=>{const d=n.mapLib;let p=!0,_;return Promise.resolve(d||eA(()=>import("./maplibre-gl-Cog15O8W.js").then(y=>y.m),[])).then(y=>{if(!p)return;if(!y)throw new Error("Invalid mapLib");const v="Map"in y?y:y.default;if(!v.Map)throw new Error("Invalid mapLib");uA(v,n),n.reuseMaps&&(_=jr.reuse(n,a.current)),_||(_=new jr(v.Map,n,a.current)),l.map=oA(_),l.mapLib=v,s(_),t==null||t.onMapMount(l.map,n.id)}).catch(y=>{const{onError:v}=n;v?v({type:"error",target:null,originalEvent:null,error:y}):console.error(y)}),()=>{p=!1,_&&(t==null||t.onMapUnmount(n.id),n.reuseMaps?_.recycle():_.destroy())}},[]),cA(()=>{i&&i.setProps(n)}),J.useImperativeHandle(e,()=>l.map,[i]);const u=J.useMemo(()=>({position:"relative",width:"100%",height:"100%",...n.style}),[n.style]),h={height:"100%"};return J.createElement("div",{id:n.id,ref:a,style:u},i&&J.createElement(bu.Provider,{value:l},J.createElement("div",{"mapboxgl-children":"",style:h},n.children)))}const hA=J.forwardRef(fA);var m3=p3();const dA=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function di(n,e){if(!n||!e)return;const t=n.style;for(const i in e){const s=e[i];Number.isFinite(s)&&!dA.test(i)?t[i]=`${s}px`:t[i]=s}}function _3(n,e){if(n===e)return null;const t=Pb(n),i=Pb(e),s=[];for(const a of i)t.has(a)||s.push(a);for(const a of t)i.has(a)||s.push(a);return s.length===0?null:s}function Pb(n){return new Set(n?n.trim().split(/\s+/):[])}J.memo(J.forwardRef((n,e)=>{const{map:t,mapLib:i}=J.useContext(bu),s=J.useRef({props:n}),a=J.useMemo(()=>{let z=!1;J.Children.forEach(n.children,k=>{k&&(z=!0)});const H={...n,element:z?document.createElement("div"):void 0},M=new i.Marker(H);return M.setLngLat([n.longitude,n.latitude]),M.getElement().addEventListener("click",k=>{var L,X;(X=(L=s.current.props).onClick)==null||X.call(L,{type:"click",target:M,originalEvent:k})}),M.on("dragstart",k=>{var X,ce;const L=k;L.lngLat=a.getLngLat(),(ce=(X=s.current.props).onDragStart)==null||ce.call(X,L)}),M.on("drag",k=>{var X,ce;const L=k;L.lngLat=a.getLngLat(),(ce=(X=s.current.props).onDrag)==null||ce.call(X,L)}),M.on("dragend",k=>{var X,ce;const L=k;L.lngLat=a.getLngLat(),(ce=(X=s.current.props).onDragEnd)==null||ce.call(X,L)}),M},[]);J.useEffect(()=>(a.addTo(t.getMap()),()=>{a.remove()}),[]);const{longitude:l,latitude:u,offset:h,style:d,draggable:p=!1,popup:_=null,rotation:y=0,rotationAlignment:v="auto",pitchAlignment:A="auto"}=n;J.useEffect(()=>{di(a.getElement(),d)},[d]),J.useImperativeHandle(e,()=>a,[]);const R=s.current.props;(a.getLngLat().lng!==l||a.getLngLat().lat!==u)&&a.setLngLat([l,u]),h&&!nA(a.getOffset(),h)&&a.setOffset(h),a.isDraggable()!==p&&a.setDraggable(p),a.getRotation()!==y&&a.setRotation(y),a.getRotationAlignment()!==v&&a.setRotationAlignment(v),a.getPitchAlignment()!==A&&a.setPitchAlignment(A),a.getPopup()!==_&&a.setPopup(_);const C=_3(R.className,n.className);if(C)for(const z of C)a.toggleClassName(z);return s.current.props=n,m3.createPortal(n.children,a.getElement())}));J.memo(J.forwardRef((n,e)=>{const{map:t,mapLib:i}=J.useContext(bu),s=J.useMemo(()=>document.createElement("div"),[]),a=J.useRef({props:n}),l=J.useMemo(()=>{const u={...n},h=new i.Popup(u);return h.setLngLat([n.longitude,n.latitude]),h.once("open",d=>{var p,_;(_=(p=a.current.props).onOpen)==null||_.call(p,d)}),h},[]);if(J.useEffect(()=>{const u=h=>{var d,p;(p=(d=a.current.props).onClose)==null||p.call(d,h)};return l.on("close",u),l.setDOMContent(s).addTo(t.getMap()),()=>{l.off("close",u),l.isOpen()&&l.remove()}},[]),J.useEffect(()=>{di(l.getElement(),n.style)},[n.style]),J.useImperativeHandle(e,()=>l,[]),l.isOpen()){const u=a.current.props;(l.getLngLat().lng!==n.longitude||l.getLngLat().lat!==n.latitude)&&l.setLngLat([n.longitude,n.latitude]),n.offset&&!Ln(u.offset,n.offset)&&l.setOffset(n.offset),(u.anchor!==n.anchor||u.maxWidth!==n.maxWidth)&&(l.options.anchor=n.anchor,l.setMaxWidth(n.maxWidth));const h=_3(u.className,n.className);if(h)for(const d of h)l.toggleClassName(d);a.current.props=n}return m3.createPortal(n.children,s)}));function Ds(n,e,t,i){const s=J.useContext(bu),a=J.useMemo(()=>n(s),[]);return J.useEffect(()=>{const l=e,u=null,h=typeof e=="function"?e:null,{map:d}=s;return d.hasControl(a)||(d.addControl(a,l==null?void 0:l.position),u&&u(s)),()=>{h&&h(s),d.hasControl(a)&&d.removeControl(a)}},[]),a}function gA(n){const e=Ds(({mapLib:t})=>new t.AttributionControl(n),{position:n.position});return J.useEffect(()=>{di(e._container,n.style)},[n.style]),null}J.memo(gA);function pA(n){const e=Ds(({mapLib:t})=>new t.FullscreenControl({container:n.containerId&&document.getElementById(n.containerId)}),{position:n.position});return J.useEffect(()=>{di(e._controlContainer,n.style)},[n.style]),null}J.memo(pA);function mA(n,e){const t=J.useRef({props:n}),i=Ds(({mapLib:s})=>{const a=new s.GeolocateControl(n),l=a._setupUI;return a._setupUI=()=>{a._container.hasChildNodes()||l()},a.on("geolocate",u=>{var h,d;(d=(h=t.current.props).onGeolocate)==null||d.call(h,u)}),a.on("error",u=>{var h,d;(d=(h=t.current.props).onError)==null||d.call(h,u)}),a.on("outofmaxbounds",u=>{var h,d;(d=(h=t.current.props).onOutOfMaxBounds)==null||d.call(h,u)}),a.on("trackuserlocationstart",u=>{var h,d;(d=(h=t.current.props).onTrackUserLocationStart)==null||d.call(h,u)}),a.on("trackuserlocationend",u=>{var h,d;(d=(h=t.current.props).onTrackUserLocationEnd)==null||d.call(h,u)}),a},{position:n.position});return t.current.props=n,J.useImperativeHandle(e,()=>i,[]),J.useEffect(()=>{di(i._container,n.style)},[n.style]),null}J.memo(J.forwardRef(mA));function _A(n){const e=Ds(({mapLib:t})=>new t.NavigationControl(n),{position:n.position});return J.useEffect(()=>{di(e._container,n.style)},[n.style]),null}J.memo(_A);function yA(n){const e=Ds(({mapLib:a})=>new a.ScaleControl(n),{position:n.position}),t=J.useRef(n),i=t.current;t.current=n;const{style:s}=n;return n.maxWidth!==void 0&&n.maxWidth!==i.maxWidth&&(e.options.maxWidth=n.maxWidth),n.unit!==void 0&&n.unit!==i.unit&&e.setUnit(n.unit),J.useEffect(()=>{di(e._container,s)},[s]),null}J.memo(yA);function bA(n){const e=Ds(({mapLib:t})=>new t.TerrainControl(n),{position:n.position});return J.useEffect(()=>{di(e._container,n.style)},[n.style]),null}J.memo(bA);function vA(n){const e=Ds(({mapLib:t})=>new t.LogoControl(n),{position:n.position});return J.useEffect(()=>{di(e._container,n.style)},[n.style]),null}J.memo(vA);function xc(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const Dg=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Db=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Db&&parseFloat(Db[1]);const Ql=globalThis,Ar=globalThis.process||{},TA=globalThis.navigator||{};function y3(n){var i,s;if(typeof window<"u"&&((i=window.process)==null?void 0:i.type)==="renderer"||typeof process<"u"&&((s=process.versions)!=null&&s.electron))return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function ks(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||y3()}function xA(n){return ks()?y3()?"Electron":(TA.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const b3="4.1.0";function SA(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class AA{constructor(e,t,i="sessionStorage"){this.storage=SA(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function wA(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function EA(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var Sc;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Sc||(Sc={}));const RA=10;function kb(n){return typeof n!="string"?n:(n=n.toUpperCase(),Sc[n]||Sc.WHITE)}function CA(n,e,t){return!ks&&typeof n=="string"&&(e&&(n=`\x1B[${kb(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${kb(t)+RA}m${n}\x1B[49m`)),n}function MA(n,e=["constructor"]){const t=Object.getPrototypeOf(n),i=Object.getOwnPropertyNames(t),s=n;for(const a of i){const l=s[a];typeof l=="function"&&(e.find(u=>a===u)||(s[a]=l.bind(n)))}}function kg(n,e){if(!n)throw new Error("Assertion failed")}function wr(){var e,t,i;let n;if(ks()&&Ql.performance)n=(t=(e=Ql==null?void 0:Ql.performance)==null?void 0:e.now)==null?void 0:t.call(e);else if("hrtime"in Ar){const s=(i=Ar==null?void 0:Ar.hrtime)==null?void 0:i.call(Ar);n=s[0]*1e3+s[1]/1e6}else n=Date.now();return n}const Er={debug:ks()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},OA={enabled:!0,level:0};function Rr(){}const Ub={},Bb={once:!0};class Mo{constructor({id:e}={id:""}){this.VERSION=b3,this._startTs=wr(),this._deltaTs=wr(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new AA(`__probe-${this.id}__`,OA),this.timeStamp(`${this.id} started`),MA(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((wr()-this._startTs).toPrecision(10))}getDelta(){return Number((wr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Er.warn,arguments,Bb)}error(e){return this._getLogFunction(0,e,Er.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Er.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Er.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Er.debug||Er.info,arguments,Bb)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||Rr,i&&[i],{tag:NA(t)}):Rr}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Rr)}group(e,t,i={collapsed:!1}){const s=Lb({logLevel:e,message:t,opts:i}),{collapsed:a}=i;return s.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Rr)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=v3(e)}_getLogFunction(e,t,i,s,a){if(this._shouldLog(e)){a=Lb({logLevel:e,message:t,args:s,opts:a}),i=i||a.method,kg(i),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=wr();const l=a.tag||a.message;if(a.once&&l)if(!Ub[l])Ub[l]=wr();else return Rr;return t=IA(this.id,a.message,a),i.bind(console,t,...a.args)}return Rr}}Mo.VERSION=b3;function v3(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return kg(Number.isFinite(e)&&e>=0),e}function Lb(n){const{logLevel:e,message:t}=n;n.logLevel=v3(e);const i=n.args?Array.from(n.args):[];for(;i.length&&i.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&i.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const s=typeof n.message;return kg(s==="string"||s==="object"),Object.assign(n,{args:i},n.opts)}function IA(n,e,t){if(typeof e=="string"){const i=t.time?EA(wA(t.total)):"";e=t.time?`${n}: ${i}  ${e}`:`${n}: ${e}`,e=CA(e,t.color,t.background)}return e}function NA(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const Zh="4.3.2",PA=Zh[0]>="0"&&Zh[0]<="9"?`v${Zh}`:"";function DA(){const n=new Mo({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=PA,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const kA=DA();function UA(n,e){return T3(n||{},e)}function T3(n,e,t=0){if(t>3)return e;const i={...n};for(const[s,a]of Object.entries(e))a&&typeof a=="object"&&!Array.isArray(a)?i[s]=T3(i[s]||{},e[s],t+1):i[s]=e[s];return i}const BA="latest";function LA(){var n;return(n=globalThis._loadersgl_)!=null&&n.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const FA=LA();function Gi(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const Es=typeof process!="object"||String(process)!=="[object process]"||process.browser,VA=typeof window<"u"&&typeof window.orientation<"u",Fb=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Fb&&parseFloat(Fb[1]);class zA{constructor(e,t){T(this,"name");T(this,"workerThread");T(this,"isRunning",!0);T(this,"result");T(this,"_resolve",()=>{});T(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Gi(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Gi(this.isRunning),this.isRunning=!1,this._reject(e)}}class Qh{terminate(){}}const Gh=new Map;function HA(n){Gi(n.source&&!n.url||!n.source&&n.url);let e=Gh.get(n.source||n.url);return e||(n.url&&(e=jA(n.url),Gh.set(n.url,e)),n.source&&(e=x3(n.source),Gh.set(n.source,e))),Gi(e),e}function jA(n){if(!n.startsWith("http"))return n;const e=WA(n);return x3(e)}function x3(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function WA(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function S3(n,e=!0,t){const i=t||new Set;if(n){if(Vb(n))i.add(n);else if(Vb(n.buffer))i.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const s in n)S3(n[s],e,i)}}return t===void 0?Array.from(i):[]}function Vb(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const Jh=()=>{};class Ld{constructor(e){T(this,"name");T(this,"source");T(this,"url");T(this,"terminated",!1);T(this,"worker");T(this,"onMessage");T(this,"onError");T(this,"_loadableURL","");const{name:t,source:i,url:s}=e;Gi(i||s),this.name=t,this.source=i,this.url=s,this.onMessage=Jh,this.onError=a=>console.log(a),this.worker=Es?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Es||typeof Qh<"u"&&!Es}destroy(){this.onMessage=Jh,this.onError=Jh,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||S3(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=HA({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Qh(i,{eval:!1})}else if(this.source)e=new Qh(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}let $A=class{constructor(e){T(this,"name","unnamed");T(this,"source");T(this,"url");T(this,"maxConcurrency",1);T(this,"maxMobileConcurrency",1);T(this,"onDebug",()=>{});T(this,"reuseWorkers",!0);T(this,"props",{});T(this,"jobQueue",[]);T(this,"idleQueue",[]);T(this,"count",0);T(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Ld.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(s,a,l)=>s.done(l),i=(s,a)=>s.error(a)){const s=new Promise(a=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:a}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new zA(t.name,e);e.onMessage=s=>t.onMessage(i,s.type,s.payload),e.onError=s=>t.onError(i,s),t.onStart(i);try{await i.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Es||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Ld({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return VA?this.maxMobileConcurrency:this.maxConcurrency}};const XA={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Wi=class Wi{constructor(e){T(this,"props");T(this,"workerPools",new Map);this.props={...XA},this.setProps(e),this.workerPools=new Map}static isSupported(){return Ld.isSupported()}static getWorkerFarm(e={}){return Wi._workerFarm=Wi._workerFarm||new Wi({}),Wi._workerFarm.setProps(e),Wi._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:i,url:s}=e;let a=this.workerPools.get(t);return a||(a=new $A({name:t,source:i,url:s}),a.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,a)),a}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};T(Wi,"_workerFarm");let Ac=Wi;function YA(n,e={}){const t=e[n.id]||{},i=Es?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let s=t.workerUrl;if(!s&&n.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(Es?s=`modules/${n.module}/dist/${i}`:s=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!s){let a=n.version;a==="latest"&&(a=BA);const l=a?`@${a}`:"";s=`https://unpkg.com/@loaders.gl/${n.module}${l}/dist/${i}`}return Gi(s),s}function qA(n,e=FA){Gi(n,"no worker provided");const t=n.version;return!(!e||!t)}function KA(n,e){return!Ac.isSupported()||!Es&&!(e!=null&&e._nodeWorkers)?!1:n.worker&&(e==null?void 0:e.worker)}async function ZA(n,e,t,i,s){const a=n.id,l=YA(n,t),h=Ac.getWorkerFarm(t).getWorkerPool({name:a,url:l});t=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(i||{}));const d=await h.startJob("process-on-worker",QA.bind(null,s));return d.postMessage("process",{input:e,options:t,context:i}),await(await d.result).result}async function QA(n,e,t,i){switch(t){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:s,input:a,options:l}=i;try{const u=await n(a,l);e.postMessage("done",{id:s,result:u})}catch(u){const h=u instanceof Error?u.message:"unknown error";e.postMessage("error",{id:s,error:h})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function GA(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const i=new Uint8Array(n),s=new Uint8Array(e);for(let a=0;a<i.length;++a)if(i[a]!==s[a])return!1;return!0}function JA(...n){return ew(n)}function ew(n){const e=n.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),t=e.reduce((a,l)=>a+l.byteLength,0),i=new Uint8Array(t);let s=0;for(const a of e)i.set(a,s),s+=a.byteLength;return i.buffer}async function tw(n){const e=[];for await(const t of n)e.push(t);return JA(...e)}function zb(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class Hb{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=zb(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(zb()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class vu{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let s=this.stats[t];return s||(e instanceof Hb?s=e:s=new Hb(t,i),this.stats[t]=s),s}}let nw="";const jb={};function iw(n){for(const e in jb)if(n.startsWith(e)){const t=jb[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${nw}${n}`),n}function sw(n){return n&&typeof n=="object"&&n.isBuffer}function A3(n){if(sw(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function w3(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function rw(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const aw=n=>typeof n=="boolean",fo=n=>typeof n=="function",Oo=n=>n!==null&&typeof n=="object",Wb=n=>Oo(n)&&n.constructor==={}.constructor,ow=n=>!!n&&typeof n[Symbol.iterator]=="function",lw=n=>n&&typeof n[Symbol.asyncIterator]=="function",Us=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,Bs=n=>typeof Blob<"u"&&n instanceof Blob,cw=n=>n&&typeof n=="object"&&n.isBuffer,uw=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||Oo(n)&&fo(n.tee)&&fo(n.cancel)&&fo(n.getReader),fw=n=>Oo(n)&&fo(n.read)&&fo(n.pipe)&&aw(n.readable),E3=n=>uw(n)||fw(n);class hw extends Error{constructor(t,i){super(t);T(this,"reason");T(this,"url");T(this,"response");this.reason=i.reason,this.url=i.url,this.response=i.response}}const dw=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,gw=/^([-\w.]+\/[-\w.+]+)/;function $b(n,e){return n.toLowerCase()===e.toLowerCase()}function pw(n){const e=gw.exec(n);return e?e[1]:n}function Xb(n){const e=dw.exec(n);return e?e[1]:""}const R3=/\?.*/;function mw(n){const e=n.match(R3);return e&&e[0]}function Ug(n){return n.replace(R3,"")}function _w(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function Tu(n){return Us(n)?n.url:Bs(n)?n.name||"":typeof n=="string"?n:""}function Bg(n){if(Us(n)){const e=n,t=e.headers.get("content-type")||"",i=Ug(e.url);return pw(t)||Xb(i)}return Bs(n)?n.type||"":typeof n=="string"?Xb(n):""}function yw(n){return Us(n)?n.headers["content-length"]||-1:Bs(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function C3(n){if(Us(n))return n;const e={},t=yw(n);t>=0&&(e["content-length"]=String(t));const i=Tu(n),s=Bg(n);s&&(e["content-type"]=s);const a=await Tw(n);a&&(e["x-first-bytes"]=a),typeof n=="string"&&(n=new TextEncoder().encode(n));const l=new Response(n,{headers:e});return Object.defineProperty(l,"url",{value:i}),l}async function bw(n){if(!n.ok)throw await vw(n)}async function vw(n){const e=_w(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const i={reason:n.statusText,url:n.url,response:n};try{const s=n.headers.get("Content-Type");i.reason=!n.bodyUsed&&(s!=null&&s.includes("application/json"))?await n.json():await n.text()}catch{}return new hw(t,i)}async function Tw(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(i=>{const s=new FileReader;s.onload=a=>{var l;return i((l=a==null?void 0:a.target)==null?void 0:l.result)},s.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${xw(t)}`}return null}function xw(n){let e="";const t=new Uint8Array(n);for(let i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function Sw(n){return!Aw(n)&&!ww(n)}function Aw(n){return n.startsWith("http:")||n.startsWith("https:")}function ww(n){return n.startsWith("data:")}async function Yb(n,e){var t,i;if(typeof n=="string"){const s=iw(n);return Sw(s)&&(t=globalThis.loaders)!=null&&t.fetchNode?(i=globalThis.loaders)==null?void 0:i.fetchNode(s,e):await fetch(s,e)}return await C3(n)}const qb=new Mo({id:"loaders.gl"});class Ew{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Rw{constructor(){T(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const M3={fetch:null,mimeType:void 0,nothrow:!1,log:new Rw,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Dg,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Cw={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function O3(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function I3(){const n=O3();return n.globalOptions=n.globalOptions||{...M3},n.globalOptions}function Mw(n,e,t,i){return t=t||[],t=Array.isArray(t)?t:[t],Ow(n,t),Nw(e,n,i)}function Ow(n,e){Kb(n,null,M3,Cw,e);for(const t of e){const i=n&&n[t.id]||{},s=t.options&&t.options[t.id]||{},a=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};Kb(i,t.id,s,a,e)}}function Kb(n,e,t,i,s){const a=e||"Top level",l=e?`${e}.`:"";for(const u in n){const h=!e&&Oo(n[u]),d=u==="baseUri"&&!e,p=u==="workerUrl"&&e;if(!(u in t)&&!d&&!p){if(u in i)qb.warn(`${a} loader option '${l}${u}' no longer supported, use '${i[u]}'`)();else if(!h){const _=Iw(u,s);qb.warn(`${a} loader option '${l}${u}' not recognized. ${_}`)()}}}}function Iw(n,e){const t=n.toLowerCase();let i="";for(const s of e)for(const a in s.options){if(n===a)return`Did you mean '${s.id}.${a}'?`;const l=a.toLowerCase();(t.startsWith(l)||l.startsWith(t))&&(i=i||`Did you mean '${s.id}.${a}'?`)}return i}function Nw(n,e,t){const s={...n.options||{}};return Pw(s,t),s.log===null&&(s.log=new Ew),Zb(s,I3()),Zb(s,e),s}function Zb(n,e){for(const t in e)if(t in e){const i=e[t];Wb(i)&&Wb(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function Pw(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function Lg(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n==null?void 0:n.extensions)):!1}function Fg(n){xc(n,"null loader"),xc(Lg(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n!=null&&n.parseTextSync||n!=null&&n.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const N3=()=>{const n=O3();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function Dw(n){const e=N3();n=Array.isArray(n)?n:[n];for(const t of n){const i=Fg(t);e.find(s=>i===s)||e.unshift(i)}}function kw(){return N3()}const Uw=/\.([^.]+)$/;async function Bw(n,e=[],t,i){if(!P3(n))return null;let s=Qb(n,e,{...t,nothrow:!0},i);if(s)return s;if(Bs(n)&&(n=await n.slice(0,10).arrayBuffer(),s=Qb(n,e,t,i)),!s&&!(t!=null&&t.nothrow))throw new Error(D3(n));return s}function Qb(n,e=[],t,i){if(!P3(n))return null;if(e&&!Array.isArray(e))return Fg(e);let s=[];e&&(s=s.concat(e)),t!=null&&t.ignoreRegisteredLoaders||s.push(...kw()),Fw(s);const a=Lw(n,s,t,i);if(!a&&!(t!=null&&t.nothrow))throw new Error(D3(n));return a}function Lw(n,e,t,i){const s=Tu(n),a=Bg(n),l=Ug(s)||(i==null?void 0:i.url);let u=null,h="";return t!=null&&t.mimeType&&(u=ed(e,t==null?void 0:t.mimeType),h=`match forced by supplied MIME type ${t==null?void 0:t.mimeType}`),u=u||Vw(e,l),h=h||(u?`matched url ${l}`:""),u=u||ed(e,a),h=h||(u?`matched MIME type ${a}`:""),u=u||Hw(e,n),h=h||(u?`matched initial data ${k3(n)}`:""),t!=null&&t.fallbackMimeType&&(u=u||ed(e,t==null?void 0:t.fallbackMimeType),h=h||(u?`matched fallback MIME type ${a}`:"")),h&&kA.log(1,`selectLoader selected ${u==null?void 0:u.name}: ${h}.`),u}function P3(n){return!(n instanceof Response&&n.status===204)}function D3(n){const e=Tu(n),t=Bg(n);let i="No valid loader found (";i+=e?`${w3(e)}, `:"no url provided, ",i+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const s=n?k3(n):"";return i+=s?` first bytes: "${s}"`:"first bytes: not available",i+=")",i}function Fw(n){for(const e of n)Fg(e)}function Vw(n,e){const t=e&&Uw.exec(e),i=t&&t[1];return i?zw(n,i):null}function zw(n,e){e=e.toLowerCase();for(const t of n)for(const i of t.extensions)if(i.toLowerCase()===e)return t;return null}function ed(n,e){var t;for(const i of n)if((t=i.mimeTypes)!=null&&t.some(s=>$b(e,s))||$b(e,`application/x.${i.id}`))return i;return null}function Hw(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(jw(e,t))return t}else if(ArrayBuffer.isView(e)){if(Gb(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&Gb(e,0,t))return t;return null}function jw(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>n.startsWith(i))}function Gb(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>Ww(n,e,t,s))}function Ww(n,e,t,i){if(i instanceof ArrayBuffer)return GA(i,n,i.byteLength);switch(typeof i){case"function":return i(n);case"string":const s=Fd(n,e,i.length);return i===s;default:return!1}}function k3(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?Fd(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?Fd(n,0,e):""}function Fd(n,e,t){if(n.byteLength<e+t)return"";const i=new DataView(n);let s="";for(let a=0;a<t;a++)s+=String.fromCharCode(i.getUint8(e+a));return s}const $w=256*1024;function*Xw(n,e){const t=(e==null?void 0:e.chunkSize)||$w;let i=0;const s=new TextEncoder;for(;i<n.length;){const a=Math.min(n.length-i,t),l=n.slice(i,i+a);i+=a,yield s.encode(l)}}const Yw=256*1024;function*qw(n,e={}){const{chunkSize:t=Yw}=e;let i=0;for(;i<n.byteLength;){const s=Math.min(n.byteLength-i,t),a=new ArrayBuffer(s),l=new Uint8Array(n,i,s);new Uint8Array(a).set(l),i+=s,yield a}}const Kw=1024*1024;async function*Zw(n,e){const t=(e==null?void 0:e.chunkSize)||Kw;let i=0;for(;i<n.size;){const s=i+t,a=await n.slice(i,s).arrayBuffer();i=s,yield a}}function Jb(n,e){return Dg?Qw(n,e):Gw(n)}async function*Qw(n,e){const t=n.getReader();let i;try{for(;;){const s=i||t.read();e!=null&&e._streamReadAhead&&(i=t.read());const{done:a,value:l}=await s;if(a)return;yield A3(l)}}catch{t.releaseLock()}}async function*Gw(n,e){for await(const t of n)yield A3(t)}function Jw(n,e){if(typeof n=="string")return Xw(n,e);if(n instanceof ArrayBuffer)return qw(n,e);if(Bs(n))return Zw(n,e);if(E3(n))return Jb(n,e);if(Us(n))return Jb(n.body,e);throw new Error("makeIterator")}const U3="Cannot convert supplied data type";function eE(n,e,t){if(e.text&&typeof n=="string")return n;if(cw(n)&&(n=n.buffer),n instanceof ArrayBuffer){const i=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let i=n.buffer;const s=n.byteLength||n.length;return(n.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(n.byteOffset,n.byteOffset+s)),i}throw new Error(U3)}async function tE(n,e,t){const i=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||i)return eE(n,e);if(Bs(n)&&(n=await C3(n)),Us(n)){const s=n;return await bw(s),e.binary?await s.arrayBuffer():await s.text()}if(E3(n)&&(n=Jw(n,t)),ow(n)||lw(n))return tw(n);throw new Error(U3)}function B3(n,e){const t=I3(),i=n||t;return typeof i.fetch=="function"?i.fetch:Oo(i.fetch)?s=>Yb(s,i.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:Yb}function nE(n,e,t){if(t)return t;const i={fetch:B3(e,n),...n};if(i.url){const s=Ug(i.url);i.baseUrl=s,i.queryString=mw(i.url),i.filename=w3(s),i.baseUrl=rw(s)}return Array.isArray(i.loaders)||(i.loaders=null),i}function iE(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...i]:i}return t&&t.length?t:void 0}async function wc(n,e,t,i){e&&!Array.isArray(e)&&!Lg(e)&&(i=void 0,t=e,e=void 0),n=await n,t=t||{};const s=Tu(n),l=iE(e,i),u=await Bw(n,l,t);return u?(t=Mw(t,u,l,s),i=nE({url:s,_parse:wc,loaders:l},t,i||null),await sE(u,n,t,i)):null}async function sE(n,e,t,i){if(qA(n),t=UA(n.options,t),Us(e)){const a=e,{ok:l,redirected:u,status:h,statusText:d,type:p,url:_}=a,y=Object.fromEntries(a.headers.entries());i.response={headers:y,ok:l,redirected:u,status:h,statusText:d,type:p,url:_}}e=await tE(e,n,t);const s=n;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,t,i);if(KA(n,t))return await ZA(n,e,t,i,wc);if(s.parseText&&typeof e=="string")return await s.parseText(e,t,i);if(s.parse)return await s.parse(e,t,i);throw Gi(!s.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function Vd(n,e,t,i){let s,a;!Array.isArray(e)&&!Lg(e)?(s=[],a=e):(s=e,a=t);const l=B3(a);let u=n;return typeof n=="string"&&(u=await l(n)),Bs(n)&&(u=await l(n)),Array.isArray(s)?await wc(u,s,a):await wc(u,s,a)}const rE="4.3.2";var d3;const aE=(d3=globalThis.loaders)==null?void 0:d3.parseImageNode,zd=typeof Image<"u",Hd=typeof ImageBitmap<"u",oE=!!aE,jd=Dg?!0:oE;function lE(n){switch(n){case"auto":return Hd||zd||jd;case"imagebitmap":return Hd;case"image":return zd;case"data":return jd;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function cE(){if(Hd)return"imagebitmap";if(zd)return"image";if(jd)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function uE(n){const e=hE(n);if(!e)throw new Error("Not an image");return e}function fE(n){switch(uE(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function hE(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const dE=/^data:image\/svg\+xml/,gE=/\.svg((\?|#).*)?$/;function Vg(n){return n&&(dE.test(n)||gE.test(n))}function pE(n,e){if(Vg(e)){let i=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(a){throw new Error(a.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return L3(n,e)}function L3(n,e){if(Vg(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function F3(n,e,t){const i=pE(n,t),s=self.URL||self.webkitURL,a=typeof i!="string"&&s.createObjectURL(i);try{return await mE(a||i,e)}finally{a&&s.revokeObjectURL(a)}}async function mE(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((i,s)=>{try{t.onload=()=>i(t),t.onerror=a=>{const l=a instanceof Error?a.message:"error";s(new Error(l))}}catch(a){s(a)}})}const _E={};let e0=!0;async function yE(n,e,t){let i;Vg(t)?i=await F3(n,e,t):i=L3(n,t);const s=e&&e.imagebitmap;return await bE(i,s)}async function bE(n,e=null){if((vE(e)||!e0)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),e0=!1}return await createImageBitmap(n)}function vE(n){for(const e in n||_E)return!1;return!0}function TE(n){return!wE(n,"ftyp",4)||(n[8]&96)===0?null:xE(n)}function xE(n){switch(SE(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function SE(n,e,t){return String.fromCharCode(...n.slice(e,t))}function AE(n){return[...n].map(e=>e.charCodeAt(0))}function wE(n,e,t=0){const i=AE(e);for(let s=0;s<i.length;++s)if(i[s]!==n[s+t])return!1;return!0}const Fn=!1,ho=!0;function V3(n){const e=Io(n);return RE(e)||OE(e)||CE(e)||ME(e)||EE(e)}function EE(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=TE(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function RE(n){const e=Io(n);return e.byteLength>=24&&e.getUint32(0,Fn)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Fn),height:e.getUint32(20,Fn)}:null}function CE(n){const e=Io(n);return e.byteLength>=10&&e.getUint32(0,Fn)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,ho),height:e.getUint16(8,ho)}:null}function ME(n){const e=Io(n);return e.byteLength>=14&&e.getUint16(0,Fn)===16973&&e.getUint32(2,ho)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,ho),height:e.getUint32(22,ho)}:null}function OE(n){const e=Io(n);if(!(e.byteLength>=3&&e.getUint16(0,Fn)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:s}=IE();let a=2;for(;a+9<e.byteLength;){const l=e.getUint16(a,Fn);if(s.has(l))return{mimeType:"image/jpeg",height:e.getUint16(a+5,Fn),width:e.getUint16(a+7,Fn)};if(!i.has(l))return null;a+=2,a+=e.getUint16(a,Fn)}return null}function IE(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Io(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function NE(n,e){var s;const{mimeType:t}=V3(n)||{},i=(s=globalThis.loaders)==null?void 0:s.parseImageNode;return xc(i),await i(n,t)}async function PE(n,e,t){e=e||{};const s=(e.image||{}).type||"auto",{url:a}=t||{},l=DE(s);let u;switch(l){case"imagebitmap":u=await yE(n,e,a);break;case"image":u=await F3(n,e,a);break;case"data":u=await NE(n);break;default:xc(!1)}return s==="data"&&(u=fE(u)),u}function DE(n){switch(n){case"auto":case"data":return cE();default:return lE(n),n}}const kE=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],UE=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],BE={image:{type:"auto",decode:!0}},LE={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:rE,mimeTypes:UE,extensions:kE,parse:PE,tests:[n=>!!V3(new DataView(n))],options:BE},Fe=new Mo({id:"deck"});let Wd={};function FE(n){Wd=n}function Dt(n,e,t,i){Fe.level>0&&Wd[n]&&Wd[n].call(null,e,t,i)}function VE(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const zE={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:VE,parseTextSync:JSON.parse};function HE(){const n="9.1.11",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(Fe.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:Fe,_registerLoggers:FE},Dw([zE,[LE,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const jE=HE();function zg(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const td={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function WE(n){const e={};for(const[t,i]of Object.entries(n))e[t]=$E(i);return e}function $E(n){let e=t0(n);if(e!=="object")return{value:n,...td[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...td[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=t0(n.value),{...n,...td[e],type:e}):{type:"object",value:null};throw new Error("props")}function t0(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const XE=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,YE=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,qE={vertex:XE,fragment:YE},n0=/void\s+main\s*\([^)]*\)\s*\{\n?/,i0=/}\n?[^{}]*$/,nd=[],gc="__LUMA_INJECT_DECLARATIONS__";function KE(n){const e={vertex:{},fragment:{}};for(const t in n){let i=n[t];const s=ZE(t);typeof i=="string"&&(i={order:0,injection:i}),e[s][t]=i}return e}function ZE(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Ec(n,e,t,i=!1){const s=e==="vertex";for(const a in t){const l=t[a];l.sort((h,d)=>h.order-d.order),nd.length=l.length;for(let h=0,d=l.length;h<d;++h)nd[h]=l[h].injection;const u=`${nd.join(`
`)}
`;switch(a){case"vs:#decl":s&&(n=n.replace(gc,u));break;case"vs:#main-start":s&&(n=n.replace(n0,h=>h+u));break;case"vs:#main-end":s&&(n=n.replace(i0,h=>u+h));break;case"fs:#decl":s||(n=n.replace(gc,u));break;case"fs:#main-start":s||(n=n.replace(n0,h=>h+u));break;case"fs:#main-end":s||(n=n.replace(i0,h=>u+h));break;default:n=n.replace(a,h=>h+u)}}return n=n.replace(gc,""),i&&(n=n.replace(/\}\s*$/,a=>a+qE[e])),n}function Rc(n){n.map(e=>QE(e))}function QE(n){if(n.instance)return;Rc(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:i={}}=n,s={normalizedInjections:KE(i),parsedDeprecations:GE(t)};e&&(s.propValidators=WE(e)),n.instance=s;let a={};e&&(a=Object.entries(e).reduce((l,[u,h])=>{const d=h==null?void 0:h.value;return d&&(l[u]=d),l},{})),n.defaultUniforms={...n.defaultUniforms,...a}}function z3(n,e,t){var i;(i=n.deprecations)==null||i.forEach(s=>{var a;(a=s.regex)!=null&&a.test(e)&&(s.deprecated?t.deprecated(s.old,s.new)():t.removed(s.old,s.new)())})}function GE(n){return n.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),n}function Hg(n){Rc(n);const e={},t={};H3({modules:n,level:0,moduleMap:e,moduleDepth:t});const i=Object.keys(t).sort((s,a)=>t[a]-t[s]).map(s=>e[s]);return Rc(i),i}function H3(n){const{modules:e,level:t,moduleMap:i,moduleDepth:s}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const a of e)i[a.name]=a,(s[a.name]===void 0||s[a.name]<t)&&(s[a.name]=t);for(const a of e)a.dependencies&&H3({modules:a.dependencies,level:t+1,moduleMap:i,moduleDepth:s})}function JE(n){switch(n==null?void 0:n.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function eR(n,e){var i;if(Number(((i=n.match(/^#version[ \t]+(\d+)/m))==null?void 0:i[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=s0(n,tR),n;case"fragment":return n=s0(n,nR),n;default:throw new Error(e)}}const j3=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],tR=[...j3,[$d("attribute"),"in $1"],[$d("varying"),"out $1"]],nR=[...j3,[$d("varying"),"in $1"]];function s0(n,e){for(const[t,i]of e)n=n.replace(t,i);return n}function $d(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function W3(n,e){let t="";for(const i in n){const s=n[i];if(t+=`void ${s.signature} {
`,s.header&&(t+=`  ${s.header}`),e[i]){const a=e[i];a.sort((l,u)=>l.order-u.order);for(const l of a)t+=`  ${l.injection}
`}s.footer&&(t+=`  ${s.footer}`),t+=`}
`}return t}function $3(n){const e={vertex:{},fragment:{}};for(const t of n){let i,s;typeof t!="string"?(i=t,s=i.hook):(i={},s=t),s=s.trim();const[a,l]=s.split(":"),u=s.replace(/\(.+/,""),h=Object.assign(i,{signature:l});switch(a){case"vs":e.vertex[u]=h;break;case"fs":e.fragment[u]=h;break;default:throw new Error(a)}}return e}function iR(n,e){return{name:sR(n,e),language:"glsl",version:rR(n)}}function sR(n,e="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return i?i[1]:e}function rR(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const i=parseInt(t[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const X3=`

${gc}
`,aR=`precision highp float;
`;function oR(n){const e=Hg(n.modules||[]);return{source:cR(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:Y3(e)}}function lR(n){const{vs:e,fs:t}=n,i=Hg(n.modules||[]);return{vs:r0(n.platformInfo,{...n,source:e,stage:"vertex",modules:i}),fs:r0(n.platformInfo,{...n,source:t,stage:"fragment",modules:i}),getUniforms:Y3(i)}}function cR(n,e){var R;const{source:t,stage:i,modules:s,hookFunctions:a=[],inject:l={},log:u}=e;zg(typeof t=="string","shader source must be a string");const h=t;let d="";const p=$3(a),_={},y={},v={};for(const C in l){const z=typeof l[C]=="string"?{injection:l[C],order:0}:l[C],H=/^(v|f)s:(#)?([\w-]+)$/.exec(C);if(H){const M=H[2],k=H[3];M?k==="decl"?y[C]=[z]:v[C]=[z]:_[C]=[z]}else v[C]=[z]}const A=s;for(const C of A){u&&z3(C,h,u);const z=q3(C,"wgsl");d+=z;const H=((R=C.injections)==null?void 0:R[i])||{};for(const M in H){const k=/^(v|f)s:#([\w-]+)$/.exec(M);if(k){const X=k[2]==="decl"?y:v;X[M]=X[M]||[],X[M].push(H[M])}else _[M]=_[M]||[],_[M].push(H[M])}}return d+=X3,d=Ec(d,i,y),d+=W3(p[i],_),d+=h,d=Ec(d,i,v),d}function r0(n,e){var ce;const{id:t,source:i,stage:s,language:a="glsl",modules:l,defines:u={},hookFunctions:h=[],inject:d={},prologue:p=!0,log:_}=e;zg(typeof i=="string","shader source must be a string");const y=a==="glsl"?iR(i).version:-1,v=n.shaderLanguageVersion,A=y===100?"#version 100":"#version 300 es",C=i.split(`
`).slice(1).join(`
`),z={};l.forEach(re=>{Object.assign(z,re.defines)}),Object.assign(z,u);let H="";switch(a){case"wgsl":break;case"glsl":H=p?`${A}

// ----- PROLOGUE -------------------------
${uR({id:t,source:i,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}

${JE(n)}
${s==="fragment"?aR:""}

// ----- APPLICATION DEFINES -------------------------

${fR(z)}

`:`${A}
`;break}const M=$3(h),k={},L={},X={};for(const re in d){const ne=typeof d[re]=="string"?{injection:d[re],order:0}:d[re],he=/^(v|f)s:(#)?([\w-]+)$/.exec(re);if(he){const te=he[2],me=he[3];te?me==="decl"?L[re]=[ne]:X[re]=[ne]:k[re]=[ne]}else X[re]=[ne]}for(const re of l){_&&z3(re,C,_);const ne=q3(re,s);H+=ne;const he=((ce=re.instance)==null?void 0:ce.normalizedInjections[s])||{};for(const te in he){const me=/^(v|f)s:#([\w-]+)$/.exec(te);if(me){const _e=me[2]==="decl"?L:X;_e[te]=_e[te]||[],_e[te].push(he[te])}else k[te]=k[te]||[],k[te].push(he[te])}}return H+="// ----- MAIN SHADER SOURCE -------------------------",H+=X3,H=Ec(H,s,L),H+=W3(M[s],k),H+=C,H=Ec(H,s,X),a==="glsl"&&y!==v&&(H=eR(H,s)),H.trim()}function Y3(n){return function(t){var s;const i={};for(const a of n){const l=(s=a.getUniforms)==null?void 0:s.call(a,t,i);Object.assign(i,l)}return i}}function uR(n){const{id:e,source:t,stage:i}=n;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}`:""}function fR(n={}){let e="";for(const t in n){const i=n[t];(i||Number.isFinite(i))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function q3(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:zg(!1)}if(!n.name)throw new Error("Shader module must have a name");const i=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(s+=`#define MODULE_${i}
`),s+=`${t}
`,s}const hR=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,dR=/^\s*\#\s*endif\s*$/;function gR(n,e){var l;const t=n.split(`
`),i=[];let s=!0,a=null;for(const u of t){const h=u.match(hR),d=u.match(dR);h?(a=h[1],s=!!((l=e==null?void 0:e.defines)!=null&&l[a])):d?s=!0:s&&i.push(u)}return i.join(`
`)}const Ss=class Ss{constructor(){T(this,"_hookFunctions",[]);T(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Ss.defaultShaderAssembler=Ss.defaultShaderAssembler||new Ss,Ss.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),i=this._hookFunctions,{source:s,getUniforms:a}=oR({...e,source:e.source,modules:t,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?gR(s):s,getUniforms:a,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),i=this._hookFunctions;return{...lR({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:i}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),i={};let s=0;for(let a=0,l=this._defaultModules.length;a<l;++a){const u=this._defaultModules[a],h=u.name;t[s++]=u,i[h]=!0}for(let a=0,l=e.length;a<l;++a){const u=e[a],h=u.name;i[h]||(t[s++]=u,i[h]=!0)}return t.length=s,Rc(t),t}};T(Ss,"defaultShaderAssembler");let Cc=Ss;const pR=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,mR=`#version 300 es
${pR}`;function K3(n){const{input:e,inputChannels:t,output:i}=n||{};if(!e)return mR;if(!t)throw new Error("inputChannels");const s=_R(t),a=yR(e,t);return`#version 300 es
in ${s} ${e};
out vec4 ${i};
void main() {
  ${i} = ${a};
}`}function _R(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function yR(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class bR{constructor(){T(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new vu({id:e})),this.stats.get(e)}}const Z3=new bR,ee=new Mo({id:"luma.gl"}),id={};function xu(n="id"){id[n]=id[n]||1;const e=id[n]++;return`${n}-${e}`}var Bd;let Xe=(Bd=class{constructor(e,t,i){T(this,"id");T(this,"props");T(this,"userData",{});T(this,"_device");T(this,"destroyed",!1);T(this,"allocatedBytes",0);T(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=vR(t,i);const s=this.props.id!=="undefined"?this.props.id:xu(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},T(Bd,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Bd);function vR(n,e){const t={...e};for(const i in n)n[i]!==void 0&&(t[i]=n[i]);return t}const Et=class Et extends Xe{constructor(t,i){const s={...i};(i.usage||0)&Et.INDEX&&!i.indexType&&(i.data instanceof Uint32Array?s.indexType="uint32":i.data instanceof Uint16Array&&(s.indexType="uint16")),delete s.data;super(t,s,Et.defaultProps);T(this,"usage");T(this,"indexType");T(this,"updateTimestamp");T(this,"debugData",new ArrayBuffer(0));this.usage=s.usage||0,this.indexType=s.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,i){throw new Error("not implemented")}_setDebugData(t,i,s){const a=ArrayBuffer.isView(t)?t.buffer:t,l=Math.min(t?t.byteLength:s,Et.DEBUG_DATA_MAX_LENGTH);a===null?this.debugData=new ArrayBuffer(l):i===0&&s===a.byteLength?this.debugData=a.slice(0,l):this.debugData=a.slice(i,i+l)}};T(Et,"defaultProps",{...Xe.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),T(Et,"MAP_READ",1),T(Et,"MAP_WRITE",2),T(Et,"COPY_SRC",4),T(Et,"COPY_DST",8),T(Et,"INDEX",16),T(Et,"VERTEX",32),T(Et,"UNIFORM",64),T(Et,"STORAGE",128),T(Et,"INDIRECT",256),T(Et,"QUERY_RESOLVE",512),T(Et,"DEBUG_DATA_MAX_LENGTH",32);let Qe=Et;function Q3(n){const e=a0[n],t=TR(e),i=n.includes("norm"),s=!i&&!n.startsWith("float"),a=n.startsWith("s");return{dataType:a0[n],byteLength:t,integer:s,signed:a,normalized:i}}function TR(n){return xR[n]}const a0={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},xR={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},It="texture-compression-bc",$e="texture-compression-astc",kn="texture-compression-etc2",SR="texture-compression-etc1-webgl",Gl="texture-compression-pvrtc-webgl",sd="texture-compression-atc-webgl",Jl="float32-renderable-webgl",rd="float16-renderable-webgl",AR="rgb9e5ufloat-renderable-webgl",ad="snorm8-renderable-webgl",no="norm16-renderable-webgl",od="snorm16-renderable-webgl",ec="float32-filterable",o0="float16-filterable-webgl";function G3(n){const e=wR[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const wR={r8unorm:{},r8snorm:{render:ad},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:ad},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:rd,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:no},"r16snorm-webgl":{f:od},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:ad},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:rd,filter:o0},"rg16unorm-webgl":{render:no},"rg16snorm-webgl":{render:od},r32uint:{},r32sint:{},r32float:{render:Jl,filter:ec},rgb9e5ufloat:{channels:"rgb",packed:!0,render:AR},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Jl},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:no},"rgb16snorm-webgl":{f:no},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:ec},rgba16uint:{},rgba16sint:{},rgba16float:{render:rd,filter:o0},"rgba16unorm-webgl":{render:no},"rgba16snorm-webgl":{render:od},"rgb32float-webgl":{render:Jl,filter:ec},rgba32uint:{},rgba32sint:{},rgba32float:{render:Jl,filter:ec},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:It},"bc1-rgb-unorm-srgb-webgl":{f:It},"bc1-rgba-unorm":{f:It},"bc1-rgba-unorm-srgb":{f:It},"bc2-rgba-unorm":{f:It},"bc2-rgba-unorm-srgb":{f:It},"bc3-rgba-unorm":{f:It},"bc3-rgba-unorm-srgb":{f:It},"bc4-r-unorm":{f:It},"bc4-r-snorm":{f:It},"bc5-rg-unorm":{f:It},"bc5-rg-snorm":{f:It},"bc6h-rgb-ufloat":{f:It},"bc6h-rgb-float":{f:It},"bc7-rgba-unorm":{f:It},"bc7-rgba-unorm-srgb":{f:It},"etc2-rgb8unorm":{f:kn},"etc2-rgb8unorm-srgb":{f:kn},"etc2-rgb8a1unorm":{f:kn},"etc2-rgb8a1unorm-srgb":{f:kn},"etc2-rgba8unorm":{f:kn},"etc2-rgba8unorm-srgb":{f:kn},"eac-r11unorm":{f:kn},"eac-r11snorm":{f:kn},"eac-rg11unorm":{f:kn},"eac-rg11snorm":{f:kn},"astc-4x4-unorm":{f:$e},"astc-4x4-unorm-srgb":{f:$e},"astc-5x4-unorm":{f:$e},"astc-5x4-unorm-srgb":{f:$e},"astc-5x5-unorm":{f:$e},"astc-5x5-unorm-srgb":{f:$e},"astc-6x5-unorm":{f:$e},"astc-6x5-unorm-srgb":{f:$e},"astc-6x6-unorm":{f:$e},"astc-6x6-unorm-srgb":{f:$e},"astc-8x5-unorm":{f:$e},"astc-8x5-unorm-srgb":{f:$e},"astc-8x6-unorm":{f:$e},"astc-8x6-unorm-srgb":{f:$e},"astc-8x8-unorm":{f:$e},"astc-8x8-unorm-srgb":{f:$e},"astc-10x5-unorm":{f:$e},"astc-10x5-unorm-srgb":{f:$e},"astc-10x6-unorm":{f:$e},"astc-10x6-unorm-srgb":{f:$e},"astc-10x8-unorm":{f:$e},"astc-10x8-unorm-srgb":{f:$e},"astc-10x10-unorm":{f:$e},"astc-10x10-unorm-srgb":{f:$e},"astc-12x10-unorm":{f:$e},"astc-12x10-unorm-srgb":{f:$e},"astc-12x12-unorm":{f:$e},"astc-12x12-unorm-srgb":{f:$e},"pvrtc-rgb4unorm-webgl":{f:Gl},"pvrtc-rgba4unorm-webgl":{f:Gl},"pvrtc-rbg2unorm-webgl":{f:Gl},"pvrtc-rgba2unorm-webgl":{f:Gl},"etc1-rbg-unorm-webgl":{f:SR},"atc-rgb-unorm-webgl":{f:sd},"atc-rgba-unorm-webgl":{f:sd},"atc-rgbai-unorm-webgl":{f:sd}},ER=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],RR=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function J3(n){return ER.some(e=>n.startsWith(e))}function jg(n){let e=CR(n);if(J3(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const i=MR(n);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}const t=RR.exec(n);if(t){const[,i,s,a,l,u]=t,h=`${a}${s}`,d=Q3(h),p=d.byteLength*8,_=i.length,y=[p,_>=2?p:0,_>=3?p:0,_>=4?p:0];e={format:n,attachment:e.attachment,dataType:d.dataType,components:_,channels:i,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:y,bytesPerPixel:d.byteLength*i.length,packed:e.packed,srgb:e.srgb},u==="-webgl"&&(e.webgl=!0),l==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function CR(n){var a;const e=G3(n),t=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((a=e.channels)==null?void 0:a.length)||1,bytesPerPixel:t,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function MR(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,i,s]=t;return{blockWidth:Number(i),blockHeight:Number(s)}}return null}function OR(n){const e=G3(n),t={format:n,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},i=jg(n),s=n.startsWith("depth")||n.startsWith("stencil"),a=i==null?void 0:i.signed,l=i==null?void 0:i.integer,u=i==null?void 0:i.webgl;return t.render&&(t.render=!a),t.filter&&(t.filter=!s&&!a&&!l&&!u),t}class IR{}class NR{constructor(e=[],t){T(this,"features");T(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){var t;return!((t=this.disabledFeatures)!=null&&t[e])&&this.features.has(e)}}const su=class su{constructor(e){T(this,"id");T(this,"props");T(this,"userData",{});T(this,"statsManager",Z3);T(this,"timestamp",0);T(this,"_reused",!1);T(this,"_lumaData",{});this.props={...su.defaultProps,...e},this.id=this.props.id||xu(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const t=OR(e),i=l=>(typeof l=="string"?this.features.has(l):l)??!0,s=i(t.create),a={format:e,create:s,render:s&&i(t.render),filter:s&&i(t.filter),blend:s&&i(t.blend),store:s&&i(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(a)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return J3(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&Qe.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":ee.warn("indices buffer content must be of integer type")()),t}};T(su,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>ee.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:ee.get("debug")||void 0,debugShaders:ee.get("debug-shaders")||void 0,debugFramebuffers:!!ee.get("debug-framebuffers"),debugWebGL:!!ee.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let Ki=su;const PR=ks()&&typeof document<"u",DR=()=>PR&&document.readyState==="complete",kR="set luma.log.level=1 (or higher) to trace rendering",l0="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",$i=class $i{constructor(){T(this,"stats",Z3);T(this,"log",ee);T(this,"VERSION","9.1.9");T(this,"spector");T(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw ee.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),ee.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");ee.error("This version of luma.gl has already been initialized")()}ee.log(1,`${this.VERSION} - ${kR}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,i])=>i).filter(i=>{var s;return(s=i.isSupported)==null?void 0:s.call(i)}).map(i=>i.type)}getBestAvailableAdapter(e=[]){var i,s,a,l;const t=this.getAdapterMap(e);return(s=(i=t.get("webgpu"))==null?void 0:i.isSupported)!=null&&s.call(i)?"webgpu":(l=(a=t.get("webgl"))==null?void 0:a.isSupported)!=null&&l.call(a)?"webgl":null}setDefaultDeviceProps(e){Object.assign($i.defaultProps,e)}async createDevice(e={}){var u;e={...$i.defaultProps,...e},e.waitForPageLoad&&await $i.pageLoaded;const t=this.getAdapterMap(e.adapters);let i=e.type||"";i==="best-available"&&(i=this.getBestAvailableAdapter(e.adapters)||i);const a=(this.getAdapterMap(e.adapters)||t).get(i),l=await((u=a==null?void 0:a.create)==null?void 0:u.call(a,e));if(l)return l;throw new Error(l0)}async attachDevice(e){var l;const t=this.getAdapterMap(e.adapters);let i="";e.handle instanceof WebGL2RenderingContext&&(i="webgl"),e.createCanvasContext&&await $i.pageLoaded,e.handle===null&&(i="unknown");const s=t.get(i),a=await((l=s==null?void 0:s.attach)==null?void 0:l.call(s,null));if(a)return a;throw new Error(l0)}enforceWebGL2(e=!0,t=[]){var a;const s=this.getAdapterMap(t).get("webgl");s||ee.warn("enforceWebGL2: webgl adapter not found")(),(a=s==null?void 0:s.enforceWebGL2)==null||a.call(s,e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const i of e)t.set(i.type,i);return t}registerDevices(e){ee.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const i=t.adapter;i&&this.preregisteredAdapters.set(i.type,i)}}};T($i,"defaultProps",{...Ki.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),T($i,"pageLoaded",UR().then(()=>{ee.probe(2,"DOM is loaded")()}));let Xd=$i;const Yd=new Xd;function UR(){return DR()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}class BR{}const ru=class ru{constructor(e){T(this,"id");T(this,"props");T(this,"canvas");T(this,"htmlCanvas");T(this,"offscreenCanvas");T(this,"type");T(this,"width",1);T(this,"height",1);T(this,"resizeObserver");T(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...ru.defaultProps,...e},e=this.props,!ks()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=FR(e.canvas):this.canvas=e.canvas;else{const t=VR(e),i=LR((e==null?void 0:e.container)||null);i.insertBefore(t,i.firstChild),this.canvas=t,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const i of t)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){var e;try{const[t]=this.getDrawingBufferSize(),i=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return i?t/i:1}catch{return 1}}cssToDevicePixels(e,t=!0){const i=this.cssToDeviceRatio(),[s,a]=this.getDrawingBufferSize();return zR(e,i,s,a,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let i="width"in t?t.width:this.htmlCanvas.clientWidth,s="height"in t?t.height:this.htmlCanvas.clientHeight;(!i||!s)&&(ee.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const a=this._canvasSizeInfo;if(a.clientWidth!==i||a.clientHeight!==s||a.devicePixelRatio!==e){let l=e;const u=Math.floor(i*l),h=Math.floor(s*l);if(this.htmlCanvas.width=u,this.htmlCanvas.height=h,this.device.gl){const[p,_]=this.getDrawingBufferSize();(p!==u||_!==h)&&(l=Math.min(p/i,_/s),this.htmlCanvas.width=Math.floor(i*l),this.htmlCanvas.height=Math.floor(s*l),ee.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var t;((t=this.htmlCanvas)==null?void 0:t.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};T(ru,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let qd=ru;function LR(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}else if(n)return n;return document.body}function FR(n){const e=document.getElementById(n);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function VR(n){const{width:e,height:t}=n,i=document.createElement("canvas");return i.id=xu("lumagl-auto-created-canvas"),i.width=e||1,i.height=t||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(t)?`${t}px`:"100%",i}function zR(n,e,t,i,s){const a=n,l=c0(a[0],e,t);let u=u0(a[1],e,i,s),h=c0(a[0]+1,e,t);const d=h===t-1?h:h-1;h=u0(a[1]+1,e,i,s);let p;return s?(h=h===0?h:h+1,p=u,u=h):p=h===i-1?h:h-1,{x:l,y:u,width:Math.max(d-l+1,1),height:Math.max(p-u+1,1)}}function c0(n,e,t){return Math.min(Math.round(n*e),t-1)}function u0(n,e,t,i){return i?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}const Rt=class Rt extends Xe{constructor(t,i){i=Rt.normalizeProps(t,i);super(t,i,Rt.defaultProps);T(this,"dimension");T(this,"format");T(this,"width");T(this,"height");T(this,"depth");T(this,"mipLevels");T(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const s=Rt.getTextureDataSize(this.props.data);this.width=(s==null?void 0:s.width)||1,this.height=(s==null?void 0:s.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?Rt.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const i=t==null?void 0:t.data;return ArrayBuffer.isView(i)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return Rt.getTextureDataSize(t[0]);if(Rt.isExternalImage(t))return Rt.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const s=Object.values(t)[0];return{width:s.width,height:s.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,i){let s;return ArrayBuffer.isView(t)?s=[{data:t,width:i.width,height:i.height}]:Array.isArray(t)?s=t:s=[t],s}static getMipLevelCount(t,i){return Math.floor(Math.log2(Math.max(t,i)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static normalizeProps(t,i){var h,d;const s={...i},a=((d=(h=t==null?void 0:t.props)==null?void 0:h._resourceDefaults)==null?void 0:d.texture)||{};Object.assign(s,a);const{width:l,height:u}=s;return typeof l=="number"&&(s.width=Math.max(1,Math.ceil(l))),typeof u=="number"&&(s.height=Math.max(1,Math.ceil(u))),s}};T(Rt,"COPY_SRC",1),T(Rt,"COPY_DST",2),T(Rt,"TEXTURE",4),T(Rt,"STORAGE",8),T(Rt,"RENDER_ATTACHMENT",16),T(Rt,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),T(Rt,"defaultProps",{...Xe.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),T(Rt,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let st=Rt;const au=class au extends Xe{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,au.defaultProps)}};T(au,"defaultProps",{...Xe.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Mc=au;function HR(n,e,t){let i="";const s=e.split(/\r?\n/),a=n.slice().sort((l,u)=>l.lineNum-u.lineNum);switch((t==null?void 0:t.showSourceCode)||"no"){case"all":let l=0;for(let u=1;u<=s.length;u++)for(i+=e2(s[u-1],u,t);a.length>l&&a[l].lineNum===u;){const h=a[l++];i+=f0(h,s,h.lineNum,{...t,inlineSource:!1})}return i;case"issues":case"no":for(const u of n)i+=f0(u,s,u.lineNum,{inlineSource:(t==null?void 0:t.showSourceCode)!=="no"});return i}}function f0(n,e,t,i){if(i!=null&&i.inlineSource){const a=jR(e,t),l=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${a}${l}${n.type.toUpperCase()}: ${n.message}

`}const s=n.type==="error"?"red":"#8B4000";return i!=null&&i.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function jR(n,e,t){let i="";for(let s=e-2;s<=e;s++){const a=n[s-1];a!==void 0&&(i+=e2(a,e,t))}return i}function e2(n,e,t){const i=t!=null&&t.html?$R(n):n;return`${WR(String(e),4)}: ${i}${t!=null&&t.html?"<br/>":`
`}`}function WR(n,e){let t="";for(let i=n.length;i<e;++i)t+=" ";return t+n}function $R(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const ou=class ou extends Xe{constructor(t,i){i={...i,debugShaders:i.debugShaders||t.props.debugShaders||"errors"};super(t,{id:XR(i),...i},ou.defaultProps);T(this,"stage");T(this,"source");T(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const i=await this.getCompilationInfo();t==="warnings"&&(i==null?void 0:i.length)===0||this._displayShaderLog(i)}_displayShaderLog(t){var d;if(typeof document>"u"||!(document!=null&&document.createElement))return;const i=t2(this.source),s=`${this.stage} ${i}`;let a=HR(t,this.source,{showSourceCode:"all",html:!0});const l=this.getTranslatedSource();l&&(a+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${l}</pre></code>`);const u=document.createElement("Button");u.innerHTML=`
<h1>Shader Compilation Error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${a}
</pre></code>`,u.style.top="10px",u.style.left="10px",u.style.position="absolute",u.style.zIndex="9999",u.style.width="100%",u.style.textAlign="left",document.body.appendChild(u),(d=document.getElementsByClassName("luma-compiler-log-error")[0])==null||d.scrollIntoView(),u.onclick=()=>{const p=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(p)}}};T(ou,"defaultProps",{...Xe.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Oc=ou;function XR(n){return t2(n.source)||n.id||xu(`unnamed ${n.stage}-shader`)}function t2(n,e="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return i?i[1]:e}const vo=class vo extends Xe{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=vo.normalizeProps(e,t),super(e,t,vo.defaultProps)}static normalizeProps(e,t){var a,l;const i=((l=(a=e==null?void 0:e.props)==null?void 0:a._resourceDefaults)==null?void 0:l.sampler)||{};return{...t,...i}}};T(vo,"defaultProps",{...Xe.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Ic=vo;const lu=class lu extends Xe{constructor(t,i={}){super(t,i,lu.defaultProps);T(this,"width");T(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(t){const i=this.colorAttachments.map(a=>a.texture.clone(t)),s=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:i,depthStencilAttachment:s})}resize(t){let i=!t;if(t){const[s,a]=Array.isArray(t)?t:[t.width,t.height];i=i||a!==this.height||s!==this.width,this.width=s,this.height=a}i&&(ee.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((i,s)=>{if(typeof i=="string"){const a=this.createColorTexture(i,s);return this.attachResource(a),a.view}return i instanceof st?i.view:i});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const i=this.createDepthStencilTexture(t);this.attachResource(i),this.depthStencilAttachment=i.view}else t instanceof st?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,i){return this.device.createTexture({id:`${this.id}-color-attachment-${i}`,usage:st.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:st.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,i){for(let s=0;s<this.colorAttachments.length;++s)if(this.colorAttachments[s]){const a=this.colorAttachments[s].texture.clone({width:t,height:i});this.destroyAttachedResource(this.colorAttachments[s]),this.colorAttachments[s]=a.view,this.attachResource(a.view)}if(this.depthStencilAttachment){const s=this.depthStencilAttachment.texture.clone({width:t,height:i});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=s.view,this.attachResource(s)}this.updateAttachments()}};T(lu,"defaultProps",{...Xe.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Nc=lu;const cu=class cu extends Xe{constructor(t,i){super(t,i,cu.defaultProps);T(this,"shaderLayout");T(this,"bufferLayout");T(this,"linkStatus","pending");T(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};T(cu,"defaultProps",{...Xe.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Wr=cu;const En=class En extends Xe{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=En.normalizeProps(e,t),super(e,t,En.defaultProps)}static normalizeProps(e,t){var a;return{...(a=e.props._resourceDefaults)==null?void 0:a.renderPass,...t}}};T(En,"defaultClearColor",[0,0,0,1]),T(En,"defaultClearDepth",1),T(En,"defaultClearStencil",0),T(En,"defaultProps",{...Xe.defaultProps,framebuffer:null,parameters:void 0,clearColor:En.defaultClearColor,clearColors:void 0,clearDepth:En.defaultClearDepth,clearStencil:En.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Kd=En;const uu=class uu extends Xe{constructor(t,i){super(t,i,uu.defaultProps);T(this,"hash","");T(this,"shaderLayout");this.shaderLayout=i.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};T(uu,"defaultProps",{...Xe.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Pc=uu;const fu=class fu extends Xe{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,fu.defaultProps)}};T(fu,"defaultProps",{...Xe.defaultProps,measureExecutionTime:void 0});let Zd=fu;const hu=class hu extends Xe{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,hu.defaultProps)}};T(hu,"defaultProps",{...Xe.defaultProps});let Qd=hu;function YR(n){const[e,t]=KR[n],i=e==="i32"||e==="u32",s=e!=="u32",a=ZR[e]*t,l=qR(e,t);return{dataType:e,components:t,defaultVertexFormat:l,byteLength:a,integer:i,signed:s}}function qR(n,e){let t;switch(n){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const KR={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},ZR={f32:4,f16:2,i32:4,u32:4};function n2(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,i]=n.split("x"),s=t,a=i?parseInt(i):1,l=Q3(s),u={type:s,components:a,byteLength:l.byteLength*a,integer:l.integer,signed:l.signed,normalized:l.normalized};return e&&(u.webglOnly=!0),u}function i2(n,e){const t={};for(const i of n.attributes){const s=GR(n,e,i.name);s&&(t[i.name]=s)}return t}function QR(n,e,t=16){const i=i2(n,e),s=new Array(t).fill(null);for(const a of Object.values(i))s[a.location]=a;return s}function GR(n,e,t){const i=JR(n,t),s=eC(e,t);if(!i)return null;const a=YR(i.type),l=(s==null?void 0:s.vertexFormat)||a.defaultVertexFormat,u=n2(l);return{attributeName:(s==null?void 0:s.attributeName)||i.name,bufferName:(s==null?void 0:s.bufferName)||i.name,location:i.location,shaderType:i.type,shaderDataType:a.dataType,shaderComponents:a.components,vertexFormat:l,bufferDataType:u.type,bufferComponents:u.components,normalized:u.normalized,integer:a.integer,stepMode:(s==null?void 0:s.stepMode)||i.stepMode||"vertex",byteOffset:(s==null?void 0:s.byteOffset)||0,byteStride:(s==null?void 0:s.byteStride)||0}}function JR(n,e){const t=n.attributes.find(i=>i.name===e);return t||ee.warn(`shader layout attribute "${e}" not present in shader`),t||null}function eC(n,e){tC(n);let t=nC(n,e);return t||(t=iC(n,e),t)?t:(ee.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function tC(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&ee.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function nC(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function iC(n,e){var t;for(const i of n){let s=i.byteStride;if(typeof i.byteStride!="number")for(const l of i.attributes||[]){const u=n2(l.format);s+=u.byteLength}const a=(t=i.attributes)==null?void 0:t.find(l=>l.attribute===e);if(a)return{attributeName:a.attribute,bufferName:i.name,stepMode:i.stepMode,vertexFormat:a.format,byteOffset:a.byteOffset,byteStride:s}}return null}const du=class du extends Xe{constructor(t,i){super(t,i,du.defaultProps);T(this,"maxVertexAttributes");T(this,"attributeInfos");T(this,"indexBuffer",null);T(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:s,bufferLayout:a}=i.renderPipeline||{};if(!s||!a)throw new Error("VertexArray");this.attributeInfos=QR(s,a,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,i){this.device.reportError(new Error("constant attributes not supported"))}};T(du,"defaultProps",{...Xe.defaultProps,renderPipeline:null});let Gd=du;const gu=class gu extends Xe{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,gu.defaultProps)}};T(gu,"defaultProps",{...Xe.defaultProps,layout:void 0,buffers:{}});let Jd=gu;const pu=class pu extends Xe{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,pu.defaultProps)}};T(pu,"defaultProps",{...Xe.defaultProps,type:void 0,count:void 0});let eg=pu;const sC={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function rC(n){return sC[n]}function aC(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let tc;function s2(n){return(!tc||tc.byteLength<n)&&(tc=new ArrayBuffer(n)),tc}function oC(n,e){const t=s2(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function lC(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Dc(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":lC(n)}const h0=1024;class cC{constructor(e){T(this,"layout",{});T(this,"byteLength");let t=0;for(const[s,a]of Object.entries(e)){const l=rC(a),{type:u,components:h}=l;t=aC(t,h);const d=t;t+=h,this.layout[s]={type:u,size:h,offset:d}}t+=(4-t%4)%4;const i=t*4;this.byteLength=Math.max(i,h0)}getData(e){const t=Math.max(this.byteLength,h0),i=s2(t),s={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(const[a,l]of Object.entries(e)){const u=this.layout[a];if(!u){ee.warn(`Supplied uniform value ${a} not present in uniform block layout`)();continue}const{type:h,size:d,offset:p}=u,_=s[h];if(d===1){if(typeof l!="number"&&typeof l!="boolean"){ee.warn(`Supplied value for single component uniform ${a} is not a number: ${l}`)();continue}_[p]=Number(l)}else{if(!Dc(l)){ee.warn(`Supplied value for multi component / array uniform ${a} is not a numeric array: ${l}`)();continue}_.set(l,p)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function uC(n,e,t=16){if(n!==e)return!1;const i=n,s=e;if(!Dc(i))return!1;if(Dc(s)&&i.length===s.length){for(let a=0;a<i.length;++a)if(s[a]!==i[a])return!1}return!0}function fC(n){return Dc(n)?n.slice():n}class hC{constructor(e){T(this,"name");T(this,"uniforms",{});T(this,"modifiedUniforms",{});T(this,"modified",!0);T(this,"bindingLayout",{});T(this,"needsRedraw","initialized");var t;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const i=(t=e==null?void 0:e.shaderLayout.bindings)==null?void 0:t.find(a=>a.type==="uniform"&&a.name===(e==null?void 0:e.name));if(!i)throw new Error(e==null?void 0:e.name);const s=i;for(const a of s.uniforms||[])this.bindingLayout[a.name]=a}}setUniforms(e){for(const[t,i]of Object.entries(e))this._setUniform(t,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){uC(this.uniforms[e],t)||(this.uniforms[e]=fC(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class dC{constructor(e){T(this,"uniformBlocks",new Map);T(this,"uniformBufferLayouts",new Map);T(this,"uniformBuffers",new Map);for(const[t,i]of Object.entries(e)){const s=t,a=new cC(i.uniformTypes||{});this.uniformBufferLayouts.set(s,a);const l=new hC({name:t});l.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(s,l)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var t;for(const[i,s]of Object.entries(e))(t=this.uniformBlocks.get(i))==null||t.setUniforms(s);this.updateUniformBuffers()}getUniformBufferByteLength(e){var t;return((t=this.uniformBufferLayouts.get(e))==null?void 0:t.byteLength)||0}getUniformBufferData(e){var i,s;const t=((i=this.uniformBlocks.get(e))==null?void 0:i.getAllUniforms())||{};return(s=this.uniformBufferLayouts.get(e))==null?void 0:s.getData(t)}createUniformBuffer(e,t,i){i&&this.setUniforms(i);const s=this.getUniformBufferByteLength(t),a=e.createBuffer({usage:Qe.UNIFORM|Qe.COPY_DST,byteLength:s}),l=this.getUniformBufferData(t);return a.write(l),a}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const i=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:Qe.UNIFORM|Qe.COPY_DST,byteLength:i});this.uniformBuffers.set(t,s)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(t);e||(e=i)}return e&&ee.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var a;const t=this.uniformBlocks.get(e);let i=this.uniformBuffers.get(e),s=!1;if(i&&(t!=null&&t.needsRedraw)){s||(s=t.needsRedraw);const l=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i==null||i.write(l);const u=(a=this.uniformBlocks.get(e))==null?void 0:a.getAllUniforms();ee.log(4,`Writing to uniform buffer ${String(e)}`,l,u)()}return s}}function r2(n){const e=ArrayBuffer.isView(n)?n.constructor:n;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function a2(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function gC(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const i=e;let s=r2(n);if(s==="uint8"&&t&&i===1)return"unorm8-webgl";if(s==="uint8"&&t&&i===3)return"unorm8x3-webgl";if(s==="uint8"||s==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${i}`}if(s==="uint16"||s==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${i}`}return i===1?s:`${s}x${i}`}class ld{constructor(e){T(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){var t;return e.attributes?(t=e.attributes)==null?void 0:t.map(i=>i.attribute):[e.name]}mergeBufferLayouts(e,t){const i=[...e];for(const s of t){const a=i.findIndex(l=>l.name===s.name);a<0?i.push(s):i[a]=s}return i}getBufferIndex(e){const t=this.bufferLayouts.findIndex(i=>i.name===e);return t===-1&&ee.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function pC(n,e){const t=Object.fromEntries(n.attributes.map(s=>[s.name,s.location])),i=e.slice();return i.sort((s,a)=>{const l=s.attributes?s.attributes.map(p=>p.attribute):[s.name],u=a.attributes?a.attributes.map(p=>p.attribute):[a.name],h=Math.min(...l.map(p=>t[p])),d=Math.min(...u.map(p=>t[p]));return h-d}),i}class mn{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}getTypeName(){return this.name}}class d0{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Xi extends mn{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Zi extends mn{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}}class Is extends mn{constructor(e,t,i,s){super(e,i),this.format=t,this.access=s}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var ji;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(ji||(ji={}));class nc{constructor(e,t,i,s,a,l,u){this.name=e,this.type=t,this.group=i,this.binding=s,this.attributes=a,this.resourceType=l,this.access=u}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class mC{constructor(e,t){this.name=e,this.type=t}}class _C{constructor(e,t,i,s){this.name=e,this.type=t,this.locationType=i,this.location=s,this.interpolation=null}}class g0{constructor(e,t,i,s){this.name=e,this.type=t,this.locationType=i,this.location=s}}class yC{constructor(e,t,i,s){this.name=e,this.type=t,this.attributes=i,this.id=s}}class bC{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i}}class vC{constructor(e,t=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=i}}class TC{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const o2=new Float32Array(1),xC=new Int32Array(o2.buffer),Nt=new Uint16Array(1);function SC(n){o2[0]=n;const e=xC[0],t=e>>31&1;let i=e>>23&255,s=8388607&e;if(i===255)return Nt[0]=t<<15|31744|(s!==0?512:0),Nt[0];if(i===0){if(s===0)return Nt[0]=t<<15,Nt[0];s|=8388608;let a=113;for(;!(8388608&s);)s<<=1,a--;return i=127-a,s&=8388607,i>0?(s=(s>>126-i)+(s>>127-i&1),Nt[0]=t<<15|i<<10|s>>13,Nt[0]):(Nt[0]=t<<15,Nt[0])}return i=i-127+15,i>=31?(Nt[0]=t<<15|31744,Nt[0]):i<=0?i<-10?(Nt[0]=t<<15,Nt[0]):(s=(8388608|s)>>1-i,Nt[0]=t<<15|s>>13,Nt[0]):(s>>=13,Nt[0]=t<<15|i<<10|s,Nt[0])}const Wg=new Uint32Array(1),l2=new Float32Array(Wg.buffer,0,1);function p0(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return Wg[0]=e,l2[0]}function AC(n,e,t,i,s,a,l,u,h){const d=i*(l>>=s)*(a>>=s)+t*l+e*u;switch(h){case"r8unorm":return[Ue(n,d,"8unorm",1)[0]];case"r8snorm":return[Ue(n,d,"8snorm",1)[0]];case"r8uint":return[Ue(n,d,"8uint",1)[0]];case"r8sint":return[Ue(n,d,"8sint",1)[0]];case"rg8unorm":{const p=Ue(n,d,"8unorm",2);return[p[0],p[1]]}case"rg8snorm":{const p=Ue(n,d,"8snorm",2);return[p[0],p[1]]}case"rg8uint":{const p=Ue(n,d,"8uint",2);return[p[0],p[1]]}case"rg8sint":{const p=Ue(n,d,"8sint",2);return[p[0],p[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const p=Ue(n,d,"8unorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8snorm":{const p=Ue(n,d,"8snorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8uint":{const p=Ue(n,d,"8uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba8sint":{const p=Ue(n,d,"8sint",4);return[p[0],p[1],p[2],p[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const p=Ue(n,d,"8unorm",4);return[p[2],p[1],p[0],p[3]]}case"r16uint":return[Ue(n,d,"16uint",1)[0]];case"r16sint":return[Ue(n,d,"16sint",1)[0]];case"r16float":return[Ue(n,d,"16float",1)[0]];case"rg16uint":{const p=Ue(n,d,"16uint",2);return[p[0],p[1]]}case"rg16sint":{const p=Ue(n,d,"16sint",2);return[p[0],p[1]]}case"rg16float":{const p=Ue(n,d,"16float",2);return[p[0],p[1]]}case"rgba16uint":{const p=Ue(n,d,"16uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16sint":{const p=Ue(n,d,"16sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16float":{const p=Ue(n,d,"16float",4);return[p[0],p[1],p[2],p[3]]}case"r32uint":return[Ue(n,d,"32uint",1)[0]];case"r32sint":return[Ue(n,d,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Ue(n,d,"32float",1)[0]];case"rg32uint":{const p=Ue(n,d,"32uint",2);return[p[0],p[1]]}case"rg32sint":{const p=Ue(n,d,"32sint",2);return[p[0],p[1]]}case"rg32float":{const p=Ue(n,d,"32float",2);return[p[0],p[1]]}case"rgba32uint":{const p=Ue(n,d,"32uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32sint":{const p=Ue(n,d,"32sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32float":{const p=Ue(n,d,"32float",4);return[p[0],p[1],p[2],p[3]]}case"rg11b10ufloat":{const p=new Uint32Array(n.buffer,d,1)[0],_=(4192256&p)>>11,y=(4290772992&p)>>22;return[p0(2047&p),p0(_),function(v){const A=112+(v>>5&31)<<23|(31&v)<<18;return Wg[0]=A,l2[0]}(y),1]}}return null}function Ue(n,e,t,i){const s=[0,0,0,0];for(let d=0;d<i;++d)switch(t){case"8unorm":s[d]=n[e]/255,e++;break;case"8snorm":s[d]=n[e]/255*2-1,e++;break;case"8uint":s[d]=n[e],e++;break;case"8sint":s[d]=n[e]-127,e++;break;case"16uint":s[d]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":s[d]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":s[d]=(a=n[e]|n[e+1]<<8,l=void 0,u=void 0,h=void 0,l=(32768&a)>>15,h=1023&a,(u=(31744&a)>>10)==0?(l?-1:1)*Math.pow(2,-14)*(h/Math.pow(2,10)):u==31?h?NaN:1/0*(l?-1:1):(l?-1:1)*Math.pow(2,u-15)*(1+h/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":s[d]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":s[d]=new Float32Array(n.buffer,e,1)[0],e+=4}var a,l,u,h;return s}function Le(n,e,t,i,s){for(let a=0;a<i;++a)switch(t){case"8unorm":n[e]=255*s[a],e++;break;case"8snorm":n[e]=.5*(s[a]+1)*255,e++;break;case"8uint":n[e]=s[a],e++;break;case"8sint":n[e]=s[a]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=s[a],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=s[a],e+=2;break;case"16float":{const l=SC(s[a]);new Uint16Array(n.buffer,e,1)[0]=l,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=s[a],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=s[a],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=s[a],e+=4}return s}const cd={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class vn{constructor(){this.id=vn._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(kc.instance);for(const i of e)i instanceof Array?this.searchBlock(i,t):i.search(t);t(Uc.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}vn._id=0;class kc extends vn{}kc.instance=new kc;class Uc extends vn{}Uc.instance=new Uc;const c2=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Ge extends vn{constructor(){super()}}class xo extends Ge{constructor(e,t,i,s,a,l){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=i,this.body=s,this.startLine=a,this.endLine=l}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class wC extends Ge{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class u2 extends Ge{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class tg extends Ge{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class f2 extends Ge{constructor(e,t,i,s){super(),this.init=e,this.condition=t,this.increment=i,this.body=s}get astNodeType(){return"for"}search(e){var t,i,s;(t=this.init)===null||t===void 0||t.search(e),(i=this.condition)===null||i===void 0||i.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}class ui extends Ge{constructor(e,t,i,s,a){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=a}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class $g extends Ge{constructor(e,t,i){super(),this.attributes=null,this.name=e,this.type=t,this.value=i}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class go extends Ge{constructor(e,t,i,s,a){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=a}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class pc extends Ge{constructor(e,t,i,s,a){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=a}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var Pr,ao,F,P;(n=>{n.increment="++",n.decrement="--"})(Pr||(Pr={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(Pr||(Pr={}));class h2 extends Ge{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(ao||(ao={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(ao||(ao={}));class d2 extends Ge{constructor(e,t,i){super(),this.operator=e,this.variable=t,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Xg extends Ge{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return c2.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class g2 extends Ge{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class p2 extends Ge{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}}class m2 extends Ge{constructor(e,t,i,s){super(),this.condition=e,this.body=t,this.elseif=i,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class _2 extends Ge{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class EC extends Ge{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class RC extends Ge{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class y2 extends Ge{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class Yg extends Ge{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class CC extends Ge{constructor(){super()}get astNodeType(){return"discard"}}class b2 extends Ge{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class v2 extends Ge{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class Z extends Ge{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const s=Z._priority.get(t.name);Z._priority.get(e[i].name)<s&&(t=e[i])}return t.name==="x32"?Z.i32:t}getTypeName(){return this.name}}Z.x32=new Z("x32"),Z.f32=new Z("f32"),Z.i32=new Z("i32"),Z.u32=new Z("u32"),Z.f16=new Z("f16"),Z.bool=new Z("bool"),Z.void=new Z("void"),Z._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);let m0=class extends Z{constructor(e){super(e)}};class li extends Z{constructor(e,t,i,s){super(e),this.members=t,this.startLine=i,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class B extends Z{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}B.vec2f=new B("vec2",Z.f32,null),B.vec3f=new B("vec3",Z.f32,null),B.vec4f=new B("vec4",Z.f32,null),B.vec2i=new B("vec2",Z.i32,null),B.vec3i=new B("vec3",Z.i32,null),B.vec4i=new B("vec4",Z.i32,null),B.vec2u=new B("vec2",Z.u32,null),B.vec3u=new B("vec3",Z.u32,null),B.vec4u=new B("vec4",Z.u32,null),B.vec2h=new B("vec2",Z.f16,null),B.vec3h=new B("vec3",Z.f16,null),B.vec4h=new B("vec4",Z.f16,null),B.vec2b=new B("vec2",Z.bool,null),B.vec3b=new B("vec3",Z.bool,null),B.vec4b=new B("vec4",Z.bool,null),B.mat2x2f=new B("mat2x2",Z.f32,null),B.mat2x3f=new B("mat2x3",Z.f32,null),B.mat2x4f=new B("mat2x4",Z.f32,null),B.mat3x2f=new B("mat3x2",Z.f32,null),B.mat3x3f=new B("mat3x3",Z.f32,null),B.mat3x4f=new B("mat3x4",Z.f32,null),B.mat4x2f=new B("mat4x2",Z.f32,null),B.mat4x3f=new B("mat4x3",Z.f32,null),B.mat4x4f=new B("mat4x4",Z.f32,null),B.mat2x2h=new B("mat2x2",Z.f16,null),B.mat2x3h=new B("mat2x3",Z.f16,null),B.mat2x4h=new B("mat2x4",Z.f16,null),B.mat3x2h=new B("mat3x2",Z.f16,null),B.mat3x3h=new B("mat3x3",Z.f16,null),B.mat3x4h=new B("mat3x4",Z.f16,null),B.mat4x2h=new B("mat4x2",Z.f16,null),B.mat4x3h=new B("mat4x3",Z.f16,null),B.mat4x4h=new B("mat4x4",Z.f16,null),B.mat2x2i=new B("mat2x2",Z.i32,null),B.mat2x3i=new B("mat2x3",Z.i32,null),B.mat2x4i=new B("mat2x4",Z.i32,null),B.mat3x2i=new B("mat3x2",Z.i32,null),B.mat3x3i=new B("mat3x3",Z.i32,null),B.mat3x4i=new B("mat3x4",Z.i32,null),B.mat4x2i=new B("mat4x2",Z.i32,null),B.mat4x3i=new B("mat4x3",Z.i32,null),B.mat4x4i=new B("mat4x4",Z.i32,null),B.mat2x2u=new B("mat2x2",Z.u32,null),B.mat2x3u=new B("mat2x3",Z.u32,null),B.mat2x4u=new B("mat2x4",Z.u32,null),B.mat3x2u=new B("mat3x2",Z.u32,null),B.mat3x3u=new B("mat3x3",Z.u32,null),B.mat3x4u=new B("mat3x4",Z.u32,null),B.mat4x2u=new B("mat4x2",Z.u32,null),B.mat4x3u=new B("mat4x3",Z.u32,null),B.mat4x4u=new B("mat4x4",Z.u32,null);class ud extends Z{constructor(e,t,i,s){super(e),this.storage=t,this.type=i,this.access=s}get astNodeType(){return"pointer"}}class po extends Z{constructor(e,t,i,s){super(e),this.attributes=t,this.format=i,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class oo extends Z{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"sampler"}}class $n extends vn{constructor(){super(),this.postfix=null}}class Ns extends $n{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Bn extends $n{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class qg extends $n{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return c2.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class sn extends $n{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class T2 extends $n{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const i=e.evalExpression(this.initializer,e.context);return i!==null&&this.postfix?i.getSubData(e,this.postfix,e.context):i}return null}search(e){this.initializer.search(e)}}class pt extends $n{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof N}get isVector(){return this.value instanceof w||this.value instanceof ve}get scalarValue(){return this.value instanceof N?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof w||this.value instanceof ve?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class x2 extends $n{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class $r extends $n{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class S2 extends $n{constructor(){super()}}class ft extends S2{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class wn extends S2{constructor(e,t,i){super(),this.operator=e,this.left=t,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?Z.f32:e.name==="u32"||t.name==="u32"?Z.u32:Z.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class A2 extends vn{constructor(e){super(),this.body=e}}class mc extends $n{constructor(){super()}get astNodeType(){return"default"}}class w2 extends A2{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class E2 extends A2{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class _0 extends vn{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"argument"}}class MC extends vn{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class y0 extends vn{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"member"}}class R2 extends vn{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class bn{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=bn._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,i,s){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.name}>`}}bn._id=0;class ng extends bn{constructor(){super(new mn("void",null),null)}toString(){return"void"}}ng.void=new ng;class Cr extends bn{constructor(e){super(new mn("pointer",null),null),this.reference=e}clone(){return this}setDataValue(e,t,i,s){this.reference.setDataValue(e,t,i,s)}getSubData(e,t,i){return t?this.reference.getSubData(e,t,i):this}}class N extends bn{constructor(e,t,i=null){super(t,i),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new N(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new N(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new N(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,i,s){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(t instanceof N))return void console.error("SetDataValue: Invalid value",t);let a=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?a=Math.floor(a):this.typeInfo.name==="bool"&&(a=a?1:0),this.data[0]=a}getSubData(e,t,i){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function OC(n,e,t){const i=e.length;return i===2?t==="f32"?new w(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new w(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new w(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new w(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):i===3?t==="f32"?new w(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new w(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new w(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new w(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):i===4?t==="f32"?new w(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new w(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new w(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new w(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class w extends bn{constructor(e,t,i=null){if(super(t,i),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?this.data=new Float32Array(e):s==="vec2i"||s==="vec3i"||s==="vec4i"?this.data=new Int32Array(e):s==="vec2u"||s==="vec3u"||s==="vec4u"?this.data=new Uint32Array(e):s==="vec2h"||s==="vec3h"||s==="vec4h"?this.data=new Float32Array(e):s==="vec2b"||s==="vec3b"||s==="vec4b"?this.data=new Int32Array(e):s==="vec2"||s==="vec3"||s==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${s}`)}}clone(){if(this.data instanceof Float32Array)return new w(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new w(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new w(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,i,s){i instanceof Ns?console.error("TODO: Set vector postfix"):t instanceof w?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;let s=e.getTypeInfo("f32");if(this.typeInfo instanceof Is)s=this.typeInfo.format||s;else{const l=this.typeInfo.name;l==="vec2f"||l==="vec3f"||l==="vec4f"?s=e.getTypeInfo("f32"):l==="vec2i"||l==="vec3i"||l==="vec4i"?s=e.getTypeInfo("i32"):l==="vec2b"||l==="vec3b"||l==="vec4b"?s=e.getTypeInfo("bool"):l==="vec2u"||l==="vec3u"||l==="vec4u"?s=e.getTypeInfo("u32"):l==="vec2h"||l==="vec3h"||l==="vec4h"?s=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${l}`)}let a=this;for(;t!==null&&a!==null;){if(t instanceof $r){const l=t.index;let u=-1;if(l instanceof pt){if(!(l.value instanceof N))return console.error(`GetSubData: Invalid array index ${l.value}`),null;u=l.value.value}else{const h=e.evalExpression(l,i);if(!(h instanceof N))return console.error("GetSubData: Unknown index type",l),null;u=h.value}if(u<0||u>=a.data.length)return console.error("GetSubData: Index out of range",u),null;if(a.data instanceof Float32Array){const h=new Float32Array(a.data.buffer,a.data.byteOffset+4*u,1);return new N(h,s)}if(a.data instanceof Int32Array){const h=new Int32Array(a.data.buffer,a.data.byteOffset+4*u,1);return new N(h,s)}if(a.data instanceof Uint32Array){const h=new Uint32Array(a.data.buffer,a.data.byteOffset+4*u,1);return new N(h,s)}throw"GetSubData: Invalid data type"}if(!(t instanceof Ns))return console.error("GetSubData: Unknown postfix",t),null;{const l=t.value.toLowerCase();if(l.length===1){let h=0;if(l==="x"||l==="r")h=0;else if(l==="y"||l==="g")h=1;else if(l==="z"||l==="b")h=2;else{if(l!=="w"&&l!=="a")return console.error(`GetSubData: Unknown member ${l}`),null;h=3}if(this.data instanceof Float32Array){let d=new Float32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new N(d,s,this)}if(this.data instanceof Int32Array){let d=new Int32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new N(d,s,this)}if(this.data instanceof Uint32Array){let d=new Uint32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new N(d,s,this)}}const u=[];for(const h of l)h==="x"||h==="r"?u.push(this.data[0]):h==="y"||h==="g"?u.push(this.data[1]):h==="z"||h==="b"?u.push(this.data[2]):h==="w"||h==="a"?u.push(this.data[3]):console.error(`GetDataValue: Unknown member ${h}`);a=OC(e,u,s.name)}t=t.postfix}return a}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class ve extends bn{constructor(e,t,i=null){super(t,i),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new ve(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,i,s){i instanceof Ns?console.error("TODO: Set matrix postfix"):t instanceof ve?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;const s=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Is)this.typeInfo.format;else if(s.endsWith("f"))e.getTypeInfo("f32");else if(s.endsWith("i"))e.getTypeInfo("i32");else if(s.endsWith("u"))e.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;e.getTypeInfo("f16")}if(t instanceof $r){const a=t.index;let l=-1;if(a instanceof pt){if(!(a.value instanceof N))return console.error(`GetDataValue: Invalid array index ${a.value}`),null;l=a.value.value}else{const d=e.evalExpression(a,i);if(!(d instanceof N))return console.error("GetDataValue: Unknown index type",a),null;l=d.value}if(l<0||l>=this.data.length)return console.error("GetDataValue: Index out of range",l),null;const u=s.endsWith("h")?"h":"f";let h;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h"||s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")h=new w(new Float32Array(this.data.buffer,this.data.byteOffset+2*l*4,2),e.getTypeInfo(`vec2${u}`));else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h"||s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")h=new w(new Float32Array(this.data.buffer,this.data.byteOffset+3*l*4,3),e.getTypeInfo(`vec3${u}`));else{if(s!=="mat2x4"&&s!=="mat2x4f"&&s!=="mat2x4h"&&s!=="mat3x4"&&s!=="mat3x4f"&&s!=="mat3x4h"&&s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;h=new w(new Float32Array(this.data.buffer,this.data.byteOffset+4*l*4,4),e.getTypeInfo(`vec4${u}`))}return t.postfix?h.getSubData(e,t.postfix,i):h}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class rt extends bn{constructor(e,t,i=0,s=null){super(t,s),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=i}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new rt(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,i,s){if(t===null)return void console.log("setDataValue: NULL data.");let a=this.offset,l=this.typeInfo;for(;i;){if(i instanceof $r)if(l instanceof Zi){const u=i.index;if(u instanceof pt){if(!(u.value instanceof N))return void console.error(`SetDataValue: Invalid index type ${u.value}`);a+=u.value.value*l.stride}else{const h=e.evalExpression(u,s);if(!(h instanceof N))return void console.error("SetDataValue: Unknown index type",u);a+=h.value*l.stride}l=l.format}else console.error(`SetDataValue: Type ${l.getTypeName()} is not an array`);else{if(!(i instanceof Ns))return void console.error("SetDataValue: Unknown postfix type",i);{const u=i.value;if(l instanceof Xi){let h=!1;for(const d of l.members)if(d.name===u){a+=d.offset,l=d.type,h=!0;break}if(!h)return void console.error(`SetDataValue: Member ${u} not found`)}else if(l instanceof mn){const h=l.getTypeName();let d=0;if(u==="x"||u==="r")d=0;else if(u==="y"||u==="g")d=1;else if(u==="z"||u==="b")d=2;else{if(u!=="w"&&u!=="a")return void console.error(`SetDataValue: Unknown member ${u}`);d=3}if(!(t instanceof N))return void console.error("SetDataValue: Invalid value",t);const p=t.value;return h==="vec2f"?void(new Float32Array(this.buffer,a,2)[d]=p):h==="vec3f"?void(new Float32Array(this.buffer,a,3)[d]=p):h==="vec4f"?void(new Float32Array(this.buffer,a,4)[d]=p):h==="vec2i"?void(new Int32Array(this.buffer,a,2)[d]=p):h==="vec3i"?void(new Int32Array(this.buffer,a,3)[d]=p):h==="vec4i"?void(new Int32Array(this.buffer,a,4)[d]=p):h==="vec2u"?void(new Uint32Array(this.buffer,a,2)[d]=p):h==="vec3u"?void(new Uint32Array(this.buffer,a,3)[d]=p):h==="vec4u"?void(new Uint32Array(this.buffer,a,4)[d]=p):void console.error(`SetDataValue: Type ${h} is not a struct`)}}}i=i.postfix}this.setData(e,t,l,a,s)}setData(e,t,i,s,a){const l=i.getTypeName();if(l!=="f32"&&l!=="f16")if(l!=="i32"&&l!=="atomic<i32>"&&l!=="x32")if(l!=="u32"&&l!=="atomic<u32>")if(l!=="bool")if(l!=="vec2f"&&l!=="vec2h")if(l!=="vec3f"&&l!=="vec3h")if(l!=="vec4f"&&l!=="vec4h")if(l!=="vec2i")if(l!=="vec3i")if(l!=="vec4i")if(l!=="vec2u")if(l!=="vec3u")if(l!=="vec4u")if(l!=="vec2b")if(l!=="vec3b")if(l!=="vec4b")if(l!=="mat2x2f"&&l!=="mat2x2h")if(l!=="mat2x3f"&&l!=="mat2x3h")if(l!=="mat2x4f"&&l!=="mat2x4h")if(l!=="mat3x2f"&&l!=="mat3x2h")if(l!=="mat3x3f"&&l!=="mat3x3h")if(l!=="mat3x4f"&&l!=="mat3x4h")if(l!=="mat4x2f"&&l!=="mat4x2h")if(l!=="mat4x3f"&&l!=="mat4x3h")if(l!=="mat4x4f"&&l!=="mat4x4h")if(t instanceof rt){if(i===t.typeInfo)return void new Uint8Array(this.buffer,s,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",l,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${l}`);else{const u=new Float32Array(this.buffer,s,16);t instanceof ve?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8],u[9]=t.data[9],u[10]=t.data[10],u[11]=t.data[11],u[12]=t.data[12],u[13]=t.data[13],u[14]=t.data[14],u[15]=t.data[15]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8],u[9]=t[9],u[10]=t[10],u[11]=t[11],u[12]=t[12],u[13]=t[13],u[14]=t[14],u[15]=t[15])}else{const u=new Float32Array(this.buffer,s,12);t instanceof ve?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8],u[9]=t.data[9],u[10]=t.data[10],u[11]=t.data[11]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8],u[9]=t[9],u[10]=t[10],u[11]=t[11])}else{const u=new Float32Array(this.buffer,s,8);t instanceof ve?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7])}else{const u=new Float32Array(this.buffer,s,12);t instanceof ve?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8],u[9]=t.data[9],u[10]=t.data[10],u[11]=t.data[11]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8],u[9]=t[9],u[10]=t[10],u[11]=t[11])}else{const u=new Float32Array(this.buffer,s,9);t instanceof ve?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8])}else{const u=new Float32Array(this.buffer,s,6);t instanceof ve?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5])}else{const u=new Float32Array(this.buffer,s,8);t instanceof ve?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7])}else{const u=new Float32Array(this.buffer,s,6);t instanceof ve?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5])}else{const u=new Float32Array(this.buffer,s,4);t instanceof ve?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3])}else{const u=new Uint32Array(this.buffer,s,4);t instanceof w?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3])}else{const u=new Uint32Array(this.buffer,s,3);t instanceof w?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2])}else{const u=new Uint32Array(this.buffer,s,2);t instanceof w?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1])}else{const u=new Uint32Array(this.buffer,s,4);t instanceof w?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3])}else{const u=new Uint32Array(this.buffer,s,3);t instanceof w?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2])}else{const u=new Uint32Array(this.buffer,s,2);t instanceof w?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1])}else{const u=new Int32Array(this.buffer,s,4);t instanceof w?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3])}else{const u=new Int32Array(this.buffer,s,3);t instanceof w?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2])}else{const u=new Int32Array(this.buffer,s,2);t instanceof w?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1])}else{const u=new Float32Array(this.buffer,s,4);t instanceof w?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3])}else{const u=new Float32Array(this.buffer,s,3);t instanceof w?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2])}else{const u=new Float32Array(this.buffer,s,2);t instanceof w?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1])}else t instanceof N&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof N&&(new Uint32Array(this.buffer,s,1)[0]=t.value);else t instanceof N&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof N&&(new Float32Array(this.buffer,s,1)[0]=t.value)}getSubData(e,t,i){var s,a,l;if(t===null)return this;let u=this.offset,h=this.typeInfo;for(;t;){if(t instanceof $r){const p=t.index,_=e.evalExpression(p,i);let y=0;if(_ instanceof N?y=_.value:console.error("GetDataValue: Invalid index type",p),h instanceof Zi)u+=y*h.stride,h=h.format;else{const v=h.getTypeName();v==="mat4x4"||v==="mat4x4f"||v==="mat4x4h"?(u+=16*y,h=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${h.getTypeName()} is not an array`)}}else{if(!(t instanceof Ns))return console.error("GetDataValue: Unknown postfix type",t),null;{const p=t.value;if(h instanceof Xi){let _=!1;for(const y of h.members)if(y.name===p){u+=y.offset,h=y.type,_=!0;break}if(!_)return console.error(`GetDataValue: Member ${p} not found`),null}else if(h instanceof mn){const _=h.getTypeName();if(_==="vec2f"||_==="vec3f"||_==="vec4f"||_==="vec2i"||_==="vec3i"||_==="vec4i"||_==="vec2u"||_==="vec3u"||_==="vec4u"||_==="vec2b"||_==="vec3b"||_==="vec4b"||_==="vec2h"||_==="vec3h"||_==="vec4h"||_==="vec2"||_==="vec3"||_==="vec4"){if(p.length>0&&p.length<5){let y="f";const v=[];for(let A=0;A<p.length;++A){const R=p[A].toLowerCase();let C=0;if(R==="x"||R==="r")C=0;else if(R==="y"||R==="g")C=1;else if(R==="z"||R==="b")C=2;else{if(R!=="w"&&R!=="a")return console.error(`Unknown member ${p}`),null;C=3}if(p.length===1){if(_.endsWith("f"))return this.buffer.byteLength<u+4*C+4?(console.log("Insufficient buffer data"),null):new N(new Float32Array(this.buffer,u+4*C,1),e.getTypeInfo("f32"),this);if(_.endsWith("h"))return new N(new Float32Array(this.buffer,u+4*C,1),e.getTypeInfo("f16"),this);if(_.endsWith("i"))return new N(new Int32Array(this.buffer,u+4*C,1),e.getTypeInfo("i32"),this);if(_.endsWith("b"))return new N(new Int32Array(this.buffer,u+4*C,1),e.getTypeInfo("bool"),this);if(_.endsWith("u"))return new N(new Uint32Array(this.buffer,u+4*C,1),e.getTypeInfo("i32"),this)}if(_==="vec2f")v.push(new Float32Array(this.buffer,u,2)[C]);else if(_==="vec3f"){if(u+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const z=new Float32Array(this.buffer,u,3);v.push(z[C])}else if(_==="vec4f")v.push(new Float32Array(this.buffer,u,4)[C]);else if(_==="vec2i")y="i",v.push(new Int32Array(this.buffer,u,2)[C]);else if(_==="vec3i")y="i",v.push(new Int32Array(this.buffer,u,3)[C]);else if(_==="vec4i")y="i",v.push(new Int32Array(this.buffer,u,4)[C]);else if(_==="vec2u"){y="u";const z=new Uint32Array(this.buffer,u,2);v.push(z[C])}else _==="vec3u"?(y="u",v.push(new Uint32Array(this.buffer,u,3)[C])):_==="vec4u"&&(y="u",v.push(new Uint32Array(this.buffer,u,4)[C]))}return v.length===2?h=e.getTypeInfo(`vec2${y}`):v.length===3?h=e.getTypeInfo(`vec3${y}`):v.length===4?h=e.getTypeInfo(`vec4${y}`):console.error(`GetDataValue: Invalid vector length ${v.length}`),new w(v,h,null)}return console.error(`GetDataValue: Unknown member ${p}`),null}return console.error(`GetDataValue: Type ${_} is not a struct`),null}}}t=t.postfix}const d=h.getTypeName();return d==="f32"?new N(new Float32Array(this.buffer,u,1),h,this):d==="i32"?new N(new Int32Array(this.buffer,u,1),h,this):d==="u32"?new N(new Uint32Array(this.buffer,u,1),h,this):d==="vec2f"?new w(new Float32Array(this.buffer,u,2),h,this):d==="vec3f"?new w(new Float32Array(this.buffer,u,3),h,this):d==="vec4f"?new w(new Float32Array(this.buffer,u,4),h,this):d==="vec2i"?new w(new Int32Array(this.buffer,u,2),h,this):d==="vec3i"?new w(new Int32Array(this.buffer,u,3),h,this):d==="vec4i"?new w(new Int32Array(this.buffer,u,4),h,this):d==="vec2u"?new w(new Uint32Array(this.buffer,u,2),h,this):d==="vec3u"?new w(new Uint32Array(this.buffer,u,3),h,this):d==="vec4u"?new w(new Uint32Array(this.buffer,u,4),h,this):h instanceof Is&&h.name==="atomic"?((s=h.format)===null||s===void 0?void 0:s.name)==="u32"?new N(new Uint32Array(this.buffer,u,1)[0],h.format,this):((a=h.format)===null||a===void 0?void 0:a.name)==="i32"?new N(new Int32Array(this.buffer,u,1)[0],h.format,this):(console.error(`GetDataValue: Invalid atomic format ${(l=h.format)===null||l===void 0?void 0:l.name}`),null):new rt(this.buffer,h,u,this)}toString(){let e="";if(this.typeInfo instanceof Zi)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let i=1;i<t.length/2;++i)e+=`, [${t[2*i]}, ${t[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}, ${t[i+3]}]`}else e="[...]";else this.typeInfo instanceof Xi?e+="{...}":e="[...]";return e}}class ci extends bn{constructor(e,t,i,s){super(t,null),this.data=e,this.descriptor=i,this.view=s}clone(){return new ci(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>0?(e=i[0])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.width)!==null&&t!==void 0?t:0}get height(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>1?(e=i[1])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>2?(e=i[2])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<t.length;++i)t[i]=Math.max(1,t[i]>>e);return t}get texelByteSize(){const e=this.format,t=cd[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=cd[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=cd[e],i=this.width;if(!e||i<=0||!t)return-1;const s=this.height,a=this.depthOrArrayLayers,l=this.dimension;return i/t.blockWidth*(l==="1d"?1:s/t.blockHeight)*t.bytesPerBlock*a}getPixel(e,t,i=0,s=0){const a=this.texelByteSize,l=this.bytesPerRow,u=this.height,h=this.data[s];return AC(new Uint8Array(h),e,t,i,s,u,l,a,this.format)}setPixel(e,t,i,s,a){const l=this.texelByteSize,u=this.bytesPerRow,h=this.height,d=this.data[s];(function(p,_,y,v,A,R,C,z,H,M){const k=v*(C>>=A)*(R>>=A)+y*C+_*z;switch(H){case"r8unorm":return void Le(p,k,"8unorm",1,M);case"r8snorm":return void Le(p,k,"8snorm",1,M);case"r8uint":return void Le(p,k,"8uint",1,M);case"r8sint":return void Le(p,k,"8sint",1,M);case"rg8unorm":return void Le(p,k,"8unorm",2,M);case"rg8snorm":return void Le(p,k,"8snorm",2,M);case"rg8uint":return void Le(p,k,"8uint",2,M);case"rg8sint":return void Le(p,k,"8sint",2,M);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Le(p,k,"8unorm",4,M);case"rgba8snorm":return void Le(p,k,"8snorm",4,M);case"rgba8uint":return void Le(p,k,"8uint",4,M);case"rgba8sint":return void Le(p,k,"8sint",4,M);case"r16uint":return void Le(p,k,"16uint",1,M);case"r16sint":return void Le(p,k,"16sint",1,M);case"r16float":return void Le(p,k,"16float",1,M);case"rg16uint":return void Le(p,k,"16uint",2,M);case"rg16sint":return void Le(p,k,"16sint",2,M);case"rg16float":return void Le(p,k,"16float",2,M);case"rgba16uint":return void Le(p,k,"16uint",4,M);case"rgba16sint":return void Le(p,k,"16sint",4,M);case"rgba16float":return void Le(p,k,"16float",4,M);case"r32uint":return void Le(p,k,"32uint",1,M);case"r32sint":return void Le(p,k,"32sint",1,M);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Le(p,k,"32float",1,M);case"rg32uint":return void Le(p,k,"32uint",2,M);case"rg32sint":return void Le(p,k,"32sint",2,M);case"rg32float":return void Le(p,k,"32float",2,M);case"rgba32uint":return void Le(p,k,"32uint",4,M);case"rgba32sint":return void Le(p,k,"32sint",4,M);case"rgba32float":return void Le(p,k,"32float",4,M);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(d),e,t,i,s,h,u,l,this.format,a)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(P||(P={}));class D{constructor(e,t,i){this.name=e,this.type=t,this.rule=i}toString(){return this.name}}class S{}F=S,S.none=new D("",P.reserved,""),S.eof=new D("EOF",P.token,""),S.reserved={asm:new D("asm",P.reserved,"asm"),bf16:new D("bf16",P.reserved,"bf16"),do:new D("do",P.reserved,"do"),enum:new D("enum",P.reserved,"enum"),f16:new D("f16",P.reserved,"f16"),f64:new D("f64",P.reserved,"f64"),handle:new D("handle",P.reserved,"handle"),i8:new D("i8",P.reserved,"i8"),i16:new D("i16",P.reserved,"i16"),i64:new D("i64",P.reserved,"i64"),mat:new D("mat",P.reserved,"mat"),premerge:new D("premerge",P.reserved,"premerge"),regardless:new D("regardless",P.reserved,"regardless"),typedef:new D("typedef",P.reserved,"typedef"),u8:new D("u8",P.reserved,"u8"),u16:new D("u16",P.reserved,"u16"),u64:new D("u64",P.reserved,"u64"),unless:new D("unless",P.reserved,"unless"),using:new D("using",P.reserved,"using"),vec:new D("vec",P.reserved,"vec"),void:new D("void",P.reserved,"void")},S.keywords={array:new D("array",P.keyword,"array"),atomic:new D("atomic",P.keyword,"atomic"),bool:new D("bool",P.keyword,"bool"),f32:new D("f32",P.keyword,"f32"),i32:new D("i32",P.keyword,"i32"),mat2x2:new D("mat2x2",P.keyword,"mat2x2"),mat2x3:new D("mat2x3",P.keyword,"mat2x3"),mat2x4:new D("mat2x4",P.keyword,"mat2x4"),mat3x2:new D("mat3x2",P.keyword,"mat3x2"),mat3x3:new D("mat3x3",P.keyword,"mat3x3"),mat3x4:new D("mat3x4",P.keyword,"mat3x4"),mat4x2:new D("mat4x2",P.keyword,"mat4x2"),mat4x3:new D("mat4x3",P.keyword,"mat4x3"),mat4x4:new D("mat4x4",P.keyword,"mat4x4"),ptr:new D("ptr",P.keyword,"ptr"),sampler:new D("sampler",P.keyword,"sampler"),sampler_comparison:new D("sampler_comparison",P.keyword,"sampler_comparison"),struct:new D("struct",P.keyword,"struct"),texture_1d:new D("texture_1d",P.keyword,"texture_1d"),texture_2d:new D("texture_2d",P.keyword,"texture_2d"),texture_2d_array:new D("texture_2d_array",P.keyword,"texture_2d_array"),texture_3d:new D("texture_3d",P.keyword,"texture_3d"),texture_cube:new D("texture_cube",P.keyword,"texture_cube"),texture_cube_array:new D("texture_cube_array",P.keyword,"texture_cube_array"),texture_multisampled_2d:new D("texture_multisampled_2d",P.keyword,"texture_multisampled_2d"),texture_storage_1d:new D("texture_storage_1d",P.keyword,"texture_storage_1d"),texture_storage_2d:new D("texture_storage_2d",P.keyword,"texture_storage_2d"),texture_storage_2d_array:new D("texture_storage_2d_array",P.keyword,"texture_storage_2d_array"),texture_storage_3d:new D("texture_storage_3d",P.keyword,"texture_storage_3d"),texture_depth_2d:new D("texture_depth_2d",P.keyword,"texture_depth_2d"),texture_depth_2d_array:new D("texture_depth_2d_array",P.keyword,"texture_depth_2d_array"),texture_depth_cube:new D("texture_depth_cube",P.keyword,"texture_depth_cube"),texture_depth_cube_array:new D("texture_depth_cube_array",P.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new D("texture_depth_multisampled_2d",P.keyword,"texture_depth_multisampled_2d"),texture_external:new D("texture_external",P.keyword,"texture_external"),u32:new D("u32",P.keyword,"u32"),vec2:new D("vec2",P.keyword,"vec2"),vec3:new D("vec3",P.keyword,"vec3"),vec4:new D("vec4",P.keyword,"vec4"),bitcast:new D("bitcast",P.keyword,"bitcast"),block:new D("block",P.keyword,"block"),break:new D("break",P.keyword,"break"),case:new D("case",P.keyword,"case"),continue:new D("continue",P.keyword,"continue"),continuing:new D("continuing",P.keyword,"continuing"),default:new D("default",P.keyword,"default"),diagnostic:new D("diagnostic",P.keyword,"diagnostic"),discard:new D("discard",P.keyword,"discard"),else:new D("else",P.keyword,"else"),enable:new D("enable",P.keyword,"enable"),fallthrough:new D("fallthrough",P.keyword,"fallthrough"),false:new D("false",P.keyword,"false"),fn:new D("fn",P.keyword,"fn"),for:new D("for",P.keyword,"for"),function:new D("function",P.keyword,"function"),if:new D("if",P.keyword,"if"),let:new D("let",P.keyword,"let"),const:new D("const",P.keyword,"const"),loop:new D("loop",P.keyword,"loop"),while:new D("while",P.keyword,"while"),private:new D("private",P.keyword,"private"),read:new D("read",P.keyword,"read"),read_write:new D("read_write",P.keyword,"read_write"),return:new D("return",P.keyword,"return"),requires:new D("requires",P.keyword,"requires"),storage:new D("storage",P.keyword,"storage"),switch:new D("switch",P.keyword,"switch"),true:new D("true",P.keyword,"true"),alias:new D("alias",P.keyword,"alias"),type:new D("type",P.keyword,"type"),uniform:new D("uniform",P.keyword,"uniform"),var:new D("var",P.keyword,"var"),override:new D("override",P.keyword,"override"),workgroup:new D("workgroup",P.keyword,"workgroup"),write:new D("write",P.keyword,"write"),r8unorm:new D("r8unorm",P.keyword,"r8unorm"),r8snorm:new D("r8snorm",P.keyword,"r8snorm"),r8uint:new D("r8uint",P.keyword,"r8uint"),r8sint:new D("r8sint",P.keyword,"r8sint"),r16uint:new D("r16uint",P.keyword,"r16uint"),r16sint:new D("r16sint",P.keyword,"r16sint"),r16float:new D("r16float",P.keyword,"r16float"),rg8unorm:new D("rg8unorm",P.keyword,"rg8unorm"),rg8snorm:new D("rg8snorm",P.keyword,"rg8snorm"),rg8uint:new D("rg8uint",P.keyword,"rg8uint"),rg8sint:new D("rg8sint",P.keyword,"rg8sint"),r32uint:new D("r32uint",P.keyword,"r32uint"),r32sint:new D("r32sint",P.keyword,"r32sint"),r32float:new D("r32float",P.keyword,"r32float"),rg16uint:new D("rg16uint",P.keyword,"rg16uint"),rg16sint:new D("rg16sint",P.keyword,"rg16sint"),rg16float:new D("rg16float",P.keyword,"rg16float"),rgba8unorm:new D("rgba8unorm",P.keyword,"rgba8unorm"),rgba8unorm_srgb:new D("rgba8unorm_srgb",P.keyword,"rgba8unorm_srgb"),rgba8snorm:new D("rgba8snorm",P.keyword,"rgba8snorm"),rgba8uint:new D("rgba8uint",P.keyword,"rgba8uint"),rgba8sint:new D("rgba8sint",P.keyword,"rgba8sint"),bgra8unorm:new D("bgra8unorm",P.keyword,"bgra8unorm"),bgra8unorm_srgb:new D("bgra8unorm_srgb",P.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new D("rgb10a2unorm",P.keyword,"rgb10a2unorm"),rg11b10float:new D("rg11b10float",P.keyword,"rg11b10float"),rg32uint:new D("rg32uint",P.keyword,"rg32uint"),rg32sint:new D("rg32sint",P.keyword,"rg32sint"),rg32float:new D("rg32float",P.keyword,"rg32float"),rgba16uint:new D("rgba16uint",P.keyword,"rgba16uint"),rgba16sint:new D("rgba16sint",P.keyword,"rgba16sint"),rgba16float:new D("rgba16float",P.keyword,"rgba16float"),rgba32uint:new D("rgba32uint",P.keyword,"rgba32uint"),rgba32sint:new D("rgba32sint",P.keyword,"rgba32sint"),rgba32float:new D("rgba32float",P.keyword,"rgba32float"),static_assert:new D("static_assert",P.keyword,"static_assert")},S.tokens={decimal_float_literal:new D("decimal_float_literal",P.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new D("hex_float_literal",P.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new D("int_literal",P.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new D("uint_literal",P.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new D("name",P.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new D("ident",P.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new D("and",P.token,"&"),and_and:new D("and_and",P.token,"&&"),arrow:new D("arrow ",P.token,"->"),attr:new D("attr",P.token,"@"),forward_slash:new D("forward_slash",P.token,"/"),bang:new D("bang",P.token,"!"),bracket_left:new D("bracket_left",P.token,"["),bracket_right:new D("bracket_right",P.token,"]"),brace_left:new D("brace_left",P.token,"{"),brace_right:new D("brace_right",P.token,"}"),colon:new D("colon",P.token,":"),comma:new D("comma",P.token,","),equal:new D("equal",P.token,"="),equal_equal:new D("equal_equal",P.token,"=="),not_equal:new D("not_equal",P.token,"!="),greater_than:new D("greater_than",P.token,">"),greater_than_equal:new D("greater_than_equal",P.token,">="),shift_right:new D("shift_right",P.token,">>"),less_than:new D("less_than",P.token,"<"),less_than_equal:new D("less_than_equal",P.token,"<="),shift_left:new D("shift_left",P.token,"<<"),modulo:new D("modulo",P.token,"%"),minus:new D("minus",P.token,"-"),minus_minus:new D("minus_minus",P.token,"--"),period:new D("period",P.token,"."),plus:new D("plus",P.token,"+"),plus_plus:new D("plus_plus",P.token,"++"),or:new D("or",P.token,"|"),or_or:new D("or_or",P.token,"||"),paren_left:new D("paren_left",P.token,"("),paren_right:new D("paren_right",P.token,")"),semicolon:new D("semicolon",P.token,";"),star:new D("star",P.token,"*"),tilde:new D("tilde",P.token,"~"),underscore:new D("underscore",P.token,"_"),xor:new D("xor",P.token,"^"),plus_equal:new D("plus_equal",P.token,"+="),minus_equal:new D("minus_equal",P.token,"-="),times_equal:new D("times_equal",P.token,"*="),division_equal:new D("division_equal",P.token,"/="),modulo_equal:new D("modulo_equal",P.token,"%="),and_equal:new D("and_equal",P.token,"&="),or_equal:new D("or_equal",P.token,"|="),xor_equal:new D("xor_equal",P.token,"^="),shift_right_equal:new D("shift_right_equal",P.token,">>="),shift_left_equal:new D("shift_left_equal",P.token,"<<=")},S.simpleTokens={"@":F.tokens.attr,"{":F.tokens.brace_left,"}":F.tokens.brace_right,":":F.tokens.colon,",":F.tokens.comma,"(":F.tokens.paren_left,")":F.tokens.paren_right,";":F.tokens.semicolon},S.literalTokens={"&":F.tokens.and,"&&":F.tokens.and_and,"->":F.tokens.arrow,"/":F.tokens.forward_slash,"!":F.tokens.bang,"[":F.tokens.bracket_left,"]":F.tokens.bracket_right,"=":F.tokens.equal,"==":F.tokens.equal_equal,"!=":F.tokens.not_equal,">":F.tokens.greater_than,">=":F.tokens.greater_than_equal,">>":F.tokens.shift_right,"<":F.tokens.less_than,"<=":F.tokens.less_than_equal,"<<":F.tokens.shift_left,"%":F.tokens.modulo,"-":F.tokens.minus,"--":F.tokens.minus_minus,".":F.tokens.period,"+":F.tokens.plus,"++":F.tokens.plus_plus,"|":F.tokens.or,"||":F.tokens.or_or,"*":F.tokens.star,"~":F.tokens.tilde,_:F.tokens.underscore,"^":F.tokens.xor,"+=":F.tokens.plus_equal,"-=":F.tokens.minus_equal,"*=":F.tokens.times_equal,"/=":F.tokens.division_equal,"%=":F.tokens.modulo_equal,"&=":F.tokens.and_equal,"|=":F.tokens.or_equal,"^=":F.tokens.xor_equal,">>=":F.tokens.shift_right_equal,"<<=":F.tokens.shift_left_equal},S.regexTokens={decimal_float_literal:F.tokens.decimal_float_literal,hex_float_literal:F.tokens.hex_float_literal,int_literal:F.tokens.int_literal,uint_literal:F.tokens.uint_literal,ident:F.tokens.ident},S.storage_class=[F.keywords.function,F.keywords.private,F.keywords.workgroup,F.keywords.uniform,F.keywords.storage],S.access_mode=[F.keywords.read,F.keywords.write,F.keywords.read_write],S.sampler_type=[F.keywords.sampler,F.keywords.sampler_comparison],S.sampled_texture_type=[F.keywords.texture_1d,F.keywords.texture_2d,F.keywords.texture_2d_array,F.keywords.texture_3d,F.keywords.texture_cube,F.keywords.texture_cube_array],S.multisampled_texture_type=[F.keywords.texture_multisampled_2d],S.storage_texture_type=[F.keywords.texture_storage_1d,F.keywords.texture_storage_2d,F.keywords.texture_storage_2d_array,F.keywords.texture_storage_3d],S.depth_texture_type=[F.keywords.texture_depth_2d,F.keywords.texture_depth_2d_array,F.keywords.texture_depth_cube,F.keywords.texture_depth_cube_array,F.keywords.texture_depth_multisampled_2d],S.texture_external_type=[F.keywords.texture_external],S.any_texture_type=[...F.sampled_texture_type,...F.multisampled_texture_type,...F.storage_texture_type,...F.depth_texture_type,...F.texture_external_type],S.texel_format=[F.keywords.r8unorm,F.keywords.r8snorm,F.keywords.r8uint,F.keywords.r8sint,F.keywords.r16uint,F.keywords.r16sint,F.keywords.r16float,F.keywords.rg8unorm,F.keywords.rg8snorm,F.keywords.rg8uint,F.keywords.rg8sint,F.keywords.r32uint,F.keywords.r32sint,F.keywords.r32float,F.keywords.rg16uint,F.keywords.rg16sint,F.keywords.rg16float,F.keywords.rgba8unorm,F.keywords.rgba8unorm_srgb,F.keywords.rgba8snorm,F.keywords.rgba8uint,F.keywords.rgba8sint,F.keywords.bgra8unorm,F.keywords.bgra8unorm_srgb,F.keywords.rgb10a2unorm,F.keywords.rg11b10float,F.keywords.rg32uint,F.keywords.rg32sint,F.keywords.rg32float,F.keywords.rgba16uint,F.keywords.rgba16sint,F.keywords.rgba16float,F.keywords.rgba32uint,F.keywords.rgba32sint,F.keywords.rgba32float],S.const_literal=[F.tokens.int_literal,F.tokens.uint_literal,F.tokens.decimal_float_literal,F.tokens.hex_float_literal,F.keywords.true,F.keywords.false],S.literal_or_ident=[F.tokens.ident,F.tokens.int_literal,F.tokens.uint_literal,F.tokens.decimal_float_literal,F.tokens.hex_float_literal,F.tokens.name],S.element_count_expression=[F.tokens.int_literal,F.tokens.uint_literal,F.tokens.ident],S.template_types=[F.keywords.vec2,F.keywords.vec3,F.keywords.vec4,F.keywords.mat2x2,F.keywords.mat2x3,F.keywords.mat2x4,F.keywords.mat3x2,F.keywords.mat3x3,F.keywords.mat3x4,F.keywords.mat4x2,F.keywords.mat4x3,F.keywords.mat4x4,F.keywords.atomic,F.keywords.bitcast,...F.any_texture_type],S.attribute_name=[F.tokens.ident,F.keywords.block,F.keywords.diagnostic],S.assignment_operators=[F.tokens.equal,F.tokens.plus_equal,F.tokens.minus_equal,F.tokens.times_equal,F.tokens.division_equal,F.tokens.modulo_equal,F.tokens.and_equal,F.tokens.or_equal,F.tokens.xor_equal,F.tokens.shift_right_equal,F.tokens.shift_left_equal],S.increment_operators=[F.tokens.plus_plus,F.tokens.minus_minus];class b0{constructor(e,t,i,s,a){this.type=e,this.lexeme=t,this.line=i,this.start=s,this.end=a}toString(){return this.lexeme}isTemplateType(){return S.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==S.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class IC{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new b0(S.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let l=1;for(;l>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),l--,l==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),l++)}return!0}}const t=S.simpleTokens[e];if(t)return this._addToken(t),!0;let i=S.none;const s=this._isAlpha(e),a=e==="_";if(this._isAlphaNumeric(e)){let l=this._peekAhead();for(;this._isAlphaNumeric(l);)e+=this._advance(),l=this._peekAhead()}if(s){const l=S.keywords[e];if(l)return this._addToken(l),!0}if(s||a)return this._addToken(S.tokens.ident),!0;for(;;){let l=this._findType(e);const u=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(u=="=")return this._current++,e+=u,this._addToken(S.tokens.minus_equal),!0;if(u=="-")return this._current++,e+=u,this._addToken(S.tokens.minus_minus),!0;const h=this._tokens.length-1;if((S.literal_or_ident.indexOf(this._tokens[h].type)!=-1||this._tokens[h].type==S.tokens.paren_right)&&u!=">")return this._addToken(l),!0}if(e==">"&&(u==">"||u=="=")){let h=!1,d=this._tokens.length-1;for(let p=0;p<5&&d>=0&&S.assignment_operators.indexOf(this._tokens[d].type)===-1;++p,--d)if(this._tokens[d].type===S.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(h=!0);break}if(h)return this._addToken(l),!0}if(l===S.none){let h=e,d=0;const p=2;for(let _=0;_<p;++_)if(h+=this._peekAhead(_),l=this._findType(h),l!==S.none){d=_;break}if(l===S.none)return i!==S.none&&(this._current--,this._addToken(i),!0);e=h,this._current+=d+1}if(i=l,this._isAtEnd())break;e+=this._advance()}return i!==S.none&&(this._addToken(i),!0)}_findType(e){for(const i in S.regexTokens){const s=S.regexTokens[i];if(this._match(e,s.rule))return s}return S.literalTokens[e]||S.none}_match(e,t){const i=t.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new b0(e,t,this._line,this._start,this._current))}}function se(n){return Array.isArray(n)||(n==null?void 0:n.buffer)instanceof ArrayBuffer}const Bc=new Float32Array(1),NC=new Uint32Array(Bc.buffer),PC=new Uint32Array(Bc.buffer),Lc=new Int32Array(1),DC=new Float32Array(Lc.buffer),kC=new Uint32Array(Lc.buffer),Fc=new Uint32Array(1),UC=new Float32Array(Fc.buffer),BC=new Int32Array(Fc.buffer);function v0(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return Bc[0]=n,NC[0];if(t==="u32")return Bc[0]=n,PC[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return Lc[0]=n,DC[0];if(t==="u32")return Lc[0]=n,kC[0]}else if(e==="u32"){if(t==="f32")return Fc[0]=n,UC[0];if(t==="i32"||t==="x32")return Fc[0]=n,BC[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class LC{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class ic{constructor(e,t){this.align=e,this.size=t}}class Vn{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new TC,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof xo&&this._functions.set(t.name,new LC(t));for(const t of e)if(t instanceof li){const i=this.getTypeInfo(t,null);i instanceof Xi&&this.structs.push(i)}for(const t of e)if(t instanceof Yg)this.aliases.push(this._getAliasInfo(t));else if(t instanceof $g){const i=t,s=this._getAttributeNum(i.attributes,"id",0),a=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new yC(i.name,a,i.attributes,s))}else if(this._isUniformVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),u=new nc(i.name,l,s,a,i.attributes,ji.Uniform,i.access);u.access||(u.access="read"),this.uniforms.push(u)}else if(this._isStorageVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),u=this._isStorageTexture(l),h=new nc(i.name,l,s,a,i.attributes,u?ji.StorageTexture:ji.Storage,i.access);h.access||(h.access="read"),this.storage.push(h)}else if(this._isTextureVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),u=this._isStorageTexture(l),h=new nc(i.name,l,s,a,i.attributes,u?ji.StorageTexture:ji.Texture,i.access);h.access||(h.access="read"),u?this.storage.push(h):this.textures.push(h)}else if(this._isSamplerVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),u=new nc(i.name,l,s,a,i.attributes,ji.Sampler,i.access);this.samplers.push(u)}else if(t instanceof xo){const i=this._getAttribute(t,"vertex"),s=this._getAttribute(t,"fragment"),a=this._getAttribute(t,"compute"),l=i||s||a,u=new vC(t.name,l==null?void 0:l.name,t.attributes);u.attributes=t.attributes,u.startLine=t.startLine,u.endLine=t.endLine,this.functions.push(u),this._functions.get(t.name).info=u,l&&(this._functions.get(t.name).inUse=!0,u.inUse=!0,u.resources=this._findResources(t,!!l),u.inputs=this._getInputs(t.args),u.outputs=this._getOutputs(t.returnType),this.entry[l.name].push(u)),u.arguments=t.args.map(h=>new bC(h.name,this.getTypeInfo(h.type,h.attributes),h.attributes)),u.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(i=>{var s,a,l;if(i instanceof R2){if(i.value)if(se(i.value))for(const u of i.value)for(const h of this.overrides)u===h.name&&((s=t.info)===null||s===void 0||s.overrides.push(h));else for(const u of this.overrides)i.value===u.name&&((a=t.info)===null||a===void 0||a.overrides.push(u))}else if(i instanceof sn)for(const u of this.overrides)i.name===u.name&&((l=t.info)===null||l===void 0||l.overrides.push(u))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var i;for(const s of e.calls){const a=(i=this._functions.get(s.name))===null||i===void 0?void 0:i.info;a&&t.add(a)}}findResource(e,t,i){if(i){for(const s of this.entry.compute)if(s.name===i){for(const a of s.resources)if(a.group==e&&a.binding==t)return a}for(const s of this.entry.vertex)if(s.name===i){for(const a of s.resources)if(a.group==e&&a.binding==t)return a}for(const s of this.entry.fragment)if(s.name===i){for(const a of s.resources)if(a.group==e&&a.binding==t)return a}}for(const s of this.uniforms)if(s.group==e&&s.binding==t)return s;for(const s of this.storage)if(s.group==e&&s.binding==t)return s;for(const s of this.textures)if(s.group==e&&s.binding==t)return s;for(const s of this.samplers)if(s.group==e&&s.binding==t)return s;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const i=[],s=this,a=[];return e.search(l=>{if(l instanceof kc)a.push({});else if(l instanceof Uc)a.pop();else if(l instanceof ui){const u=l;t&&u.type!==null&&this._markStructsFromAST(u.type),a.length>0&&(a[a.length-1][u.name]=u)}else if(l instanceof Bn){const u=l;t&&u.type!==null&&this._markStructsFromAST(u.type)}else if(l instanceof go){const u=l;t&&u.type!==null&&this._markStructsFromAST(u.type),a.length>0&&(a[a.length-1][u.name]=u)}else if(l instanceof sn){const u=l;if(a.length>0&&a[a.length-1][u.name])return;const h=s._findResource(u.name);h&&i.push(h)}else if(l instanceof qg){const u=l,h=s._functions.get(u.name);h&&(t&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=s._findResources(h.node,t)),i.push(...h.resources))}else if(l instanceof Xg){const u=l,h=s._functions.get(u.name);h&&(t&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=s._findResources(h.node,t)),i.push(...h.resources))}}),[...new Map(i.map(l=>[l.name,l])).values()]}getBindGroups(){const e=[];function t(i,s){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),s>=e[i].length&&(e[i].length=s+1)}for(const i of this.uniforms)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.storage)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.textures)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.samplers)t(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof li)this._getStructOutputs(e,t);else{const i=this._getOutputInfo(e);i!==null&&t.push(i)}return t}_getStructOutputs(e,t){for(const i of e.members)if(i.type instanceof li)this._getStructOutputs(i.type,t);else{const s=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(s!==null){const a=this.getTypeInfo(i.type,i.type.attributes),l=this._parseInt(s.value),u=new g0(i.name,a,s.name,l);t.push(u)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this.getTypeInfo(e,e.attributes),s=this._parseInt(t.value);return new g0("",i,t.name,s)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const i of e)if(i.type instanceof li)this._getStructInputs(i.type,t);else{const s=this._getInputInfo(i);s!==null&&t.push(s)}return t}_getStructInputs(e,t){for(const i of e.members)if(i.type instanceof li)this._getStructInputs(i.type,t);else{const s=this._getInputInfo(i);s!==null&&t.push(s)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this._getAttribute(e,"interpolation"),s=this.getTypeInfo(e.type,e.attributes),a=this._parseInt(t.value),l=new _C(e.name,s,t.name,a);return i!==null&&(l.interpolation=this._parseString(i.value)),l}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new mC(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof po){const s=e,a=s.format?this.getTypeInfo(s.format,s.attributes):null,l=new Zi(s.name,t);return l.format=a,l.count=s.count,this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof li){const s=e,a=new Xi(s.name,t);a.startLine=s.startLine,a.endLine=s.endLine;for(const l of s.members){const u=this.getTypeInfo(l.type,l.attributes);a.members.push(new d0(l.name,u,l.attributes))}return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof oo){const s=e,a=s.format instanceof Z,l=s.format?a?this.getTypeInfo(s.format,null):new mn(s.format,null):null,u=new Is(s.name,l,t,s.access);return this._types.set(e,u),this._updateTypeInfo(u),u}if(e instanceof B){const s=e,a=s.format?this.getTypeInfo(s.format,null):null,l=new Is(s.name,a,t,s.access);return this._types.set(e,l),this._updateTypeInfo(l),l}const i=new mn(e.name,t);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var t,i,s;const a=this._getTypeSize(e);if(e.size=(t=a==null?void 0:a.size)!==null&&t!==void 0?t:0,e instanceof Zi&&e.format){const l=this._getTypeSize(e.format);e.stride=Math.max((i=l==null?void 0:l.size)!==null&&i!==void 0?i:0,(s=l==null?void 0:l.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(e.format)}e instanceof Xi&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let i=0,s=0,a=0,l=0;for(let u=0,h=e.members.length;u<h;++u){const d=e.members[u],p=this._getTypeSize(d);if(!p)continue;(t=this._getAlias(d.type.name))!==null&&t!==void 0||d.type;const _=p.align,y=p.size;i=this._roundUp(_,i+s),s=y,a=i,l=Math.max(l,_),d.offset=i,d.size=y,this._updateTypeInfo(d.type)}e.size=this._roundUp(l,a+s),e.align=l}_getTypeSize(e){var t,i;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),a=this._getAttributeNum(e.attributes,"align",0);if(e instanceof d0&&(e=e.type),e instanceof mn){const l=this._getAlias(e.name);l!==null&&(e=l)}{const l=Vn._typeInfo[e.name];if(l!==void 0){const u=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new ic(Math.max(a,l.align/u),Math.max(s,l.size/u))}}{const l=Vn._typeInfo[e.name.substring(0,e.name.length-1)];if(l){const u=e.name[e.name.length-1]==="h"?2:1;return new ic(Math.max(a,l.align/u),Math.max(s,l.size/u))}}if(e instanceof Zi){let l=e,u=8,h=8;const d=this._getTypeSize(l.format);return d!==null&&(h=d.size,u=d.align),h=l.count*this._getAttributeNum((i=e==null?void 0:e.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(u,h)),s&&(h=s),new ic(Math.max(a,u),Math.max(s,h))}if(e instanceof Xi){let l=0,u=0,h=0,d=0,p=0;for(const _ of e.members){const y=this._getTypeSize(_.type);y!==null&&(l=Math.max(y.align,l),h=this._roundUp(y.align,h+d),d=y.size,p=h)}return u=this._roundUp(l,p+d),new ic(Math.max(a,l),Math.max(s,u))}return null}_isUniformVar(e){return e instanceof ui&&e.storage=="uniform"}_isStorageVar(e){return e instanceof ui&&e.storage=="storage"}_isTextureVar(e){return e instanceof ui&&e.type!==null&&Vn._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof ui&&e.type!==null&&Vn._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const i=e;if(!i||!i.attributes)return null;const s=i.attributes;for(let a of s)if(a.name==t)return a;return null}_getAttributeNum(e,t,i){if(e===null)return i;for(let s of e)if(s.name==t){let a=s!==null&&s.value!==null?s.value:i;return a instanceof Array&&(a=a[0]),typeof a=="number"?a:typeof a=="string"?parseInt(a):i}return i}_roundUp(e,t){return Math.ceil(t/e)*e}}Vn._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Vn._textureTypes=S.any_texture_type.map(n=>n.name),Vn._samplerTypes=S.sampler_type.map(n=>n.name);class Kg{constructor(e,t,i){this.name=e,this.value=t,this.node=i}clone(){return new Kg(this.name,this.value,this.node)}}class Zg{constructor(e){this.name=e.name,this.node=e}clone(){return new Zg(this.node)}}class Qg{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,i){this.variables.set(e,new Kg(e,t,i??null))}setVariable(e,t,i){const s=this.getVariable(e);s!==null?s.value=t:this.createVariable(e,t,i)}getVariableValue(e){var t;const i=this.getVariable(e);return(t=i==null?void 0:i.value)!==null&&t!==void 0?t:null}clone(){return new Qg(this)}}class FC{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class VC{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const i=this.exec.evalExpression(e.args[0],t);let s=!0;if(i instanceof w)return i.data.forEach(a=>{a||(s=!1)}),new N(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w){const s=i.data.some(a=>a);return new N(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const i=this.exec.evalExpression(e.args[2],t);if(!(i instanceof N))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return i.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let i=e.args[0];i instanceof ft&&(i=i.right);const s=this.exec.evalExpression(i,t);if(s instanceof rt&&s.typeInfo.size===0){const a=s.typeInfo,l=s.buffer.byteLength/a.stride;return new N(l,this.getTypeInfo("u32"))}return new N(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.abs(a)),i.typeInfo);const s=i;return new N(Math.abs(s.value),s.typeInfo)}Acos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.acos(a)),i.typeInfo);const s=i;return new N(Math.acos(s.value),i.typeInfo)}Acosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.acosh(a)),i.typeInfo);const s=i;return new N(Math.acosh(s.value),i.typeInfo)}Asin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.asin(a)),i.typeInfo);const s=i;return new N(Math.asin(s.value),i.typeInfo)}Asinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.asinh(a)),i.typeInfo);const s=i;return new N(Math.asinh(s.value),i.typeInfo)}Atan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.atan(a)),i.typeInfo);const s=i;return new N(Math.atan(s.value),i.typeInfo)}Atanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.atanh(a)),i.typeInfo);const s=i;return new N(Math.atanh(s.value),i.typeInfo)}Atan2(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof w&&s instanceof w)return new w(i.data.map((u,h)=>Math.atan2(u,s.data[h])),i.typeInfo);const a=i,l=s;return new N(Math.atan2(a.value,l.value),i.typeInfo)}Ceil(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.ceil(a)),i.typeInfo);const s=i;return new N(Math.ceil(s.value),i.typeInfo)}_clamp(e,t,i){return Math.min(Math.max(e,t),i)}Clamp(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof w&&s instanceof w&&a instanceof w)return new w(i.data.map((d,p)=>this._clamp(d,s.data[p],a.data[p])),i.typeInfo);const l=i,u=s,h=a;return new N(this._clamp(l.value,u.value,h.value),i.typeInfo)}Cos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.cos(a)),i.typeInfo);const s=i;return new N(Math.cos(s.value),i.typeInfo)}Cosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.cosh(a)),i.typeInfo);const s=i;return new N(Math.cos(s.value),i.typeInfo)}CountLeadingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.clz32(a)),i.typeInfo);const s=i;return new N(Math.clz32(s.value),i.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>this._countOneBits(a)),i.typeInfo);const s=i;return new N(this._countOneBits(s.value),i.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>this._countTrailingZeros(a)),i.typeInfo);const s=i;return new N(this._countTrailingZeros(s.value),i.typeInfo)}Cross(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof w&&s instanceof w){if(i.data.length!==3||s.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const a=i.data,l=s.data;return new w([a[1]*l[2]-l[1]*a[2],a[2]*l[0]-l[2]*a[0],a[0]*l[1]-l[0]*a[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const i=this.exec.evalExpression(e.args[0],t),s=180/Math.PI;return i instanceof w?new w(i.data.map(a=>a*s),i.typeInfo):new N(i.value*s,this.getTypeInfo("f32"))}Determinant(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof ve){const s=i.data,a=i.typeInfo.getTypeName(),l=a.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(a==="mat2x2"||a==="mat2x2f"||a==="mat2x2h")return new N(s[0]*s[3]-s[1]*s[2],l);if(a==="mat2x3"||a==="mat2x3f"||a==="mat2x3h")return new N(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),l);if(a==="mat2x4"||a==="mat2x4f"||a==="mat2x4h")console.error(`TODO: Determinant for ${a}`);else if(a==="mat3x2"||a==="mat3x2f"||a==="mat3x2h")console.error(`TODO: Determinant for ${a}`);else{if(a==="mat3x3"||a==="mat3x3f"||a==="mat3x3h")return new N(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),l);a==="mat3x4"||a==="mat3x4f"||a==="mat3x4h"||a==="mat4x2"||a==="mat4x2f"||a==="mat4x2h"||a==="mat4x3"||a==="mat4x3f"||a==="mat4x3h"?console.error(`TODO: Determinant for ${a}`):a!=="mat4x4"&&a!=="mat4x4f"&&a!=="mat4x4h"||console.error(`TODO: Determinant for ${a}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof w&&s instanceof w){let u=0;for(let h=0;h<i.data.length;++h)u+=(i.data[h]-s.data[h])*(i.data[h]-s.data[h]);return new N(Math.sqrt(u),this.getTypeInfo("f32"))}const a=i,l=s;return new N(Math.abs(a.value-l.value),i.typeInfo)}_dot(e,t){let i=0;for(let s=0;s<e.length;++s)i+=t[s]*e[s];return i}Dot(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);return i instanceof w&&s instanceof w?new N(this._dot(i.data,s.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.exp(a)),i.typeInfo);const s=i;return new N(Math.exp(s.value),i.typeInfo)}Exp2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.pow(2,a)),i.typeInfo);const s=i;return new N(Math.pow(2,s.value),i.typeInfo)}ExtractBits(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(a.typeInfo.name!=="u32"&&a.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const l=s.value,u=a.value;if(i instanceof w)return new w(i.data.map(d=>d>>l&(1<<u)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const h=i.value;return new N(h>>l&(1<<u)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof w&&s instanceof w&&a instanceof w){const l=this._dot(s.data,a.data);return new w(l<0?Array.from(i.data):i.data.map(u=>-u),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>this._firstLeadingBit(a)),i.typeInfo);const s=i;return new N(this._firstLeadingBit(s.value),i.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>this._firstTrailingBit(a)),i.typeInfo);const s=i;return new N(this._firstTrailingBit(s.value),i.typeInfo)}Floor(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.floor(a)),i.typeInfo);const s=i;return new N(Math.floor(s.value),i.typeInfo)}Fma(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof w&&s instanceof w&&a instanceof w)return i.data.length!==s.data.length||i.data.length!==a.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new w(i.data.map((d,p)=>d*s.data[p]+a.data[p]),i.typeInfo);const l=i,u=s,h=a;return new N(l.value*u.value+h.value,l.typeInfo)}Fract(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>a-Math.floor(a)),i.typeInfo);const s=i;return new N(s.value-Math.floor(s.value),i.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t),l=this.exec.evalExpression(e.args[3],t);if(a.typeInfo.name!=="u32"&&a.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const u=a.value,h=(1<<l.value)-1<<u,d=~h;if(i instanceof w&&s instanceof w)return new w(i.data.map((y,v)=>y&d|s.data[v]<<u&h),i.typeInfo);const p=i.value,_=s.value;return new N(p&d|_<<u&h,i.typeInfo)}InverseSqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>1/Math.sqrt(a)),i.typeInfo);const s=i;return new N(1/Math.sqrt(s.value),i.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w){let a=0;return i.data.forEach(l=>{a+=l*l}),new N(Math.sqrt(a),this.getTypeInfo("f32"))}const s=i;return new N(Math.abs(s.value),i.typeInfo)}Log(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.log(a)),i.typeInfo);const s=i;return new N(Math.log(s.value),i.typeInfo)}Log2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.log2(a)),i.typeInfo);const s=i;return new N(Math.log2(s.value),i.typeInfo)}Max(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof w&&s instanceof w)return new w(i.data.map((u,h)=>Math.max(u,s.data[h])),i.typeInfo);const a=i,l=s;return new N(Math.max(a.value,l.value),i.typeInfo)}Min(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof w&&s instanceof w)return new w(i.data.map((u,h)=>Math.min(u,s.data[h])),i.typeInfo);const a=i,l=s;return new N(Math.min(a.value,l.value),i.typeInfo)}Mix(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof w&&s instanceof w&&a instanceof w)return new w(i.data.map((h,d)=>i.data[d]*(1-a.data[d])+s.data[d]*a.data[d]),i.typeInfo);const l=s,u=a;return new N(i.value*(1-u.value)+l.value*u.value,i.typeInfo)}Modf(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof w&&s instanceof w)return new w(i.data.map((l,u)=>l%s.data[u]),i.typeInfo);const a=s;return new N(i.value%a.value,i.typeInfo)}Normalize(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w){const s=this.Length(e,t).value;return new w(i.data.map(a=>a/s),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof w&&s instanceof w)return new w(i.data.map((u,h)=>Math.pow(u,s.data[h])),i.typeInfo);const a=i,l=s;return new N(Math.pow(a.value,l.value),i.typeInfo)}QuantizeToF16(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof w?new w(i.data.map(s=>s),i.typeInfo):new N(i.value,i.typeInfo)}Radians(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof w?new w(i.data.map(s=>s*Math.PI/180),i.typeInfo):new N(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof w&&s instanceof w){const a=this._dot(i.data,s.data);return new w(i.data.map((l,u)=>l-2*a*s.data[u]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof w&&s instanceof w&&a instanceof N){const l=this._dot(s.data,i.data);return new w(i.data.map((u,h)=>{const d=1-a.value*a.value*(1-l*l);if(d<0)return 0;const p=Math.sqrt(d);return a.value*u-(a.value*l+p)*s.data[h]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.round(a)),i.typeInfo);const s=i;return new N(Math.round(s.value),i.typeInfo)}Saturate(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.min(Math.max(a,0),1)),i.typeInfo);const s=i;return new N(Math.min(Math.max(s.value,0),1),i.typeInfo)}Sign(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.sign(a)),i.typeInfo);const s=i;return new N(Math.sign(s.value),i.typeInfo)}Sin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.sin(a)),i.typeInfo);const s=i;return new N(Math.sin(s.value),i.typeInfo)}Sinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.sinh(a)),i.typeInfo);const s=i;return new N(Math.sinh(s.value),i.typeInfo)}_smoothstep(e,t,i){const s=Math.min(Math.max((i-e)/(t-e),0),1);return s*s*(3-2*s)}SmoothStep(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(a instanceof w&&i instanceof w&&s instanceof w)return new w(a.data.map((d,p)=>this._smoothstep(i.data[p],s.data[p],d)),a.typeInfo);const l=i,u=s,h=a;return new N(this._smoothstep(l.value,u.value,h.value),a.typeInfo)}Sqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.sqrt(a)),i.typeInfo);const s=i;return new N(Math.sqrt(s.value),i.typeInfo)}Step(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(s instanceof w&&i instanceof w)return new w(s.data.map((l,u)=>l<i.data[u]?0:1),s.typeInfo);const a=i;return new N(s.value<a.value?0:1,a.typeInfo)}Tan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.tan(a)),i.typeInfo);const s=i;return new N(Math.tan(s.value),i.typeInfo)}Tanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.tanh(a)),i.typeInfo);const s=i;return new N(Math.tanh(s.value),i.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const i=this.exec.evalExpression(e.args[0],t);if(!(i instanceof ve))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const s=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){const a=i.data;return new ve([a[0],a[2],a[1],a[3]],s)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){const a=i.data;return new ve([a[0],a[3],a[6],a[1],a[4],a[7]],s)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){const a=i.data;return new ve([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13]],s)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){const a=i.data;return new ve([a[0],a[3],a[1],a[4],a[2],a[5]],s)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){const a=i.data;return new ve([a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]],s)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){const a=i.data;return new ve([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14]],s)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){const a=i.data;return new ve([a[0],a[4],a[1],a[5],a[2],a[6]],s)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){const a=i.data;return new ve([a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]],s)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){const a=i.data;return new ve([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]],s)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof w)return new w(i.data.map(a=>Math.trunc(a)),i.typeInfo);const s=i;return new N(Math.trunc(s.value),i.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const i=e.args[0],s=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(i instanceof sn){const a=i.name,l=t.getVariableValue(a);if(l instanceof ci){if(s<0||s>=l.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const u=l.getMipLevelSize(s),h=l.dimension;return h==="1d"?new N(u[0],this.getTypeInfo("u32")):h==="3d"?new w(u,this.getTypeInfo("vec3u")):h==="2d"?new w(u.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${h} not found. Line ${e.line}`),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const i=e.args[0],s=this.exec.evalExpression(e.args[1],t),a=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(s instanceof w)||s.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(i instanceof sn){const l=i.name,u=t.getVariableValue(l);if(u instanceof ci){const h=Math.floor(s.data[0]),d=Math.floor(s.data[1]);if(h<0||h>=u.width||d<0||d>=u.height)return console.error(`Texture ${l} out of bounds. Line ${e.line}`),null;const p=u.getPixel(h,d,0,a);return p===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new w(p,this.getTypeInfo("vec4f"))}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const i=e.args[0];if(i instanceof sn){const s=i.name,a=t.getVariableValue(s);return a instanceof ci?new N(a.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const i=e.args[0];if(i instanceof sn){const s=i.name,a=t.getVariableValue(s);return a instanceof ci?new N(a.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const i=e.args[0];if(i instanceof sn){const s=i.name,a=t.getVariableValue(s);return a instanceof ci?new N(a.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const i=e.args[0],s=this.exec.evalExpression(e.args[1],t),a=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,l=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(l.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(s instanceof w)||s.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(i instanceof sn){const u=i.name,h=t.getVariableValue(u);if(h instanceof ci){const d=h.getMipLevelSize(0),p=Math.floor(s.data[0]),_=Math.floor(s.data[1]);return p<0||p>=d[0]||_<0||_>=d[1]?(console.error(`Texture ${u} out of bounds. Line ${e.line}`),null):(h.setPixel(p,_,0,a,Array.from(l)),null)}return console.error(`Texture ${u} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let i=e.args[0];i instanceof ft&&(i=i.right);const s=this.exec.getVariableName(i,t);return t.getVariable(s).value.getSubData(this.exec,i.postfix,t)}AtomicStore(e,t){let i=e.args[0];i instanceof ft&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t);return h instanceof N&&u instanceof N&&(h.value=u.value),a.value instanceof rt&&a.value.setDataValue(this.exec,h,i.postfix,t),null}AtomicAdd(e,t){let i=e.args[0];i instanceof ft&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new N(h.value,h.typeInfo);return h instanceof N&&u instanceof N&&(h.value+=u.value),a.value instanceof rt&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicSub(e,t){let i=e.args[0];i instanceof ft&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new N(h.value,h.typeInfo);return h instanceof N&&u instanceof N&&(h.value-=u.value),a.value instanceof rt&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicMax(e,t){let i=e.args[0];i instanceof ft&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new N(h.value,h.typeInfo);return h instanceof N&&u instanceof N&&(h.value=Math.max(h.value,u.value)),a.value instanceof rt&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicMin(e,t){let i=e.args[0];i instanceof ft&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new N(h.value,h.typeInfo);return h instanceof N&&u instanceof N&&(h.value=Math.min(h.value,u.value)),a.value instanceof rt&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicAnd(e,t){let i=e.args[0];i instanceof ft&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new N(h.value,h.typeInfo);return h instanceof N&&u instanceof N&&(h.value=h.value&u.value),a.value instanceof rt&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicOr(e,t){let i=e.args[0];i instanceof ft&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new N(h.value,h.typeInfo);return h instanceof N&&u instanceof N&&(h.value=h.value|u.value),a.value instanceof rt&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicXor(e,t){let i=e.args[0];i instanceof ft&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new N(h.value,h.typeInfo);return h instanceof N&&u instanceof N&&(h.value=h.value^u.value),a.value instanceof rt&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicExchange(e,t){let i=e.args[0];i instanceof ft&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new N(h.value,h.typeInfo);return h instanceof N&&u instanceof N&&(h.value=u.value),a.value instanceof rt&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const fd={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Bt={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Pt extends FC{constructor(e,t){var i;super(),this.ast=e??[],this.reflection=new Vn,this.reflection.updateAST(this.ast),this.context=(i=t==null?void 0:t.clone())!==null&&i!==void 0?i:new Qg,this.builtins=new VC(this),this.typeInfo={bool:this.getTypeInfo(Z.bool),i32:this.getTypeInfo(Z.i32),u32:this.getTypeInfo(Z.u32),f32:this.getTypeInfo(Z.f32),f16:this.getTypeInfo(Z.f16),vec2f:this.getTypeInfo(B.vec2f),vec2u:this.getTypeInfo(B.vec2u),vec2i:this.getTypeInfo(B.vec2i),vec2h:this.getTypeInfo(B.vec2h),vec3f:this.getTypeInfo(B.vec3f),vec3u:this.getTypeInfo(B.vec3u),vec3i:this.getTypeInfo(B.vec3i),vec3h:this.getTypeInfo(B.vec3h),vec4f:this.getTypeInfo(B.vec4f),vec4u:this.getTypeInfo(B.vec4u),vec4i:this.getTypeInfo(B.vec4i),vec4h:this.getTypeInfo(B.vec4h),mat2x2f:this.getTypeInfo(B.mat2x2f),mat2x3f:this.getTypeInfo(B.mat2x3f),mat2x4f:this.getTypeInfo(B.mat2x4f),mat3x2f:this.getTypeInfo(B.mat3x2f),mat3x3f:this.getTypeInfo(B.mat3x3f),mat3x4f:this.getTypeInfo(B.mat3x4f),mat4x2f:this.getTypeInfo(B.mat4x2f),mat4x3f:this.getTypeInfo(B.mat4x3f),mat4x4f:this.getTypeInfo(B.mat4x4f)}}getVariableValue(e){var t,i;const s=(i=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&i!==void 0?i:null;if(s===null)return null;if(s instanceof N)return s.value;if(s instanceof w||s instanceof ve)return Array.from(s.data);if(s instanceof rt&&s.typeInfo instanceof Zi){if(s.typeInfo.format.name==="u32")return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="i32")return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="f32")return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return console.error(`Unsupported return variable type ${s.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,i,s){const a=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,a),this._execStatements(this.ast,a);const l=a.getFunction(e);if(!l)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const u=t[0],h=t[1],d=t[2],p=this.getTypeInfo("vec3u");a.setVariable("@num_workgroups",new w(t,p));for(const _ in i)for(const y in i[_]){const v=i[_][y];a.variables.forEach(A=>{var R;const C=A.node;if(C!=null&&C.attributes){let z=null,H=null;for(const M of C.attributes)M.name==="binding"?z=M.value:M.name==="group"&&(H=M.value);if(y==z&&_==H)if(v.texture!==void 0&&v.descriptor!==void 0){const M=new ci(v.texture,this.getTypeInfo(C.type),v.descriptor,(R=v.texture.view)!==null&&R!==void 0?R:null);A.value=M}else v.uniform!==void 0?A.value=new rt(v.uniform,this.getTypeInfo(C.type)):A.value=new rt(v,this.getTypeInfo(C.type))}})}for(let _=0;_<d;++_)for(let y=0;y<h;++y)for(let v=0;v<u;++v)a.setVariable("@workgroup_id",new w([v,y,_],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(l,[v,y,_],a)}execStatement(e,t){if(e instanceof _2)return this.evalExpression(e.value,t);if(e instanceof b2){if(e.condition){const i=this.evalExpression(e.condition,t);if(!(i instanceof N))throw new Error("Invalid break-if condition");if(!i.value)return null}return Pt._breakObj}if(e instanceof v2)return Pt._continueObj;if(e instanceof go)this._let(e,t);else if(e instanceof ui)this._var(e,t);else if(e instanceof pc)this._const(e,t);else if(e instanceof xo)this._function(e,t);else{if(e instanceof m2)return this._if(e,t);if(e instanceof p2)return this._switch(e,t);if(e instanceof f2)return this._for(e,t);if(e instanceof u2)return this._while(e,t);if(e instanceof g2)return this._loop(e,t);if(e instanceof tg){const i=t.clone();return i.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,i)}if(e instanceof d2)this._assign(e,t);else if(e instanceof h2)this._increment(e,t);else{if(e instanceof li)return null;if(e instanceof $g){const i=e.name;t.getVariable(i)===null&&t.setVariable(i,new N(0,this.getTypeInfo("u32")))}else if(e instanceof Xg)this._call(e,t);else{if(e instanceof y2||e instanceof Yg)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof wn?this._evalBinaryOp(e,t):e instanceof pt?this._evalLiteral(e,t):e instanceof sn?this._evalVariable(e,t):e instanceof qg?this._evalCall(e,t):e instanceof Bn?this._evalCreate(e,t):e instanceof T2?this._evalConst(e,t):e instanceof x2?this._evalBitcast(e,t):e instanceof ft?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof Z){const s=this.reflection.getTypeInfo(e);if(s!==null)return s}let i=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return i!==null||(i=this.reflection.getTypeInfoByName(e)),i}_setOverrides(e,t){for(const i in e){const s=e[i],a=this.reflection.getOverrideInfo(i);a!==null?(a.type===null&&(a.type=this.getTypeInfo("u32")),a.type.name==="u32"||a.type.name==="i32"||a.type.name==="f32"||a.type.name==="f16"?t.setVariable(i,new N(s,a.type)):a.type.name==="bool"?t.setVariable(i,new N(s?1:0,a.type)):a.type.name==="vec2"||a.type.name==="vec3"||a.type.name==="vec4"||a.type.name==="vec2f"||a.type.name==="vec3f"||a.type.name==="vec4f"||a.type.name==="vec2i"||a.type.name==="vec3i"||a.type.name==="vec4i"||a.type.name==="vec2u"||a.type.name==="vec3u"||a.type.name==="vec4u"||a.type.name==="vec2h"||a.type.name==="vec3h"||a.type.name==="vec4h"?t.setVariable(i,new w(s,a.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,i){const s=[1,1,1];for(const p of e.node.attributes)if(p.name==="workgroup_size"){if(p.value.length>0){const _=i.getVariableValue(p.value[0]);s[0]=_ instanceof N?_.value:parseInt(p.value[0])}if(p.value.length>1){const _=i.getVariableValue(p.value[1]);s[1]=_ instanceof N?_.value:parseInt(p.value[1])}if(p.value.length>2){const _=i.getVariableValue(p.value[2]);s[2]=_ instanceof N?_.value:parseInt(p.value[2])}}const a=this.getTypeInfo("vec3u"),l=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new w(s,a));const u=s[0],h=s[1],d=s[2];for(let p=0,_=0;p<d;++p)for(let y=0;y<h;++y)for(let v=0;v<u;++v,++_){const A=[v,y,p],R=[v+t[0]*s[0],y+t[1]*s[1],p+t[2]*s[2]];i.setVariable("@local_invocation_id",new w(A,a)),i.setVariable("@global_invocation_id",new w(R,a)),i.setVariable("@local_invocation_index",new N(_,l)),this._dispatchExec(e,i)}}_dispatchExec(e,t){for(const i of e.node.args)for(const s of i.attributes)if(s.name==="builtin"){const a=`@${s.value}`,l=t.getVariable(a);l!==void 0&&t.variables.set(i.name,l)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof ft;)e=e.right;return e instanceof sn?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const i of e){if(i instanceof Array){const a=t.clone(),l=this._execStatements(i,a);if(l)return l;continue}const s=this.execStatement(i,t);if(s)return s}return null}_call(e,t){const i=t.clone();i.currentFunctionName=e.name;const s=t.getFunction(e.name);if(s){for(let a=0;a<s.node.args.length;++a){const l=s.node.args[a],u=this.evalExpression(e.args[a],i);i.setVariable(l.name,u,l)}this._execStatements(s.node.body,i)}else e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const i=this.getVariableName(e.variable,t),s=t.getVariable(i);s?e.operator==="++"?s.value instanceof N?s.value.value++:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):e.operator==="--"?s.value instanceof N?s.value.value--:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${i} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof sn){const i=this.getVariableName(e,t),s=t.getVariable(i);return s===null?(console.error(`Variable ${i} not found. Line ${e.line}`),null):s.value.getSubData(this,e.postfix,t)}if(e instanceof ft){if(e.operator==="*"){const i=this._getVariableData(e.right,t);return i instanceof Cr?i.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const i=this._getVariableData(e.right,t);return new Cr(i)}}return null}_assign(e,t){let i=null,s="<var>",a=null;if(e.variable instanceof ft){const h=this._getVariableData(e.variable,t),d=this.evalExpression(e.value,t),p=e.operator;if(p==="="){if(h instanceof N||h instanceof w||h instanceof ve){if(d instanceof N||d instanceof w||d instanceof ve&&h.data.length===d.data.length)return void h.data.set(d.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(h instanceof rt&&d instanceof rt&&h.buffer.byteLength-h.offset>=d.buffer.byteLength-d.offset)return void(h.buffer.byteLength%4==0?new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4).set(new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4)):new Uint8Array(h.buffer,h.offset,h.typeInfo.size).set(new Uint8Array(d.buffer,d.offset,d.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(p==="+=")return h instanceof N||h instanceof w||h instanceof ve?d instanceof N||d instanceof w||d instanceof ve?void h.data.set(d.data.map((_,y)=>h.data[y]+_)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(p==="-=")return(h instanceof N||h instanceof w||h instanceof ve)&&(d instanceof N||d instanceof w||d instanceof ve)?void h.data.set(d.data.map((_,y)=>h.data[y]-_)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof ft){if(e.variable.operator==="*"){s=this.getVariableName(e.variable.right,t);const h=t.getVariable(s);if(!(h&&h.value instanceof Cr))return void console.error(`Variable ${s} is not a pointer. Line ${e.line}`);i=h.value.reference;let d=e.variable.postfix;if(!d){let p=e.variable.right;for(;p instanceof ft;){if(p.postfix){d=p.postfix;break}p=p.right}}d&&(i=i.getSubData(this,d,t))}}else{a=e.variable.postfix,s=this.getVariableName(e.variable,t);const h=t.getVariable(s);if(h===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);i=h.value}if(i instanceof Cr&&(i=i.reference),i===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);const l=this.evalExpression(e.value,t),u=e.operator;if(u==="=")if(i instanceof rt)i.setDataValue(this,l,a,t);else if(a){if(!(i instanceof w||i instanceof ve))return void console.error(`Variable ${s} is not a vector or matrix. Line ${e.line}`);if(a instanceof $r){const h=this.evalExpression(a.index,t).value;if(i instanceof w){if(!(l instanceof N))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[h]=l.value}else{if(!(i instanceof ve))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const d=this.evalExpression(a.index,t).value;if(d<0)return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(l instanceof w))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const p=i.typeInfo.getTypeName();if(p==="mat2x2"||p==="mat2x2f"||p==="mat2x2h"){if(!(d<2&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat2x3"||p==="mat2x3f"||p==="mat2x3h"){if(!(d<2&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else if(p==="mat2x4"||p==="mat2x4f"||p==="mat2x4h"){if(!(d<2&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}else if(p==="mat3x2"||p==="mat3x2f"||p==="mat3x2h"){if(!(d<3&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat3x3"||p==="mat3x3f"||p==="mat3x3h"){if(!(d<3&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else if(p==="mat3x4"||p==="mat3x4f"||p==="mat3x4h"){if(!(d<3&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}else if(p==="mat4x2"||p==="mat4x2f"||p==="mat4x2h"){if(!(d<4&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat4x3"||p==="mat4x3f"||p==="mat4x3h"){if(!(d<4&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else{if(p!=="mat4x4"&&p!=="mat4x4f"&&p!=="mat4x4h")return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(d<4&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}}}}}else if(a instanceof Ns){const h=a.value;if(!(i instanceof w))return void console.error(`Invalid assignment to ${h}. Variable ${s} is not a vector. Line ${e.line}`);if(l instanceof N){if(h.length>1)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);if(h==="x")i.data[0]=l.value;else if(h==="y"){if(i.data.length<2)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);i.data[1]=l.value}else if(h==="z"){if(i.data.length<3)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);i.data[2]=l.value}else if(h==="w"){if(i.data.length<4)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);i.data[3]=l.value}}else{if(!(l instanceof w))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(h.length!==l.data.length)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);for(let d=0;d<h.length;++d){const p=h[d];if(p==="x"||p==="r")i.data[0]=l.data[d];else if(p==="y"||p==="g"){if(l.data.length<2)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);i.data[1]=l.data[d]}else if(p==="z"||p==="b"){if(l.data.length<3)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);i.data[2]=l.data[d]}else{if(p!=="w"&&p!=="a")return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);if(l.data.length<4)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);i.data[3]=l.data[d]}}}}}else i instanceof N&&l instanceof N?i.value=l.value:i instanceof w&&l instanceof w||i instanceof ve&&l instanceof ve?i.data.set(l.data):console.error(`Invalid assignment to ${s}. Line ${e.line}`);else{const h=i.getSubData(this,a,t);if(h instanceof w&&l instanceof N){const d=h.data,p=l.value;if(u==="+=")for(let _=0;_<d.length;++_)d[_]+=p;else if(u==="-=")for(let _=0;_<d.length;++_)d[_]-=p;else if(u==="*=")for(let _=0;_<d.length;++_)d[_]*=p;else if(u==="/=")for(let _=0;_<d.length;++_)d[_]/=p;else if(u==="%=")for(let _=0;_<d.length;++_)d[_]%=p;else if(u==="&=")for(let _=0;_<d.length;++_)d[_]&=p;else if(u==="|=")for(let _=0;_<d.length;++_)d[_]|=p;else if(u==="^=")for(let _=0;_<d.length;++_)d[_]^=p;else if(u==="<<=")for(let _=0;_<d.length;++_)d[_]<<=p;else if(u===">>=")for(let _=0;_<d.length;++_)d[_]>>=p;else console.error(`Invalid operator ${u}. Line ${e.line}`)}else if(h instanceof w&&l instanceof w){const d=h.data,p=l.data;if(d.length!==p.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(u==="+=")for(let _=0;_<d.length;++_)d[_]+=p[_];else if(u==="-=")for(let _=0;_<d.length;++_)d[_]-=p[_];else if(u==="*=")for(let _=0;_<d.length;++_)d[_]*=p[_];else if(u==="/=")for(let _=0;_<d.length;++_)d[_]/=p[_];else if(u==="%=")for(let _=0;_<d.length;++_)d[_]%=p[_];else if(u==="&=")for(let _=0;_<d.length;++_)d[_]&=p[_];else if(u==="|=")for(let _=0;_<d.length;++_)d[_]|=p[_];else if(u==="^=")for(let _=0;_<d.length;++_)d[_]^=p[_];else if(u==="<<=")for(let _=0;_<d.length;++_)d[_]<<=p[_];else if(u===">>=")for(let _=0;_<d.length;++_)d[_]>>=p[_];else console.error(`Invalid operator ${u}. Line ${e.line}`)}else{if(!(h instanceof N&&l instanceof N))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);u==="+="?h.value+=l.value:u==="-="?h.value-=l.value:u==="*="?h.value*=l.value:u==="/="?h.value/=l.value:u==="%="?h.value%=l.value:u==="&="?h.value&=l.value:u==="|="?h.value|=l.value:u==="^="?h.value^=l.value:u==="<<="?h.value<<=l.value:u===">>="?h.value>>=l.value:console.error(`Invalid operator ${u}. Line ${e.line}`)}i instanceof rt&&i.setDataValue(this,h,a,t)}}_function(e,t){const i=new Zg(e);t.functions.set(e.name,i)}_const(e,t){let i=null;e.value!==null&&(i=this.evalExpression(e.value,t)),t.createVariable(e.name,i,e)}_let(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof ft||(i=i.clone())}else{const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||s==="array"){const a=new Bn(e.type,[]);i=this._evalCreate(a,t)}}t.createVariable(e.name,i,e)}_var(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof ft||(i=i.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||e.type instanceof po||e.type instanceof li||e.type instanceof B){const a=new Bn(e.type,[]);i=this._evalCreate(a,t)}}t.createVariable(e.name,i,e)}_switch(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof N))return console.error(`Invalid if condition. Line ${e.line}`),null;let s=null;for(const a of e.cases)if(a instanceof w2)for(const l of a.selectors){if(l instanceof mc){s=a;continue}const u=this.evalExpression(l,t);if(!(u instanceof N))return console.error(`Invalid case selector. Line ${e.line}`),null;if(u.value===i.value)return this._execStatements(a.body,t)}else a instanceof E2&&(s=a);return s?this._execStatements(s.body,t):null}_if(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof N))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(e.body,t);for(const s of e.elseif){const a=this.evalExpression(s.condition,t);if(!(a instanceof N))return console.error(`Invalid if condition. Line ${e.line}`),null;if(a.value)return this._execStatements(s.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof N?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===Pt._breakObj)break;if(i!==null&&i!==Pt._continueObj)return i;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const i=this._execStatements(e.body,t);if(i===Pt._breakObj)break;if(i===Pt._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Pt._breakObj)break}else if(i!==null)return i}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===Pt._breakObj)break;if(i!==Pt._continueObj&&i!==null)return i}return null}_evalBitcast(e,t){const i=this.evalExpression(e.value,t),s=e.type;if(i instanceof N){const a=v0(i.value,i.typeInfo.name,s.name);return new N(a,this.getTypeInfo(s))}if(i instanceof w){const a=i.typeInfo.getTypeName();let l="";if(a.endsWith("f"))l="f32";else if(a.endsWith("i"))l="i32";else if(a.endsWith("u"))l="u32";else if(a.endsWith("b"))l="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${a}. Line ${e.line}`),null;l="f16"}const u=s.getTypeName();let h="";if(u.endsWith("f"))h="f32";else if(u.endsWith("i"))h="i32";else if(u.endsWith("u"))h="u32";else if(u.endsWith("b"))h="bool";else{if(!u.endsWith("h"))return console.error(`Unknown vector type ${h}. Line ${e.line}`),null;h="f16"}const d=function(p,_,y){if(_===y)return p;const v=new Array(p.length);for(let A=0;A<p.length;A++)v[A]=v0(p[A],_,y);return v}(Array.from(i.data),l,h);return new w(d,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var i;if(e instanceof Bn){if(e.type===null)return ng.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const s=e instanceof Bn?e.type.name:e.name,a=e instanceof Bn?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(a===null)return console.error(`Unknown type ${s}. Line ${e.line}`),null;if(a.size===0)return null;const l=new rt(new ArrayBuffer(a.size),a,0);if(a instanceof Xi){if(e.args)for(let u=0;u<e.args.length;++u){const h=a.members[u],d=e.args[u],p=this.evalExpression(d,t);l.setData(this,p,h.type,h.offset,t)}}else if(a instanceof Zi){let u=0;if(e.args)for(let h=0;h<e.args.length;++h){const d=e.args[h],p=this.evalExpression(d,t);a.format===null&&(((i=p.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?a.format=this.getTypeInfo("i32"):a.format=p.typeInfo),l.setData(this,p,a.format,u,t),u+=a.stride}}else console.error(`Unknown type "${s}". Line ${e.line}`);return e instanceof Bn?l.getSubData(this,e.postfix,t):l}_evalLiteral(e,t){const i=this.getTypeInfo(e.type),s=i.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new N(e.scalarValue,i):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(e,t):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const i=t.getVariableValue(e.name);return i===null?i:i.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const s=Pt._priority.get(t.name);Pt._priority.get(e[i].name)<s&&(t=e[i])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const i=this.evalExpression(e.right,t);if(e.operator==="&")return new Cr(i);if(e.operator==="*")return i instanceof Cr?i.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const s=i instanceof N?i.value:i instanceof w?Array.from(i.data):null;switch(e.operator){case"+":{if(se(s)){const u=s.map((h,d)=>+h);return new w(u,i.typeInfo)}const a=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new N(+a,l)}case"-":{if(se(s)){const u=s.map((h,d)=>-h);return new w(u,i.typeInfo)}const a=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new N(-a,l)}case"!":{if(se(s)){const u=s.map((h,d)=>h?0:1);return new w(u,i.typeInfo)}const a=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new N(a?0:1,l)}case"~":{if(se(s)){const u=s.map((h,d)=>~h);return new w(u,i.typeInfo)}const a=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new N(~a,l)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const i=this.evalExpression(e.left,t),s=this.evalExpression(e.right,t),a=i instanceof N?i.value:i instanceof w||i instanceof ve?Array.from(i.data):null,l=s instanceof N?s.value:s instanceof w||s instanceof ve?Array.from(s.data):null;switch(e.operator){case"+":{if(se(a)&&se(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,A)=>v+_[A]);return new w(y,i.typeInfo)}if(se(a)){const p=l,_=a.map((y,v)=>y+p);return new w(_,i.typeInfo)}if(se(l)){const p=a,_=l.map((y,v)=>p+y);return new w(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u+h,d)}case"-":{if(se(a)&&se(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,A)=>v-_[A]);return new w(y,i.typeInfo)}if(se(a)){const p=l,_=a.map((y,v)=>y-p);return new w(_,i.typeInfo)}if(se(l)){const p=a,_=l.map((y,v)=>p-y);return new w(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u-h,d)}case"*":{if(se(a)&&se(l)){const p=a,_=l;if(i instanceof ve&&s instanceof ve){const y=function(C,z,H,M){if(Bt[z.name]===void 0||Bt[M.name]===void 0)return null;const k=Bt[z.name][0],L=Bt[z.name][1],X=Bt[M.name][0];if(k!==Bt[M.name][1])return null;const ce=new Array(X*L);for(let re=0;re<L;re++)for(let ne=0;ne<X;ne++){let he=0;for(let te=0;te<k;te++)he+=C[te*L+re]*H[ne*k+te];ce[re*X+ne]=he}return ce}(p,i.typeInfo,_,s.typeInfo);if(y===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const v=Bt[s.typeInfo.name][0],A=Bt[i.typeInfo.name][1],R=this.getTypeInfo(`mat${v}x${A}f`);return new ve(y,R)}if(i instanceof ve&&s instanceof w){const y=function(v,A,R,C){if(Bt[A.name]===void 0||fd[C.name]===void 0)return null;const z=Bt[A.name][0],H=Bt[A.name][1];if(z!==R.length)return null;const M=new Array(H);for(let k=0;k<H;k++){let L=0;for(let X=0;X<z;X++)L+=v[X*H+k]*R[X];M[k]=L}return M}(p,i.typeInfo,_,s.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new w(y,s.typeInfo)}if(i instanceof w&&s instanceof ve){const y=function(v,A,R,C){if(fd[A.name]===void 0||Bt[C.name]===void 0)return null;const z=Bt[C.name][0],H=Bt[C.name][1];if(H!==v.length)return null;const M=[];for(let k=0;k<z;k++){let L=0;for(let X=0;X<H;X++)L+=v[X]*R[X*z+k];M[k]=L}return M}(p,i.typeInfo,_,s.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new w(y,i.typeInfo)}{if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,A)=>v*_[A]);return new w(y,i.typeInfo)}}if(se(a)){const p=l,_=a.map((y,v)=>y*p);return i instanceof ve?new ve(_,i.typeInfo):new w(_,i.typeInfo)}if(se(l)){const p=a,_=l.map((y,v)=>p*y);return s instanceof ve?new ve(_,s.typeInfo):new w(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u*h,d)}case"%":{if(se(a)&&se(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,A)=>v%_[A]);return new w(y,i.typeInfo)}if(se(a)){const p=l,_=a.map((y,v)=>y%p);return new w(_,i.typeInfo)}if(se(l)){const p=a,_=l.map((y,v)=>p%y);return new w(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u%h,d)}case"/":{if(se(a)&&se(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,A)=>v/_[A]);return new w(y,i.typeInfo)}if(se(a)){const p=l,_=a.map((y,v)=>y/p);return new w(_,i.typeInfo)}if(se(l)){const p=a,_=l.map((y,v)=>p/y);return new w(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u/h,d)}case"&":{if(se(a)&&se(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,A)=>v&_[A]);return new w(y,i.typeInfo)}if(se(a)){const p=l,_=a.map((y,v)=>y&p);return new w(_,i.typeInfo)}if(se(l)){const p=a,_=l.map((y,v)=>p&y);return new w(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u&h,d)}case"|":{if(se(a)&&se(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,A)=>v|_[A]);return new w(y,i.typeInfo)}if(se(a)){const p=l,_=a.map((y,v)=>y|p);return new w(_,i.typeInfo)}if(se(l)){const p=a,_=l.map((y,v)=>p|y);return new w(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u|h,d)}case"^":{if(se(a)&&se(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,A)=>v^_[A]);return new w(y,i.typeInfo)}if(se(a)){const p=l,_=a.map((y,v)=>y^p);return new w(_,i.typeInfo)}if(se(l)){const p=a,_=l.map((y,v)=>p^y);return new w(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u^h,d)}case"<<":{if(se(a)&&se(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,A)=>v<<_[A]);return new w(y,i.typeInfo)}if(se(a)){const p=l,_=a.map((y,v)=>y<<p);return new w(_,i.typeInfo)}if(se(l)){const p=a,_=l.map((y,v)=>p<<y);return new w(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u<<h,d)}case">>":{if(se(a)&&se(l)){const p=a,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,A)=>v>>_[A]);return new w(y,i.typeInfo)}if(se(a)){const p=l,_=a.map((y,v)=>y>>p);return new w(_,i.typeInfo)}if(se(l)){const p=a,_=l.map((y,v)=>p>>y);return new w(_,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u>>h,d)}case">":if(se(a)&&se(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p>h[_]?1:0);return new w(d,i.typeInfo)}if(se(a)){const u=l,h=a.map((d,p)=>d>u?1:0);return new w(h,i.typeInfo)}if(se(l)){const u=a,h=l.map((d,p)=>u>d?1:0);return new w(h,s.typeInfo)}return new N(a>l?1:0,this.getTypeInfo("bool"));case"<":if(se(a)&&se(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p<h[_]?1:0);return new w(d,i.typeInfo)}if(se(a)){const u=l,h=a.map((d,p)=>d<u?1:0);return new w(h,i.typeInfo)}if(se(l)){const u=a,h=l.map((d,p)=>u<d?1:0);return new w(h,s.typeInfo)}return new N(a<l?1:0,this.getTypeInfo("bool"));case"==":if(se(a)&&se(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p===h[_]?1:0);return new w(d,i.typeInfo)}if(se(a)){const u=l,h=a.map((d,p)=>d==u?1:0);return new w(h,i.typeInfo)}if(se(l)){const u=a,h=l.map((d,p)=>u==d?1:0);return new w(h,s.typeInfo)}return new N(a===l?1:0,this.getTypeInfo("bool"));case"!=":if(se(a)&&se(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p!==h[_]?1:0);return new w(d,i.typeInfo)}if(se(a)){const u=l,h=a.map((d,p)=>d!==u?1:0);return new w(h,i.typeInfo)}if(se(l)){const u=a,h=l.map((d,p)=>u!==d?1:0);return new w(h,s.typeInfo)}return new N(a!==l?1:0,this.getTypeInfo("bool"));case">=":if(se(a)&&se(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p>=h[_]?1:0);return new w(d,i.typeInfo)}if(se(a)){const u=l,h=a.map((d,p)=>d>=u?1:0);return new w(h,i.typeInfo)}if(se(l)){const u=a,h=l.map((d,p)=>u>=d?1:0);return new w(h,s.typeInfo)}return new N(a>=l?1:0,this.getTypeInfo("bool"));case"<=":if(se(a)&&se(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p<=h[_]?1:0);return new w(d,i.typeInfo)}if(se(a)){const u=l,h=a.map((d,p)=>d<=u?1:0);return new w(h,i.typeInfo)}if(se(l)){const u=a,h=l.map((d,p)=>u<=d?1:0);return new w(h,s.typeInfo)}return new N(a<=l?1:0,this.getTypeInfo("bool"));case"&&":if(se(a)&&se(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p&&h[_]?1:0);return new w(d,i.typeInfo)}if(se(a)){const u=l,h=a.map((d,p)=>d&&u?1:0);return new w(h,i.typeInfo)}if(se(l)){const u=a,h=l.map((d,p)=>u&&d?1:0);return new w(h,s.typeInfo)}return new N(a&&l?1:0,this.getTypeInfo("bool"));case"||":if(se(a)&&se(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,_)=>p||h[_]?1:0);return new w(d,i.typeInfo)}if(se(a)){const u=l,h=a.map((d,p)=>d||u?1:0);return new w(h,i.typeInfo)}if(se(l)){const u=a,h=l.map((d,p)=>u||d?1:0);return new w(h,s.typeInfo)}return new N(a||l?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const i=t.clone();i.currentFunctionName=e.name;const s=t.getFunction(e.name);if(!s)return e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let a=0;a<s.node.args.length;++a){const l=s.node.args[a],u=this.evalExpression(e.args[a],i);i.createVariable(l.name,u,l)}return this._execStatements(s.node.body,i)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const i=t.getFunction(e.name);if(i){const s=t.clone();for(let a=0;a<i.node.args.length;++a){const l=i.node.args[a],u=this.evalExpression(e.args[a],s);s.setVariable(l.name,u,l)}return this._execStatements(i.node.body,s)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new N(0,this.getTypeInfo(e.type));const i=this.evalExpression(e.args[0],t);return i.typeInfo=this.getTypeInfo(e.type),i.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const i=this.getTypeInfo(e.type),s=e.type.getTypeName(),a=fd[s];if(a===void 0)return console.error(`Invalid vec constructor ${s}. Line ${e.line}`),null;const l=[];if(e instanceof pt)if(e.isVector){const u=e.vectorValue;for(const h of u)l.push(h)}else l.push(e.scalarValue);else if(e.args)for(const u of e.args){const h=this.evalExpression(u,t);if(h instanceof w){const d=h.data;for(let p=0;p<d.length;++p){let _=d[p];l.push(_)}}else if(h instanceof N){let d=h.value;l.push(d)}}if(e.type instanceof B&&e.type.format===null&&(e.type.format=B.f32),l.length===0){const u=new Array(a).fill(0);return new w(u,i).getSubData(this,e.postfix,t)}if(l.length===1)for(;l.length<a;)l.push(l[0]);return l.length<a?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new w(l.length>a?l.slice(0,a):l,i).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const i=this.getTypeInfo(e.type),s=e.type.getTypeName(),a=Bt[s];if(a===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${e.line}`),null;const l=[];if(e instanceof pt)if(e.isVector){const u=e.vectorValue;for(const h of u)l.push(h)}else l.push(e.scalarValue);else if(e.args)for(const u of e.args){const h=this.evalExpression(u,t);h instanceof w?l.push(...h.data):h instanceof N?l.push(h.value):h instanceof ve&&l.push(...h.data)}if(i instanceof Is&&i.format===null&&(i.format=this.getTypeInfo("f32")),l.length===0){const u=new Array(a[2]).fill(0);return new ve(u,i).getSubData(this,e.postfix,t)}return l.length!==a[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new ve(l,i).getSubData(this,e.postfix,t)}}Pt._breakObj=new bn(new mn("BREAK",null),null),Pt._continueObj=new bn(new mn("CONTINUE",null),null),Pt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class zC{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class HC{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new zC,this._exec=new Pt,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;t.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const s=i.arrayType,a=i.countNode;if(a instanceof sn){const l=a.name,u=this._context.constants.get(l);if(u)try{const h=u.constEvaluate(this._exec);s.count=h}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const i of t)i.search(s=>{s instanceof y0||s instanceof ud?s.type=this._forwardType(s.type):s instanceof po?s.format=this._forwardType(s.format):s instanceof ui||s instanceof go||s instanceof pc?s.type=this._forwardType(s.type):s instanceof xo?s.returnType=this._forwardType(s.returnType):s instanceof _0&&(s.type=this._forwardType(s.type))});return t}_forwardType(e){if(e instanceof m0){const t=this._getType(e.name);if(t)return t}else e instanceof ud?e.type=this._forwardType(e.type):e instanceof po&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new IC(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==S.eof}_match(e){if(e instanceof D)return!!this._check(e)&&(this._advance(),!0);for(let t=0,i=e.length;t<i;++t){const s=e[t];if(this._check(s))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const i=t.type;let s=!1;for(const a of e){if(i===a)return!0;a===S.tokens.name&&(s=!0)}if(s){const a=S.tokens.name.rule.exec(t.lexeme);if(a&&a.index==0&&a[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===S.tokens.name){const i=S.tokens.name.rule.exec(t.lexeme);return i&&i.index==0&&i[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(S.tokens.semicolon)&&!this._isAtEnd(););if(this._match(S.keywords.alias)){const t=this._type_alias();return this._consume(S.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(S.keywords.diagnostic)){const t=this._diagnostic();return this._consume(S.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(S.keywords.requires)){const t=this._requires_directive();return this._consume(S.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(S.keywords.enable)){const t=this._enable_directive();return this._consume(S.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(S.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(S.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(S.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(S.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(S.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(S.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(S.keywords.fn))return null;const e=this._currentLine,t=this._consume(S.tokens.ident,"Expected function name.").toString();this._consume(S.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(S.tokens.paren_right))do{if(this._check(S.tokens.paren_right))break;const u=this._attribute(),h=this._consume(S.tokens.name,"Expected argument name.").toString();this._consume(S.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),p=this._type_decl();p!=null&&(p.attributes=d,i.push(this._updateNode(new _0(h,p,u))))}while(this._match(S.tokens.comma));this._consume(S.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(S.tokens.arrow)){const u=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=u)}const a=this._compound_statement(),l=this._currentLine;return this._updateNode(new xo(t,i,s,a,e,l),e)}_compound_statement(){const e=[];for(this._consume(S.tokens.brace_left,"Expected '{' for block.");!this._check(S.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(S.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(S.tokens.semicolon)&&!this._isAtEnd(););if(this._check(S.tokens.attr)&&this._attribute(),this._check(S.keywords.if))return this._if_statement();if(this._check(S.keywords.switch))return this._switch_statement();if(this._check(S.keywords.loop))return this._loop_statement();if(this._check(S.keywords.for))return this._for_statement();if(this._check(S.keywords.while))return this._while_statement();if(this._check(S.keywords.continuing))return this._continuing_statement();if(this._check(S.keywords.static_assert))return this._static_assert_statement();if(this._check(S.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(S.keywords.return))e=this._return_statement();else if(this._check([S.keywords.var,S.keywords.let,S.keywords.const]))e=this._variable_statement();else if(this._match(S.keywords.discard))e=this._updateNode(new CC);else if(this._match(S.keywords.break)){const t=this._updateNode(new b2);if(this._currentLoop.length>0){const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t,this._check(S.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(S.keywords.continue)){const t=this._updateNode(new v2);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(S.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(S.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new wC(t),e)}_while_statement(){if(!this._match(S.keywords.while))return null;const e=this._updateNode(new u2(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(S.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(S.keywords.continuing))return null;const t=this._currentLine,i=this._compound_statement();return this._updateNode(new tg(i,e),t)}_for_statement(){if(!this._match(S.keywords.for))return null;this._consume(S.tokens.paren_left,"Expected '('.");const e=this._updateNode(new f2(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(S.tokens.semicolon)?null:this._for_init(),this._consume(S.tokens.semicolon,"Expected ';'."),e.condition=this._check(S.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(S.tokens.semicolon,"Expected ';'."),e.increment=this._check(S.tokens.paren_right)?null:this._for_increment(),this._consume(S.tokens.paren_right,"Expected ')'."),this._check(S.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(S.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(S.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new ui(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(S.keywords.let)){const e=this._currentLine,t=this._consume(S.tokens.name,"Expected name for let.").toString();let i=null;if(this._match(S.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}this._consume(S.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new go(t,i,null,null,s),e)}if(this._match(S.keywords.const)){const e=this._currentLine,t=this._consume(S.tokens.name,"Expected name for const.").toString();let i=null;if(this._match(S.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}this._consume(S.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return i===null&&s instanceof pt&&(i=s.type),this._updateNode(new pc(t,i,null,null,s),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(S.increment_operators))return this._current=e,null;const i=this._consume(S.increment_operators,"Expected increment operator");return this._updateNode(new h2(i.type===S.tokens.plus_plus?Pr.increment:Pr.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(S.tokens.brace_right))return null;let i=this._match(S.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const s=this._consume(S.assignment_operators,"Expected assignment operator."),a=this._short_circuit_or_expression();return this._updateNode(new d2(ao.parse(s.lexeme),e,a),t)}_func_call_statement(){if(!this._check(S.tokens.ident))return null;const e=this._currentLine,t=this._current,i=this._consume(S.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=t,null):this._updateNode(new Xg(i.lexeme,s),e)}_loop_statement(){if(!this._match(S.keywords.loop))return null;this._check(S.tokens.attr)&&this._attribute(),this._consume(S.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new g2([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let i of t)e.body.push(i);else e.body.push(t);if(t instanceof tg){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(S.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(S.keywords.switch))return null;const e=this._updateNode(new p2(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(S.tokens.attr)&&this._attribute(),this._consume(S.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(S.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([S.keywords.default,S.keywords.case]);){if(this._match(S.keywords.case)){const i=this._case_selectors();for(const a of i)if(a instanceof mc){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(S.tokens.colon),this._check(S.tokens.attr)&&this._attribute(),this._consume(S.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(S.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new w2(i,s)))}if(this._match(S.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(S.tokens.colon),this._check(S.tokens.attr)&&this._attribute(),this._consume(S.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(S.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new E2(i)))}}return e}_case_selectors(){const e=[];for(this._match(S.keywords.default)?e.push(this._updateNode(new mc)):e.push(this._shift_expression());this._match(S.tokens.comma);)this._match(S.keywords.default)?e.push(this._updateNode(new mc)):e.push(this._shift_expression());return e}_case_body(){if(this._match(S.keywords.fallthrough))return this._consume(S.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(S.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(S.tokens.attr)&&this._attribute();const i=this._compound_statement();let s=[];this._match_elseif()&&(this._check(S.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let a=null;return this._match(S.keywords.else)&&(this._check(S.tokens.attr)&&this._attribute(),a=this._compound_statement()),this._updateNode(new m2(t,i,s,a),e)}_match_elseif(){return this._tokens[this._current].type===S.keywords.else&&this._tokens[this._current+1].type===S.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),i=this._compound_statement();return e.push(this._updateNode(new MC(t,i))),this._match_elseif()&&(this._check(S.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(S.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new _2(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(S.tokens.or_or);)e=this._updateNode(new wn(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(S.tokens.and_and);)e=this._updateNode(new wn(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(S.tokens.or);)e=this._updateNode(new wn(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(S.tokens.xor);)e=this._updateNode(new wn(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(S.tokens.and);)e=this._updateNode(new wn(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([S.tokens.equal_equal,S.tokens.not_equal])?this._updateNode(new wn(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([S.tokens.less_than,S.tokens.greater_than,S.tokens.less_than_equal,S.tokens.greater_than_equal]);)e=this._updateNode(new wn(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([S.tokens.shift_left,S.tokens.shift_right]);)e=this._updateNode(new wn(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([S.tokens.plus,S.tokens.minus]);)e=this._updateNode(new wn(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([S.tokens.star,S.tokens.forward_slash,S.tokens.modulo]);)e=this._updateNode(new wn(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([S.tokens.minus,S.tokens.bang,S.tokens.tilde,S.tokens.star,S.tokens.and])?this._updateNode(new ft(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(S.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(S.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new $r(e)),i=this._postfix_expression();return i&&(t.postfix=i),t}if(this._match(S.tokens.period)){const e=this._consume(S.tokens.name,"Expected member name."),t=this._postfix_expression(),i=this._updateNode(new Ns(e.lexeme));return t&&(i.postfix=t),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return Z.void;case"bool":return Z.bool;case"i32":return Z.i32;case"u32":return Z.u32;case"f32":return Z.f32;case"f16":return Z.f16;case"vec2f":return B.vec2f;case"vec3f":return B.vec3f;case"vec4f":return B.vec4f;case"vec2i":return B.vec2i;case"vec3i":return B.vec3i;case"vec4i":return B.vec4i;case"vec2u":return B.vec2u;case"vec3u":return B.vec3u;case"vec4u":return B.vec4u;case"vec2h":return B.vec2h;case"vec3h":return B.vec3h;case"vec4h":return B.vec4h;case"mat2x2f":return B.mat2x2f;case"mat2x3f":return B.mat2x3f;case"mat2x4f":return B.mat2x4f;case"mat3x2f":return B.mat3x2f;case"mat3x3f":return B.mat3x3f;case"mat3x4f":return B.mat3x4f;case"mat4x2f":return B.mat4x2f;case"mat4x3f":return B.mat4x3f;case"mat4x4f":return B.mat4x4f;case"mat2x2h":return B.mat2x2h;case"mat2x3h":return B.mat2x3h;case"mat2x4h":return B.mat2x4h;case"mat3x2h":return B.mat3x2h;case"mat3x3h":return B.mat3x3h;case"mat3x4h":return B.mat3x4h;case"mat4x2h":return B.mat4x2h;case"mat4x3h":return B.mat4x3h;case"mat4x4h":return B.mat4x4h;case"mat2x2i":return B.mat2x2i;case"mat2x3i":return B.mat2x3i;case"mat2x4i":return B.mat2x4i;case"mat3x2i":return B.mat3x2i;case"mat3x3i":return B.mat3x3i;case"mat3x4i":return B.mat3x4i;case"mat4x2i":return B.mat4x2i;case"mat4x3i":return B.mat4x3i;case"mat4x4i":return B.mat4x4i;case"mat2x2u":return B.mat2x2u;case"mat2x3u":return B.mat2x3u;case"mat2x4u":return B.mat2x4u;case"mat3x2u":return B.mat3x2u;case"mat3x3u":return B.mat3x3u;case"mat3x4u":return B.mat3x4u;case"mat4x2u":return B.mat4x2u;case"mat4x3u":return B.mat4x3u;case"mat4x4u":return B.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(S.tokens.ident)){const i=this._previous().toString();if(this._check(S.tokens.paren_left)){const s=this._argument_expression_list(),a=this._getType(i);return a!==null?this._updateNode(new Bn(a,s)):this._updateNode(new qg(i,s))}if(this._context.constants.has(i)){const s=this._context.constants.get(i);return this._updateNode(new T2(i,s.value))}return this._updateNode(new sn(i))}if(this._match(S.tokens.int_literal)){const i=this._previous().toString();let s=i.endsWith("i")||i.endsWith("i")?Z.i32:i.endsWith("u")||i.endsWith("U")?Z.u32:Z.x32;const a=parseInt(i);return this._validateTypeRange(a,s),this._updateNode(new pt(new N(a,this._exec.getTypeInfo(s)),s))}if(this._match(S.tokens.uint_literal)){const i=parseInt(this._previous().toString());return this._validateTypeRange(i,Z.u32),this._updateNode(new pt(new N(i,this._exec.getTypeInfo(Z.u32)),Z.u32))}if(this._match([S.tokens.decimal_float_literal,S.tokens.hex_float_literal])){let i=this._previous().toString(),s=i.endsWith("h");s&&(i=i.substring(0,i.length-1));const a=parseFloat(i);this._validateTypeRange(a,s?Z.f16:Z.f32);const l=s?Z.f16:Z.f32;return this._updateNode(new pt(new N(a,this._exec.getTypeInfo(l)),l))}if(this._match([S.keywords.true,S.keywords.false])){let i=this._previous().toString()===S.keywords.true.rule;return this._updateNode(new pt(new N(i?1:0,this._exec.getTypeInfo(Z.bool)),Z.bool))}if(this._check(S.tokens.paren_left))return this._paren_expression();if(this._match(S.keywords.bitcast)){this._consume(S.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(S.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new x2(i,s))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Bn(e,t))}_argument_expression_list(){if(!this._match(S.tokens.paren_left))return null;const e=[];do{if(this._check(S.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(S.tokens.comma));return this._consume(S.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(S.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(S.tokens.paren_right),e}_paren_expression(){this._consume(S.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(S.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(S.keywords.struct))return null;const e=this._currentLine,t=this._consume(S.tokens.ident,"Expected name for struct.").toString();this._consume(S.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(S.tokens.brace_right);){const l=this._attribute(),u=this._consume(S.tokens.name,"Expected variable name.").toString();this._consume(S.tokens.colon,"Expected ':' for struct member type.");const h=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=h),this._check(S.tokens.brace_right)?this._match(S.tokens.comma):this._consume(S.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new y0(u,d,l)))}this._consume(S.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,a=this._updateNode(new li(t,i,e,s),e);return this._context.structs.set(t,a),a}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(S.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof pt){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof pt&&(e.type=e.value.type.name==="x32"?Z.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(S.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(S.keywords.const))return null;const t=this._consume(S.tokens.name,"Expected variable name"),i=this._currentLine;let s=null;if(this._match(S.tokens.colon)){const h=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=h)}let a=null;this._consume(S.tokens.equal,"const declarations require an assignment");const l=this._short_circuit_or_expression();try{let h=[Z.f32],d=l.constEvaluate(this._exec,h);d instanceof N&&this._validateTypeRange(d.value,h[0]),h[0]instanceof B&&h[0].format===null&&d.typeInfo instanceof Is&&d.typeInfo.format!==null&&(d.typeInfo.format.name==="f16"?h[0].format=Z.f16:d.typeInfo.format.name==="f32"?h[0].format=Z.f32:d.typeInfo.format.name==="i32"?h[0].format=Z.i32:d.typeInfo.format.name==="u32"?h[0].format=Z.u32:d.typeInfo.format.name==="bool"?h[0].format=Z.bool:console.error(`TODO: impelement template format type ${d.typeInfo.format.name}`)),a=this._updateNode(new pt(d,h[0])),this._exec.context.setVariable(t.toString(),d)}catch{a=l}if(s!==null&&a instanceof pt){if(a.type.name!=="x32"&&s.getTypeName()!==a.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${a.type.name} to ${s.name}. Line:${this._currentLine}`);a.type=s,a.isScalar&&this._validateTypeRange(a.scalarValue,a.type)}else s===null&&a instanceof pt&&(s=(e=a==null?void 0:a.type)!==null&&e!==void 0?e:Z.f32,s===Z.x32&&(s=Z.i32));const u=this._updateNode(new pc(t.toString(),s,"","",a),i);return this._context.constants.set(u.name,u),u}_global_let_decl(){if(!this._match(S.keywords.let))return null;const e=this._currentLine,t=this._consume(S.tokens.name,"Expected variable name");let i=null;if(this._match(S.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}let s=null;if(this._match(S.tokens.equal)&&(s=this._const_expression()),i!==null&&s instanceof pt){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i}else i===null&&s instanceof pt&&(i=s.type.name==="x32"?Z.i32:s.type);return s instanceof pt&&s.isScalar&&this._validateTypeRange(s.scalarValue,i),this._updateNode(new go(t.toString(),i,"","",s),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(S.keywords.var))return null;const e=this._currentLine;let t="",i="";this._match(S.tokens.less_than)&&(t=this._consume(S.storage_class,"Expected storage_class.").toString(),this._match(S.tokens.comma)&&(i=this._consume(S.access_mode,"Expected access_mode.").toString()),this._consume(S.tokens.greater_than,"Expected '>'."));const s=this._consume(S.tokens.name,"Expected variable name");let a=null;if(this._match(S.tokens.colon)){const l=this._attribute();a=this._type_decl(),a!=null&&(a.attributes=l)}return this._updateNode(new ui(s.toString(),a,t,i,null),e)}_override_decl(){if(!this._match(S.keywords.override))return null;const e=this._consume(S.tokens.name,"Expected variable name");let t=null;if(this._match(S.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}return this._updateNode(new $g(e.toString(),t,null))}_diagnostic(){this._consume(S.tokens.paren_left,"Expected '('");const e=this._consume(S.tokens.ident,"Expected severity control name.");this._consume(S.tokens.comma,"Expected ','");let t=this._consume(S.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(S.tokens.period)&&(t+=`.${this._consume(S.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(S.tokens.paren_right,"Expected ')'"),this._updateNode(new y2(e.toString(),t))}_enable_directive(){const e=this._consume(S.tokens.ident,"identity expected.");return this._updateNode(new EC(e.toString()))}_requires_directive(){const e=[this._consume(S.tokens.ident,"identity expected.").toString()];for(;this._match(S.tokens.comma);){const t=this._consume(S.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new RC(e))}_type_alias(){const e=this._consume(S.tokens.ident,"identity expected.");this._consume(S.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const i=this._updateNode(new Yg(e.toString(),t));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([S.tokens.ident,...S.texel_format,S.keywords.bool,S.keywords.f32,S.keywords.i32,S.keywords.u32])){const i=this._advance().toString();if(this._context.structs.has(i))return this._context.structs.get(i);if(this._context.aliases.has(i))return this._context.aliases.get(i).type;if(!this._getType(i)){const s=this._updateNode(new m0(i));return this._forwardTypeCount++,s}return this._updateNode(new Z(i))}let e=this._texture_sampler_types();if(e)return e;if(this._check(S.template_types)){let i=this._advance().toString(),s=null,a=null;return this._match(S.tokens.less_than)&&(s=this._type_decl(),a=null,this._match(S.tokens.comma)&&(a=this._consume(S.access_mode,"Expected access_mode for pointer").toString()),this._consume(S.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new B(i,s,a))}if(this._match(S.keywords.ptr)){let i=this._previous().toString();this._consume(S.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(S.storage_class,"Expected storage_class for pointer");this._consume(S.tokens.comma,"Expected ',' for pointer.");const a=this._type_decl();let l=null;return this._match(S.tokens.comma)&&(l=this._consume(S.access_mode,"Expected access_mode for pointer").toString()),this._consume(S.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new ud(i,s.toString(),a,l))}const t=this._attribute();if(this._match(S.keywords.array)){let i=null,s=-1;const a=this._previous();let l=null;if(this._match(S.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let h="";if(this._match(S.tokens.comma)){l=this._shift_expression();try{h=l.constEvaluate(this._exec).toString(),l=null}catch{h="1"}}this._consume(S.tokens.greater_than,"Expected '>' for array."),s=h?parseInt(h):0}const u=this._updateNode(new po(a.toString(),t,i,s));return l&&this._deferArrayCountEval.push({arrayType:u,countNode:l}),u}return null}_texture_sampler_types(){if(this._match(S.sampler_type))return this._updateNode(new oo(this._previous().toString(),null,null));if(this._match(S.depth_texture_type))return this._updateNode(new oo(this._previous().toString(),null,null));if(this._match(S.sampled_texture_type)||this._match(S.multisampled_texture_type)){const e=this._previous();this._consume(S.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(S.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new oo(e.toString(),t,null))}if(this._match(S.storage_texture_type)){const e=this._previous();this._consume(S.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(S.texel_format,"Invalid texel format.").toString();this._consume(S.tokens.comma,"Expected ',' after texel format.");const i=this._consume(S.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(S.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new oo(e.toString(),t,i))}return null}_attribute(){let e=[];for(;this._match(S.tokens.attr);){const t=this._consume(S.attribute_name,"Expected attribute name"),i=this._updateNode(new R2(t.toString(),null));if(this._match(S.tokens.paren_left)){if(i.value=this._consume(S.literal_or_ident,"Expected attribute value").toString(),this._check(S.tokens.comma)){this._advance();do{const s=this._consume(S.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(s)}while(this._match(S.tokens.comma))}this._consume(S.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}}class jC extends Vn{constructor(e){super(),e&&this.update(e)}update(e){const t=new HC().parse(e);this.updateAST(t)}}function WC(n){var a;const e={attributes:[],bindings:[]};let t;try{t=$C(n)}catch(l){return ee.error(l.message)(),e}for(const l of t.uniforms){const u=[];for(const h of((a=l.type)==null?void 0:a.members)||[])u.push({name:h.name,type:T0(h.type)});e.bindings.push({type:"uniform",name:l.name,group:l.group,location:l.binding,members:u})}for(const l of t.textures)e.bindings.push({type:"texture",name:l.name,group:l.group,location:l.binding});for(const l of t.samplers)e.bindings.push({type:"sampler",name:l.name,group:l.group,location:l.binding});const i=t.entry.vertex[0],s=(i==null?void 0:i.inputs.length)||0;for(let l=0;l<s;l++){const u=i.inputs[l];if(u.locationType==="location"){const h=T0(u.type);e.attributes.push({name:u.name,location:Number(u.location),type:h})}}return e}function T0(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function $C(n){try{return new jC(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(t+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(t+=e.token.line||""),new Error(t,{cause:e})}}const XC={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...XC}};const _n=globalThis.mathgl.config;function YC(n,{precision:e=_n.precision}={}){return n=qC(n),`${parseFloat(n.toPrecision(e))}`}function Xr(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Yi(n,e,t){return ZC(n,i=>Math.max(e,Math.min(t,i)))}function Vc(n,e,t){return Xr(n)?n.map((i,s)=>Vc(i,e[s],t)):t*e+(1-t)*n}function So(n,e,t){const i=_n.EPSILON;try{if(n===e)return!0;if(Xr(n)&&Xr(e)){if(n.length!==e.length)return!1;for(let s=0;s<n.length;++s)if(!So(n[s],e[s]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=_n.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{_n.EPSILON=i}}function qC(n){return Math.round(n/_n.EPSILON)*_n.EPSILON}function KC(n){return n.clone?n.clone():new Array(n.length)}function ZC(n,e,t){if(Xr(n)){const i=n;t=t||KC(i);for(let s=0;s<t.length&&s<i.length;++s){const a=typeof n=="number"?n:n[s];t[s]=e(a,s,t)}return t}return e(n)}class C2 extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Xr(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(_n)}formatString(e){let t="";for(let i=0;i<this.ELEMENTS;++i)t+=(i>0?", ":"")+YC(this[i],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!So(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,i){if(i===void 0)return this.lerp(this,e,t);for(let s=0;s<this.ELEMENTS;++s){const a=e[s],l=typeof t=="number"?t:t[s];this[s]=a+i*(l-a)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}add(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=t[i];return this.check()}subtract(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=t[i];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(_n.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}get elements(){return this}}function QC(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function nn(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function hd(n,e,t=""){if(_n.debug&&!QC(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function x0(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class GC extends C2{get x(){return this[0]}set x(e){this[0]=nn(e)}get y(){return this[1]}set y(e){this[1]=nn(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-e[i];t+=s*s}return nn(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return nn(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=t[i];return this.check()}divide(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=t[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return x0(e>=0&&e<this.ELEMENTS,"index is out of range"),nn(this[e])}setComponent(e,t){return x0(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const _c=1e-6;let Yr=typeof Float32Array<"u"?Float32Array:Array;function JC(){const n=new Yr(2);return Yr!=Float32Array&&(n[0]=0,n[1]=0),n}function S0(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function eM(n,e){return n[0]=-e[0],n[1]=-e[1],n}function M2(n,e,t,i){const s=e[0],a=e[1];return n[0]=s+i*(t[0]-s),n[1]=a+i*(t[1]-a),n}function tM(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[4]*s+t[12],n[1]=t[1]*i+t[5]*s+t[13],n}(function(){const n=JC();return function(e,t,i,s,a,l){let u,h;for(t||(t=2),i||(i=0),s?h=Math.min(s*t+i,e.length):h=e.length,u=i;u<h;u+=t)n[0]=e[u],n[1]=e[u+1],a(n,n,l),e[u]=n[0],e[u+1]=n[1];return e}})();function nM(n,e,t){const i=e[0],s=e[1],a=t[3]*i+t[7]*s||1;return n[0]=(t[0]*i+t[4]*s)/a,n[1]=(t[1]*i+t[5]*s)/a,n}function O2(n,e,t){const i=e[0],s=e[1],a=e[2],l=t[3]*i+t[7]*s+t[11]*a||1;return n[0]=(t[0]*i+t[4]*s+t[8]*a)/l,n[1]=(t[1]*i+t[5]*s+t[9]*a)/l,n[2]=(t[2]*i+t[6]*s+t[10]*a)/l,n}function iM(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[2]*s,n[1]=t[1]*i+t[3]*s,n[2]=e[2],n}function sM(){const n=new Yr(3);return Yr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function rM(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function aM(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function oM(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function lM(n,e,t){const i=e[0],s=e[1],a=e[2],l=t[0],u=t[1],h=t[2];return n[0]=s*h-a*u,n[1]=a*l-i*h,n[2]=i*u-s*l,n}function I2(n,e,t){const i=e[0],s=e[1],a=e[2];let l=t[3]*i+t[7]*s+t[11]*a+t[15];return l=l||1,n[0]=(t[0]*i+t[4]*s+t[8]*a+t[12])/l,n[1]=(t[1]*i+t[5]*s+t[9]*a+t[13])/l,n[2]=(t[2]*i+t[6]*s+t[10]*a+t[14])/l,n}function cM(n,e,t){const i=e[0],s=e[1],a=e[2];return n[0]=i*t[0]+s*t[3]+a*t[6],n[1]=i*t[1]+s*t[4]+a*t[7],n[2]=i*t[2]+s*t[5]+a*t[8],n}function uM(n,e,t){const i=t[0],s=t[1],a=t[2],l=t[3],u=e[0],h=e[1],d=e[2];let p=s*d-a*h,_=a*u-i*d,y=i*h-s*u,v=s*y-a*_,A=a*p-i*y,R=i*_-s*p;const C=l*2;return p*=C,_*=C,y*=C,v*=2,A*=2,R*=2,n[0]=u+p+v,n[1]=h+_+A,n[2]=d+y+R,n}function fM(n,e,t,i){const s=[],a=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],a[0]=s[0],a[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),a[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),n[0]=a[0]+t[0],n[1]=a[1]+t[1],n[2]=a[2]+t[2],n}function hM(n,e,t,i){const s=[],a=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],a[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),a[1]=s[1],a[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),n[0]=a[0]+t[0],n[1]=a[1]+t[1],n[2]=a[2]+t[2],n}function dM(n,e,t,i){const s=[],a=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],a[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),a[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),a[2]=s[2],n[0]=a[0]+t[0],n[1]=a[1]+t[1],n[2]=a[2]+t[2],n}function gM(n,e){const t=n[0],i=n[1],s=n[2],a=e[0],l=e[1],u=e[2],h=Math.sqrt((t*t+i*i+s*s)*(a*a+l*l+u*u)),d=h&&oM(n,e)/h;return Math.acos(Math.min(Math.max(d,-1),1))}const pM=rM;(function(){const n=sM();return function(e,t,i,s,a,l){let u,h;for(t||(t=3),i||(i=0),s?h=Math.min(s*t+i,e.length):h=e.length,u=i;u<h;u+=t)n[0]=e[u],n[1]=e[u+1],n[2]=e[u+2],a(n,n,l),e[u]=n[0],e[u+1]=n[1],e[u+2]=n[2];return e}})();const dd=[0,0,0];let sc;class Hn extends GC{static get ZERO(){return sc||(sc=new Hn(0,0,0),Object.freeze(sc)),sc}constructor(e=0,t=0,i=0){super(-0,-0,-0),arguments.length===1&&Xr(e)?this.copy(e):(_n.debug&&(nn(e),nn(t),nn(i)),this[0]=e,this[1]=t,this[2]=i)}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return _n.debug&&(nn(e.x),nn(e.y),nn(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=nn(e)}angle(e){return gM(this,e)}cross(e){return lM(this,this,e),this.check()}rotateX({radians:e,origin:t=dd}){return fM(this,this,t,e),this.check()}rotateY({radians:e,origin:t=dd}){return hM(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=dd}){return dM(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return I2(this,this,e),this.check()}transformAsVector(e){return O2(this,this,e),this.check()}transformByMatrix3(e){return cM(this,this,e),this.check()}transformByMatrix2(e){return iM(this,this,e),this.check()}transformByQuaternion(e){return uM(this,this,e),this.check()}}class mM extends C2{toString(){let e="[";if(_n.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=nn(i),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)t[s]=this[i+s];return t}setColumn(e,t){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=t[s];return this}}function _M(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function yM(n,e){if(n===e){const t=e[1],i=e[2],s=e[3],a=e[6],l=e[7],u=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=i,n[9]=a,n[11]=e[14],n[12]=s,n[13]=l,n[14]=u}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function ig(n,e){const t=e[0],i=e[1],s=e[2],a=e[3],l=e[4],u=e[5],h=e[6],d=e[7],p=e[8],_=e[9],y=e[10],v=e[11],A=e[12],R=e[13],C=e[14],z=e[15],H=t*u-i*l,M=t*h-s*l,k=t*d-a*l,L=i*h-s*u,X=i*d-a*u,ce=s*d-a*h,re=p*R-_*A,ne=p*C-y*A,he=p*z-v*A,te=_*C-y*R,me=_*z-v*R,Ae=y*z-v*C;let _e=H*Ae-M*me+k*te+L*he-X*ne+ce*re;return _e?(_e=1/_e,n[0]=(u*Ae-h*me+d*te)*_e,n[1]=(s*me-i*Ae-a*te)*_e,n[2]=(R*ce-C*X+z*L)*_e,n[3]=(y*X-_*ce-v*L)*_e,n[4]=(h*he-l*Ae-d*ne)*_e,n[5]=(t*Ae-s*he+a*ne)*_e,n[6]=(C*k-A*ce-z*M)*_e,n[7]=(p*ce-y*k+v*M)*_e,n[8]=(l*me-u*he+d*re)*_e,n[9]=(i*he-t*me-a*re)*_e,n[10]=(A*X-R*k+z*H)*_e,n[11]=(_*k-p*X-v*H)*_e,n[12]=(u*ne-l*te-h*re)*_e,n[13]=(t*te-i*ne+s*re)*_e,n[14]=(R*M-A*L-C*H)*_e,n[15]=(p*L-_*M+y*H)*_e,n):null}function bM(n){const e=n[0],t=n[1],i=n[2],s=n[3],a=n[4],l=n[5],u=n[6],h=n[7],d=n[8],p=n[9],_=n[10],y=n[11],v=n[12],A=n[13],R=n[14],C=n[15],z=e*l-t*a,H=e*u-i*a,M=t*u-i*l,k=d*A-p*v,L=d*R-_*v,X=p*R-_*A,ce=e*X-t*L+i*k,re=a*X-l*L+u*k,ne=d*M-p*H+_*z,he=v*M-A*H+R*z;return h*ce-s*re+C*ne-y*he}function Rs(n,e,t){const i=e[0],s=e[1],a=e[2],l=e[3],u=e[4],h=e[5],d=e[6],p=e[7],_=e[8],y=e[9],v=e[10],A=e[11],R=e[12],C=e[13],z=e[14],H=e[15];let M=t[0],k=t[1],L=t[2],X=t[3];return n[0]=M*i+k*u+L*_+X*R,n[1]=M*s+k*h+L*y+X*C,n[2]=M*a+k*d+L*v+X*z,n[3]=M*l+k*p+L*A+X*H,M=t[4],k=t[5],L=t[6],X=t[7],n[4]=M*i+k*u+L*_+X*R,n[5]=M*s+k*h+L*y+X*C,n[6]=M*a+k*d+L*v+X*z,n[7]=M*l+k*p+L*A+X*H,M=t[8],k=t[9],L=t[10],X=t[11],n[8]=M*i+k*u+L*_+X*R,n[9]=M*s+k*h+L*y+X*C,n[10]=M*a+k*d+L*v+X*z,n[11]=M*l+k*p+L*A+X*H,M=t[12],k=t[13],L=t[14],X=t[15],n[12]=M*i+k*u+L*_+X*R,n[13]=M*s+k*h+L*y+X*C,n[14]=M*a+k*d+L*v+X*z,n[15]=M*l+k*p+L*A+X*H,n}function zc(n,e,t){const i=t[0],s=t[1],a=t[2];let l,u,h,d,p,_,y,v,A,R,C,z;return e===n?(n[12]=e[0]*i+e[4]*s+e[8]*a+e[12],n[13]=e[1]*i+e[5]*s+e[9]*a+e[13],n[14]=e[2]*i+e[6]*s+e[10]*a+e[14],n[15]=e[3]*i+e[7]*s+e[11]*a+e[15]):(l=e[0],u=e[1],h=e[2],d=e[3],p=e[4],_=e[5],y=e[6],v=e[7],A=e[8],R=e[9],C=e[10],z=e[11],n[0]=l,n[1]=u,n[2]=h,n[3]=d,n[4]=p,n[5]=_,n[6]=y,n[7]=v,n[8]=A,n[9]=R,n[10]=C,n[11]=z,n[12]=l*i+p*s+A*a+e[12],n[13]=u*i+_*s+R*a+e[13],n[14]=h*i+y*s+C*a+e[14],n[15]=d*i+v*s+z*a+e[15]),n}function Gg(n,e,t){const i=t[0],s=t[1],a=t[2];return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*a,n[9]=e[9]*a,n[10]=e[10]*a,n[11]=e[11]*a,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function vM(n,e,t,i){let s=i[0],a=i[1],l=i[2],u=Math.sqrt(s*s+a*a+l*l),h,d,p,_,y,v,A,R,C,z,H,M,k,L,X,ce,re,ne,he,te,me,Ae,_e,Be;return u<_c?null:(u=1/u,s*=u,a*=u,l*=u,d=Math.sin(t),h=Math.cos(t),p=1-h,_=e[0],y=e[1],v=e[2],A=e[3],R=e[4],C=e[5],z=e[6],H=e[7],M=e[8],k=e[9],L=e[10],X=e[11],ce=s*s*p+h,re=a*s*p+l*d,ne=l*s*p-a*d,he=s*a*p-l*d,te=a*a*p+h,me=l*a*p+s*d,Ae=s*l*p+a*d,_e=a*l*p-s*d,Be=l*l*p+h,n[0]=_*ce+R*re+M*ne,n[1]=y*ce+C*re+k*ne,n[2]=v*ce+z*re+L*ne,n[3]=A*ce+H*re+X*ne,n[4]=_*he+R*te+M*me,n[5]=y*he+C*te+k*me,n[6]=v*he+z*te+L*me,n[7]=A*he+H*te+X*me,n[8]=_*Ae+R*_e+M*Be,n[9]=y*Ae+C*_e+k*Be,n[10]=v*Ae+z*_e+L*Be,n[11]=A*Ae+H*_e+X*Be,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function N2(n,e,t){const i=Math.sin(t),s=Math.cos(t),a=e[4],l=e[5],u=e[6],h=e[7],d=e[8],p=e[9],_=e[10],y=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=a*s+d*i,n[5]=l*s+p*i,n[6]=u*s+_*i,n[7]=h*s+y*i,n[8]=d*s-a*i,n[9]=p*s-l*i,n[10]=_*s-u*i,n[11]=y*s-h*i,n}function TM(n,e,t){const i=Math.sin(t),s=Math.cos(t),a=e[0],l=e[1],u=e[2],h=e[3],d=e[8],p=e[9],_=e[10],y=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=a*s-d*i,n[1]=l*s-p*i,n[2]=u*s-_*i,n[3]=h*s-y*i,n[8]=a*i+d*s,n[9]=l*i+p*s,n[10]=u*i+_*s,n[11]=h*i+y*s,n}function P2(n,e,t){const i=Math.sin(t),s=Math.cos(t),a=e[0],l=e[1],u=e[2],h=e[3],d=e[4],p=e[5],_=e[6],y=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=a*s+d*i,n[1]=l*s+p*i,n[2]=u*s+_*i,n[3]=h*s+y*i,n[4]=d*s-a*i,n[5]=p*s-l*i,n[6]=_*s-u*i,n[7]=y*s-h*i,n}function xM(n,e){const t=e[0],i=e[1],s=e[2],a=e[3],l=t+t,u=i+i,h=s+s,d=t*l,p=i*l,_=i*u,y=s*l,v=s*u,A=s*h,R=a*l,C=a*u,z=a*h;return n[0]=1-_-A,n[1]=p+z,n[2]=y-C,n[3]=0,n[4]=p-z,n[5]=1-d-A,n[6]=v+R,n[7]=0,n[8]=y+C,n[9]=v-R,n[10]=1-d-_,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function SM(n,e,t,i,s,a,l){const u=1/(t-e),h=1/(s-i),d=1/(a-l);return n[0]=a*2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a*2*h,n[6]=0,n[7]=0,n[8]=(t+e)*u,n[9]=(s+i)*h,n[10]=(l+a)*d,n[11]=-1,n[12]=0,n[13]=0,n[14]=l*a*2*d,n[15]=0,n}function AM(n,e,t,i,s){const a=1/Math.tan(e/2);if(n[0]=a/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0){const l=1/(i-s);n[10]=(s+i)*l,n[14]=2*s*i*l}else n[10]=-1,n[14]=-2*i;return n}const wM=AM;function EM(n,e,t,i,s,a,l){const u=1/(e-t),h=1/(i-s),d=1/(a-l);return n[0]=-2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*h,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*d,n[11]=0,n[12]=(e+t)*u,n[13]=(s+i)*h,n[14]=(l+a)*d,n[15]=1,n}const RM=EM;function CM(n,e,t,i){let s,a,l,u,h,d,p,_,y,v;const A=e[0],R=e[1],C=e[2],z=i[0],H=i[1],M=i[2],k=t[0],L=t[1],X=t[2];return Math.abs(A-k)<_c&&Math.abs(R-L)<_c&&Math.abs(C-X)<_c?_M(n):(_=A-k,y=R-L,v=C-X,s=1/Math.sqrt(_*_+y*y+v*v),_*=s,y*=s,v*=s,a=H*v-M*y,l=M*_-z*v,u=z*y-H*_,s=Math.sqrt(a*a+l*l+u*u),s?(s=1/s,a*=s,l*=s,u*=s):(a=0,l=0,u=0),h=y*u-v*l,d=v*a-_*u,p=_*l-y*a,s=Math.sqrt(h*h+d*d+p*p),s?(s=1/s,h*=s,d*=s,p*=s):(h=0,d=0,p=0),n[0]=a,n[1]=h,n[2]=_,n[3]=0,n[4]=l,n[5]=d,n[6]=y,n[7]=0,n[8]=u,n[9]=p,n[10]=v,n[11]=0,n[12]=-(a*A+l*R+u*C),n[13]=-(h*A+d*R+p*C),n[14]=-(_*A+y*R+v*C),n[15]=1,n)}function MM(){const n=new Yr(4);return Yr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function OM(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function No(n,e,t){const i=e[0],s=e[1],a=e[2],l=e[3];return n[0]=t[0]*i+t[4]*s+t[8]*a+t[12]*l,n[1]=t[1]*i+t[5]*s+t[9]*a+t[13]*l,n[2]=t[2]*i+t[6]*s+t[10]*a+t[14]*l,n[3]=t[3]*i+t[7]*s+t[11]*a+t[15]*l,n}(function(){const n=MM();return function(e,t,i,s,a,l){let u,h;for(t||(t=4),i||(i=0),s?h=Math.min(s*t+i,e.length):h=e.length,u=i;u<h;u+=t)n[0]=e[u],n[1]=e[u+1],n[2]=e[u+2],n[3]=e[u+3],a(n,n,l),e[u]=n[0],e[u+1]=n[1],e[u+2]=n[2],e[u+3]=n[3];return e}})();var sg;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(sg||(sg={}));const IM=45*Math.PI/180,NM=1,gd=.1,pd=500,PM=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class jn extends mM{static get IDENTITY(){return kM()}static get ZERO(){return DM()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return sg}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,s,a,l,u,h,d,p,_,y,v,A,R,C){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this[4]=a,this[5]=l,this[6]=u,this[7]=h,this[8]=d,this[9]=p,this[10]=_,this[11]=y,this[12]=v,this[13]=A,this[14]=R,this[15]=C,this.check()}setRowMajor(e,t,i,s,a,l,u,h,d,p,_,y,v,A,R,C){return this[0]=e,this[1]=a,this[2]=d,this[3]=v,this[4]=t,this[5]=l,this[6]=p,this[7]=A,this[8]=i,this[9]=u,this[10]=_,this[11]=R,this[12]=s,this[13]=h,this[14]=y,this[15]=C,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(PM)}fromObject(e){return this.check()}fromQuaternion(e){return xM(this,e),this.check()}frustum(e){const{left:t,right:i,bottom:s,top:a,near:l=gd,far:u=pd}=e;return u===1/0?UM(this,t,i,s,a,l):SM(this,t,i,s,a,l,u),this.check()}lookAt(e){const{eye:t,center:i=[0,0,0],up:s=[0,1,0]}=e;return CM(this,t,i,s),this.check()}ortho(e){const{left:t,right:i,bottom:s,top:a,near:l=gd,far:u=pd}=e;return RM(this,t,i,s,a,l,u),this.check()}orthographic(e){const{fovy:t=IM,aspect:i=NM,focalDistance:s=1,near:a=gd,far:l=pd}=e;A0(t);const u=t/2,h=s*Math.tan(u),d=h*i;return this.ortho({left:-d,right:d,bottom:-h,top:h,near:a,far:l})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:i=1,near:s=.1,far:a=500}=e;return A0(t),wM(this,t,i,s,a),this.check()}determinant(){return bM(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),s=1/i[0],a=1/i[1],l=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*a,e[2]=this[2]*l,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*a,e[6]=this[6]*l,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*a,e[10]=this[10]*l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),s=1/i[0],a=1/i[1],l=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*a,e[2]=this[2]*l,e[3]=this[4]*s,e[4]=this[5]*a,e[5]=this[6]*l,e[6]=this[8]*s,e[7]=this[9]*a,e[8]=this[10]*l,e}transpose(){return yM(this,this),this.check()}invert(){return ig(this,this),this.check()}multiplyLeft(e){return Rs(this,e,this),this.check()}multiplyRight(e){return Rs(this,this,e),this.check()}rotateX(e){return N2(this,this,e),this.check()}rotateY(e){return TM(this,this,e),this.check()}rotateZ(e){return P2(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return vM(this,this,e,t),this.check()}scale(e){return Gg(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return zc(this,this,e),this.check()}transform(e,t){return e.length===4?(t=No(t||[-0,-0,-0,-0],e,this),hd(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:i}=e;let s;switch(i){case 2:s=tM(t||[-0,-0],e,this);break;case 3:s=I2(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return hd(s,e.length),s}transformAsVector(e,t){let i;switch(e.length){case 2:i=nM(t||[-0,-0],e,this);break;case 3:i=O2(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return hd(i,e.length),i}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}}let rc,ac;function DM(){return rc||(rc=new jn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(rc)),rc}function kM(){return ac||(ac=new jn,Object.freeze(ac)),ac}function A0(n){if(n>Math.PI*2)throw Error("expected radians")}function UM(n,e,t,i,s,a){const l=2*a/(t-e),u=2*a/(s-i),h=(t+e)/(t-e),d=(s+i)/(s-i),p=-1,_=-1,y=-2*a;return n[0]=l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=u,n[6]=0,n[7]=0,n[8]=h,n[9]=d,n[10]=p,n[11]=_,n[12]=0,n[13]=0,n[14]=y,n[15]=0,n}function D2(n,e=[],t=0){const i=Math.fround(n),s=n-i;return e[t]=i,e[t+1]=s,e}function BM(n){return n-Math.fround(n)}function LM(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let i=0;i<4;++i){const s=t*4+i;D2(n[i*4+t],e,s*2)}return e}const FM=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,VM={name:"fp32",vs:FM},zM=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,HM={ONE:1},jM={name:"fp64arithmetic",vs:zM,defaultUniforms:HM,uniformTypes:{ONE:"f32"},fp64ify:D2,fp64LowPart:BM,fp64ifyMatrix4:LM},WM=[0,1,1,1],$M=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,XM=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,w0={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:WM},vs:$M,fs:XM,getUniforms:YM};function YM(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const i=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=i}if(n.highlightColor){const i=Array.from(n.highlightColor,s=>s/255);Number.isFinite(i[3])||(i[3]=1),t.highlightColor=i}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const E0=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,qM=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,k2=3,KM=255;var Ao;(function(n){n[n.POINT=0]="POINT",n[n.DIRECTIONAL=1]="DIRECTIONAL"})(Ao||(Ao={}));const mo={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:k2},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:Ao.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:qM,vs:E0,fs:E0,getUniforms:ZM};function ZM(n,e={}){if(n=n&&{...n},!n)return{...mo.defaultUniforms};n.lights&&(n={...n,...GM(n.lights),lights:void 0});const{ambientLight:t,pointLights:i,directionalLights:s}=n||{};if(!(t||i&&i.length>0||s&&s.length>0))return{...mo.defaultUniforms,enabled:0};const l={...mo.defaultUniforms,...e,...QM({ambientLight:t,pointLights:i,directionalLights:s})};return n.enabled!==void 0&&(l.enabled=n.enabled?1:0),l}function QM({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const i={};i.ambientLightColor=md(n);let s=0;for(const a of e){i.lightType=Ao.POINT;const l=s;i[`lightColor${l}`]=md(a),i[`lightPosition${l}`]=a.position,i[`lightAttenuation${l}`]=a.attenuation||[1,0,0],s++}for(const a of t){i.lightType=Ao.DIRECTIONAL;const l=s;i[`lightColor${l}`]=md(a),i[`lightDirection${l}`]=a.direction,s++}return s>k2&&ee.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=t.length,i.pointLightCount=e.length,i}function GM(n){var t,i;const e={pointLights:[],directionalLights:[]};for(const s of n||[])switch(s.type){case"ambient":e.ambientLight=s;break;case"directional":(t=e.directionalLights)==null||t.push(s);break;case"point":(i=e.pointLights)==null||i.push(s);break}return e}function md(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(i=>i*t/KM)}const U2=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,B2=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,L2=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,F2={props:{},name:"gouraudMaterial",vs:B2.replace("phongMaterial","gouraudMaterial"),fs:U2.replace("phongMaterial","gouraudMaterial"),source:L2.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[mo],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...F2.defaultUniforms,...e}}},V2={name:"phongMaterial",dependencies:[mo],source:L2,vs:U2,fs:B2,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...V2.defaultUniforms,...e}}},R0=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,JM={name:"layer",vs:R0,fs:R0,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},eO=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,z2="#define SMOOTH_EDGE_RADIUS 0.5",tO=`${z2}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,nO=`${z2}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,H2={name:"geometry",source:eO,vs:tO,fs:nO},iO=25;var ht;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(ht||(ht={}));var mt;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(mt||(mt={}));var Se;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(Se||(Se={}));const sO="compute",rO="auto",rg="manipulation",yc="none",ag="pan-x",og="pan-y";function aO(n){if(n.includes(yc))return yc;const e=n.includes(ag),t=n.includes(og);return e&&t?yc:e||t?e?ag:og:n.includes(rg)?rg:rO}class oO{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===sO&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return aO(e.join(" "))}}function Hc(n){return n.trim().split(/\s+/g)}function _d(n,e,t){if(n)for(const i of Hc(e))n.addEventListener(i,t,!1)}function yd(n,e,t){if(n)for(const i of Hc(e))n.removeEventListener(i,t,!1)}function C0(n){return(n.ownerDocument||n).defaultView}function lO(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function j2(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,i=0,s=0;for(;s<e;)t+=n[s].clientX,i+=n[s].clientY,s++;return{x:Math.round(t/e),y:Math.round(i/e)}}function M0(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:j2(e),deltaX:n.deltaX,deltaY:n.deltaY}}function W2(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.sqrt(t*t+i*i)}function O0(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.sqrt(t*t+i*i)}function cO(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.atan2(i,t)*180/Math.PI}function I0(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.atan2(i,t)*180/Math.PI}function $2(n,e){return n===e?mt.None:Math.abs(n)>=Math.abs(e)?n<0?mt.Left:mt.Right:e<0?mt.Up:mt.Down}function uO(n,e){const t=e.center;let i=n.offsetDelta,s=n.prevDelta;const a=n.prevInput;return(e.eventType===ht.Start||(a==null?void 0:a.eventType)===ht.End)&&(s=n.prevDelta={x:(a==null?void 0:a.deltaX)||0,y:(a==null?void 0:a.deltaY)||0},i=n.offsetDelta={x:t.x,y:t.y}),{deltaX:s.x+(t.x-i.x),deltaY:s.y+(t.y-i.y)}}function X2(n,e,t){return{x:e/n||0,y:t/n||0}}function fO(n,e){return O0(e[0],e[1])/O0(n[0],n[1])}function hO(n,e){return I0(e[1],e[0])-I0(n[1],n[0])}function dO(n,e){const t=n.lastInterval||e,i=e.timeStamp-t.timeStamp;let s,a,l,u;if(e.eventType!==ht.Cancel&&(i>iO||t.velocity===void 0)){const h=e.deltaX-t.deltaX,d=e.deltaY-t.deltaY,p=X2(i,h,d);a=p.x,l=p.y,s=Math.abs(p.x)>Math.abs(p.y)?p.x:p.y,u=$2(h,d),n.lastInterval=e}else s=t.velocity,a=t.velocityX,l=t.velocityY,u=t.direction;e.velocity=s,e.velocityX=a,e.velocityY=l,e.direction=u}function gO(n,e){const{session:t}=n,{pointers:i}=e,{length:s}=i;t.firstInput||(t.firstInput=M0(e)),s>1&&!t.firstMultiple?t.firstMultiple=M0(e):s===1&&(t.firstMultiple=!1);const{firstInput:a,firstMultiple:l}=t,u=l?l.center:a.center,h=e.center=j2(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=cO(u,h),e.distance=W2(u,h);const{deltaX:d,deltaY:p}=uO(t,e);e.deltaX=d,e.deltaY=p,e.offsetDirection=$2(e.deltaX,e.deltaY);const _=X2(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=_.x,e.overallVelocityY=_.y,e.overallVelocity=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,e.scale=l?fO(l.pointers,i):1,e.rotation=l?hO(l.pointers,i):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let y=n.element;return lO(e.srcEvent.target,y)&&(y=e.srcEvent.target),e.target=y,dO(t,e),e}function pO(n,e,t){const i=t.pointers.length,s=t.changedPointers.length,a=e&ht.Start&&i-s===0,l=e&(ht.End|ht.Cancel)&&i-s===0;t.isFirst=!!a,t.isFinal=!!l,a&&(n.session={}),t.eventType=e;const u=gO(n,t);n.emit("hammer.input",u),n.recognize(u),n.session.prevInput=u}let mO=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){pO(this.manager,e,t)}init(){_d(this.element,this.evEl,this.domHandler),_d(this.target,this.evTarget,this.domHandler),_d(C0(this.element),this.evWin,this.domHandler)}destroy(){yd(this.element,this.evEl,this.domHandler),yd(this.target,this.evTarget,this.domHandler),yd(C0(this.element),this.evWin,this.domHandler)}};const _O={pointerdown:ht.Start,pointermove:ht.Move,pointerup:ht.End,pointercancel:ht.Cancel,pointerout:ht.Cancel},yO="pointerdown",bO="pointermove pointerup pointercancel";class vO extends mO{constructor(e){super(e),this.evEl=yO,this.evWin=bO,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let i=!1;const s=_O[e.type],a=e.pointerType,l=a==="touch";let u=t.findIndex(h=>h.pointerId===e.pointerId);s&ht.Start&&(e.buttons||l)?u<0&&(t.push(e),u=t.length-1):s&(ht.End|ht.Cancel)&&(i=!0),!(u<0)&&(t[u]=e,this.callback(s,{pointers:t,changedPointers:[e],eventType:s,pointerType:a,srcEvent:e}),i&&t.splice(u,1))}}const TO=["","webkit","Moz","MS","ms","o"];function xO(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const i of TO){const s=i?i+t:e;if(s in n)return s}}const SO=1,N0=2,P0={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class AO{constructor(e,t){this.options={...P0,...t,cssProps:{...P0.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new vO(this),this.touchAction=new oO(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?N0:SO}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i;const{recognizers:s}=this;let{curRecognizer:a}=t;(!a||a&&a.state&Se.Recognized)&&(a=t.curRecognizer=null);let l=0;for(;l<s.length;)i=s[l],t.stopped!==N0&&(!a||i===a||i.canRecognizeWith(a))?i.recognize(e):i.reset(),!a&&i.state&(Se.Began|Se.Changed|Se.Ended)&&(a=t.curRecognizer=i),l++}get(e){const{recognizers:t}=this;for(let i=0;i<t.length;i++)if(t[i].options.event===e)return t[i];return null}add(e){if(Array.isArray(e)){for(const i of e)this.add(i);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const i of e)this.remove(i);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:i}=this,s=i.indexOf(t);s!==-1&&(i.splice(s,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:i}=this;for(const s of Hc(e))i[s]=i[s]||[],i[s].push(t)}off(e,t){if(!e)return;const{handlers:i}=this;for(const s of Hc(e))t?i[s]&&i[s].splice(i[s].indexOf(t),1):delete i[s]}emit(e,t){const i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;const s=t;s.type=e,s.preventDefault=function(){t.srcEvent.preventDefault()};let a=0;for(;a<i.length;)i[a](s),a++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[i,s]of Object.entries(this.options.cssProps)){const a=xO(t.style,i);e?(this.oldCssProps[a]=t.style[a],t.style[a]=s):t.style[a]=this.oldCssProps[a]||""}e||(this.oldCssProps={})}}}let wO=1;function EO(){return wO++}function D0(n){return n&Se.Cancelled?"cancel":n&Se.Ended?"end":n&Se.Changed?"move":n&Se.Began?"start":""}class Y2{constructor(e){this.options=e,this.id=EO(),this.state=Se.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const s of e)this.recognizeWith(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:i}=this;return i[t.id]||(i[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const i of e)this.dropRecognizeWith(i);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const s of e)this.requireFailure(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:i}=this;return i.indexOf(t)===-1&&(i.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const i of e)this.dropRequireFailure(i);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const i=this.requireFail.indexOf(t);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<Se.Ended&&this.manager.emit(this.options.event+D0(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Se.Ended&&this.manager.emit(this.options.event+D0(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Se.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Se.Failed|Se.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=Se.Failed;return}this.state&(Se.Recognized|Se.Cancelled|Se.Failed)&&(this.state=Se.Possible),this.state=this.process(t),this.state&(Se.Began|Se.Changed|Se.Ended|Se.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class q2 extends Y2{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:i}=e,s=t&(Se.Began|Se.Changed),a=this.attrTest(e);return s&&(i&ht.Cancel||!a)?t|Se.Cancelled:s||a?i&ht.End?t|Se.Ended:t&Se.Began?t|Se.Changed:Se.Began:Se.Failed}}class k0 extends Y2{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[rg]}process(e){const{options:t}=this,i=e.pointers.length===t.pointers,s=e.distance<t.threshold,a=e.deltaTime<t.time;if(this.reset(),e.eventType&ht.Start&&this.count===0)return this.failTimeout();if(s&&a&&i){if(e.eventType!==ht.End)return this.failTimeout();const l=this.pTime?e.timeStamp-this.pTime<t.interval:!0,u=!this.pCenter||W2(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!u||!l?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Se.Recognized,this.tryEmit(this._input)},t.interval),Se.Began):Se.Recognized}return Se.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Se.Failed},this.options.interval),Se.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Se.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const RO=["","start","move","end","cancel","up","down","left","right"];class U0 extends q2{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:mt.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&mt.Horizontal&&t.push(og),e&mt.Vertical&&t.push(ag),t}getEventNames(){return RO.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let i=!0,{distance:s}=e,{direction:a}=e;const l=e.deltaX,u=e.deltaY;return a&t.direction||(t.direction&mt.Horizontal?(a=l===0?mt.None:l<0?mt.Left:mt.Right,i=l!==this.pX,s=Math.abs(e.deltaX)):(a=u===0?mt.None:u<0?mt.Up:mt.Down,i=u!==this.pY,s=Math.abs(e.deltaY))),e.direction=a,i&&s>t.threshold&&!!(a&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Se.Began)||!(this.state&Se.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=mt[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const CO=["","start","move","end","cancel","in","out"];class MO extends q2{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[yc]}getEventNames(){return CO.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Se.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class Su{constructor(e,t,i){this.element=e,this.callback=t,this.options=i}}const OO=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",IO=OO.indexOf("firefox")!==-1,B0=4.000244140625,NO=40,PO=.25;class DO extends Su{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=s=>{if(!this.options.enable)return;let a=s.deltaY;globalThis.WheelEvent&&(IO&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(a/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(a*=NO)),a!==0&&a%B0===0&&(a=Math.floor(a/B0)),s.shiftKey&&a&&(a=a*PO),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-a,srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const L0=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class kO extends Su{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=a=>{this.handleOverEvent(a),this.handleOutEvent(a),this.handleEnterEvent(a),this.handleLeaveEvent(a),this.handleMoveEvent(a)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,L0.forEach(a=>e.addEventListener(a,this.handleEvent))}destroy(){L0.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const F0=["keydown","keyup"];class UO extends Su{constructor(e,t,i){super(e,t,{enable:!0,tabIndex:0,...i}),this.handleEvent=s=>{const a=s.target||s.srcElement;a.tagName==="INPUT"&&a.type==="text"||a.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",F0.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){F0.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class BO extends Su{constructor(e,t,i){super(e,t,i),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const V0=1,lg=2,z0=4,LO={pointerdown:V0,pointermove:lg,pointerup:z0,mousedown:V0,mousemove:lg,mouseup:z0},FO=0,VO=1,zO=2,HO=1,jO=2,WO=4;function $O(n){const e=LO[n.srcEvent.type];if(!e)return null;const{buttons:t,button:i}=n.srcEvent;let s=!1,a=!1,l=!1;return e===lg?(s=!!(t&HO),a=!!(t&WO),l=!!(t&jO)):(s=i===FO,a=i===VO,l=i===zO),{leftButton:s,middleButton:a,rightButton:l}}function XO(n,e){const t=n.center;if(!t)return null;const i=e.getBoundingClientRect(),s=i.width/e.offsetWidth||1,a=i.height/e.offsetHeight||1,l={x:(t.x-i.left-e.clientLeft)/s,y:(t.y-i.top-e.clientTop)/a};return{center:t,offsetCenter:l}}const YO={srcElement:"root",priority:0};class qO{constructor(e,t){this.handleEvent=i=>{if(this.isEmpty())return;const s=this._normalizeEvent(i);let a=i.srcEvent.target;for(;a&&a!==s.rootElement;){if(this._emit(s,a),s.handled)return;a=a.parentNode}this._emit(s,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,s=!1,a=!1){const{handlers:l,handlersByElement:u}=this,h={...YO,...i};let d=u.get(h.srcElement);d||(d=[],u.set(h.srcElement,d));const p={type:e,handler:t,srcElement:h.srcElement,priority:h.priority};s&&(p.once=!0),a&&(p.passive=!0),l.push(p),this._active=this._active||!p.passive;let _=d.length-1;for(;_>=0&&!(d[_].priority>=p.priority);)_--;d.splice(_+1,0,p)}remove(e,t){const{handlers:i,handlersByElement:s}=this;for(let a=i.length-1;a>=0;a--){const l=i[a];if(l.type===e&&l.handler===t){i.splice(a,1);const u=s.get(l.srcElement);u.splice(u.indexOf(l),1),u.length===0&&s.delete(l.srcElement)}}this._active=i.some(a=>!a.passive)}_emit(e,t){const i=this.handlersByElement.get(t);if(i){let s=!1;const a=()=>{e.handled=!0},l=()=>{e.handled=!0,s=!0},u=[];for(let h=0;h<i.length;h++){const{type:d,handler:p,once:_}=i[h];if(p({...e,type:d,stopPropagation:a,stopImmediatePropagation:l}),_&&u.push(i[h]),s)break}for(let h=0;h<u.length;h++){const{type:d,handler:p}=u[h];this.remove(d,p)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...$O(e),...XO(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function KO(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const i=t.shift(),s=t.shift()||{};e=new i(s)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class ZO{constructor(e=null,t={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new AO(e,this.options);for(const i of this.options.recognizers){const{recognizer:s,recognizeWith:a,requireFailure:l}=KO(i);this.manager.add(s),a&&s.recognizeWith(a),l&&s.requireFailure(l)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new DO(e,this._onOtherEvent,{enable:!1}),this.moveInput=new kO(e,this._onOtherEvent,{enable:!1}),this.keyInput=new UO(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new BO(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){var a,l,u,h;const{manager:i}=this;if(!i)return;const s=i.get(e);s&&(s.set({enable:t}),i.touchAction.update()),(a=this.wheelInput)==null||a.enableEventType(e,t),(l=this.moveInput)==null||l.enableEventType(e,t),(u=this.keyInput)==null||u.enableEventType(e,t),(h=this.contextmenuInput)==null||h.enableEventType(e,t)}_addEventHandler(e,t,i,s,a){if(typeof e!="string"){i=t;for(const[d,p]of Object.entries(e))this._addEventHandler(d,p,i,s,a);return}const{manager:l,events:u}=this;if(!l)return;let h=u.get(e);if(!h){const d=this._getRecognizerName(e)||e;h=new qO(this,d),u.set(e,h),l&&l.on(e,h.handleEvent)}h.add(e,t,i,s,a),h.isEmpty()||this._toggleRecognizer(h.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[a,l]of Object.entries(e))this._removeEventHandler(a,l);return}const{events:i}=this,s=i.get(e);if(s&&(s.remove(e,t),s.isEmpty())){const{recognizerName:a}=s;let l=!1;for(const u of i.values())if(u.recognizerName===a&&!u.isEmpty()){l=!0;break}l||this._toggleRecognizer(a,!1)}}_getRecognizerName(e){var t;return(t=this.manager.recognizers.find(i=>i.getEventNames().includes(e)))==null?void 0:t.options.event}}const Ie={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ie,"IDENTITY",{get:()=>(Fe.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const pn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Ji={common:0,meters:1,pixels:2},cg={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},H0={multipan:[U0,{threshold:10,direction:mt.Vertical,pointers:2}],pinch:[MO,{},null,["multipan"]],pan:[U0,{threshold:1},["pinch"],["multipan"]],dblclick:[k0,{event:"dblclick",taps:2}],click:[k0,{event:"click"},null,["dblclick"]]};function QO(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}return!1}function Po(n){let e={},t;return i=>{for(const s in i)if(!QO(i[s],e[s])){t=n(i),e=i;break}return t}}const j0=[0,0,0,0],GO=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],K2=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],JO=[0,0,0],Z2=[0,0,0],eI=Po(iI);function Q2(n,e,t=Z2){t.length<3&&(t=[t[0],t[1],0]);let i=t,s,a=!0;switch(e===Ie.LNGLAT_OFFSETS||e===Ie.METER_OFFSETS?s=t:s=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case pn.WEB_MERCATOR:(e===Ie.LNGLAT||e===Ie.CARTESIAN)&&(s=[0,0,0],a=!1);break;case pn.WEB_MERCATOR_AUTO_OFFSET:e===Ie.LNGLAT?i=s:e===Ie.CARTESIAN&&(i=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],s=n.unprojectPosition(i),i[0]-=t[0],i[1]-=t[1],i[2]-=t[2]);break;case pn.IDENTITY:i=n.position.map(Math.fround),i[2]=i[2]||0;break;case pn.GLOBE:a=!1,s=null;break;default:a=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:i,offsetMode:a}}function tI(n,e,t){const{viewMatrixUncentered:i,projectionMatrix:s}=n;let{viewMatrix:a,viewProjectionMatrix:l}=n,u=j0,h=j0,d=n.cameraPosition;const{geospatialOrigin:p,shaderCoordinateOrigin:_,offsetMode:y}=Q2(n,e,t);return y&&(h=n.projectPosition(p||_),d=[d[0]-h[0],d[1]-h[1],d[2]-h[2]],h[3]=1,u=No([],h,l),a=i||a,l=Rs([],s,a),l=Rs([],l,GO)),{viewMatrix:a,viewProjectionMatrix:l,projectionCenter:u,originCommon:h,cameraPosCommon:d,shaderCoordinateOrigin:_,geospatialOrigin:p}}function nI({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:i=Ie.DEFAULT,coordinateOrigin:s=Z2,autoWrapLongitude:a=!1}){i===Ie.DEFAULT&&(i=n.isGeospatial?Ie.LNGLAT:Ie.CARTESIAN);const l=eI({viewport:n,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return l.wrapLongitude=a,l.modelMatrix=t||K2,l}function iI({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:i}){const{projectionCenter:s,viewProjectionMatrix:a,originCommon:l,cameraPosCommon:u,shaderCoordinateOrigin:h,geospatialOrigin:d}=tI(n,t,i),p=n.getDistanceScales(),_=[n.width*e,n.height*e],y=No([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,v={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:h,commonOrigin:l.slice(0,3),center:s,pseudoMeters:!!n._pseudoMeters,viewportSize:_,devicePixelRatio:e,focalDistance:y,commonUnitsPerMeter:p.unitsPerMeter,commonUnitsPerWorldUnit:p.unitsPerMeter,commonUnitsPerWorldUnit2:JO,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:a,modelMatrix:K2,cameraPosition:u};if(d){const A=n.getDistanceScales(d);switch(t){case Ie.METER_OFFSETS:v.commonUnitsPerWorldUnit=A.unitsPerMeter,v.commonUnitsPerWorldUnit2=A.unitsPerMeter2;break;case Ie.LNGLAT:case Ie.LNGLAT_OFFSETS:n._pseudoMeters||(v.commonUnitsPerMeter=A.unitsPerMeter),v.commonUnitsPerWorldUnit=A.unitsPerDegree,v.commonUnitsPerWorldUnit2=A.unitsPerDegree2;break;case Ie.CARTESIAN:v.commonUnitsPerWorldUnit=[1,1,A.unitsPerMeter[2]],v.commonUnitsPerWorldUnit2=[0,0,A.unitsPerMeter2[2]];break}}return v}const sI=Object.keys(Ie).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${Ie[n]};`).join(""),rI=Object.keys(pn).map(n=>`const PROJECTION_MODE_${n}: i32 = ${pn[n]};`).join(""),aI=Object.keys(Ji).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${Ji[n]};`).join(""),oI=`${sI}
${rI}
${aI}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,lI=`${oI}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,cI=Object.keys(Ie).map(n=>`const int COORDINATE_SYSTEM_${n} = ${Ie[n]};`).join(""),uI=Object.keys(pn).map(n=>`const int PROJECTION_MODE_${n} = ${pn[n]};`).join(""),fI=Object.keys(Ji).map(n=>`const int UNIT_${n.toUpperCase()} = ${Ji[n]};`).join(""),hI=`${cI}
${uI}
${fI}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,dI={};function gI(n=dI){return"viewport"in n?nI(n):{}}const Jg={name:"project",dependencies:[VM,H2],source:lI,vs:hI,getUniforms:gI,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},pI=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,mI=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Do={name:"project32",dependencies:[Jg],source:pI,vs:mI};function _I(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Vr(n,e){const t=No([],e,n);return OM(t,t,1/t[3]),t}function W0(n,e){const t=n%e;return t<0?e+t:t}function ug(n,e,t){return n<e?e:n>t?t:n}function yI(n){return Math.log(n)*Math.LOG2E}const ep=Math.log2||yI;function hi(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Cn=Math.PI,G2=Cn/4,yn=Cn/180,fg=180/Cn,qr=512,jc=4003e4,$0=85.051129,bI=1.5;function vI(n){return ep(n)}function Wc(n){const[e,t]=n;hi(Number.isFinite(e)),hi(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const i=e*yn,s=t*yn,a=qr*(i+Cn)/(2*Cn),l=qr*(Cn+Math.log(Math.tan(G2+s*.5)))/(2*Cn);return[a,l]}function Kr(n){const[e,t]=n,i=e/qr*(2*Cn)-Cn,s=2*(Math.atan(Math.exp(t/qr*(2*Cn)-Cn))-G2);return[i*fg,s*fg]}function TI(n){const{latitude:e}=n;hi(Number.isFinite(e));const t=Math.cos(e*yn);return vI(jc*t)-9}function bd(n){const e=Math.cos(n*yn);return qr/jc/e}function hg(n){const{latitude:e,longitude:t,highPrecision:i=!1}=n;hi(Number.isFinite(e)&&Number.isFinite(t));const s=qr,a=Math.cos(e*yn),l=s/360,u=l/a,h=s/jc/a,d={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[l,u,h],degreesPerUnit:[1/l,1/u,1/h]};if(i){const p=yn*Math.tan(e*yn)/a,_=l*p/2,y=s/jc*p,v=y/u*h;d.unitsPerDegree2=[0,_,y],d.unitsPerMeter2=[v,0,v]}return d}function J2(n,e){const[t,i,s]=n,[a,l,u]=e,{unitsPerMeter:h,unitsPerMeter2:d}=hg({longitude:t,latitude:i,highPrecision:!0}),p=Wc(n);p[0]+=a*(h[0]+d[0]*l),p[1]+=l*(h[1]+d[1]*l);const _=Kr(p),y=(s||0)+(u||0);return Number.isFinite(s)||Number.isFinite(u)?[_[0],_[1],y]:_}function xI(n){const{height:e,pitch:t,bearing:i,altitude:s,scale:a,center:l}=n,u=_I();zc(u,u,[0,0,-s]),N2(u,u,-t*yn),P2(u,u,i*yn);const h=a/e;return Gg(u,u,[h,h,h]),l&&zc(u,u,aM([],l)),u}function SI(n){const{width:e,height:t,altitude:i,pitch:s=0,offset:a,center:l,scale:u,nearZMultiplier:h=1,farZMultiplier:d=1}=n;let{fovy:p=$c(bI)}=n;i!==void 0&&(p=$c(i));const _=p*yn,y=s*yn,v=e1(p);let A=v;l&&(A+=l[2]*u/Math.cos(y)/t);const R=_*(.5+(a?a[1]:0)/t),C=Math.sin(R)*A/Math.sin(ug(Math.PI/2-y-R,.01,Math.PI-.01)),z=Math.sin(y)*C+A,H=A*10,M=Math.min(z*d,H);return{fov:_,aspect:e/t,focalDistance:v,near:h,far:M}}function $c(n){return 2*Math.atan(.5/n)*fg}function e1(n){return .5/Math.tan(.5*n*yn)}function t1(n,e){const[t,i,s=0]=n;return hi(Number.isFinite(t)&&Number.isFinite(i)&&Number.isFinite(s)),Vr(e,[t,i,s,1])}function tp(n,e,t=0){const[i,s,a]=n;if(hi(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(a))return Vr(e,[i,s,a,1]);const l=Vr(e,[i,s,0,1]),u=Vr(e,[i,s,1,1]),h=l[2],d=u[2],p=h===d?0:((t||0)-h)/(d-h);return M2([],l,u,p)}function AI(n){const{width:e,height:t,bounds:i,minExtent:s=0,maxZoom:a=24,offset:l=[0,0]}=n,[[u,h],[d,p]]=i,_=wI(n.padding),y=Wc([u,ug(p,-85.051129,$0)]),v=Wc([d,ug(h,-85.051129,$0)]),A=[Math.max(Math.abs(v[0]-y[0]),s),Math.max(Math.abs(v[1]-y[1]),s)],R=[e-_.left-_.right-Math.abs(l[0])*2,t-_.top-_.bottom-Math.abs(l[1])*2];hi(R[0]>0&&R[1]>0);const C=R[0]/A[0],z=R[1]/A[1],H=(_.right-_.left)/2/C,M=(_.top-_.bottom)/2/z,k=[(v[0]+y[0])/2+H,(v[1]+y[1])/2+M],L=Kr(k),X=Math.min(a,ep(Math.abs(Math.min(C,z))));return hi(Number.isFinite(X)),{longitude:L[0],latitude:L[1],zoom:X}}function wI(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(hi(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const X0=Math.PI/180;function EI(n,e=0){const{width:t,height:i,unproject:s}=n,a={targetZ:e},l=s([0,i],a),u=s([t,i],a);let h,d;const p=n.fovy?.5*n.fovy*X0:Math.atan(.5/n.altitude),_=(90-n.pitch)*X0;return p>_-.01?(h=Y0(n,0,e),d=Y0(n,t,e)):(h=s([0,0],a),d=s([t,0],a)),[l,u,d,h]}function Y0(n,e,t){const{pixelUnprojectionMatrix:i}=n,s=Vr(i,[e,0,1,1]),a=Vr(i,[e,n.height,1,1]),u=(t*n.distanceScales.unitsPerMeter[2]-s[2])/(a[2]-s[2]),h=M2([],s,a,u),d=Kr(h);return d.push(t),d}const q0=512;function RI(n){const{width:e,height:t,pitch:i=0}=n;let{longitude:s,latitude:a,zoom:l,bearing:u=0}=n;(s<-180||s>180)&&(s=W0(s+180,360)-180),(u<-180||u>180)&&(u=W0(u+180,360)-180);const h=ep(t/q0);if(l<=h)l=h,a=0;else{const d=t/2/Math.pow(2,l),p=Kr([0,d])[1];if(a<p)a=p;else{const _=Kr([0,q0-d])[1];a>_&&(a=_)}}return{width:e,height:t,longitude:s,latitude:a,zoom:l,pitch:i,bearing:u}}const n1=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,CI=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,MI=`
${n1}
${CI}
`,OI=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,II=`
${n1}
${OI}
`,NI=Po(BI),PI=Po(LI),DI=[0,0,0,1],kI=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function UI(n,e){const[t,i,s]=n,a=tp([t,i,s],e);return Number.isFinite(s)?a:[a[0],a[1],0]}function BI({viewport:n,center:e}){return new jn(n.viewProjectionMatrix).invert().transform(e)}function LI({viewport:n,shadowMatrices:e}){const t=[],i=n.pixelUnprojectionMatrix,s=n.isGeospatial?void 0:1,a=[[0,0,s],[n.width,0,s],[0,n.height,s],[n.width,n.height,s],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(l=>UI(l,i));for(const l of e){const u=l.clone().translate(new Hn(n.center).negate()),h=a.map(p=>u.transform(p)),d=new jn().ortho({left:Math.min(...h.map(p=>p[0])),right:Math.max(...h.map(p=>p[0])),bottom:Math.min(...h.map(p=>p[1])),top:Math.max(...h.map(p=>p[1])),near:Math.min(...h.map(p=>-p[2])),far:Math.max(...h.map(p=>-p[2]))});t.push(d.multiplyRight(l))}return t}function FI(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const i=Jg.getUniforms(t),s=NI({viewport:t.viewport,center:i.center}),a=[],l=PI({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let h=0;h<n.shadowMatrices.length;h++){const d=l[h],p=d.clone().translate(new Hn(t.viewport.center).negate());i.coordinateSystem===Ie.LNGLAT&&i.projectionMode===pn.WEB_MERCATOR?(l[h]=p,a[h]=s):(l[h]=d.clone().multiplyRight(kI),a[h]=p.transform(s))}const u={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||DI,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let h=0;h<l.length;h++)u[`viewProjectionMatrix${h}`]=l[h],u[`projectCenter${h}`]=a[h];for(let h=0;h<2;h++)u[`shadow_uShadowMap${h}`]=n.shadowMaps&&n.shadowMaps[h]||n.dummyShadowMap;return u}const K0={name:"shadow",dependencies:[Jg],vs:MI,fs:II,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:FI,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},i1={...w0,defaultUniforms:{...w0.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},VI=[H2],zI=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],HI=[];function jI(n){const e=Cc.getDefaultShaderAssembler();for(const i of VI)e.addDefaultModule(i);const t=n==="glsl"?zI:HI;for(const i of t)e.addShaderHook(i);return e}const WI=[255,255,255],$I=1;let XI=0;class s1{constructor(e={}){this.type="ambient";const{color:t=WI}=e,{intensity:i=$I}=e;this.id=e.id||`ambient-${XI++}`,this.color=t,this.intensity=i}}const YI=[255,255,255],qI=1,KI=[0,0,-1];let ZI=0;class dg{constructor(e={}){this.type="directional";const{color:t=YI}=e,{intensity:i=qI}=e,{direction:s=KI}=e,{_shadow:a=!1}=e;this.id=e.id||`directional-${ZI++}`,this.color=t,this.intensity=i,this.type="directional",this.direction=new Hn(s).normalize().toArray(),this.shadow=a}getProjectedLight(e){return this}}class QI{constructor(e,t={id:"pass"}){const{id:i}=t;this.id=i,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class np extends QI{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,i]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,a=e.clearColor??(s?[0,0,0,0]:!1),l=s?1:!1,u=s?0:!1,h=e.colorMask??15,d={viewport:[0,0,t,i]};e.colorMask&&(d.colorMask=h),e.scissorRect&&(d.scissorRect=e.scissorRect);const p=this.device.beginRenderPass({framebuffer:e.target,parameters:d,clearColor:a,clearDepth:l,clearStencil:u});try{return this._drawLayers(p,e)}finally{p.end(),this.device.submit()}}_drawLayers(e,t){const{target:i,shaderModuleProps:s,viewports:a,views:l,onViewportActive:u,clearStack:h=!0}=t;t.pass=t.pass||"unknown",h&&(this._lastRenderIndex=-1);const d=[];for(const p of a){const _=l&&l[p.id];u==null||u(p);const y=this._getDrawLayerParams(p,t),v=p.subViewports||[p];for(const A of v){const R=this._drawLayersInViewport(e,{target:i,shaderModuleProps:s,viewport:A,view:_,pass:t.pass,layers:t.layers},y);d.push(R)}}return d}_getDrawLayerParams(e,{layers:t,pass:i,isPicking:s=!1,layerFilter:a,cullRect:l,effects:u,shaderModuleProps:h},d=!1){var A;const p=[],_=r1(this._lastRenderIndex+1),y={layer:t[0],viewport:e,isPicking:s,renderPass:i,cullRect:l},v={};for(let R=0;R<t.length;R++){const C=t[R],z=this._shouldDrawLayer(C,y,a,v),H={shouldDrawLayer:z};z&&!d&&(H.shouldDrawLayer=!0,H.layerRenderIndex=_(C,z),H.shaderModuleProps=this._getShaderModuleProps(C,u,i,h),H.layerParameters={...(A=C.context.deck)==null?void 0:A.props.parameters,...this.getLayerParameters(C,R,e)}),p[R]=H}return p}_drawLayersInViewport(e,{layers:t,shaderModuleProps:i,pass:s,target:a,viewport:l,view:u},h){const d=GI(this.device,{shaderModuleProps:i,target:a,viewport:l});if(u&&u.props.clear){const _=u.props.clear===!0?{color:!0,depth:!0}:u.props.clear;this.device.beginRenderPass({framebuffer:a,parameters:{viewport:d,scissorRect:d},clearColor:_.color?[0,0,0,0]:!1,clearDepth:_.depth?1:!1}).end()}const p={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:d});for(let _=0;_<t.length;_++){const y=t[_],v=h[_],{shouldDrawLayer:A}=v;if(A&&y.props.pickable&&p.pickableCount++,y.isComposite&&p.compositeCount++,y.isDrawable&&v.shouldDrawLayer){const{layerRenderIndex:R,shaderModuleProps:C,layerParameters:z}=v;p.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,R),C.project&&(C.project.viewport=l),y.context.renderPass=e;try{y._drawLayer({renderPass:e,shaderModuleProps:C,uniforms:{layerIndex:R},parameters:z})}catch(H){y.raiseError(H,`drawing ${y} to ${s}`)}}}return p}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,i){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let l=e.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(t))return!1;t.layer=l,l=l.parent}if(i){const u=t.layer.id;if(u in s||(s[u]=i(t)),!s[u])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,i,s){var h,d;const a=this.device.canvasContext.cssToDeviceRatio(),l=((h=e.internalState)==null?void 0:h.propsInTransition)||e.props,u={layer:l,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:a,modelMatrix:l.modelMatrix,coordinateSystem:l.coordinateSystem,coordinateOrigin:l.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const p of t)Z0(u,(d=p.getShaderModuleProps)==null?void 0:d.call(p,e,u));return Z0(u,this.getShaderModuleProps(e,t,u),s)}}function r1(n=0,e={}){const t={},i=(s,a)=>{const l=s.props._offset,u=s.id,h=s.parent&&s.parent.id;let d;if(h&&!(h in e)&&i(s.parent,!1),h in t){const p=t[h]=t[h]||r1(e[h],e);d=p(s,a),t[u]=p}else Number.isFinite(l)?(d=l+(e[h]||0),t[u]=null):d=n;return a&&d>=n&&(n=d+1),e[u]=d,d};return i}function GI(n,{shaderModuleProps:e,target:t,viewport:i}){var h;const s=((h=e==null?void 0:e.project)==null?void 0:h.devicePixelRatio)??n.canvasContext.cssToDeviceRatio(),[,a]=n.canvasContext.getDrawingBufferSize(),l=t?t.height:a,u=i;return[u.x*s,l-(u.y+u.height)*s,u.width*s,u.height*s]}function Z0(n,...e){for(const t of e)if(t)for(const i in t)n[i]?Object.assign(n[i],t[i]):n[i]=t[i];return n}class JI extends np{constructor(e,t){super(e,t);const i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),s=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],a=s.width*i,l=s.height*i,u=[1,1,1,1];(a!==t.width||l!==t.height)&&t.resize({width:a,height:l}),super.render({...e,clearColor:u,target:t,pass:"shadow"})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}}const e4={color:[255,255,255],intensity:1},Q0=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],t4=[0,0,0,200/255];class ip{constructor(e={}){this.id="lighting-effect",this.shadowColor=t4,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),i._addDefaultShaderModule(K0),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:i,onViewportActive:s,views:a}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:e,layerFilter:t,viewports:i,onViewportActive:s,views:a,shaderModuleProps:{shadow:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const i=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(l=>l.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(l=>l.getProjectedLight({layer:e})),pointLights:this.pointLights.map(l=>l.getProjectedLight({layer:e}))},a=e.props.material;return{shadow:i,lighting:s,phongMaterial:a,gouraudMaterial:a}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(K0))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const i=new jn().lookAt({eye:new Hn(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const i=new JI(e);this.shadowPasses[t]=i}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:i}=this;!e&&t.length===0&&i.length===0&&(this.ambientLight=new s1(e4),this.directionalLights.push(new dg(Q0[0]),new dg(Q0[1])))}}class n4{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:i=1,type:s,padding:a=0,copy:l=!1,initialize:u=!1,maxCount:h}){const d=s||e&&e.constructor||Float32Array,p=t*i+a;if(ArrayBuffer.isView(e)){if(p<=e.length)return e;if(p*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new d(e.buffer,0,p)}let _=1/0;h&&(_=h*i+a);const y=this._allocate(d,p,u,_);return e&&l?y.set(e):u||y.fill(0,0,4),this._release(e),y}release(e){this._release(e)}_allocate(e,t,i,s){let a=Math.max(Math.ceil(t*this.opts.overAlloc),1);a>s&&(a=s);const l=this._pool,u=e.BYTES_PER_ELEMENT*a,h=l.findIndex(d=>d.byteLength>=u);if(h>=0){const d=new e(l.splice(h,1)[0],0,a);return i&&d.fill(0),d}return new e(a)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:i}=e,{byteLength:s}=i,a=t.findIndex(l=>l.byteLength>=s);a<0?t.push(i):(a>0||t.length<this.opts.poolSize)&&t.splice(a,0,i),t.length>this.opts.poolSize&&t.shift()}}const wo=new n4;function lo(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function i4(n){return[n[12],n[13],n[14]]}function s4(n){return{left:Mr(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:Mr(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:Mr(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:Mr(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:Mr(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:Mr(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const G0=new Hn;function Mr(n,e,t,i){G0.set(n,e,t);const s=G0.len();return{distance:i/s,normal:new Hn(-n/s,-e/s,-t/s)}}function r4(n){return n-Math.fround(n)}let io;function vd(n,e){const{size:t=1,startIndex:i=0}=e,s=e.endIndex!==void 0?e.endIndex:n.length,a=(s-i)/t;io=wo.allocate(io,a,{type:Float32Array,size:t*2});let l=i,u=0;for(;l<s;){for(let h=0;h<t;h++){const d=n[l++];io[u+h]=d,io[u+h+t]=r4(d)}u+=t*2}return io.subarray(0,a*t*2)}function a4(n){let e=null,t=!1;for(const i of n)i&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const o4=Math.PI/180,l4=lo(),J0=[0,0,0],c4={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function u4({width:n,height:e,orthographic:t,fovyRadians:i,focalDistance:s,padding:a,near:l,far:u}){const h=n/e,d=t?new jn().orthographic({fovy:i,aspect:h,focalDistance:s,near:l,far:u}):new jn().perspective({fovy:i,aspect:h,near:l,far:u});if(a){const{left:p=0,right:_=0,top:y=0,bottom:v=0}=a,A=Yi((p+n-_)/2,0,n)-n/2,R=Yi((y+e-v)/2,0,e)-e/2;d[8]-=A*2/n,d[9]+=R*2/e}return d}class ta{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||c4,this.focalDistance=e.focalDistance||1,this.position=e.position||J0,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?pn.WEB_MERCATOR:pn.WEB_MERCATOR_AUTO_OFFSET:pn.IDENTITY}equals(e){return e instanceof ta?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&So(e.projectionMatrix,this.projectionMatrix)&&So(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const i=this.projectPosition(e),s=t1(i,this.pixelProjectionMatrix),[a,l]=s,u=t?l:this.height-l;return e.length===2?[a,u]:[a,u,s[2]]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[s,a,l]=e,u=t?a:this.height-a,h=i&&i*this.distanceScales.unitsPerMeter[2],d=tp([s,u,l],this.pixelUnprojectionMatrix,h),[p,_,y]=this.unprojectPosition(d);return Number.isFinite(l)?[p,_,y]:Number.isFinite(i)?[p,_,i]:[p,_]}projectPosition(e){const[t,i]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,i,s]}unprojectPosition(e){const[t,i]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,i,s]}projectFlat(e){if(this.isGeospatial){const t=Wc(e);return t[1]=Yi(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Kr(e):e}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,0],t),s=this.unproject([this.width,0],t),a=this.unproject([0,this.height],t),l=this.unproject([this.width,this.height],t);return[Math.min(i[0],s[0],a[0],l[0]),Math.min(i[1],s[1],a[1],l[1]),Math.max(i[0],s[0],a[0],l[0]),Math.max(i[1],s[1],a[1],l[1])]}getDistanceScales(e){return e&&this.isGeospatial?hg({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:i=1,height:s=1}){return e<this.x+this.width&&this.x<e+i&&t<this.y+this.height&&this.y<t+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,s4(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=TI({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||hg({latitude:i,longitude:t}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:a,modelMatrix:l}=e;let u=J0;if(a&&(u=l?new jn(l).transformAsVector(a,[]):a),this.isGeospatial){const h=this.projectPosition([t,i,0]);this.center=new Hn(u).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(u)}_initMatrices(e){const{viewMatrix:t=l4,projectionMatrix:i=null,orthographic:s=!1,fovyRadians:a,fovy:l=75,near:u=.1,far:h=1e3,padding:d=null,focalDistance:p=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new jn().multiplyRight(t).translate(new Hn(this.center).negate()),this.projectionMatrix=i||u4({width:this.width,height:this.height,orthographic:s,fovyRadians:a||l*o4,focalDistance:p,padding:d,near:u,far:h});const _=lo();Rs(_,_,this.projectionMatrix),Rs(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=ig([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=i4(this.viewMatrixInverse);const y=lo(),v=lo();Gg(y,y,[this.width/2,-this.height/2,1]),zc(y,y,[1,-1,0]),Rs(v,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=ig(lo(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Fe.warn("Pixel project matrix not invertible")()}}ta.displayName="Viewport";class Zr extends ta{constructor(e={}){const{latitude:t=0,longitude:i=0,zoom:s=0,pitch:a=0,bearing:l=0,nearZMultiplier:u=.1,farZMultiplier:h=1.01,nearZ:d,farZ:p,orthographic:_=!1,projectionMatrix:y,repeat:v=!1,worldOffset:A=0,position:R,padding:C,legacyMeterSizes:z=!1}=e;let{width:H,height:M,altitude:k=1.5}=e;const L=Math.pow(2,s);H=H||1,M=M||1;let X,ce=null;if(y)k=y[5]/2,X=$c(k);else{e.fovy?(X=e.fovy,k=e1(X)):X=$c(k);let ne;if(C){const{top:he=0,bottom:te=0}=C;ne=[0,Yi((he+M-te)/2,0,M)-M/2]}ce=SI({width:H,height:M,scale:L,center:R&&[0,0,R[2]*bd(t)],offset:ne,pitch:a,fovy:X,nearZMultiplier:u,farZMultiplier:h}),Number.isFinite(d)&&(ce.near=d),Number.isFinite(p)&&(ce.far=p)}let re=xI({height:M,pitch:a,bearing:l,scale:L,altitude:k});A&&(re=new jn().translate([512*A,0,0]).multiplyLeft(re)),super({...e,width:H,height:M,viewMatrix:re,longitude:i,latitude:t,zoom:s,...ce,fovy:X,focalDistance:k}),this.latitude=t,this.longitude=i,this.zoom=s,this.pitch=a,this.bearing=l,this.altitude=k,this.fovy=X,this.orthographic=_,this._subViewports=v?[]:null,this._pseudoMeters=z,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let s=t;s<=i;s++){const a=s?new Zr({...this,worldOffset:s}):this;this._subViewports.push(a)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,i]=this.projectFlat(e),s=(e[2]||0)*bd(e[1]);return[t,i,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,i]=this.unprojectFlat(e),s=(e[2]||0)/bd(i);return[t,i,s]}addMetersToLngLat(e,t){return J2(e,t)}panByPosition(e,t){const i=tp(t,this.pixelUnprojectionMatrix),s=this.projectFlat(e),a=S0([],s,eM([],i)),l=S0([],this.center,a),[u,h]=this.unprojectFlat(l);return{longitude:u,latitude:h}}getBounds(e={}){const t=EI(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:i,height:s}=this,{longitude:a,latitude:l,zoom:u}=AI({width:i,height:s,bounds:e,...t});return new Zr({width:i,height:s,longitude:a,latitude:l,zoom:u})}}Zr.displayName="WebMercatorViewport";const ev=[0,0,0];function Td(n,e,t=!1){const i=e.projectPosition(n);if(t&&e instanceof Zr){const[s,a,l=0]=n,u=e.getDistanceScales([s,a]);i[2]=l*u.unitsPerMeter[2]}return i}function f4(n){const{viewport:e,modelMatrix:t,coordinateOrigin:i}=n;let{coordinateSystem:s,fromCoordinateSystem:a,fromCoordinateOrigin:l}=n;return s===Ie.DEFAULT&&(s=e.isGeospatial?Ie.LNGLAT:Ie.CARTESIAN),a===void 0&&(a=s),l===void 0&&(l=i),{viewport:e,coordinateSystem:s,coordinateOrigin:i,modelMatrix:t,fromCoordinateSystem:a,fromCoordinateOrigin:l}}function a1(n,{viewport:e,modelMatrix:t,coordinateSystem:i,coordinateOrigin:s,offsetMode:a}){let[l,u,h=0]=n;switch(t&&([l,u,h]=No([],[l,u,h,1],t)),i){case Ie.LNGLAT:return Td([l,u,h],e,a);case Ie.LNGLAT_OFFSETS:return Td([l+s[0],u+s[1],h+(s[2]||0)],e,a);case Ie.METER_OFFSETS:return Td(J2(s,[l,u,h]),e,a);case Ie.CARTESIAN:default:return e.isGeospatial?[l+s[0],u+s[1],h+s[2]]:e.projectPosition([l,u,h])}}function o1(n,e){const{viewport:t,coordinateSystem:i,coordinateOrigin:s,modelMatrix:a,fromCoordinateSystem:l,fromCoordinateOrigin:u}=f4(e),{autoOffset:h=!0}=e,{geospatialOrigin:d=ev,shaderCoordinateOrigin:p=ev,offsetMode:_=!1}=h?Q2(t,i,s):{},y=a1(n,{viewport:t,modelMatrix:a,coordinateSystem:l,coordinateOrigin:u,offsetMode:_});if(_){const v=t.projectPosition(d||p);pM(y,y,v)}return y}const h4=[255,255,255],d4=1,g4=[1,0,0],p4=[0,0,1];let m4=0;class sp{constructor(e={}){this.type="point";const{color:t=h4}=e,{intensity:i=d4}=e,{position:s=p4}=e;this.id=e.id||`point-${m4++}`,this.color=t,this.intensity=i,this.type="point",this.position=s,this.attenuation=_4(e),this.projectedLight={...this}}getProjectedLight({layer:e}){const{projectedLight:t}=this,i=e.context.viewport,{coordinateSystem:s,coordinateOrigin:a}=e.props,l=o1(this.position,{viewport:i,coordinateSystem:s,coordinateOrigin:a,fromCoordinateSystem:i.isGeospatial?Ie.LNGLAT:Ie.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return t.color=this.color,t.intensity=this.intensity,t.position=l,t}}function _4(n){return n.attenuation?n.attenuation:g4}let y4=1,b4=1;class l1{constructor(){T(this,"time",0);T(this,"channels",new Map);T(this,"animations",new Map);T(this,"playing",!1);T(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:a=1}=e,l=y4++,u={time:0,delay:t,duration:i,rate:s,repeat:a};return this._setChannelTime(u,this.time),this.channels.set(l,u),l}removeChannel(e){this.channels.delete(e);for(const[t,i]of this.animations)i.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const s of t)this._setChannelTime(s,this.time);const i=this.animations.values();for(const s of i){const{animation:a,channel:l}=s;a.setTime(this.getTime(l))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const i=b4++;return this.animations.set(i,{animation:e,channel:t}),e.setTime(this.getTime(t)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const i=t-e.delay,s=e.duration*e.repeat;i>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}function v4(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function T4(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let x4=0;const S4={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:Yd.stats.get(`animation-loop-${x4++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class A4{constructor(e){T(this,"device",null);T(this,"canvas",null);T(this,"props");T(this,"animationProps",null);T(this,"timeline",null);T(this,"stats");T(this,"cpuTime");T(this,"gpuTime");T(this,"frameRate");T(this,"display");T(this,"needsRedraw","initialized");T(this,"_initialized",!1);T(this,"_running",!1);T(this,"_animationFrameId",null);T(this,"_nextFramePromise",null);T(this,"_resolveNextFrame",null);T(this,"_cpuStartTime",0);T(this,"_error",null);if(this.props={...S4,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new vu({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var i,s;if(this.props.onError(e),this._error=Error(),((s=(i=this.device)==null?void 0:i.canvasContext)==null?void 0:s.canvas)instanceof HTMLCanvasElement){const a=document.createElement("h1");a.innerHTML=e.message,a.style.position="absolute",a.style.top="20%",a.style.left="10px",a.style.color="black",a.style.backgroundColor="red",document.body.appendChild(a)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=v4(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(T4(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var t;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(t=this.device)==null||t.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var t,i;const e=(i=(t=this.device)==null?void 0:t.canvasContext)==null?void 0:i.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const i=this.props.onAddHTML(t);i&&(t.innerHTML=i)}}_getSizeAndAspect(){var a,l,u,h;if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=((l=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:l.getPixelSize())||[1,1];let i=1;const s=(h=(u=this.device)==null?void 0:u.canvasContext)==null?void 0:h.canvas;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:e>0&&t>0&&(i=e/t),{width:e,height:t,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,t;this.props.autoResizeDrawingBuffer&&((t=(e=this.device)==null?void 0:e.canvasContext)==null||t.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const xd={};function Au(n="id"){xd[n]=xd[n]||1;const e=xd[n]++;return`${n}-${e}`}class tv{constructor(e){T(this,"id");T(this,"userData",{});T(this,"topology");T(this,"bufferLayout",[]);T(this,"vertexCount");T(this,"indices");T(this,"attributes");if(this.id=e.id||Au("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Qe.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function w4(n,e){if(e instanceof tv)return e;const t=E4(n,e),{attributes:i,bufferLayout:s}=R4(n,e);return new tv({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:t,attributes:i})}function E4(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:Qe.INDEX,data:t})}function R4(n,e){const t=[],i={};for(const[a,l]of Object.entries(e.attributes)){let u=a;switch(a){case"POSITION":u="positions";break;case"NORMAL":u="normals";break;case"TEXCOORD_0":u="texCoords";break;case"COLOR_0":u="colors";break}if(l){i[u]=n.createBuffer({data:l.value,id:`${a}-buffer`});const{value:h,size:d,normalized:p}=l;t.push({name:u,format:gC(h,d,p)})}}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:t,vertexCount:s}}const mu=class mu{constructor(e){T(this,"device");T(this,"destroyPolicy");T(this,"_hashCounter",0);T(this,"_hashes",{});T(this,"_renderPipelineCache",{});T(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new mu(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...Wr.defaultProps,...e},i=this._hashRenderPipeline(t);if(!this._renderPipelineCache[i]){const s=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=i,this._renderPipelineCache[i]={pipeline:s,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){const t={...Pc.defaultProps,...e},i=this._hashComputePipeline(t);if(!this._computePipelineCache[i]){const s=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=i,this._computePipelineCache[i]={pipeline:s,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){const t=e.hash,i=e instanceof Pc?this._computePipelineCache:this._renderPipelineCache;i[t].useCount--,i[t].useCount===0&&this.destroyPolicy==="unused"&&(i[t].pipeline.destroy(),delete i[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,s="-",a=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${i}V${s}BL${a}`;default:const l=this._getHash(JSON.stringify(e.parameters));return`${t}/${i}V${s}T${e.topology}P${l}BL${a}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};T(mu,"defaultProps",{...Wr.defaultProps});let gg=mu;const _u=class _u{constructor(e){T(this,"device");T(this,"destroyPolicy");T(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new _u(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let i=this._cache[t];if(!i){const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=i={shader:s,useCount:0}}return i.useCount++,i.shader}release(e){const t=this._hashShader(e),i=this._cache[t];i&&(i.useCount--,i.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};T(_u,"defaultProps",{...Oc.defaultProps});let pg=_u;function C4(n,e){var s;const t={},i="Values";if(n.attributes.length===0&&!((s=n.varyings)!=null&&s.length))return{"No attributes or varyings":{[i]:"N/A"}};for(const a of n.attributes)if(a){const l=`${a.location} ${a.name}: ${a.type}`;t[`in ${l}`]={[i]:a.stepMode||"vertex"}}for(const a of n.varyings||[]){const l=`${a.location} ${a.name}`;t[`out ${l}`]={[i]:JSON.stringify(a)}}return t}let xt=null,vs=null;function M4(n,{id:e,minimap:t,opaque:i,top:s="0",left:a="0",rgbaScale:l=1}){xt||(xt=document.createElement("canvas"),xt.id=e,xt.title=e,xt.style.zIndex="100",xt.style.position="absolute",xt.style.top=s,xt.style.left=a,xt.style.border="blue 5px solid",xt.style.transform="scaleY(-1)",document.body.appendChild(xt),vs=xt.getContext("2d")),(xt.width!==n.width||xt.height!==n.height)&&(xt.width=n.width/2,xt.height=n.height/2,xt.style.width="400px",xt.style.height="400px");const u=n.device.readPixelsToArrayWebGL(n),h=vs==null?void 0:vs.createImageData(n.width,n.height);if(h){for(let p=0;p<u.length;p+=4)h.data[0+p+0]=u[p+0]*l,h.data[0+p+1]=u[p+1]*l,h.data[0+p+2]=u[p+2]*l,h.data[0+p+3]=i?255:u[p+3]*l;vs==null||vs.putImageData(h,0,0)}}function mg(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!mg(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),s=Object.keys(e);if(i.length!==s.length)return!1;for(const a of i)if(!e.hasOwnProperty(a)||!mg(n[a],e[a],t-1))return!1;return!0}return!1}function O4(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function I4(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function c1(n){return O4(n)||I4(n)}function N4(n){return c1(n)||typeof n=="number"||typeof n=="boolean"}function u1(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const i=n[t];N4(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}class P4{constructor(e,t){T(this,"options",{disableWarnings:!1});T(this,"modules");T(this,"moduleUniforms");T(this,"moduleBindings");Object.assign(this.options,t);const i=Hg(Object.values(e).filter(s=>s.dependencies));for(const s of i)e[s.name]=s;ee.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[s,a]of Object.entries(e))this._addModule(a),a.name&&s!==a.name&&!this.options.disableWarnings&&ee.warn(`Module name: ${s} vs ${a.name}`)()}destroy(){}setProps(e){var t;for(const i of Object.keys(e)){const s=i,a=e[s]||{},l=this.modules[s];if(!l){this.options.disableWarnings||ee.warn(`Module ${i} not found`)();continue}const u=this.moduleUniforms[s],h=this.moduleBindings[s],d=((t=l.getUniforms)==null?void 0:t.call(l,a,u))||a,{uniforms:p,bindings:_}=u1(d);this.moduleUniforms[s]={...u,...p},this.moduleBindings[s]={...h,..._}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){var t;const e={};for(const[i,s]of Object.entries(this.moduleUniforms))for(const[a,l]of Object.entries(s))e[`${i}.${a}`]={type:(t=this.modules[i].uniformTypes)==null?void 0:t[a],value:String(l)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let D4="";async function k4(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:D4+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class Sd{constructor(e,t){T(this,"device");T(this,"id");T(this,"texture");T(this,"sampler");T(this,"view");T(this,"ready");T(this,"isReady",!1);T(this,"destroyed",!1);T(this,"resolveReady",()=>{});T(this,"rejectReady",()=>{});this.device=e,this.id=t.id||Au("async-texture"),typeof(t==null?void 0:t.data)=="string"&&t.dimension==="2d"&&(t={...t,data:k4(t.data)}),this.ready=new Promise((i,s)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=s}),this.initAsync(t)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const t=e.data;let i;try{i=await f1(t)}catch(a){this.rejectReady(a)}if(this.destroyed)return;const s={...e,data:i};this.texture=this.device.createTexture(s),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function f1(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(f1));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),i=Object.keys(e),s={};for(let a=0;a<i.length;a++)s[i[a]]=t[a];return s}return n}const Ts=2,U4=1e4,yu=class yu{constructor(e,t){T(this,"device");T(this,"id");T(this,"source");T(this,"vs");T(this,"fs");T(this,"pipelineFactory");T(this,"shaderFactory");T(this,"userData",{});T(this,"parameters");T(this,"topology");T(this,"bufferLayout");T(this,"isInstanced");T(this,"instanceCount",0);T(this,"vertexCount");T(this,"indexBuffer",null);T(this,"bufferAttributes",{});T(this,"constantAttributes",{});T(this,"bindings",{});T(this,"uniforms",{});T(this,"vertexArray");T(this,"transformFeedback",null);T(this,"pipeline");T(this,"shaderInputs");T(this,"_uniformStore");T(this,"_attributeInfos",{});T(this,"_gpuGeometry",null);T(this,"_getModuleUniforms");T(this,"props");T(this,"_pipelineNeedsUpdate","newly created");T(this,"_needsRedraw","initializing");T(this,"_destroyed",!1);T(this,"_lastDrawTimestamp",-1);T(this,"_lastLogTime",0);T(this,"_logOpen",!1);T(this,"_drawCount",0);var h,d,p,_;this.props={...yu.defaultProps,...t},t=this.props,this.id=t.id||Au("model"),this.device=e,Object.assign(this.userData,t.userData);const i=Object.fromEntries(((h=this.props.modules)==null?void 0:h.map(y=>[y.name,y]))||[]),s=t.shaderInputs||new P4(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);const a=L4(e),l=(((d=this.props.modules)==null?void 0:d.length)>0?this.props.modules:(p=this.shaderInputs)==null?void 0:p.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:y,getUniforms:v}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:a,...this.props,modules:l});this.source=y,this._getModuleUniforms=v,(_=this.props).shaderLayout||(_.shaderLayout=WC(this.source))}else{const{vs:y,fs:v,getUniforms:A}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:a,...this.props,modules:l});this.vs=y,this.fs=v,this._getModuleUniforms=A}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||gg.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||pg.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return ee.info(Ts,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings}),_g(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:a}=this.vertexArray,l=a?a.byteLength/(a.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:l,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){var i;(i=this._gpuGeometry)==null||i.destroy();const t=e&&w4(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const s=new ld(this.bufferLayout);this.bufferLayout=s.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new ld(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){mg(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new dC(this.shaderInputs.modules);for(const[t,i]of Object.entries(this.shaderInputs.modules))if(B4(i)){const s=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const i=(t==null?void 0:t.disableWarnings)??this.props.disableWarnings;e.indices&&ee.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=pC(this.pipeline.shaderLayout,this.bufferLayout);const s=new ld(this.bufferLayout);for(const[a,l]of Object.entries(e)){const u=s.getBufferLayout(a);if(!u){i||ee.warn(`Model(${this.id}): Missing layout for buffer "${a}".`)();continue}const h=s.getAttributeNamesForBuffer(u);let d=!1;for(const p of h){const _=this._attributeInfos[p];if(_){const y=this.device.type==="webgpu"?s.getBufferIndex(_.bufferName):_.location;this.vertexArray.setBuffer(y,l),d=!0}}!d&&!i&&ee.warn(`Model(${this.id}): Ignoring buffer "${l.id}" for unknown attribute "${a}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[i,s]of Object.entries(e)){const a=this._attributeInfos[i];a?this.vertexArray.setConstantWebGL(a.location,s):((t==null?void 0:t.disableWarnings)??this.props.disableWarnings)||ee.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){_g(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:i}=u1(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Sd&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,i]of Object.entries(this.bindings))i instanceof Sd?i.isReady&&(e[t]=i.texture):e[t]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Mc?e=Math.max(e,t.texture.updateTimestamp):t instanceof Qe||t instanceof st?e=Math.max(e,t.updateTimestamp):t instanceof Sd?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof Ic||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[i]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(s=>s.name===i)&&i!=="positions"&&delete t[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(ee.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=i:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:s}),this._attributeInfos=i2(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=ee.level>3?0:U4;ee.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,ee.group(Ts,`>>> DRAWING MODEL ${this.id}`,{collapsed:ee.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=C4(this.pipeline.shaderLayout,this.id);ee.table(Ts,e)();const t=this.shaderInputs.getDebugTable();for(const[s,a]of Object.entries(this.uniforms))t[s]={value:a};ee.table(Ts,t)();const i=this._getAttributeDebugTable();ee.table(Ts,this._attributeInfos)(),ee.table(Ts,i)(),ee.groupEnd(Ts)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const i=e.props.framebuffer;i&&M4(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,i]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[i.location];e[i.location]={name:t,type:i.shaderType,values:s?this._getBufferOrConstantValues(s,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,i=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,t){const i=a2(t);return(e instanceof Qe?new i(e.debugData):e).toString()}};T(yu,"defaultProps",{...Wr.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Cc.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Wn=yu;function B4(n){return!!(n.uniformTypes&&!_g(n.uniformTypes))}function L4(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function _g(n){for(const e in n)return!1;return!0}const To=class To{constructor(e,t=To.defaultProps){T(this,"device");T(this,"model");T(this,"transformFeedback");if(!To.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Wn(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||K3(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var t;return((t=e==null?void 0:e.info)==null?void 0:t.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Qe)return t.readAsync();const{buffer:i,byteOffset:s=0,byteLength:a=i.byteLength}=t;return i.readAsync(s,a)}};T(To,"defaultProps",{...Wn.defaultProps,outputs:void 0,feedbackBuffers:void 0});let Qr=To;const F4="transform_output";class nv{constructor(e,t){T(this,"device");T(this,"model");T(this,"sampler");T(this,"currentIndex",0);T(this,"samplerTextureMap",null);T(this,"bindings",[]);T(this,"resources",{});this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Wn(this.device,{id:t.id||"texture-transform-model",fs:t.fs||K3({input:t.targetTextureVarying,inputChannels:t.targetTextureChannels,output:F4}),vertexCount:t.vertexCount,...t}),this._initialize(t),Object.seal(this)}destroy(){var e;this.model.destroy();for(const t of this.bindings)(e=t.framebuffer)==null||e.destroy()}delete(){this.destroy()}run(e){const{framebuffer:t}=this.bindings[this.currentIndex],i=this.device.beginRenderPass({framebuffer:t,...e});this.model.draw(i),i.end()}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:t,sourceTextures:i,targetTexture:s}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,t),s){e.targetTexture=s;const{width:a,height:l}=s;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:a,height:l,colorAttachments:[s]}),e.framebuffer.resize({width:a,height:l})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const i in t)t[i].sampler=this.sampler}}class h1{constructor(e){T(this,"id");T(this,"topology");T(this,"vertexCount");T(this,"indices");T(this,"attributes");T(this,"userData",{});const{attributes:t={},indices:i=null,vertexCount:s=null}=e;this.id=e.id||Au("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[a,l]of Object.entries(t)){const u=ArrayBuffer.isView(l)?{value:l}:l;if(!ArrayBuffer.isView(u.value))throw new Error(`${this._print(a)}: must be typed array or object with value as typed array`);if((a==="POSITION"||a==="positions")&&!u.size&&(u.size=3),a==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=u}else this.attributes[a]=u}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let i=1/0;for(const s of Object.values(e)){const{value:a,size:l,constant:u}=s;!u&&a&&l!==void 0&&l>=1&&(i=Math.min(i,a.length/l))}return i}}const V4={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class d1 extends np{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:a,pickingFBO:l,deviceRect:{x:u,y:h,width:d,height:p},cullRect:_,effects:y,pass:v="picking",pickZ:A,shaderModuleProps:R}){this.pickZ=A;const C=this._resetColorEncoder(A),z=[u,h,d,p],H=super.render({target:l,layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:a,cullRect:_,effects:y==null?void 0:y.filter(k=>k.useInPicking),pass:v,isPicking:!0,shaderModuleProps:R,clearColor:[0,0,0,0],colorMask:15,scissorRect:z});return this._colorEncoderState=null,{decodePickingColor:C&&H4.bind(null,C),stats:H}}shouldDrawLayer(e){const{pickable:t,operation:i}=e.props;return t&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,t,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,i){const s={...e.props.parameters},{pickable:a,operation:l}=e.props;return!this._colorEncoderState||l.includes("terrain")?s.blend=!1:a&&l.includes("draw")&&(Object.assign(s,V4),s.blend=!0,s.blendColor=z4(this._colorEncoderState,e,i)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function z4(n,e,t){const{byLayer:i,byAlpha:s}=n;let a,l=i.get(e);return l?(l.viewports.push(t),a=l.a):(a=i.size+1,a<=255?(l={a,layer:e,viewports:[t]},i.set(e,l),s[a]=l):(Fe.warn("Too many pickable layers, only picking the first 255")(),a=0)),[0,0,0,a/255]}function H4(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const Nr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Xc=Symbol.for("component"),Qi=Symbol.for("propTypes"),Ad=Symbol.for("deprecatedProps"),zr=Symbol.for("asyncPropDefaults"),Ps=Symbol.for("asyncPropOriginal"),qi=Symbol.for("asyncPropResolved");function rp(n,e=()=>!0){return Array.isArray(n)?g1(n,e,[]):e(n)?[n]:[]}function g1(n,e,t){let i=-1;for(;++i<n.length;){const s=n[i];Array.isArray(s)?g1(s,e,t):e(s)&&t.push(s)}return t}function j4({target:n,source:e,start:t=0,count:i=1}){const s=e.length,a=i*s;let l=0;for(let u=t;l<s;l++)n[u++]=e[l];for(;l<a;)l<a-l?(n.copyWithin(t+l,t,t+l),l*=2):(n.copyWithin(t+l,t,t+a-l),l=a);return n}class W4{constructor(e,t,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const i=++this._loadCount;let s=e;typeof e=="string"&&(s=Vd(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(a=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=a)}).catch(a=>{this._loadCount===i&&(this.isLoaded=!0,this._error=a||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const a of this._subscribers)a.onChange(this.getData())}}class $4{constructor(e){var t;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(t=e.device)==null?void 0:t.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:i=!1,persistent:s=!0}){let a=this._resources[e];a?a.setData(t,i):(a=new W4(e,t,this._context),this._resources[e]=a),a.persistent=s}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const i in t){const s=t[i],a=this._resources[s.resourceId];a&&a.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:i,requestId:s="default"}){const{_resources:a,protocol:l}=this;e.startsWith(l)&&(e=e.replace(l,""),a[e]||this.add({resourceId:e,data:null,persistent:!1}));const u=a[e];if(this._track(i,s,u,t),u)return u.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,i,s){const a=this._consumers,l=a[e]=a[e]||{};let u=l[t];const h=u&&u.resourceId&&this._resources[u.resourceId];h&&(h.unsubscribe(u),this.prune()),i&&(u?(u.onChange=s,u.resourceId=i.id):u={onChange:s,resourceId:i.id},l[t]=u,i.subscribe(u))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const X4="layerManager.setLayers",Y4="layerManager.activateViewport";class q4{constructor(e,t){var u;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=h=>{Dt(Y4,this,h),h&&(this.context.viewport=h)};const{deck:i,stats:s,viewport:a,timeline:l}=t||{};this.layers=[],this.resourceManager=new $4({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:i,shaderAssembler:jI(((u=e==null?void 0:e.info)==null?void 0:u.shadingLanguage)||"glsl"),defaultShaderModules:[JM],renderPass:void 0,stats:s||new vu({id:"deck.gl"}),viewport:a||new ta({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:l||new l1,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const s=i.getNeedsRedraw(e);t=t||s}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(i=>t.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Dt(X4,this,t,e),this._lastRenderedLayers=e;const i=rp(e,Boolean);for(const s of i)s.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(i=>i.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,i=t.findIndex(s=>s.name===e.name);i>=0&&(t.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,i){i.raiseError(t,`${e} of ${i}`)}_updateLayers(e,t){const i={};for(const l of e)i[l.id]?Fe.warn(`Multiple old layers with same id ${l.id}`)():i[l.id]=l;if(this._defaultShaderModulesChanged){for(const l of e)l.setNeedsUpdate(),l.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(t,i,s),this._finalizeOldLayers(i);let a=!1;for(const l of s)if(l.hasUniformTransition()){a=`Uniform transition in ${l}`;break}this._needsUpdate=a,this.layers=s}_updateSublayersRecursively(e,t,i){for(const s of e){s.context=this.context;const a=t[s.id];a===null&&Fe.warn(`Multiple new layers with same id ${s.id}`)(),t[s.id]=null;let l=null;try{this._debug&&a!==s&&s.validateProps(),a?(this._transferLayerState(a,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),l=s.isComposite?s.getSubLayers():null}catch(u){this._handleError("matching",u,s)}l&&this._updateSublayersRecursively(l,t,i)}}_finalizeOldLayers(e){for(const t in e){const i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Nr.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=Nr.MATCHED,t!==e&&(e.lifecycle=Nr.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Nr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Nr.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function jt(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!jt(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),s=Object.keys(e);if(i.length!==s.length)return!1;for(const a of i)if(!e.hasOwnProperty(a)||!jt(n[a],e[a],t-1))return!1;return!0}return!1}class K4{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){const i=this.getViewports(),s={x:e[0],y:e[1]};for(let a=i.length-1;a>=0;--a){const l=i[a];if(l.containsPixel(s)){const u=e.slice();return u[0]-=l.x,u[1]-=l.y,l.unproject(u,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=rp(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!jt(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Fe.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const i=t.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:a=>{var l;return(l=this.getView(e.id))==null?void 0:l.makeViewport({viewState:a,width:this.width,height:this.height})}})}_updateController(e,t,i,s){const a=e.controller;if(a&&i){const l={...t,...a,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!s||s.constructor!==a.type)&&(s=this._createController(e,l)),s&&s.setProps(l),s}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let s=e.length;s--;){const a=e[s],l=this.getViewState(a),u=a.makeViewport({viewState:l,width:this.width,height:this.height});let h=t[a.id];const d=!!a.controller;d&&!h&&(i=!0),(i||!d)&&h&&(h.finalize(),h=null),this.controllers[a.id]=this._updateController(a,l,u,h),u&&this._viewports.unshift(u)}for(const s in t){const a=t[s];a&&!this.controllers[s]&&a.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((i,s)=>!e[s].equals(t[s]))}}const Z4=/([0-9]+\.?[0-9]*)(%|px)/;function Fi(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=Z4.exec(n);if(e&&e.length>=3){const t=e[2]==="%",i=parseFloat(e[1]);return{position:t?i/100:i,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function Vi(n,e){return n.relative?Math.round(n.position*e):n.position}class Gr{constructor(e){const{id:t,x:i=0,y:s=0,width:a="100%",height:l="100%",padding:u=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Fi(i),this._y=Fi(s),this._width=Fi(a),this._height=Fi(l),this._padding=u&&{left:Fi(u.left||0),right:Fi(u.right||0),top:Fi(u.top||0),bottom:Fi(u.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&jt(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:i}){i=this.filterViewState(i);const s=this.getDimensions({width:e,height:t});if(!s.height||!s.width)return null;const a=this.getViewportType(i);return new a({...i,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const i in this.props.viewState)i!=="id"&&(t[i]=this.props.viewState[i]);return t}return e}getDimensions({width:e,height:t}){const i={x:Vi(this._x,e),y:Vi(this._y,t),width:Vi(this._width,e),height:Vi(this._height,t)};return this._padding&&(i.padding={left:Vi(this._padding.left,e),top:Vi(this._padding.top,t),right:Vi(this._padding.right,e),bottom:Vi(this._padding.bottom,t)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class wu{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var t,i;this.cancel(),this.settings=e,this._inProgress=!0,(i=(t=this.settings).onStart)==null||i.call(t,this)}end(){var e,t;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(t=(e=this.settings).onEnd)==null||t.call(e,this))}cancel(){var e,t;this._inProgress&&((t=(e=this.settings).onInterrupt)==null||t.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,t;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:i,settings:s}=this;this._handle=i.addChannel({delay:i.getTime(),duration:s.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(t=(e=this.settings).onUpdate)==null||t.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const iv=()=>{},yg={BREAK:1,SNAP_TO_END:2,IGNORE:3},Q4=n=>n,G4=yg.BREAK;class J4{constructor(e){this._onTransitionUpdate=t=>{const{time:i,settings:{interpolator:s,startProps:a,endProps:l,duration:u,easing:h}}=t,d=h(i/u),p=s.interpolateProps(a,l,d);this.propsInTransition=this.getControllerState({...this.props,...p}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new wu(e.timeline),this.onViewStateChange=e.onViewStateChange||iv,this.onStateChange=e.onStateChange||iv}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let s=i;if(this.transition.inProgress){const{interruption:a,endProps:l}=this.transition.settings;s={...i,...a===yg.SNAP_TO_END?l:this.propsInTransition||i}}this._triggerTransition(s,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||t==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===yg.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const i=this.getControllerState(e),s=this.getControllerState(t).shortestPathFrom(i),a=t.transitionInterpolator,l=a.getDuration?a.getDuration(e,t):t.transitionDuration;if(l===0)return;const u=a.initializeProps(e,s);this.propsInTransition={};const h={duration:l,easing:t.transitionEasing||Q4,interpolator:a,interruption:t.transitionInterruption||G4,startProps:u.start,endProps:u.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(h),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(t)}}}function kt(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class eN{constructor(e){const{compare:t,extract:i,required:s}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=s}arePropsEqual(e,t){for(const i of this._propsToCompare)if(!(i in e)||!(i in t)||!So(e[i],t[i]))return!1;return!0}initializeProps(e,t){const i={},s={};for(const a of this._propsToExtract)(a in e||a in t)&&(i[a]=e[a],s[a]=t[a]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const i=e[t];kt(Number.isFinite(i)||Array.isArray(i),`${t} is required for transition`)})}}const tN=["longitude","latitude","zoom","bearing","pitch"],nN=["longitude","latitude","zoom"];class p1 extends eN{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:tN,required:nN},super(i.transitionProps),this.opts=i}initializeProps(e,t){const i=super.initializeProps(e,t),{makeViewport:s,around:a}=this.opts;if(s&&a){const l=s(e),u=s(t),h=l.unproject(a);i.start.around=a,Object.assign(i.end,{around:u.project(h),aroundPosition:h,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){const s={};for(const a of this._propsToExtract)s[a]=Vc(e[a]||0,t[a]||0,i);if(t.aroundPosition&&this.opts.makeViewport){const a=this.opts.makeViewport({...t,...s});Object.assign(s,a.panByPosition(t.aroundPosition,Vc(e.around,t.around,i)))}return s}}const zi={transitionDuration:0},iN=300,oc=n=>1-(1-n)*(1-n),Or={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},xs={};class sN{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new J4({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const t in this._events)this._events[t]&&((e=this.eventManager)==null||e.off(t,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:i}=this.props,{offsetCenter:s}=e;return[s.x-t,s.y-i]}isPointInBounds(e,t){const{width:i,height:s}=this.props;if(t&&t.handled)return!1;const a=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=s;return a&&t&&t.stopPropagation(),a}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?iN:0;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:a=!0,doubleClickZoom:l=!0,touchZoom:u=!0,touchRotate:h=!1,keyboard:d=!0}=e,p=!!this.onViewStateChange;this.toggleEvents(Or.WHEEL,p&&i),this.toggleEvents(Or.PAN,p),this.toggleEvents(Or.PINCH,p&&(u||h)),this.toggleEvents(Or.MULTI_PAN,p&&h),this.toggleEvents(Or.DOUBLE_CLICK,p&&l),this.toggleEvents(Or.KEYBOARD,p&&d),this.scrollZoom=i,this.dragPan=s,this.dragRotate=a,this.doubleClickZoom=l,this.touchZoom=u,this.touchRotate=h,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(i=>{this._events[i]!==t&&(this._events[i]=t,t?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,t=null,i={}){const s={...e.getViewportProps(),...t},a=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),a){const l=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:l,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(s,zi,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,zi,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],a=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:oc},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,zi,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],a=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:oc},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:a}=e;let l=2/(1+Math.exp(-Math.abs(a*i)));a<0&&l!==0&&(l=1/l);const u=this.controllerState.zoom({pos:t,scale:l});return this.updateViewport(u,{...this._getTransitionProps({around:t}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,zi,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const i=this.controllerState.rotate({pos:t});return this.updateViewport(i,zi,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const i=this.getCenter(e),s=[i[0],i[1]+=e.velocityY*t/2],a=this.controllerState.rotate({pos:s});this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:oc},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return xs._startPinchRotation=e.rotation,xs._lastPinchEvent=e,this.updateViewport(i,zi,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:i}=e,s=this.getCenter(e);t=t.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=e;t=t.rotate({deltaAngleX:xs._startPinchRotation-i})}return this.updateViewport(t,zi,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),xs._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:i}=xs;if(this.touchZoom&&t&&i&&e.scale!==i.scale){const s=this.getCenter(e);let a=this.controllerState.rotateEnd();const l=Math.log2(e.scale),u=(l-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),h=Math.pow(2,l+u*t/2);a=a.zoom({pos:s,scale:h}).zoomEnd(),this.updateViewport(a,{...this._getTransitionProps({around:s}),transitionDuration:t,transitionEasing:oc},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return xs._startPinchRotation=null,xs._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:a,rotateSpeedY:l}=this.keyboard===!0?{}:this.keyboard,{controllerState:u}=this;let h;const d={};switch(e.srcEvent.code){case"Minus":h=t?u.zoomOut(i).zoomOut(i):u.zoomOut(i),d.isZooming=!0;break;case"Equal":h=t?u.zoomIn(i).zoomIn(i):u.zoomIn(i),d.isZooming=!0;break;case"ArrowLeft":t?(h=u.rotateLeft(a),d.isRotating=!0):(h=u.moveLeft(s),d.isPanning=!0);break;case"ArrowRight":t?(h=u.rotateRight(a),d.isRotating=!0):(h=u.moveRight(s),d.isPanning=!0);break;case"ArrowUp":t?(h=u.rotateUp(l),d.isRotating=!0):(h=u.moveUp(s),d.isPanning=!0);break;case"ArrowDown":t?(h=u.rotateDown(l),d.isRotating=!0):(h=u.moveDown(s),d.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?zi:e?{...t,transitionInterpolator:new p1({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class rN{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const sv=5,aN=1.2;class oN extends rN{constructor(e){const{width:t,height:i,latitude:s,longitude:a,zoom:l,bearing:u=0,pitch:h=0,altitude:d=1.5,position:p=[0,0,0],maxZoom:_=20,minZoom:y=0,maxPitch:v=60,minPitch:A=0,startPanLngLat:R,startZoomLngLat:C,startRotatePos:z,startBearing:H,startPitch:M,startZoom:k,normalize:L=!0}=e;kt(Number.isFinite(a)),kt(Number.isFinite(s)),kt(Number.isFinite(l)),super({width:t,height:i,latitude:s,longitude:a,zoom:l,bearing:u,pitch:h,altitude:d,maxZoom:_,minZoom:y,maxPitch:v,minPitch:A,normalize:L,position:p},{startPanLngLat:R,startZoomLngLat:C,startRotatePos:z,startBearing:H,startPitch:M,startZoom:k}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:a,startPitch:l}=this.getState();if(!s||a===void 0||l===void 0)return this;let u;return e?u=this._getNewRotation(e,s,l,a):u={bearing:a+t,pitch:l+i},this._getUpdatedState(u)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:s,startZoomLngLat:a}=this.getState();if(a||(s=this.getViewportProps().zoom,a=this._unproject(t)||this._unproject(e)),!a)return this;const{maxZoom:l,minZoom:u}=this.getViewportProps();let h=s+Math.log2(i);h=Yi(h,u,l);const d=this.makeViewport({...this.getViewportProps(),zoom:h});return this._getUpdatedState({zoom:h,...d.panByPosition(a,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:a}=i;return Math.abs(s-t.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(a-t.longitude)>180&&(i.longitude=a<0?a+360:a-360),i}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:s}=e;e.zoom=Yi(s,i,t);const{maxPitch:a,minPitch:l,pitch:u}=e;e.pitch=Yi(u,l,a);const{normalize:h=!0}=e;return h&&Object.assign(e,RI(e)),e}_zoomFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,s){const a=e[0]-t[0],l=e[1]-t[1],u=e[1],h=t[1],{width:d,height:p}=this.getViewportProps(),_=a/d;let y=0;l>0?Math.abs(p-h)>sv&&(y=l/(h-p)*aN):l<0&&h>sv&&(y=1-u/h),y=Yi(y,-1,1);const{minPitch:v,maxPitch:A}=this.getViewportProps(),R=s+180*_;let C=i;return y>0?C=i+y*(A-i):y<0&&(C=i-y*(v-i)),{pitch:C,bearing:R}}}class lN extends sN{constructor(){super(...arguments),this.ControllerState=oN,this.transition={transitionDuration:300,transitionInterpolator:new p1({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class m1 extends Gr{constructor(e={}){super(e)}getViewportType(){return Zr}get ControllerType(){return lN}}m1.displayName="MapView";const cN=new ip;function uN(n,e){const t=n.order??1/0,i=e.order??1/0;return t-i}class fN{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(i=>i.id===e.id)){const i=t.findIndex(s=>uN(s,e)>0);i<0?t.push(e):t.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(jt(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const s of this.effects)t[s.id]=s;const i=[];for(const s of e){const a=t[s.id];let l=s;a&&a!==s?a.setProps?(a.setProps(s.props),l=a):a.cleanup(this._context):a||s.setup(this._context),i.push(l),delete t[s.id]}for(const s in t)t[s].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(s=>s instanceof ip)||this._resolvedEffects.push(cN),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class hN extends np{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const dN="deckRenderer.renderLayers";class gN{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new hN(e),this.pickLayersPass=new d1(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const s=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const a=t.render({...i,target:s});i.effects&&this._postRender(i.effects,i),this.renderCount++,Dt(dN,this,a,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const i of e)t.preRenderStats[i.id]=i.preRender(t),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[s]}))});for(const i of e)i.resize(t)}_postRender(e,t){const{renderBuffers:i}=this,s={...t,inputBuffer:i[0],swapBuffer:i[1]};for(const a of e)if(a.postRender){s.target=a.id===this.lastPostProcessEffect?t.target:void 0;const l=a.postRender(s);s.inputBuffer=l,s.swapBuffer=l===i[0]?i[1]:i[0]}}}const pN={pickedColor:null,pickedObjectIndex:-1};function mN({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:i,deviceRadius:s,deviceRect:a}){const{x:l,y:u,width:h,height:d}=a;let p=s*s,_=-1,y=0;for(let v=0;v<d;v++){const A=v+u-i,R=A*A;if(R>p)y+=4*h;else for(let C=0;C<h;C++){if(n[y+3]-1>=0){const H=C+l-t,M=H*H+R;M<=p&&(p=M,_=y)}y+=4}}if(_>=0){const v=n.slice(_,_+4),A=e(v);if(A){const R=Math.floor(_/4/h),C=_/4-R*h;return{...A,pickedColor:v,pickedX:l+C,pickedY:u+R}}Fe.error("Picked non-existent layer. Is picking buffer corrupt?")()}return pN}function _N({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let i=0;i<n.length;i+=4)if(n[i+3]-1>=0){const a=n.slice(i,i+4),l=a.join(",");if(!t.has(l)){const u=e(a);u?t.set(l,{...u,color:a}):Fe.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function _1({pickInfo:n,viewports:e,pixelRatio:t,x:i,y:s,z:a}){let l=e[0];e.length>1&&(l=bN((n==null?void 0:n.pickedViewports)||e,{x:i,y:s}));let u;if(l){const h=[i-l.x,s-l.y];a!==void 0&&(h[2]=a),u=l.unproject(h)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:u,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function yN(n){const{pickInfo:e,lastPickedInfo:t,mode:i,layers:s}=n,{pickedColor:a,pickedLayer:l,pickedObjectIndex:u}=e,h=l?[l]:[];if(i==="hover"){const _=t.index,y=t.layerId,v=l?l.props.id:null;if(v!==y||u!==_){if(v!==y){const A=s.find(R=>R.props.id===y);A&&h.unshift(A)}t.layerId=v,t.index=u,t.info=null}}const d=_1(n),p=new Map;return p.set(null,d),h.forEach(_=>{let y={...d};_===l&&(y.color=a,y.index=u,y.picked=!0),y=y1({layer:_,info:y,mode:i});const v=y.layer;_===l&&i==="hover"&&(t.info=y),p.set(v.id,y),i==="hover"&&v.updateAutoHighlight(y)}),p}function y1({layer:n,info:e,mode:t}){for(;n&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:i}),n=n.parent}return e}function bN(n,e){for(let t=n.length-1;t>=0;t--){const i=n[t];if(i.containsPixel(e))return i}return n[0]}class vN{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new d1(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:i,viewports:s},a=this.lastPickedInfo.info){const l=a&&a.layer&&a.layer.id,u=a&&a.viewport&&a.viewport.id,h=l?i.find(y=>y.id===l):null,d=u&&s.find(y=>y.id===u)||s[0],p=d&&d.unproject([e-d.x,t-d.y]);return{...a,...{x:e,y:t,viewport:d,coordinate:p,layer:h}}}_resizeBuffer(){var t,i;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const s=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=s}const{canvas:e}=this.device.getDefaultCanvasContext();(t=this.pickingFBO)==null||t.resize({width:e.width,height:e.height}),(i=this.depthFBO)==null||i.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:i,x:s,y:a,radius:l=0,depth:u=1,mode:h="query",unproject3D:d,onViewportActive:p,effects:_}){const y=this.device.canvasContext.cssToDeviceRatio(),v=this._getPickable(e);if(!v||i.length===0)return{result:[],emptyInfo:_1({viewports:i,x:s,y:a,pixelRatio:y})};this._resizeBuffer();const A=this.device.canvasContext.cssToDevicePixels([s,a],!0),R=[A.x+Math.floor(A.width/2),A.y+Math.floor(A.height/2)],C=Math.round(l*y),{width:z,height:H}=this.pickingFBO,M=this._getPickingRect({deviceX:R[0],deviceY:R[1],deviceRadius:C,deviceWidth:z,deviceHeight:H}),k={x:s-l,y:a-l,width:l*2+1,height:l*2+1};let L;const X=[],ce=new Set;for(let re=0;re<u;re++){let ne;if(M){const te=this._drawAndSample({layers:v,views:t,viewports:i,onViewportActive:p,deviceRect:M,cullRect:k,effects:_,pass:`picking:${h}`});ne=mN({...te,deviceX:R[0],deviceY:R[1],deviceRadius:C,deviceRect:M})}else ne={pickedColor:null,pickedObjectIndex:-1};let he;if(ne.pickedLayer&&d&&this.depthFBO){const{pickedColors:te}=this._drawAndSample({layers:[ne.pickedLayer],views:t,viewports:i,onViewportActive:p,deviceRect:{x:ne.pickedX,y:ne.pickedY,width:1,height:1},cullRect:k,effects:_,pass:`picking:${h}:z`},!0);te[3]&&(he=te[0])}ne.pickedLayer&&re+1<u&&(ce.add(ne.pickedLayer),ne.pickedLayer.disablePickingIndex(ne.pickedObjectIndex)),L=yN({pickInfo:ne,lastPickedInfo:this.lastPickedInfo,mode:h,layers:v,viewports:i,x:s,y:a,z:he,pixelRatio:y});for(const te of L.values())te.layer&&X.push(te);if(!ne.pickedColor)break}for(const re of ce)re.restorePickingColors();return{result:X,emptyInfo:L.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:i,x:s,y:a,width:l=1,height:u=1,mode:h="query",maxObjects:d=null,onViewportActive:p,effects:_}){const y=this._getPickable(e);if(!y||i.length===0)return[];this._resizeBuffer();const v=this.device.canvasContext.cssToDeviceRatio(),A=this.device.canvasContext.cssToDevicePixels([s,a],!0),R=A.x,C=A.y+A.height,z=this.device.canvasContext.cssToDevicePixels([s+l,a+u],!0),H=z.x+z.width,M=z.y,k={x:R,y:M,width:H-R,height:C-M},L=this._drawAndSample({layers:y,views:t,viewports:i,onViewportActive:p,deviceRect:k,cullRect:{x:s,y:a,width:l,height:u},effects:_,pass:`picking:${h}`}),X=_N(L),ce=new Map,re=[],ne=Number.isFinite(d);for(let he=0;he<X.length&&!(ne&&re.length>=d);he++){const te=X[he];let me={color:te.pickedColor,layer:null,index:te.pickedObjectIndex,picked:!0,x:s,y:a,pixelRatio:v};me=y1({layer:te.pickedLayer,info:me,mode:h});const Ae=me.layer.id;ce.has(Ae)||ce.set(Ae,new Set);const _e=ce.get(Ae),Be=me.object??me.index;_e.has(Be)||(_e.add(Be),re.push(me))}return re}_drawAndSample({layers:e,views:t,viewports:i,onViewportActive:s,deviceRect:a,cullRect:l,effects:u,pass:h},d=!1){const p=d?this.depthFBO:this.pickingFBO,_={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:s,pickingFBO:p,deviceRect:a,cullRect:l,effects:u,pass:h,pickZ:d,preRenderStats:{},isPicking:!0};for(const H of u)H.useInPicking&&(_.preRenderStats[H.id]=H.preRender(_));const{decodePickingColor:y}=this.pickLayersPass.render(_),{x:v,y:A,width:R,height:C}=a,z=new(d?Float32Array:Uint8Array)(R*C*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:v,sourceY:A,sourceWidth:R,sourceHeight:C,target:z}),{pickedColors:z,decodePickingColor:y}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:i,deviceWidth:s,deviceHeight:a}){const l=Math.max(0,e-i),u=Math.max(0,t-i),h=Math.min(s,e+i+1)-l,d=Math.min(a,t+i+1)-u;return h<=0||d<=0?null:{x:l,y:u,width:h,height:d}}}const TN={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},xN="top-left",rv="__root";class SN{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!jt(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const i of this.resolvedWidgets)t[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)t[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const s=t[i.id];s?s.viewId!==i.viewId||s.placement!==i.placement?(this._remove(s),this._add(i)):i!==s&&(s.setProps(i.props),i=s):this._add(i),t[i.id]=null,this.resolvedWidgets.push(i)}for(const i in t){const s=t[i];s&&this._remove(s)}this.widgets=e}_add(e){const{viewId:t=null,placement:i=xN}=e,s=e.onAdd({deck:this.deck,viewId:t});s&&this._getContainer(t,i).append(s),e._element=s}_remove(e){var t;(t=e.onRemove)==null||t.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){var l;const i=e||rv;let s=this.containers[i];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",(l=this.parentElement)==null||l.append(s),this.containers[i]=s);let a=s.querySelector(`.${t}`);return a||(a=document.createElement("div"),a.className=t,a.style.position="absolute",a.style.zIndex="2",Object.assign(a.style,TN[t]),s.append(a)),a}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const i in this.containers){const s=this.lastViewports[i]||null,a=i===rv||s,l=this.containers[i];a?(l.style.display="block",l.style.left=`${s?s.x:0}px`,l.style.top=`${s?s.y:0}px`,l.style.width=`${s?s.width:e}px`,l.style.height=`${s?s.height:t}px`):l.style.display="none"}}onRedraw({viewports:e,layers:t}){var s,a;const i=e.reduce((l,u)=>(l[u.id]=u,l),{});for(const l of this.getWidgets()){const{viewId:u}=l;if(u){const h=i[u];h&&(l.onViewportChange&&l.onViewportChange(h),(s=l.onRedraw)==null||s.call(l,{viewports:[h],layers:t}))}else{if(l.onViewportChange)for(const h of e)l.onViewportChange(h);(a=l.onRedraw)==null||a.call(l,{viewports:e,layers:t})}}this.lastViewports=i,this._updateContainers()}onHover(e,t){var i,s;for(const a of this.getWidgets()){const{viewId:l}=a;(!l||l===((i=e.viewport)==null?void 0:i.id))&&((s=a.onHover)==null||s.call(a,e,t))}}onEvent(e,t){var s,a;const i=cg[t.type];if(i)for(const l of this.getWidgets()){const{viewId:u}=l;(!u||u===((s=e.viewport)==null?void 0:s.id))&&((a=l[i])==null||a.call(l,e,t))}}}const AN={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class wN{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,AN),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var t;this.isVisible&&e.id===((t=this.lastViewport)==null?void 0:t.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,i=t&&t.props.getTooltip;if(!i)return;const s=i(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,t,i){const s=this.element;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${t}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}var Dr;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Dr||(Dr={}));const ap={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},ut=(n,e,t)=>e?n.enable(t):n.disable(t),av=(n,e,t)=>n.hint(t,e),tn=(n,e,t)=>n.pixelStorei(t,e),ov=(n,e,t)=>{const i=t===36006?36009:36008;return n.bindFramebuffer(i,e)},so=(n,e,t)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(s,e)};function wd(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const EN={3042:ut,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:ut,2885:(n,e)=>n.cullFace(e),2929:ut,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:ut,35723:av,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>{var t;return(t=n.bindTransformFeedback)==null?void 0:t.call(n,36386,e)},34229:(n,e)=>n.bindVertexArray(e),36006:ov,36010:ov,34964:so,36662:so,36663:so,35053:so,35055:so,2886:(n,e)=>n.frontFace(e),33170:av,2849:(n,e)=>n.lineWidth(e),32823:ut,32824:"polygonOffset",10752:"polygonOffset",35977:ut,32926:ut,32928:ut,32938:"sampleCoverage",32939:"sampleCoverage",3089:ut,3088:(n,e)=>n.scissor(...e),2960:ut,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:ut,10754:ut,12288:ut,12289:ut,12290:ut,12291:ut,12292:ut,12293:ut,12294:ut,12295:ut,3333:tn,3317:tn,37440:tn,37441:tn,37443:tn,3330:tn,3332:tn,3331:tn,3314:tn,32878:tn,3316:tn,3315:tn,32877:tn,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=(e==null?void 0:e.length)===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=wd(e)?e:[e,e];const[t,i]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,i)},stencilFunc:(n,e)=>{e=wd(e)&&e.length===3?[...e,...e]:e;const[t,i,s,a,l,u]=e;n.stencilFuncSeparate(1028,t,i,s),n.stencilFuncSeparate(1029,a,l,u)},stencilOp:(n,e)=>{e=wd(e)&&e.length===3?[...e,...e]:e;const[t,i,s,a,l,u]=e;n.stencilOpSeparate(1028,t,i,s),n.stencilOpSeparate(1029,a,l,u)},viewport:(n,e)=>n.viewport(...e)};function it(n,e,t){return e[n]!==void 0?e[n]:t[n]}const RN={blendEquation:(n,e,t)=>n.blendEquationSeparate(it(32777,e,t),it(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(it(32969,e,t),it(32968,e,t),it(32971,e,t),it(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(it(32824,e,t),it(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(it(32938,e,t),it(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,it(2962,e,t),it(2967,e,t),it(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,it(34816,e,t),it(36003,e,t),it(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,it(2964,e,t),it(2965,e,t),it(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,it(34817,e,t),it(34818,e,t),it(34819,e,t))},lv={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?n({[i]:t}):{valueChanged:!0}},blendColor:(n,e,t,i,s)=>n({32773:new Float32Array([e,t,i,s])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,i,s)=>n({32969:e,32968:t,32971:i,32970:s}),clearColor:(n,e,t,i,s)=>n({3106:new Float32Array([e,t,i,s])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,i,s)=>n({3107:[e,t,i,s]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,i,s)=>n({3088:new Int32Array([e,t,i,s])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,i)=>n({2962:e,2967:t,2963:i,34816:e,36003:t,36004:i}),stencilFuncSeparate:(n,e,t,i,s)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:i,[e===1028?2963:36004]:s}),stencilOp:(n,e,t,i)=>n({2964:e,2965:t,2966:i,34817:e,34818:t,34819:i}),stencilOpSeparate:(n,e,t,i,s)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:i,[e===1028?2966:34819]:s}),viewport:(n,e,t,i,s)=>n({2978:[e,t,i,s]})},Un=(n,e)=>n.isEnabled(e),cv={3042:Un,2884:Un,2929:Un,3024:Un,32823:Un,32926:Un,32928:Un,3089:Un,2960:Un,35977:Un},CN=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function na(n,e){if(ON(e))return;const t={};for(const s in e){const a=Number(s),l=EN[s];l&&(typeof l=="string"?t[l]=!0:l(n,e[s],a))}const i=n.state&&n.state.cache;if(i)for(const s in t){const a=RN[s];a(n,e,i)}}function b1(n,e=ap){if(typeof e=="number"){const s=e,a=cv[s];return a?a(n,s):n.getParameter(s)}const t=Array.isArray(e)?e:Object.keys(e),i={};for(const s of t){const a=cv[s];i[s]=a?a(n,Number(s)):n.getParameter(Number(s))}return i}function MN(n){na(n,ap)}function ON(n){for(const e in n)return!1;return!0}function IN(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),i=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&i&&n.length===e.length){for(let s=0;s<n.length;++s)if(n[s]!==e[s])return!1;return!0}return!1}class Cs{constructor(e,t){T(this,"gl");T(this,"program",null);T(this,"stateStack",[]);T(this,"enable",!0);T(this,"cache",null);T(this,"log");T(this,"initialized",!1);this.gl=e,this.log=(t==null?void 0:t.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];na(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?b1(e):Object.assign({},ap),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,PN(e);for(const i in lv){const s=lv[i];NN(e,i,s)}uv(e,"getParameter"),uv(e,"isEnabled")}_updateCache(e){let t=!1,i;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const a in e){const l=e[a],u=this.cache[a];IN(l,u)||(t=!0,i=u,s&&!(a in s)&&(s[a]=u),this.cache[a]=l)}return{valueChanged:t,oldValue:i}}}function uv(n,e){const t=n[e].bind(n);n[e]=function(s){if(s===void 0||CN.has(s))return t(s);const a=Cs.get(n);return s in a.cache||(a.cache[s]=t(s)),a.enable?a.cache[s]:t(s)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function NN(n,e,t){if(!n[e])return;const i=n[e].bind(n);n[e]=function(...a){const l=Cs.get(n),{valueChanged:u,oldValue:h}=t(l._updateCache,...a);return u&&i(...a),h},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function PN(n){const e=n.useProgram.bind(n);n.useProgram=function(i){const s=Cs.get(n);s.program!==i&&(e(i),s.program=i)}}function DN(n,e,t){let i="";const s={preserveDrawingBuffer:!0,...t};let a=null;if(a||(a=n.getContext("webgl2",s)),s.failIfMajorPerformanceCaveat&&(i||(i="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!a&&!t.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,a=n.getContext("webgl2",s),a.luma||(a.luma={}),a.luma.softwareRenderer=!0),a||(a=n.getContext("webgl",{}),a&&(a=null,i||(i="Your browser only supports WebGL1"))),!a)throw i||(i="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:l,onContextRestored:u}=e;return n.addEventListener("webglcontextlost",h=>l(h),!1),n.addEventListener("webglcontextrestored",h=>u(h),!1),a.luma||(a.luma={}),a}function Jr(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function kN(n,e){const t=n.getParameter(7936),i=n.getParameter(7937);Jr(n,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,a=n.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),l=n.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),u=a||t,h=l||i,d=n.getParameter(7938),p=v1(u,h),_=UN(u,h),y=BN(u,h);return{type:"webgl",gpu:p,gpuType:y,gpuBackend:_,vendor:u,renderer:h,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function v1(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function UN(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function BN(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(v1(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function T1(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const co="WEBGL_compressed_texture_s3tc",uo="WEBGL_compressed_texture_s3tc_srgb",kr="EXT_texture_compression_rgtc",Ur="EXT_texture_compression_bptc",LN="WEBGL_compressed_texture_etc",FN="WEBGL_compressed_texture_astc",VN="WEBGL_compressed_texture_etc1",zN="WEBGL_compressed_texture_pvrtc",HN="WEBGL_compressed_texture_atc",fv="EXT_texture_norm16",hv="EXT_render_snorm",jN="EXT_color_buffer_float",op={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[hv],"norm16-renderable-webgl":[fv],"snorm16-renderable-webgl":[fv,hv],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[co,uo,kr,Ur],"texture-compression-bc5-webgl":[kr],"texture-compression-bc7-webgl":[Ur],"texture-compression-etc2":[LN],"texture-compression-astc":[FN],"texture-compression-etc1-webgl":[VN],"texture-compression-pvrtc-webgl":[zN],"texture-compression-atc-webgl":[HN]};function WN(n){return n in op}function $N(n,e,t){return(op[e]||[]).every(s=>Jr(n,s,t))}const lp={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:jN,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:co},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:uo},"bc1-rgba-unorm":{gl:33777,x:co},"bc1-rgba-unorm-srgb":{gl:35916,x:uo},"bc2-rgba-unorm":{gl:33778,x:co},"bc2-rgba-unorm-srgb":{gl:35918,x:uo},"bc3-rgba-unorm":{gl:33779,x:co},"bc3-rgba-unorm-srgb":{gl:35919,x:uo},"bc4-r-unorm":{gl:36283,x:kr},"bc4-r-snorm":{gl:36284,x:kr},"bc5-rg-unorm":{gl:36285,x:kr},"bc5-rg-snorm":{gl:36286,x:kr},"bc6h-rgb-ufloat":{gl:36495,x:Ur},"bc6h-rgb-float":{gl:36494,x:Ur},"bc7-rgba-unorm":{gl:36492,x:Ur},"bc7-rgba-unorm-srgb":{gl:36493,x:Ur},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function XN(n,e,t){let i=e.create;const s=lp[e.format];return(s==null?void 0:s.gl)===void 0&&(i=!1),s!=null&&s.x&&(i=i&&!!Jr(n,s.x,t)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function x1(n){var s;const e=lp[n],t=KN(n),i=jg(n);return{internalFormat:t,format:(e==null?void 0:e.dataFormat)||qN(i.channels,i.integer,i.normalized,t),type:i.dataType?T1(i.dataType):((s=e==null?void 0:e.types)==null?void 0:s[0])||5121,compressed:i.compressed||!1}}function YN(n){switch(jg(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function qN(n,e,t,i){if(i===6408||i===6407)return i;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function KN(n){const e=lp[n],t=e==null?void 0:e.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const dv={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class ZN extends NR{constructor(t,i,s){super([],s);T(this,"gl");T(this,"extensions");T(this,"testedFeatures",new Set);this.gl=t,this.extensions=i,Jr(t,"EXT_color_buffer_float",i)}*[Symbol.iterator](){const t=this.getFeatures();for(const i of t)this.has(i)&&(yield i);return[]}has(t){var i;return(i=this.disabledFeatures)!=null&&i[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),WN(t)&&$N(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(i=>i!=="polygon-mode-webgl");for(const i of t)this.has(i)}getFeatures(){return[...Object.keys(dv),...Object.keys(op)]}getWebGLFeature(t){const i=dv[t];return typeof i=="string"?!!Jr(this.gl,i,this.extensions):!!i}}class QN extends IR{constructor(t){super();T(this,"gl");T(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class _o extends Nc{constructor(t,i){super(t,i);T(this,"device");T(this,"gl");T(this,"handle");T(this,"colorAttachments",[]);T(this,"depthStencilAttachment",null);const s=i.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||s?this.props.handle:this.gl.createFramebuffer(),s||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let i=0;i<this.colorAttachments.length;++i){const s=this.colorAttachments[i];if(s){const a=36064+i;this._attachTextureView(a,s)}}if(this.depthStencilAttachment){const i=YN(this.depthStencilAttachment.props.format);this._attachTextureView(i,this.depthStencilAttachment)}if(this.device.props.debug){const i=this.gl.checkFramebufferStatus(36160);if(i!==36053)throw new Error(`Framebuffer ${JN(i)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,i){const{gl:s}=this.device,{texture:a}=i,l=i.props.baseMipLevel,u=i.props.baseArrayLayer;switch(s.bindTexture(a.glTarget,a.handle),a.glTarget){case 35866:case 32879:s.framebufferTextureLayer(36160,t,a.handle,l,u);break;case 34067:const h=GN(u);s.framebufferTexture2D(36160,t,h,a.handle,l);break;case 3553:s.framebufferTexture2D(36160,t,3553,a.handle,l);break;default:throw new Error("Illegal texture type")}s.bindTexture(a.glTarget,null)}}function GN(n){return n<34069?n+34069:n}function JN(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class eP extends qd{constructor(t,i){super(i);T(this,"device");T(this,"format","rgba8unorm");T(this,"depthStencilFormat","depth24plus");T(this,"presentationSize");T(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new _o(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const i=this.getDevicePixelRatio(t==null?void 0:t.useDevicePixels);this.setDevicePixelRatio(i,t);return}}commit(){}}async function S1(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",n),new Promise((s,a)=>{i.onload=s,i.onerror=l=>a(new Error(`Unable to load script '${n}': ${l}`)),t.appendChild(i)})}const tP=1;let qe=null,gv=!1;const cp={debugSpectorJS:ee.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function nP(n){if(!globalThis.SPECTOR)try{await S1(n.debugSpectorJSUrl||cp.debugSpectorJSUrl)}catch(e){ee.warn(String(e))}}function iP(n){var e;if(n={...cp,...n},!n.debugSpectorJS)return null;if(!qe&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){ee.probe(tP,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:t}=globalThis.SPECTOR;qe=new t,globalThis.luma&&(globalThis.luma.spector=qe)}if(!qe)return null;if(gv||(gv=!0,qe.spyCanvases(),qe==null||qe.onCaptureStarted.add(t=>ee.info("Spector capture started:",t)()),qe==null||qe.onCapture.add(t=>{ee.info("Spector capture complete:",t)(),qe==null||qe.getResultUI(),qe==null||qe.resultView.display(),qe==null||qe.resultView.addCapture(t)})),n.gl){const t=n.gl,i=t.device;qe==null||qe.startCapture(n.gl,500),t.device=i,new Promise(s=>setTimeout(s,2e3)).then(s=>{ee.info("Spector capture stopped after 2 seconds")(),qe==null||qe.stopCapture()})}return qe}const sP="https://unpkg.com/webgl-debug@2.0.1/index.js";function A1(n){return n.luma=n.luma||{},n.luma}async function rP(){ks()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await S1(sP))}function aP(n,e={}){return e.debugWebGL||e.traceWebGL?lP(n,e):oP(n)}function oP(n){const e=A1(n);return e.realContext?e.realContext:n}function lP(n,e){if(!globalThis.WebGLDebugUtils)return ee.warn("webgl-debug not loaded")(),n;const t=A1(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...Dr,...n});const i=globalThis.WebGLDebugUtils.makeDebugContext(n,cP.bind(null,e),uP.bind(null,e));for(const l in Dr)!(l in i)&&typeof Dr[l]=="number"&&(i[l]=Dr[l]);class s{}Object.setPrototypeOf(i,Object.getPrototypeOf(n)),Object.setPrototypeOf(s,i);const a=Object.create(s);return t.realContext=n,t.debugContext=a,a.debug=!0,a}function pv(n,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function cP(n,e,t,i){i=Array.from(i).map(u=>u===void 0?"undefined":u);const s=globalThis.WebGLDebugUtils.glEnumToString(e),a=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,i),l=`${s} in gl.${t}(${a})`;ee.error(l)();debugger}function uP(n,e,t){let i="";ee.level>=1&&(i=pv(e,t),n.traceWebGL&&ee.log(1,i)());for(const s of t)if(s===void 0){i=i||pv(e,t);debugger}}const Ed={};function fP(n="id"){Ed[n]=Ed[n]||1;const e=Ed[n]++;return`${n}-${e}`}class yo extends Qe{constructor(t,i={}){super(t,i);T(this,"device");T(this,"gl");T(this,"handle");T(this,"glTarget");T(this,"glUsage");T(this,"glIndexType",5123);T(this,"byteLength");T(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const s=typeof i=="object"?i.handle:void 0;this.handle=s||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=hP(this.props.usage),this.glUsage=dP(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,i.data?this._initWithData(i.data,i.byteOffset,i.byteLength):this._initWithByteLength(i.byteLength||0)}_initWithData(t,i=0,s=t.byteLength+i){const a=this.glTarget;this.gl.bindBuffer(a,this.handle),this.gl.bufferData(a,s,this.glUsage),this.gl.bufferSubData(a,i,t),this.gl.bindBuffer(a,null),this.bytesUsed=s,this.byteLength=s,this._setDebugData(t,i,s),this.trackAllocatedMemory(s)}_initWithByteLength(t){let i=t;t===0&&(i=new Float32Array(0));const s=this.glTarget;return this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bindBuffer(s,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,i=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,i,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,i,t.byteLength)}async readAsync(t=0,i){return this.readSyncWebGL(t,i)}readSyncWebGL(t=0,i){i=i??this.byteLength-t;const s=new Uint8Array(i),a=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,s,a,i),this.gl.bindBuffer(36662,null),this._setDebugData(s,t,i),s}}function hP(n){return n&Qe.INDEX?34963:n&Qe.VERTEX?34962:n&Qe.UNIFORM?35345:34962}function dP(n){return n&Qe.INDEX||n&Qe.VERTEX?35044:n&Qe.UNIFORM?35048:35044}function gP(n){const e=n.split(/\r?\n/),t=[];for(const i of e){if(i.length<=1)continue;const s=i.split(":");if(s.length===2){const[_,y]=s;t.push({message:y.trim(),type:mv(_),lineNum:0,linePos:0});continue}const[a,l,u,...h]=s;let d=parseInt(u,10);isNaN(d)&&(d=0);let p=parseInt(l,10);isNaN(p)&&(p=0),t.push({message:h.join(":").trim(),type:mv(a),lineNum:d,linePos:p})}return t}function mv(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class pP extends Oc{constructor(t,i){super(t,i);T(this,"device");T(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?gP(t):[]}getTranslatedSource(){const i=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(i==null?void 0:i.getTranslatedShaderSource(this.handle))||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:i}=this.device;if(i.shaderSource(this.handle,t),i.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}ee.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),ee.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async a=>await new Promise(l=>setTimeout(l,a));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:s}=this.device;for(;;){if(s.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function mP(n,e,t,i){if(vP(e))return i(n);const s=n;s.pushState();try{return _P(n,e),na(s.gl,t),i(n)}finally{s.popState()}}function _P(n,e){const t=n,{gl:i}=t;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(Ms("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const a=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,l=Ms("provokingVertex",e.provokingVertex,{first:36429,last:36430});a==null||a.provokingVertexWEBGL(l)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const a=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,l=Ms("polygonMode",e.polygonMode,{fill:6914,line:6913});a==null||a.polygonModeWEBGL(1028,l),a==null||a.polygonModeWEBGL(1029,l)}e.polygonOffsetLine&&i.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(bP("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(bg("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;i.stencilMaskSeparate(1028,s),i.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&ee.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,a=bg("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,a,0,s),i.stencilFuncSeparate(1029,a,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=Rd("stencilPassOperation",e.stencilPassOperation),a=Rd("stencilFailOperation",e.stencilFailOperation),l=Rd("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,a,l,s),i.stencilOpSeparate(1029,a,l,s)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const s=_v("blendColorOperation",e.blendColorOperation||"add"),a=_v("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(s,a);const l=lc("blendColorSrcFactor",e.blendColorSrcFactor||"one"),u=lc("blendColorDstFactor",e.blendColorDstFactor||"zero"),h=lc("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),d=lc("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(l,u,h,d)}}function bg(n,e){return Ms(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Rd(n,e){return Ms(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function _v(n,e){return Ms(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function lc(n,e){return Ms(n,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function yP(n,e){return`Illegal parameter ${e} for ${n}`}function Ms(n,e,t){if(!(e in t))throw new Error(yP(n,e));return t[e]}function bP(n,e){return e}function vP(n){let e=!0;for(const t in n){e=!1;break}return e}function w1(n){const e={};return n.addressModeU&&(e[10242]=Cd(n.addressModeU)),n.addressModeV&&(e[10243]=Cd(n.addressModeV)),n.addressModeW&&(e[32882]=Cd(n.addressModeW)),n.magFilter&&(e[10240]=vg(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=TP(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=bg("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function Cd(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function vg(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function TP(n,e="none"){if(!e)return vg(n);switch(e){case"none":return vg(n);case"nearest":return n==="nearest"?9984:9986;case"linear":return n==="nearest"?9985:9987}}class Tg extends Ic{constructor(t,i){super(t,i);T(this,"device");T(this,"handle");T(this,"parameters");this.device=t,this.parameters=w1(i),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[i,s]of Object.entries(t)){const a=Number(i);switch(a){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,a,s);break;default:this.device.gl.samplerParameteri(this.handle,a,s);break}}}}class Br extends Mc{constructor(t,i){super(t,{...st.defaultProps,...i});T(this,"device");T(this,"gl");T(this,"handle");T(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=i.texture}}const xP="Failed to deduce GL constant from typed array";function SP(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(xP)}}function AP(n,e){const{clamped:t=!0}=e||{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function E1(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function wP(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Yc(n,e,t){if(EP(e))return t(n);const{nocatch:i=!0}=e,s=Cs.get(n);s.push(),na(n,e);let a;if(i)a=t(n),s.pop();else try{a=t(n)}finally{s.pop()}return a}function EP(n){for(const e in n)return!1;return!0}function RP(n,e,t){const{dimension:i,width:s,height:a,depth:l=0}=t,{glInternalFormat:u}=t,h=t.glTarget;switch(i){case"2d-array":case"3d":n.texStorage3D(h,e,u,s,a,l);break;default:n.texStorage2D(h,e,u,s,a)}}function yv(n,e,t,i){const{width:s,height:a}=i,{dimension:l,depth:u=0,mipLevel:h=0}=i,{x:d=0,y:p=0,z:_=0}=i,{glFormat:y,glType:v}=i,A=R1(i.glTarget,l,u),R=i.flipY?{37440:!0}:{};Yc(n,R,()=>{switch(l){case"2d-array":case"3d":n.bindTexture(A,e),n.texSubImage3D(A,h,d,p,_,s,a,u,y,v,t),n.bindTexture(A,null);break;case"2d":case"cube":n.bindTexture(A,e),n.texSubImage2D(A,h,d,p,s,a,y,v,t),n.bindTexture(A,null);break;default:throw new Error(l)}})}function bv(n,e,t){const{dimension:i,width:s,height:a,depth:l=0,mipLevel:u=0,byteOffset:h=0}=t,{x:d=0,y:p=0,z:_=0}=t,{glFormat:y,glType:v,compressed:A}=t,R=R1(t.glTarget,i,l);switch(i){case"2d-array":case"3d":A?n.compressedTexSubImage3D(R,u,d,p,_,s,a,l,y,e,h):n.texSubImage3D(R,u,d,p,_,s,a,l,y,v,e,h);break;case"2d":case"cube":A?n.compressedTexSubImage2D(R,u,d,p,s,a,y,e,h):n.texSubImage2D(R,u,d,p,s,a,y,v,e,h);break;default:throw new Error(i)}}function CP(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function R1(n,e,t){return e==="cube"?34069+t:n}function MP(n,e){var z;const{sourceX:t=0,sourceY:i=0,sourceAttachment:s=0}=e||{};let{target:a=null,sourceWidth:l,sourceHeight:u,sourceDepth:h,sourceFormat:d,sourceType:p}=e||{};const{framebuffer:_,deleteFramebuffer:y}=C1(n),{gl:v,handle:A}=_;l||(l=_.width),u||(u=_.height);const R=(z=_.colorAttachments[s])==null?void 0:z.texture;if(!R)throw new Error(`Invalid framebuffer attachment ${s}`);h=(R==null?void 0:R.depth)||1,d||(d=(R==null?void 0:R.glFormat)||6408),p||(p=(R==null?void 0:R.glType)||5121),a=NP(a,p,d,l,u),p=p||SP(a);const C=v.bindFramebuffer(36160,A);return v.readBuffer(36064+s),v.readPixels(t,i,l,u,d,p,a),v.readBuffer(36064),v.bindFramebuffer(36160,C||null),y&&_.destroy(),a}function OP(n,e){const{target:t,sourceX:i=0,sourceY:s=0,sourceFormat:a=6408,targetByteOffset:l=0}=e||{};let{sourceWidth:u,sourceHeight:h,sourceType:d}=e||{};const{framebuffer:p,deleteFramebuffer:_}=C1(n);u=u||p.width,h=h||p.height;const y=p;d=d||5121;let v=t;if(!v){const R=E1(a),C=wP(d),z=l+u*h*R*C;v=y.device.createBuffer({byteLength:z})}const A=n.device.createCommandEncoder();return A.copyTextureToBuffer({sourceTexture:n,width:u,height:h,origin:[i,s],destinationBuffer:v,byteOffset:l}),A.destroy(),_&&p.destroy(),v}function C1(n){return n instanceof Nc?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:IP(n),deleteFramebuffer:!0}}function IP(n,e){const{device:t,width:i,height:s,id:a}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${a}`,width:i,height:s,colorAttachments:[n]})}function NP(n,e,t,i,s,a){if(n)return n;e||(e=5121);const l=AP(e,{clamped:!1}),u=E1(t);return new l(i*s*u)}class bo extends st{constructor(t,i){super(t,i);T(this,"device");T(this,"gl");T(this,"handle");T(this,"sampler");T(this,"view");T(this,"mipmaps");T(this,"compressed");T(this,"glTarget");T(this,"glFormat");T(this,"glType");T(this,"glInternalFormat");T(this,"textureUnit",0);const s={...this.props};s.data=i.data,this.device=t,this.gl=this.device.gl,this.glTarget=CP(this.props.dimension);const a=x1(this.props.format);this.glInternalFormat=a.internalFormat,this.glFormat=a.format,this.glType=a.type,this.compressed=a.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(s),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:i,height:s}=t;if(!i||!s){const a=st.getTextureDataSize(t.data);i=(a==null?void 0:a.width)||1,s=(a==null?void 0:a.height)||1}if(this.width=i,this.height=s,this.depth=t.depth,this.setSampler(t.sampler),this.view=new Br(this.device,{...this.props,texture:this}),this.bind(),RP(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new Br(this.device,{...t,texture:this})}setSampler(t={}){let i;t instanceof Tg?(this.sampler=t,i=t.props):(this.sampler=new Tg(this.device,t),i=t);const s=w1(i);this._setSamplerParameters(s)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(ee.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(t!=null&&t.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(s){ee.warn(`Error generating mipmap for ${this}: ${s.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const i=st.getExternalImageSize(t.image),s={...st.defaultCopyExternalImageOptions,...i,...t},{image:a,depth:l,mipLevel:u,x:h,y:d,z:p,flipY:_}=s;let{width:y,height:v}=s;const{dimension:A,glTarget:R,glFormat:C,glInternalFormat:z,glType:H}=this;if(y=Math.min(y,this.width-h),v=Math.min(v,this.height-d),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return yv(this.device.gl,this.handle,a,{dimension:A,mipLevel:u,x:h,y:d,z:p,width:y,height:v,depth:l,glFormat:C,glType:H,glTarget:R,flipY:_}),{width:s.width,height:s.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,i=0){this.bind();const s=st.normalizeTextureData(t,this);s.length>1&&this.props.mipmaps!==!1&&ee.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let a=0;a<s.length;a++){const l=s[a];this._setMipLevel(i,a,l)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),bv(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,i=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const s of st.CubeFaces)this.setTextureCubeFaceData(t[s],s)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,i,s=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&ee.warn(`${this.id} has mipmap and multiple LODs.`)();const a=st.CubeFaces.indexOf(i);this.setTexture2DData(t,a)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:i,width:s,height:a,pixels:l,data:u,format:h=6408,type:d=5121}=t,{gl:p}=this,_=l||u;this.bind(),_ instanceof Promise?_.then(y=>this.setImageDataForFace(Object.assign({},t,{face:i,data:y,pixels:y}))):this.width||this.height?p.texImage2D(i,0,h,s,a,0,h,d,_):p.texImage2D(i,0,h,h,d,_)}_getImageDataMap(t){for(let i=0;i<st.CubeFaces.length;++i){const s=st.CubeFaces[i];t[s]&&(t[34069+i]=t[s],delete t[s])}return t}_setSamplerParameters(t){ee.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[i,s]of Object.entries(t)){const a=Number(i),l=s;switch(a){case 33082:case 33083:this.gl.texParameterf(this.glTarget,a,l);break;case 10241:this.gl.texParameteri(this.glTarget,a,l);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,a,l);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,a,l);break;default:this.gl.texParameteri(this.glTarget,a,l);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,i,s,a=this.glTarget){if(st.isExternalImage(s)){yv(this.device.gl,this.handle,s,{...this,depth:t,mipLevel:i,glTarget:a,flipY:this.props.flipY});return}if(st.isTextureLevelData(s)){bv(this.device.gl,s.data,{...this,depth:t,mipLevel:i,glTarget:a});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:i}=this;return t!==void 0&&(this.textureUnit=t,i.activeTexture(33984+t)),i.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:i}=this;return t!==void 0&&(this.textureUnit=t,i.activeTexture(33984+t)),i.bindTexture(this.glTarget,null),t}}const PP=[1,2,4,8];class DP extends Kd{constructor(t,i){var l;super(t,i);T(this,"device");T(this,"glParameters");this.device=t;let s;if(!((l=i==null?void 0:i.parameters)!=null&&l.viewport))if(i!=null&&i.framebuffer){const{width:u,height:h}=i.framebuffer;s=[0,0,u,h]}else{const[u,h]=t.getCanvasContext().getDrawingBufferSize();s=[0,0,u,h]}this.device.pushState(),this.setParameters({viewport:s,...this.props.parameters});const a=this.props.framebuffer;if(a!=null&&a.handle)if(this.props.framebuffer){const u=this.props.framebuffer.colorAttachments.map((h,d)=>36064+d);this.device.gl.drawBuffers(u)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const i={...this.glParameters};i.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(i.depthMask=!this.props.depthReadOnly),i.stencilMask=this.props.stencilReadOnly?0:1,i[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(i.viewport=t.viewport.slice(0,4),i.depthRange=[t.viewport[4],t.viewport[5]]):i.viewport=t.viewport),t.scissorRect&&(i.scissorTest=!0,i.scissor=t.scissorRect),t.blendConstant&&(i.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(i.colorMask=PP.map(s=>!!(s&t.colorMask))),this.glParameters=i,na(this.device.gl,i)}beginOcclusionQuery(t){const i=this.props.occlusionQuerySet;i==null||i.beginOcclusionQuery()}endOcclusionQuery(){const t=this.props.occlusionQuerySet;t==null||t.endOcclusionQuery()}clear(){const t={...this.glParameters};let i=0;this.props.clearColors&&this.props.clearColors.forEach((s,a)=>{s&&this.clearColorBuffer(a,s)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(i|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(i|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(i|=1024,t.clearStencil=this.props.clearStencil),i!==0&&Yc(this.device.gl,t,()=>{this.device.gl.clear(i)})}clearColorBuffer(t=0,i=[0,0,0,0]){Yc(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(i.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,i);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,i);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,i);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function kP(n){return UP.includes(n)}const UP=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],M1={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function O1(n){const e=M1[n];if(!e)throw new Error("uniform");const[t,i,,s]=e;return{format:s,components:i,glType:t}}function BP(n){const e=M1[n];if(!e)throw new Error("attribute");const[,t,,i,s]=e;return{attributeType:i,vertexFormat:s,components:t}}function LP(n,e){const t={attributes:[],bindings:[]};t.attributes=FP(n,e);const i=HP(n,e);for(const u of i){const h=u.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));t.bindings.push({type:"uniform",name:u.name,group:0,location:u.location,visibility:(u.vertex?1:0)&(u.fragment?2:0),minBindingSize:u.byteLength,uniforms:h})}const s=zP(n,e);let a=0;for(const u of s)if(kP(u.type)){const{viewDimension:h,sampleType:d}=WP(u.type);t.bindings.push({type:"texture",name:u.name,group:0,location:a,viewDimension:h,sampleType:d}),u.textureUnit=a,a+=1}s.length&&(t.uniforms=s);const l=VP(n,e);return l!=null&&l.length&&(t.varyings=l),t}function FP(n,e){const t=[],i=n.getProgramParameter(e,35721);for(let s=0;s<i;s++){const a=n.getActiveAttrib(e,s);if(!a)throw new Error("activeInfo");const{name:l,type:u}=a,h=n.getAttribLocation(e,l);if(h>=0){const{attributeType:d}=BP(u),p=/instance/i.test(l)?"instance":"vertex";t.push({name:l,location:h,stepMode:p,type:d})}}return t.sort((s,a)=>s.location-a.location),t}function VP(n,e){const t=[],i=n.getProgramParameter(e,35971);for(let s=0;s<i;s++){const a=n.getTransformFeedbackVarying(e,s);if(!a)throw new Error("activeInfo");const{name:l,type:u,size:h}=a,{glType:d,components:p}=O1(u),_={location:s,name:l,type:d,size:h*p};t.push(_)}return t.sort((s,a)=>s.location-a.location),t}function zP(n,e){const t=[],i=n.getProgramParameter(e,35718);for(let s=0;s<i;s++){const a=n.getActiveUniform(e,s);if(!a)throw new Error("activeInfo");const{name:l,size:u,type:h}=a,{name:d,isArray:p}=$P(l);let _=n.getUniformLocation(e,d);const y={location:_,name:d,size:u,type:h,isArray:p};if(t.push(y),y.size>1)for(let v=0;v<y.size;v++){const A=`${d}[${v}]`;_=n.getUniformLocation(e,A);const R={...y,name:A,location:_};t.push(R)}}return t}function HP(n,e){const t=(a,l)=>n.getActiveUniformBlockParameter(e,a,l),i=[],s=n.getProgramParameter(e,35382);for(let a=0;a<s;a++){const l={name:n.getActiveUniformBlockName(e,a)||"",location:t(a,35391),byteLength:t(a,35392),vertex:t(a,35396),fragment:t(a,35398),uniformCount:t(a,35394),uniforms:[]},u=t(a,35395)||[],h=n.getActiveUniforms(e,u,35383),d=n.getActiveUniforms(e,u,35384),p=n.getActiveUniforms(e,u,35387),_=n.getActiveUniforms(e,u,35388);for(let y=0;y<l.uniformCount;++y){const v=n.getActiveUniform(e,u[y]);if(!v)throw new Error("activeInfo");l.uniforms.push({name:v.name,format:O1(h[y]).format,type:h[y],arrayLength:d[y],byteOffset:p[y],byteStride:_[y]})}i.push(l)}return i.sort((a,l)=>a.location-l.location),i}const jP={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function WP(n){const e=jP[n];if(!e)throw new Error("sampler");const[t,i]=e;return{viewDimension:t,sampleType:i}}function $P(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function XP(n,e,t,i){const s=n;let a=i;a===!0&&(a=1),a===!1&&(a=0);const l=typeof a=="number"?[a]:a;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,i);case 5126:return n.uniform1fv(e,l);case 35664:return n.uniform2fv(e,l);case 35665:return n.uniform3fv(e,l);case 35666:return n.uniform4fv(e,l);case 5124:return n.uniform1iv(e,l);case 35667:return n.uniform2iv(e,l);case 35668:return n.uniform3iv(e,l);case 35669:return n.uniform4iv(e,l);case 35670:return n.uniform1iv(e,l);case 35671:return n.uniform2iv(e,l);case 35672:return n.uniform3iv(e,l);case 35673:return n.uniform4iv(e,l);case 5125:return s.uniform1uiv(e,l,1);case 36294:return s.uniform2uiv(e,l,2);case 36295:return s.uniform3uiv(e,l,3);case 36296:return s.uniform4uiv(e,l,4);case 35674:return n.uniformMatrix2fv(e,!1,l);case 35675:return n.uniformMatrix3fv(e,!1,l);case 35676:return n.uniformMatrix4fv(e,!1,l);case 35685:return s.uniformMatrix2x3fv(e,!1,l);case 35686:return s.uniformMatrix2x4fv(e,!1,l);case 35687:return s.uniformMatrix3x2fv(e,!1,l);case 35688:return s.uniformMatrix3x4fv(e,!1,l);case 35689:return s.uniformMatrix4x2fv(e,!1,l);case 35690:return s.uniformMatrix4x3fv(e,!1,l)}throw new Error("Illegal uniform")}function YP(n){return c1(n)!==null||typeof n=="number"||typeof n=="boolean"}function qP(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const i=n[t];YP(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}function KP(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function ZP(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const vv=4;class QP extends Wr{constructor(t,i){super(t,i);T(this,"device");T(this,"handle");T(this,"vs");T(this,"fs");T(this,"introspectedLayout");T(this,"uniforms",{});T(this,"bindings",{});T(this,"varyings",null);T(this,"_uniformCount",0);T(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=i.vs,this.fs=i.fs;const{varyings:s,bufferMode:a=35981}=i;s&&s.length>0&&(this.varyings=s,this.device.gl.transformFeedbackVaryings(this.handle,s,a)),this._linkShaders(),ee.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=LP(this.device.gl,this.handle),ee.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=GP(this.introspectedLayout,i.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,i){for(const[s,a]of Object.entries(t)){const l=this.shaderLayout.bindings.find(u=>u.name===s)||this.shaderLayout.bindings.find(u=>u.name===`${s}Uniforms`);if(!l){const u=this.shaderLayout.bindings.map(h=>`"${h.name}"`).join(", ");i!=null&&i.disableWarnings||ee.warn(`No binding "${s}" in render pipeline "${this.id}", expected one of ${u}`,a)();continue}switch(a||ee.warn(`Unsetting binding "${s}" in render pipeline "${this.id}"`)(),l.type){case"uniform":if(!(a instanceof yo)&&!(a.buffer instanceof yo))throw new Error("buffer value");break;case"texture":if(!(a instanceof Br||a instanceof bo||a instanceof _o))throw new Error("texture value");break;case"sampler":ee.warn(`Ignoring sampler ${s}`)();break;default:throw new Error(l.type)}this.bindings[s]=a}}draw(t){var C;const{renderPass:i,parameters:s=this.props.parameters,topology:a=this.props.topology,vertexArray:l,vertexCount:u,instanceCount:h,isInstanced:d=!1,firstVertex:p=0,transformFeedback:_}=t,y=KP(a),v=!!l.indexBuffer,A=(C=l.indexBuffer)==null?void 0:C.glIndexType;if(this.linkStatus!=="success")return ee.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return ee.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),l.bindBeforeRender(i),_&&_.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const R=i;return mP(this.device,s,R.glParameters,()=>{v&&d?this.device.gl.drawElementsInstanced(y,u||0,A,p,h||0):v?this.device.gl.drawElements(y,u||0,A,p):d?this.device.gl.drawArraysInstanced(y,p,u||0,h||0):this.device.gl.drawArrays(y,p,u||0),_&&_.end()}),l.unbindAfterRender(i),!0}setUniformsWebGL(t){const{bindings:i}=qP(t);Object.keys(i).forEach(s=>{ee.warn(`Unsupported value "${JSON.stringify(i[s])}" used in setUniforms() for key ${s}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),ee.time(vv,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),ee.timeEnd(vv,`linkProgram for ${this.id}`)(),ee.level,!this.device.features.has("compilation-status-async-webgl")){const s=this._getLinkStatus();this._reportLinkStatus(s);return}ee.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),ee.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const i=this._getLinkStatus();this._reportLinkStatus(i)}async _reportLinkStatus(t){var i;switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((i=this.fs)==null?void 0:i.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const s=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${s}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async a=>await new Promise(l=>setTimeout(l,a));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:s}=this.device;for(;;){if(s.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const i of this.shaderLayout.bindings)!this.bindings[i.name]&&!this.bindings[i.name.replace(/Uniforms$/,"")]&&(ee.warn(`Binding ${i.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let i=0,s=0;for(const a of this.shaderLayout.bindings){const l=this.bindings[a.name]||this.bindings[a.name.replace(/Uniforms$/,"")];if(!l)throw new Error(`No value for binding ${a.name} in ${this.id}`);switch(a.type){case"uniform":const{name:u}=a,h=t.getUniformBlockIndex(this.handle,u);if(h===4294967295)throw new Error(`Invalid uniform block name ${u}`);t.uniformBlockBinding(this.handle,s,h),l instanceof yo?t.bindBufferBase(35345,s,l.handle):t.bindBufferRange(35345,s,l.buffer.handle,l.offset||0,l.size||l.buffer.byteLength-l.offset),s+=1;break;case"texture":if(!(l instanceof Br||l instanceof bo||l instanceof _o))throw new Error("texture");let d;if(l instanceof Br)d=l.texture;else if(l instanceof bo)d=l;else if(l instanceof _o&&l.colorAttachments[0]instanceof Br)ee.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),d=l.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+i),t.bindTexture(d.glTarget,d.handle),i+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${a.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:i,location:s,type:a,textureUnit:l}=t,u=this.uniforms[i]??l;u!==void 0&&XP(this.device.gl,s,a,u)}}}function GP(n,e){const t={...n,attributes:n.attributes.map(i=>({...i}))};for(const i of(e==null?void 0:e.attributes)||[]){const s=t.attributes.find(a=>a.name===i.name);s?(s.type=i.type||s.type,s.stepMode=i.stepMode||s.stepMode):ee.warn(`shader layout attribute ${i.name} not present in shader`)}return t}class JP extends Qd{constructor(t){super(t,{});T(this,"device");T(this,"commands",[]);this.device=t}submitCommands(t=this.commands){for(const i of t)switch(i.name){case"copy-buffer-to-buffer":eD(this.device,i.options);break;case"copy-buffer-to-texture":tD(this.device,i.options);break;case"copy-texture-to-buffer":nD(this.device,i.options);break;case"copy-texture-to-texture":iD(this.device,i.options);break;default:throw new Error(i.name)}}}function eD(n,e){const t=e.sourceBuffer,i=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,i.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function tD(n,e){throw new Error("Not implemented")}function nD(n,e){const{sourceTexture:t,mipLevel:i=0,aspect:s="all",width:a=e.sourceTexture.width,height:l=e.sourceTexture.height,depthOrArrayLayers:u=0,origin:h=[0,0],destinationBuffer:d,byteOffset:p=0,bytesPerRow:_,rowsPerImage:y}=e;if(s!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||u!==0||_||y)throw new Error("not implemented");const{framebuffer:v,destroyFramebuffer:A}=I1(t);let R;try{const C=d,z=a||v.width,H=l||v.height,M=x1(v.colorAttachments[0].texture.props.format),k=M.format,L=M.type;n.gl.bindBuffer(35051,C.handle),R=n.gl.bindFramebuffer(36160,v.handle),n.gl.readPixels(h[0],h[1],z,H,k,L,p)}finally{n.gl.bindBuffer(35051,null),R!==void 0&&n.gl.bindFramebuffer(36160,R),A&&v.destroy()}}function iD(n,e){const{sourceTexture:t,destinationMipLevel:i=0,origin:s=[0,0],destinationOrigin:a=[0,0],destinationTexture:l}=e;let{width:u=e.destinationTexture.width,height:h=e.destinationTexture.height}=e;const{framebuffer:d,destroyFramebuffer:p}=I1(t),[_,y]=s,[v,A,R]=a,C=n.gl.bindFramebuffer(36160,d.handle);let z=null,H;if(l instanceof bo)z=l,u=Number.isFinite(u)?u:z.width,h=Number.isFinite(h)?h:z.height,z.bind(0),H=z.glTarget;else throw new Error("invalid destination");switch(H){case 3553:case 34067:n.gl.copyTexSubImage2D(H,i,v,A,_,y,u,h);break;case 35866:case 32879:n.gl.copyTexSubImage3D(H,i,v,A,R,_,y,u,h);break}z&&z.unbind(),n.gl.bindFramebuffer(36160,C),p&&d.destroy()}function I1(n){if(n instanceof st){const{width:e,height:t,id:i}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class sD extends Zd{constructor(t,i){super(t,i);T(this,"device");T(this,"commandBuffer");this.device=t,this.commandBuffer=new JP(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,i,s){}}function rD(n){const{target:e,source:t,start:i=0,count:s=1}=n,a=t.length,l=s*a;let u=0;for(let h=i;u<a;u++)e[h++]=t[u];for(;u<l;)u<l-u?(e.copyWithin(i+u,i,i+u),u*=2):(e.copyWithin(i+u,i,i+l-u),u=l);return n.target}class up extends Gd{constructor(t,i){super(t,i);T(this,"device");T(this,"handle");T(this,"buffer",null);T(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return xA()==="Chrome"}destroy(){var t;super.destroy(),this.buffer&&((t=this.buffer)==null||t.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const i=t;if(i&&i.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,i?i.handle:null),this.indexBuffer=i,this.device.gl.bindVertexArray(null)}setBuffer(t,i){const s=i;if(s.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:a,type:l,stride:u,offset:h,normalized:d,integer:p,divisor:_}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,s.handle),p?this.device.gl.vertexAttribIPointer(t,a,l,u,h):this.device.gl.vertexAttribPointer(t,a,l,d,u,h),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,_||0),this.attributes[t]=s,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,i){this._enable(t,!1),this.attributes[t]=i}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const i=this.attributes[t];ArrayBuffer.isView(i)&&this.device.setConstantAttributeWebGL(t,i)}}_getAccessor(t){const i=this.attributeInfos[t];if(!i)throw new Error(`Unknown attribute location ${t}`);const s=T1(i.bufferDataType);return{size:i.bufferComponents,type:s,stride:i.byteStride,offset:i.byteOffset,normalized:i.normalized,integer:i.integer,divisor:i.stepMode==="instance"?1:0}}_enable(t,i=!0){const a=up.isConstantAttributeZeroSupported(this.device)||t!==0;(i||a)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),i?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,i){const s=aD(i),a=s.byteLength*t,l=s.length*t;if(this.buffer&&a!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${a} !== ${this.buffer.byteLength}.`);let u=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:a}),u=u||!oD(s,this.bufferValue),u){const h=oC(i.constructor,l);rD({target:h,source:s,start:0,count:l}),this.buffer.write(h),this.bufferValue=i}return this.buffer}}function aD(n){return Array.isArray(n)?new Float32Array(n):n}function oD(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class lD extends Jd{constructor(t,i){super(t,i);T(this,"device");T(this,"gl");T(this,"handle");T(this,"layout");T(this,"buffers",{});T(this,"unusedBuffers",{});T(this,"bindOnUse",!0);T(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,i.buffers&&this.setBuffers(i.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(ZP(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const i in t)this.setBuffer(i,t[i])})}setBuffer(t,i){const s=this._getVaryingIndex(t),{buffer:a,byteLength:l,byteOffset:u}=this._getBufferRange(i);if(s<0){this.unusedBuffers[t]=a,ee.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[s]={buffer:a,byteLength:l,byteOffset:u},this.bindOnUse||this._bindBuffer(s,a,u,l)}getBuffer(t){if(Tv(t))return this.buffers[t]||null;const i=this._getVaryingIndex(t);return i>=0?this.buffers[i]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let i;return this._bound?i=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,i=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),i}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof yo)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:i,byteOffset:s=0,byteLength:a=t.buffer.byteLength}=t;return{buffer:i,byteOffset:s,byteLength:a}}_getVaryingIndex(t){if(Tv(t))return Number(t);for(const i of this.layout.varyings)if(t===i.name)return i.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:i,byteLength:s,byteOffset:a}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),i,a,s)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,i,s=0,a){const l=i&&i.handle;!l||a===void 0?this.gl.bindBufferBase(35982,t,l):this.gl.bindBufferRange(35982,t,l,s,a)}}function Tv(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class cD extends eg{constructor(t,i){super(t,i);T(this,"device");T(this,"handle");T(this,"target",null);T(this,"_queryPending",!1);T(this,"_pollingPromise",null);if(this.device=t,i.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t!=null&&t.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let i=0;return this._pollingPromise=new Promise((s,a)=>{const l=()=>{this.isResultAvailable()?(s(this.getResult()),this._pollingPromise=null):i++>t?(a("Timed out"),this._pollingPromise=null):requestAnimationFrame(l)};requestAnimationFrame(l)}),this._pollingPromise}}class Lr extends Ki{constructor(t){var _,y;super({...t,id:t.id||fP("webgl-device")});T(this,"type","webgl");T(this,"handle");T(this,"features");T(this,"limits");T(this,"info");T(this,"canvasContext");T(this,"lost");T(this,"_resolveContextLost");T(this,"gl");T(this,"debug",!1);T(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});T(this,"_extensions",{});T(this,"_polyfilled",!1);T(this,"spectorJS");T(this,"renderPass",null);T(this,"_constants");const i=Ki._getCanvasContextProps(t);if(!i)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let s=(y=(_=i.canvas)==null?void 0:_.gl)==null?void 0:y.device;if(s)throw new Error(`WebGL context already attached to device ${s.id}`);this.canvasContext=new eP(this,i),this.lost=new Promise(v=>{this._resolveContextLost=v});const a={...t.webgl};i.alphaMode==="premultiplied"&&(a.premultipliedAlpha=!0),t.powerPreference!==void 0&&(a.powerPreference=t.powerPreference);const u=this.props._handle||DN(this.canvasContext.canvas,{onContextLost:v=>{var A;return(A=this._resolveContextLost)==null?void 0:A.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:v=>console.log("WebGL context restored")},a);if(!u)throw new Error("WebGL context creation failed");if(s=u.device,s){if(t._reuseDevices)return ee.log(1,`Not creating a new Device, instead returning a reference to Device ${s.id} already attached to WebGL context`,s)(),s._reused=!0,s;throw new Error(`WebGL context already attached to device ${s.id}`)}this.handle=u,this.gl=u,this.spectorJS=iP({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=kN(this.gl,this._extensions),this.limits=new QN(this.gl),this.features=new ZN(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),i.autoResize!==!1&&this.canvasContext.resize(),new Cs(this.gl,{log:(...v)=>ee.log(1,...v)()}).trackState(this.gl,{copyState:!1});const d=t.debugWebGL||t.debug,p=t.debugWebGL;d&&(this.gl=aP(this.gl,{debugWebGL:d,traceWebGL:p}),ee.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(ee.level=Math.max(ee.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const i=this._normalizeBufferProps(t);return new yo(this,i)}createTexture(t){return new bo(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new Tg(this,t)}createShader(t){return new pP(this,t)}createFramebuffer(t){return new _o(this,t)}createVertexArray(t){return new up(this,t)}createTransformFeedback(t){return new lD(this,t)}createQuerySet(t){return new cD(this,t)}createRenderPipeline(t){return new QP(this,t)}beginRenderPass(t){return new DP(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(t={}){return new sD(this,t)}submit(){var t;(t=this.renderPass)==null||t.end(),this.renderPass=null}readPixelsToArrayWebGL(t,i){return MP(t,i)}readPixelsToBufferWebGL(t,i){return OP(t,i)}setParametersWebGL(t){na(this.gl,t)}getParametersWebGL(t){return b1(this.gl,t)}withParametersWebGL(t,i){return Yc(this.gl,t,i)}resetWebGL(){ee.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),MN(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return XN(this.gl,t,this._extensions)}loseDevice(){var a;let t=!1;const s=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return s&&(t=!0,s.loseContext()),(a=this._resolveContextLost)==null||a.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){Cs.get(this.gl).push()}popState(){Cs.get(this.gl).pop()}setSpectorMetadata(t,i){t.__SPECTOR_Metadata=i}getGLKey(t,i){const s=Number(t);for(const a in this.gl)if(this.gl[a]===s)return`GL.${a}`;return i!=null&&i.emptyIfUnknown?"":String(t)}getGLKeys(t){const i={emptyIfUnknown:!0};return Object.entries(t).reduce((s,[a,l])=>(s[`${a}:${this.getGLKey(a,i)}`]=`${l}:${this.getGLKey(l,i)}`,s),{})}setConstantAttributeWebGL(t,i){const s=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(s).fill(null);const a=this._constants[t];switch(a&&dD(a,i)&&ee.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=i,i.constructor){case Float32Array:uD(this,t,i);break;case Int32Array:fD(this,t,i);break;case Uint32Array:hD(this,t,i);break;default:throw new Error("constant")}}getExtension(t){return Jr(this.gl,t,this._extensions),this._extensions}}function uD(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function fD(n,e,t){n.gl.vertexAttribI4iv(e,t)}function hD(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function dD(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const gD={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},pD=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),mD=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),_D=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function yD(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,i){if(t==="webgl"||t==="experimental-webgl"){const s=this.originalGetContext("webgl2",i);return s instanceof HTMLElement&&bD(s),s}return this.originalGetContext(t,i)}}function bD(n){n.getExtension("EXT_color_buffer_float");const e={...gD,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:pD(n),OES_vertex_array_object:mD(n),ANGLE_instanced_arrays:_D(n)},t=n.getExtension;n.getExtension=function(s){const a=t.call(n,s);return a||(s in e?e[s]:null)};const i=n.getSupportedExtensions;n.getSupportedExtensions=function(){const s=i.apply(n)||[];return s==null?void 0:s.concat(Object.keys(e))}}const cc=1;class vD extends BR{constructor(){super();T(this,"type","webgl");Ki.defaultProps={...Ki.defaultProps,...cp},Lr.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){yD(t)}async attach(t){if(t instanceof Lr)return t;if((t==null?void 0:t.device)instanceof Ki)return t.device;if(!TD(t))throw new Error("Invalid WebGL2RenderingContext");return new Lr({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(t={}){ee.groupCollapsed(cc,"WebGLDevice created")();const i=[];(t.debugWebGL||t.debug)&&i.push(rP()),t.debugSpectorJS&&i.push(nP(t));const s=await Promise.allSettled(i);for(const u of s)u.status==="rejected"&&ee.error(`Failed to initialize debug libraries ${u.reason}`)();const a=new Lr(t),l=`${a._reused?"Reusing":"Created"} device with WebGL2 ${a.debug?"debug ":""}context: ${a.info.vendor}, ${a.info.renderer} for canvas: ${a.canvasContext.id}`;return ee.probe(cc,l)(),ee.table(cc,a.info)(),ee.groupEnd(cc)(),a}}function TD(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const xv=new vD;function Hi(){}const xD=({isDragging:n})=>n?"grabbing":"grab",N1={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Hi,onWebGLInitialized:Hi,onResize:Hi,onViewStateChange:Hi,onInteractionStateChange:Hi,onBeforeRender:Hi,onAfterRender:Hi,onLoad:Hi,onError:n=>Fe.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:xD,getTooltip:null,debug:!1,drawPickingColors:!1};class fp{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new vu({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:s}=this;if(i.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(i.leftButton||i.rightButton)return;{const a=i.offsetCenter;if(!a)return;s.x=a.x,s.y=a.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=i},this._onEvent=i=>{const s=cg[i.type],a=i.offsetCenter;if(!s||!a||!this.layerManager)return;const l=this.layerManager.getLayers(),u=this.deckPicker.getLastPickedObject({x:a.x,y:a.y,layers:l,viewports:this.getViewports(a)},this._lastPointerDownInfo),{layer:h}=u,d=h&&(h[s]||h.props[s]),p=this.props[s];let _=!1;d&&(_=d.call(h,u,i)),_||(p==null||p(u,i),this.widgetManager.onEvent(u,i))},this._onPointerDown=i=>{var l;if(((l=this.device)==null?void 0:l.type)==="webgpu")return;const s=i.offsetCenter,a=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=a.result[0]||a.emptyInfo},this.props={...N1,...e},e=this.props,e.viewState&&e.initialViewState&&Fe.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Fe.error("WebGL1 context not supported.")(),t=xv.attach(e.gl)),t||(t=Yd.createDevice({type:"best-available",_reuseDevices:!0,adapters:[xv],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&wo.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,t,i,s,a,l,u,h,d,p;(e=this.animationLoop)==null||e.stop(),(t=this.animationLoop)==null||t.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(i=this.layerManager)==null||i.finalize(),this.layerManager=null,(s=this.viewManager)==null||s.finalize(),this.viewManager=null,(a=this.effectManager)==null||a.finalize(),this.effectManager=null,(l=this.deckRenderer)==null||l.finalize(),this.deckRenderer=null,(u=this.deckPicker)==null||u.finalize(),this.deckPicker=null,(h=this.eventManager)==null||h.destroy(),this.eventManager=null,(d=this.widgetManager)==null||d.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((p=this.canvas.parentElement)==null||p.removeChild(this.canvas),this.canvas=null)}setProps(e){var i;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Fe.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Fe.removed("onLayerClick","onClick")(),e.initialViewState&&!jt(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(i=this.animationLoop)==null||i.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),a=this.effectManager.needsRedraw(e),l=this.deckRenderer.needsRedraw(e);return t=t||i||s||a||l,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return kt(this.viewManager),this.viewManager.views}getViewports(e){return kt(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var t;(t=this.layerManager)==null||t.removeDefaultShaderModule(e)}_pick(e,t,i){kt(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(t).timeStart();const a=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return s.get(t).timeEnd(),a}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),kt(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){var s;if(!this.canvas)return;const{width:t,height:i}=e;if(t||t===0){const a=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=a}if(i||i===0){const a=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=((s=e.style)==null?void 0:s.position)||"absolute",this.canvas.style.height=a}}_updateCanvasSize(){var s,a;const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,i=e.clientHeight??e.height;(t!==this.width||i!==this.height)&&(this.width=t,this.height=i,(s=this.viewManager)==null||s.setProps({width:t,height:i}),(a=this.layerManager)==null||a.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:i}))}_createAnimationLoop(e,t){const{gl:i,onError:s,useDevicePixels:a}=t;return new A4({device:e,useDevicePixels:a,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:l=>this._setDevice(l.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new m1({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var t,i,s,a;if(((t=this.device)==null?void 0:t.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:l,emptyInfo:u}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=l.length>0;let h=u,d=!1;for(const p of l)h=p,d=((i=p.layer)==null?void 0:i.onHover(p,e.event))||d;d||((a=(s=this.props).onHover)==null||a.call(s,h,e.event),this.widgetManager.onHover(h,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var s,a;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(s=this.device.canvasContext)==null?void 0:s.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new l1;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new ZO(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(H0).map(l=>{var v;const[u,h,d,p]=H0[l],_=(v=this.props.eventRecognizerOptions)==null?void 0:v[l],y={...h,..._,event:l};return{recognizer:new u(y),recognizeWith:d,requestFailure:p}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const l in cg)this.eventManager.on(l,this._onEvent);this.viewManager=new K4({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new q4(this.device,{deck:this,stats:this.stats,viewport:i,timeline:t}),this.effectManager=new fN({deck:this,device:this.device}),this.deckRenderer=new gN(this.device),this.deckPicker=new vN(this.device),this.widgetManager=new SN({deck:this,parentElement:(a=this.canvas)==null?void 0:a.parentElement}),this.widgetManager.addDefault(new wN),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){var l;const{device:i,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:s});const a={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};(l=this.deckRenderer)==null||l.renderLayers(a),a.pass==="screen"&&this.widgetManager.onRedraw({viewports:a.viewports,layers:a.layers}),this.props.onAfterRender({device:i,gl:s})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Fe.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const i=Yd.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}fp.defaultProps=N1;fp.VERSION=jE;function SD(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return a2(n)}}const AD=r2;function uc(n,e,t){const i=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:n,format:e.size>1?`${i}x${e.size}`:e.type,byteOffset:e.offset||0}}function As(n){return n.stride||n.size*n.bytesPerElement}function wD(n,e){return n.type===e.type&&n.size===e.size&&As(n)===As(e)&&(n.offset||0)===(e.offset||0)}function xg(n,e){e.offset&&Fe.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=As(n),i=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,s=e.elementOffset||0,a=i*t+s*n.bytesPerElement+(n.offset||0);return{...e,offset:a,stride:t}}function ED(n,e){const t=xg(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class RD{constructor(e,t,i){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const s=t.logicalType||t.type,a=s==="float64";let{defaultValue:l}=t;l=Number.isFinite(l)?[l]:l||new Array(this.size).fill(0);let u;a?u="float32":!s&&t.isIndexed?u="uint32":u=s||"float32";let h=SD(s||u);this.doublePrecision=a,a&&t.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...t,defaultType:h,defaultValue:l,logicalType:s,type:u,normalized:u.includes("norm"),size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*As(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),wo.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const i={};if(this.state.constant){const s=this.value;if(t){const a=xg(this.getAccessor(),t),l=a.offset/s.BYTES_PER_ELEMENT,u=a.size||this.size;i[e]=s.subarray(l,l+u)}else i[e]=s}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,t=null){const i=this.getAccessor(),s=[],a={name:this.id,byteStride:As(i),attributes:s};if(this.doublePrecision){const l=ED(i,t||{});s.push(uc(e,{...i,...l.high},this.device.type),uc(`${e}64Low`,{...i,...l.low},this.device.type))}else if(t){const l=xg(i,t);s.push(uc(e,{...i,...l},this.device.type))}else s.push(uc(e,i,this.device.type));return a}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:i,size:s}=this,a=i*s;if(t&&a&&t.length>=a){const l=new Array(s).fill(1/0),u=new Array(s).fill(-1/0);for(let h=0;h<a;)for(let d=0;d<s;d++){const p=t[h++];p<l[d]&&(l[d]=p),p>u[d]&&(u[d]=p)}e=[l,u]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof Qe?i={buffer:e}:i=e;const s={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)s.type="float32";else{const l=AD(i.value);s.type=s.normalized?l.replace("int","norm"):l}s.bytesPerElement=i.value.BYTES_PER_ELEMENT,s.stride=As(s)}if(t.bounds=null,i.constant){let a=i.value;if(a=this._normalizeValue(a,[],0),this.settings.normalized&&(a=this.normalizeConstant(a)),!(!t.constant||!this._areValuesEqual(a,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(a)?a:new Float32Array(a)}else if(i.buffer){const a=i.buffer;t.externalBuffer=a,t.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let a=i.value;t.externalBuffer=null,t.constant=!1,this.value=a;let{buffer:l}=this;const u=As(s),h=(s.vertexOffset||0)*u;if(this.doublePrecision&&a instanceof Float64Array&&(a=vd(a,s)),this.settings.isIndexed){const p=this.settings.defaultType;a.constructor!==p&&(a=new p(a))}const d=a.byteLength+h+u*2;(!l||l.byteLength<d)&&(l=this._createBuffer(d)),l.write(a,h)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:i=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?vd(t,{size:this.size,startIndex:i,endIndex:s}):t.subarray(i,s),i*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:i}=this,s=i.allocatedValue,a=wo.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=a;const{byteOffset:l}=this;let{buffer:u}=this;return(!u||u.byteLength<a.byteLength+l)&&(u=this._createBuffer(a.byteLength+l),t&&s&&u.write(s instanceof Float64Array?vd(s,this):s,l)),i.allocatedValue=a,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=t.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof i)&&this.settings.normalized&&!("normalized"in e)&&Fe.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,i){const{defaultValue:s,size:a}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e){let l=a;for(;--l>=0;)t[i+l]=s[l];return t}switch(a){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let l=a;for(;--l>=0;)t[i+l]=Number.isFinite(e[l])?e[l]:s[l]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:i}=this;for(let s=0;s<i;s++)if(e[s]!==t[s])return!1;return!0}_createBuffer(e){var s;this._buffer&&this._buffer.destroy();const{isIndexed:t,type:i}=this.settings;return this._buffer=this.device.createBuffer({...(s=this._buffer)==null?void 0:s.props,id:this.id,usage:(t?Qe.INDEX:Qe.VERTEX)|Qe.COPY_DST,indexType:t?i:void 0,byteLength:e}),this._buffer}}const Sv=[],Av=[];function P1(n,e=0,t=1/0){let i=Sv;const s={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?i=n:n.length>0&&(Av.length=n.length,i=Av):i=Sv,(e>0||Number.isFinite(t))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,t),s.index=e-1),{iterable:i,objectInfo:s}}function D1(n){return n&&n[Symbol.asyncIterator]}function CD(n,e){const{size:t,stride:i,offset:s,startIndices:a,nested:l}=e,u=n.BYTES_PER_ELEMENT,h=i?i/u:t,d=s?s/u:0,p=Math.floor((n.length-d)/h);return(_,{index:y,target:v})=>{if(!a){const z=y*h+d;for(let H=0;H<t;H++)v[H]=n[z+H];return v}const A=a[y],R=a[y+1]||p;let C;if(l){C=new Array(R-A);for(let z=A;z<R;z++){const H=z*h+d;v=new Array(t);for(let M=0;M<t;M++)v[M]=n[H+M];C[z-A]=v}}else if(h===t)C=n.subarray(A*t+d,R*t+d);else{C=new n.constructor((R-A)*t);let z=0;for(let H=A;H<R;H++){const M=H*h+d;for(let k=0;k<t;k++)C[z++]=n[M+k]}}return C}}const MD=[],bc=[[0,1/0]];function OD(n,e){if(n===bc||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],i=n.length;let s=0;for(let a=0;a<i;a++){const l=n[a];l[1]<e[0]?(t.push(l),s=a+1):l[0]>e[1]?t.push(l):e=[Math.min(l[0],e[0]),Math.max(l[1],e[1])]}return t.splice(s,0,e),t}const ID={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function k1(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...ID[t],...e,...n,type:t}}class U1 extends RD{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:bc}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!wD(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,i=this.settings.transition,s=Array.isArray(t)?e[t.find(a=>e[a])]:e[t];return k1(s,i)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:i=0,endRow:s=1/0}=t;this.state.updateRanges=OD(this.state.updateRanges,[i,s])}else this.state.updateRanges=bc}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=MD}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,t.updateRanges!==bc),!0):!1}updateBuffer({numInstances:e,data:t,props:i,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:l,noAlloc:u}}=this;let h=!0;if(l){for(const[d,p]of a)l.call(s,this,{data:t,startRow:d,endRow:p,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,p]of a){const _=Number.isFinite(d)?this.getVertexOffset(d):0,y=Number.isFinite(p)?this.getVertexOffset(p):u||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:_,endOffset:y})}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:i,settings:s}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),s.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const l=e;kt(ArrayBuffer.isView(l.value),`invalid ${s.accessor}`);const u=!!l.size&&l.size!==this.size;return i.binaryAccessor=CD(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:t,nested:u}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const i in e)Object.assign(t,super.getValue(i,e[i]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=s??"vertex",!t)return i;for(const a in t){const l=super._getBufferLayout(a,t[a]);i.attributes.push(...l.attributes)}return i}_autoUpdater(e,{data:t,startRow:i,endRow:s,props:a,numInstances:l}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:u,state:h,value:d,size:p,startIndices:_}=e,{accessor:y,transform:v}=u;let A=h.binaryAccessor||(typeof y=="function"?y:a[y]);typeof A!="function"&&(A=()=>A),kt(typeof A=="function",`accessor "${y}" is not a function`);let R=e.getVertexOffset(i);const{iterable:C,objectInfo:z}=P1(t,i,s);for(const H of C){z.index++;let M=A(H,z);if(v&&(M=v.call(this,M)),_){const k=(z.index<_.length-1?_[z.index+1]:l)-_[z.index];if(M&&Array.isArray(M[0])){let L=R;for(const X of M)e._normalizeValue(X,d,L),L+=p}else M&&M.length>p?d.set(M,R):(e._normalizeValue(M,z.target,0),j4({target:d,source:z.target,start:R,count:k}));R+=k*p}else e._normalizeValue(M,d,R),R+=p}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Md(n){const{source:e,target:t,start:i=0,size:s,getData:a}=n,l=n.end||t.length,u=e.length,h=l-i;if(u>h){t.set(e.subarray(0,h),i);return}if(t.set(e,i),!a)return;let d=u;for(;d<h;){const p=a(d,e);for(let _=0;_<s;_++)t[i+d]=p[_]||0,d++}}function ND({source:n,target:e,size:t,getData:i,sourceStartIndices:s,targetStartIndices:a}){if(!s||!a)return Md({source:n,target:e,size:t,getData:i}),e;let l=0,u=0;const h=i&&((p,_)=>i(p+u,_)),d=Math.min(s.length,a.length);for(let p=1;p<d;p++){const _=s[p]*t,y=a[p]*t;Md({source:n.subarray(l,_),target:e,start:u,end:y,size:t,getData:h}),l=_,u=y}return u<e.length&&Md({source:[],target:e,start:u,size:t,getData:h}),e}function PD(n){const{device:e,settings:t,value:i}=n,s=new U1(e,t);return s.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),s}function B1(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function L1(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function F1(n){n.push(n.shift())}function DD(n,e){const{doublePrecision:t,settings:i,value:s,size:a}=n,l=t&&s instanceof Float64Array?2:1;let u=0;const{shaderAttributes:h}=n.settings;if(h)for(const d of Object.values(h))u=Math.max(u,d.vertexOffset??0);return(i.noAlloc?s.length:(e+u)*a)*l}function V1({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t==null||t.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function z1({device:n,buffer:e,attribute:t,fromLength:i,toLength:s,fromStartIndices:a,getData:l=u=>u}){const u=t.doublePrecision&&t.value instanceof Float64Array?2:1,h=t.size*u,d=t.byteOffset,p=t.settings.bytesPerElement<4?d/t.settings.bytesPerElement*4:d,_=t.startIndices,y=a&&_,v=t.isConstant;if(!y&&e&&i>=s)return e;const A=t.value instanceof Float64Array?Float32Array:t.value.constructor,R=v?t.value:new A(t.getBuffer().readSyncWebGL(d,s*A.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!v){const M=l;l=(k,L)=>t.normalizeConstant(M(k,L))}const C=v?(M,k)=>l(R,k):(M,k)=>l(R.subarray(M+d,M+d+h),k),z=e?new Float32Array(e.readSyncWebGL(p,i*4).buffer):new Float32Array(0),H=new Float32Array(s);return ND({source:z,target:H,sourceStartIndices:a,targetStartIndices:_,size:h,getData:C}),(!e||e.byteLength<H.byteLength+p)&&(e==null||e.destroy(),e=n.createBuffer({byteLength:H.byteLength+p,usage:35050})),e.write(H,p),e}class H1{constructor({device:e,attribute:t,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new wu(i),this.attribute=t,this.attributeInTransition=PD(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=DD(this.attribute,t),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class kD extends H1{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="interpolation",this.transform=FD(e,t)}start(e,t){const i=this.currentLength,s=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:a,attribute:l}=this;F1(a),a[0]=z1({device:this.device,buffer:a[0],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),a[1]=V1({device:this.device,source:a[0],target:a[1]}),this.setBuffer(a[1]);const{transform:u}=this,h=u.model;let d=Math.floor(this.currentLength/l.size);j1(l)&&(d/=2),h.setVertexCount(d),l.isConstant?(h.setAttributes({aFrom:a[0]}),h.setConstantAttributes({aTo:l.value})):h.setAttributes({aFrom:a[0],aTo:l.getBuffer()}),u.transformFeedback.setBuffers({vCurrent:a[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:i}=this.transition;let s=i/e;t&&(s=t(s));const{model:a}=this.transform,l={time:s};a.shaderInputs.setProps({interpolation:l}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const UD=`uniform interpolationUniforms {
  float time;
} interpolation;
`,wv={name:"interpolation",vs:UD,uniformTypes:{time:"f32"}},BD=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,LD=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function j1(n){return n.doublePrecision&&n.value instanceof Float64Array}function FD(n,e){const t=e.size,i=B1(t),s=L1(t),a=e.getBufferLayout();return j1(e)?new Qr(n,{vs:LD,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*t}]}],modules:[jM,wv],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Qr(n,{vs:BD,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:a.attributes[0].format}],modules:[wv],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class VD extends H1{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="spring",this.texture=XD(e),this.framebuffer=YD(e,this.texture),this.transform=$D(e,t)}start(e,t){const i=this.currentLength,s=this.currentStartIndices;super.start(e,t);const{buffers:a,attribute:l}=this;for(let h=0;h<2;h++)a[h]=z1({device:this.device,buffer:a[h],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});a[2]=V1({device:this.device,source:a[0],target:a[2]}),this.setBuffer(a[1]);const{model:u}=this.transform;u.setVertexCount(Math.floor(this.currentLength/l.size)),l.isConstant?u.setConstantAttributes({aTo:l.value}):u.setAttributes({aTo:l.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:i,transition:s}=this,a=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const l={stiffness:a.stiffness,damping:a.damping};t.model.shaderInputs.setProps({spring:l}),t.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),F1(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const zD=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,HD={name:"spring",vs:zD,uniformTypes:{damping:"f32",stiffness:"f32"}},jD=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,WD=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function $D(n,e){const t=B1(e.size),i=L1(e.size);return new Qr(n,{vs:jD,fs:WD,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[HD],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function XD(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function YD(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const qD={interpolation:kD,spring:VD};class KD{constructor(e,{id:t,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:i}){this.numInstances=i||1;for(const s in e){const a=e[s],l=a.getTransitionSetting(t);l&&this._updateAttribute(s,a,l)}for(const s in this.transitions){const a=e[s];(!a||!a.getTransitionSetting(t))&&this._removeTransition(s)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,i){const s=this.transitions[e];let a=!s||s.type!==i.type;if(a){s&&this._removeTransition(e);const l=qD[i.type];l?this.transitions[e]=new l({attribute:t,timeline:this.timeline,device:this.device}):(Fe.error(`unsupported transition type '${i.type}'`)(),a=!1)}(a||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const Ev="attributeManager.invalidate",ZD="attributeManager.updateStart",QD="attributeManager.updateEnd",GD="attribute.updateStart",JD="attribute.allocate",ek="attribute.updateEnd";class Eu{constructor(e,{id:t="attribute-manager",stats:i,timeline:s}={}){this.mergeBoundsMemoized=Po(a4),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new KD(e,{id:`${t}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const i=this._invalidateTrigger(e,t);Dt(Ev,this,e,i)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Dt(Ev,this,"all")}update({data:e,numInstances:t,startIndices:i=null,transitions:s,props:a={},buffers:l={},context:u={}}){let h=!1;Dt(ZD,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const p=this.attributes[d],_=p.settings.accessor;p.startIndices=i,p.numInstances=t,a[d]&&Fe.removed(`props.${d}`,`data.attributes.${d}`)(),p.setExternalBuffer(l[d])||p.setBinaryValue(typeof _=="string"?l[_]:void 0,e.startIndices)||typeof _=="string"&&!l[_]&&p.setConstantValue(a[_])||p.needsUpdate()&&(h=!0,this._updateAttribute({attribute:p,numInstances:t,data:e,props:a,context:u})),this.needsRedraw=this.needsRedraw||p.needsRedraw()}h&&Dt(QD,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(i=>{var s;return(s=this.attributes[i])==null?void 0:s.getBounds()});return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:i}=this,s={...i.getAttributes()};for(const a in t){const l=t[a];l.needsRedraw(e)&&!i.hasAttribute(a)&&(s[a]=l)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const i in e){const s=e[i],a={...s,id:i,size:s.isIndexed&&1||s.size||1,...t};this.attributes[i]=new U1(this.device,a)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:i,updateTriggers:s}=this,a=s[e];return a&&a.forEach(l=>{const u=i[l];u&&u.setNeedsUpdate(u.id,t)}),a}_updateAttribute(e){const{attribute:t,numInstances:i}=e;if(Dt(GD,t),t.constant){t.setConstantValue(t.value);return}t.allocate(i)&&Dt(JD,t,i),t.updateBuffer(e)&&(this.needsRedraw=!0,Dt(ek,t,i))}}class tk extends wu{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:i,duration:s,easing:a}}=this,l=a(e/s);this._value=Vc(t,i,l)}}const Rv=1e-5;function Cv(n,e,t,i,s){const a=e-n,u=(t-e)*s,h=-a*i;return u+h+a+e}function nk(n,e,t,i,s){if(Array.isArray(t)){const a=[];for(let l=0;l<t.length;l++)a[l]=Cv(n[l],e[l],t[l],i,s);return a}return Cv(n,e,t,i,s)}function Mv(n,e){if(Array.isArray(n)){let t=0;for(let i=0;i<n.length;i++){const s=n[i]-e[i];t+=s*s}return Math.sqrt(t)}return Math.abs(n-e)}class ik extends wu{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:i,stiffness:s}=this.settings,{_prevValue:a=e,_currValue:l=e}=this;let u=nk(a,l,t,i,s);const h=Mv(u,t),d=Mv(u,l);h<Rv&&d<Rv&&(u=t,this.end()),this._prevValue=l,this._currValue=u}}const sk={interpolation:tk,spring:ik};class rk{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,s){const{transitions:a}=this;if(a.has(e)){const h=a.get(e),{value:d=h.settings.fromValue}=h;t=d,this.remove(e)}if(s=k1(s),!s)return;const l=sk[s.type];if(!l){Fe.error(`unsupported transition type '${s.type}'`)();return}const u=new l(this.timeline);u.start({...s,fromValue:t,toValue:i}),a.set(e,u)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function ak(n){const e=n[Qi];for(const t in e){const i=e[t],{validate:s}=i;if(s&&!s(n[t],i))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function ok(n,e){const t=hp({newProps:n,oldProps:e,propTypes:n[Qi],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=ck(n,e);let s=!1;return i||(s=uk(n,e)),{dataChanged:i,propsChanged:t,updateTriggersChanged:s,extensionsChanged:fk(n,e),transitionsChanged:lk(n,e)}}function lk(n,e){if(!n.transitions)return!1;const t={},i=n[Qi];let s=!1;for(const a in n.transitions){const l=i[a],u=l&&l.type;(u==="number"||u==="color"||u==="array")&&Sg(n[a],e[a],l)&&(t[a]=!0,s=!0)}return s?t:!1}function hp({newProps:n,oldProps:e,ignoreProps:t={},propTypes:i={},triggerName:s="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const a of Object.keys(n))if(!(a in t)){if(!(a in e))return`${s}.${a} added`;const l=Sg(n[a],e[a],i[a]);if(l)return`${s}.${a} ${l}`}for(const a of Object.keys(e))if(!(a in t)){if(!(a in n))return`${s}.${a} dropped`;if(!Object.hasOwnProperty.call(n,a)){const l=Sg(n[a],e[a],i[a]);if(l)return`${s}.${a} ${l}`}}return!1}function Sg(n,e,t){let i=t&&t.equal;return i&&!i(n,e,t)||!i&&(i=n&&e&&n.equals,i&&!i.call(n,e))?"changed deeply":!i&&e!==n?"changed shallowly":null}function ck(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:i,_dataDiff:s}=n;return i?i(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&s&&(t=s(n.data,e.data)||t),t}function uk(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&Ov(n,e,"all"))return{all:!0};const t={};let i=!1;for(const s in n.updateTriggers)s!=="all"&&Ov(n,e,s)&&(t[s]=!0,i=!0);return i?t:!1}function fk(n,e){if(e===null)return!0;const t=e.extensions,{extensions:i}=n;if(i===t)return!1;if(!t||!i||i.length!==t.length)return!0;for(let s=0;s<i.length;s++)if(!i[s].equals(t[s]))return!0;return!1}function Ov(n,e,t){let i=n.updateTriggers[t];i=i??{};let s=e.updateTriggers[t];return s=s??{},hp({oldProps:s,newProps:i,triggerName:t})}const hk="count(): argument not an object",dk="count(): argument not a container";function gk(n){if(!mk(n))throw new Error(hk);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(pk(n))return Object.keys(n).length;throw new Error(dk)}function pk(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function mk(n){return n!==null&&typeof n=="object"}function Iv(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=t.modules.findIndex(s=>s.name==="project32");i>=0&&t.modules.splice(i,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const i={...n.inject};for(const s in e.inject)i[s]=(i[s]||"")+e.inject[s];t.inject=i}return t}const _k={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Ag={};function yk(n,e,t,i){if(t instanceof st)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let s=null;t.compressed&&(s={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const a=e.createTexture({...t,sampler:{..._k,...s,...i},mipmaps:!0});return Ag[a.id]=n,a}function bk(n,e){!e||!(e instanceof st)||Ag[e.id]===n&&(e.delete(),delete Ag[e.id])}const vk={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||wg(n)&&(n.length===3||n.length===4)},equal(n,e,t){return jt(n,e,1)}},accessor:{validate(n,e){const t=qc(n);return t==="function"||t===qc(e.value)},equal(n,e,t){return typeof e=="function"?!0:jt(n,e,1)}},array:{validate(n,e){return e.optional&&!n||wg(n)},equal(n,e,t){const{compare:i}=t,s=Number.isInteger(i)?i:i?1:0;return i?jt(n,e,s):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:i}=t,s=Number.isInteger(i)?i:i?1:0;return i?jt(n,e,s):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:i}=t.props;return i?i(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const i=t.context;return!i||!i.device?null:yk(t.id,i.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{bk(t.id,n)}}};function Tk(n){const e={},t={},i={};for(const[s,a]of Object.entries(n)){const l=a==null?void 0:a.deprecatedFor;if(l)i[s]=Array.isArray(l)?l:[l];else{const u=xk(s,a);e[s]=u,t[s]=u.value}}return{propTypes:e,defaultProps:t,deprecatedProps:i}}function xk(n,e){switch(qc(e)){case"object":return ro(n,e);case"array":return ro(n,{type:"array",value:e,compare:!1});case"boolean":return ro(n,{type:"boolean",value:e});case"number":return ro(n,{type:"number",value:e});case"function":return ro(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function ro(n,e){return"type"in e?{name:n,...vk[e.type],...e}:"value"in e?{name:n,type:qc(e.value),...e}:{name:n,type:"object",value:e}}function wg(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function qc(n){return wg(n)?"array":n===null?"null":typeof n}function Sk(n,e){let t;for(let a=e.length-1;a>=0;a--){const l=e[a];"extensions"in l&&(t=l.extensions)}const i=Eg(n.constructor,t),s=Object.create(i);s[Xc]=n,s[Ps]={},s[qi]={};for(let a=0;a<e.length;++a){const l=e[a];for(const u in l)s[u]=l[u]}return Object.freeze(s),s}const Ak="_mergedDefaultProps";function Eg(n,e){if(!(n instanceof Ru.constructor))return{};let t=Ak;if(e)for(const s of e){const a=s.constructor;a&&(t+=`:${a.extensionName||a.name}`)}const i=W1(n,t);return i||(n[t]=wk(n,e||[]))}function wk(n,e){if(!n.prototype)return null;const i=Object.getPrototypeOf(n),s=Eg(i),a=W1(n,"defaultProps")||{},l=Tk(a),u=Object.assign(Object.create(null),s,l.defaultProps),h=Object.assign(Object.create(null),s==null?void 0:s[Qi],l.propTypes),d=Object.assign(Object.create(null),s==null?void 0:s[Ad],l.deprecatedProps);for(const p of e){const _=Eg(p.constructor);_&&(Object.assign(u,_),Object.assign(h,_[Qi]),Object.assign(d,_[Ad]))}return Ek(u,n),Ck(u,h),Rk(u,d),u[Qi]=h,u[Ad]=d,e.length===0&&!dp(n,"_propTypes")&&(n._propTypes=h),u}function Ek(n,e){const t=Ok(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function Rk(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(i){const s=`${this.id}: ${t}`;for(const a of e[t])dp(this,a)||(this[a]=i);Fe.deprecated(s,e[t].join("/"))()}})}function Ck(n,e){const t={},i={};for(const s in e){const a=e[s],{name:l,value:u}=a;a.async&&(t[l]=u,i[l]=Mk(l))}n[zr]=t,n[Ps]={},Object.defineProperties(n,i)}function Mk(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||D1(e)?this[Ps][n]=e:this[qi][n]=e},get(){if(this[qi]){if(n in this[qi])return this[qi][n]||this[zr][n];if(n in this[Ps]){const e=this[Xc]&&this[Xc].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[zr][n]}}return this[zr][n]}}}function dp(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function W1(n,e){return dp(n,e)&&n[e]}function Ok(n){const e=n.componentName;return e||Fe.warn(`${n.name}.componentName not specified`)(),e||n.name}let Ik=0;class Ru{constructor(...e){this.props=Sk(this,e),this.id=this.props.id,this.count=Ik++}clone(e){const{props:t}=this,i={};for(const s in t[zr])s in t[qi]?i[s]=t[qi][s]:s in t[Ps]&&(i[s]=t[Ps][s]);return new this.constructor({...t,...i,...e})}}Ru.componentName="Component";Ru.defaultProps={};const Nk=Object.freeze({});class Pk{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||Nk}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Xc]||this.component;const t=e[qi]||{},i=e[Ps]||e,s=e[zr]||{};for(const a in t){const l=t[a];this._createAsyncPropData(a,s[a]),this._updateAsyncProp(a,l),t[a]=this.getAsyncProp(a)}for(const a in i){const l=i[a];this._createAsyncPropData(a,s[a]),this._updateAsyncProp(a,l)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(D1(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const i=this.asyncProps[e];return t===i.resolvedValue||t===i.lastValue?!1:(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){const s=this.asyncProps[e];s&&i>=s.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=t,s.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const s=i.pendingLoadCount;t.then(a=>{this.component&&(a=this._postProcessValue(i,a),this._setAsyncPropValue(e,a,s),this._onResolve(e,a))}).catch(a=>{this._onError(e,a)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const s=i.pendingLoadCount;let a=[],l=0;for await(const u of t){if(!this.component)return;const{dataTransform:h}=this.component.props;h?a=h(u,a):a=a.concat(u),Object.defineProperty(a,"__diff",{enumerable:!1,value:[{startRow:l,endRow:a.length}]}),l=a.length,this._setAsyncPropValue(e,a,s)}this._onResolve(e,a)}_postProcessValue(e,t){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const s=this.component&&this.component.props[Qi];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class Dk extends Pk{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const i=this.layer,s=i==null?void 0:i.props.fetch;return s?s(t,{propName:e,layer:i}):super._fetch(e,t)}_onResolve(e,t){const i=this.layer;if(i){const s=i.props.onDataLoad;e==="data"&&s&&s(t,{propName:e,layer:i})}}_onError(e,t){const i=this.layer;i&&i.raiseError(t,`loading ${e} of ${this.layer}`)}}const kk="layer.changeFlag",Uk="layer.initialize",Bk="layer.update",Lk="layer.finalize",Fk="layer.matched",Nv=2**24-1,Vk=Object.freeze([]),zk=Po(({oldViewport:n,viewport:e})=>n.equals(e));let An=new Uint8ClampedArray(0);const Hk={data:{type:"data",value:Vk,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:i,loadOptions:s,signal:a})=>{const{resourceManager:l}=t.context;s=s||t.getLoadOptions(),i=i||t.props.loaders,a&&(s={...s,fetch:{...s==null?void 0:s.fetch,signal:a}});let u=l.contains(n);return!u&&!s&&(l.add({resourceId:n,data:Vd(n,i),persistent:!1}),u=!0),u?l.subscribe({resourceId:n,onChange:h=>{var d;return(d=t.internalState)==null?void 0:d.reloadAsyncProp(e,h)},consumerId:t.id,requestId:e}):Vd(n,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Ie.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Ls extends Ru{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Nr.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){kt(this.internalState);const t=this.internalState.viewport||this.context.viewport,i=a1(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,a,l]=t1(i,t.pixelProjectionMatrix);return e.length===2?[s,a]:[s,a,l]}unproject(e){return kt(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){kt(this.internalState);const i=this.internalState.viewport||this.context.viewport;return o1(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ie.DEFAULT||e===Ie.LNGLAT||e===Ie.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){kt(e instanceof Uint8Array);const[t,i,s]=e;return t+i*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:gk(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=Iv(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=Iv(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(const s of i)t.invalidateAll(s);else t.invalidateAll();if(t){const{props:s}=e,a=this.internalState.hasPickingBuffer,l=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(u=>u.getNeedsPickingBuffer.call(this,u));if(a!==l){this.internalState.hasPickingBuffer=l;const{pickingColors:u,instancePickingColors:h}=t.attributes,d=u||h;d&&(l&&d.constant&&(d.constant=!1,t.invalidate(d.id)),!d.value&&!l&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:i}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,t){var i,s,a,l;t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),(s=(i=this.props).onError)!=null&&s.call(i,e)||(l=(a=this.context)==null?void 0:a.onError)==null||l.call(a,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!zk({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const i in e)e[i].layoutChanged()&&(t=!0);for(const i of this.getModels())this._setModelAttributes(i,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,i=this.getNumInstances(),s=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:s,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const a=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(a)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),i=Object.create(this.props);for(const s in t)Object.defineProperty(i,s,{value:t[s]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const i=Math.floor(An.length/4);if(this.internalState.usesPickingColorCache=!0,i<t){t>Nv&&Fe.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),An=wo.allocate(An,t,{size:4,copy:!0,maxCount:Math.max(t,Nv)});const s=Math.floor(An.length/4),a=[0,0,0];for(let l=i;l<s;l++)this.encodePickingColor(l,a),An[l*4+0]=a[0],An[l*4+1]=a[1],An[l*4+2]=a[2],An[l*4+3]=0}e.value=An.subarray(0,t*4)}_setModelAttributes(e,t,i=!1){var u;if(!Object.keys(t).length)return;if(i){const h=this.getAttributeManager();e.setBufferLayout(h.getBufferLayouts(e)),t=h.getAttributes()}const s=((u=e.userData)==null?void 0:u.excludeAttributes)||{},a={},l={};for(const h in t){if(s[h])continue;const d=t[h].getValue();for(const p in d){const _=d[p];_ instanceof Qe?t[h].settings.isIndexed?e.setIndexBuffer(_):a[p]=_:_&&(l[p]=_)}}e.setAttributes(a),e.setConstantAttributes(l)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:s}=this.getAttributeManager().attributes,a=i||s,l=a&&t.attributes&&t.attributes[a.id];if(l&&l.value){const u=l.value,h=this.encodePickingColor(e);for(let d=0;d<t.length;d++){const p=a.getVertexOffset(d);u[p]===h[0]&&u[p+1]===h[1]&&u[p+2]===h[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,s=t||i;if(!s)return;const a=s.getVertexOffset(e),l=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(l-a),a)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==An.buffer&&(i.value=An.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){kt(!this.internalState),kt(Number.isFinite(this.props.coordinateSystem)),Dt(Uk,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Dk({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Fe.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new rk(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Dt(Fk,this,this===e);const{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Dt(Bk,this,e),!e)return;const t=this.props,i=this.context,s=this.internalState,a=i.viewport,l=this._updateUniformTransition();s.propsInTransition=l,i.viewport=s.viewport||a,this.props=l;try{const u=this._getUpdateParams(),h=this.getModels();if(i.device)this.updateState(u);else try{this.updateState(u)}catch{}for(const p of this.props.extensions)p.updateState.call(this,u,p);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==h[0];this._postUpdate(u,d)}finally{i.viewport=a,this.props=t,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Dt(Lk,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:i={},parameters:s={}}){this._updateAttributeTransition();const a=this.props,l=this.context;this.props=this.internalState.propsInTransition||a;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:u}=this.props,h=u&&u(i)||[0,0];l.device instanceof Lr&&l.device.setParametersWebGL({polygonOffset:h});for(const d of this.getModels())d.device.type==="webgpu"?d.setParameters({...d.parameters,...s}):d.setParameters(s);if(l.device instanceof Lr)l.device.withParametersWebGL(s,()=>{const d={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:s,context:l};for(const p of this.props.extensions)p.draw.call(this,d,p);this.draw(d)});else{const d={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:s,context:l};for(const p of this.props.extensions)p.draw.call(this,d,p);this.draw(d)}}finally{this.props=a}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const s in e)if(e[s]){let a=!1;switch(s){case"dataChanged":const l=e[s],u=t[s];l&&Array.isArray(u)&&(t.dataChanged=Array.isArray(l)?u.concat(l):l,a=!0);default:t[s]||(t[s]=e[s],a=!0)}a&&Dt(kk,this,s,e)}const i=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){var s;const i=ok(e,t);if(i.updateTriggersChanged)for(const a in i.updateTriggersChanged)i.updateTriggersChanged[a]&&this.invalidateAttribute(a);if(i.transitionsChanged)for(const a in i.transitionsChanged)this.internalState.uniformTransitions.add(a,t[a],e[a],(s=e.transitions)==null?void 0:s[a]);return this.setChangeFlags(i)}validateProps(){ak(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(t.highlightColor=i(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new Eu(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:i,oldProps:s}=e,a=this.state.model;a!=null&&a.isInstanced&&a.setInstanceCount(this.getNumInstances());const{autoHighlight:l,highlightedObjectIndex:u,highlightColor:h}=i;if(t||s.autoHighlight!==l||s.highlightedObjectIndex!==u||s.highlightColor!==h){const d={};Array.isArray(h)&&(d.highlightColor=h),(t||s.autoHighlight!==l||u!==s.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(u)&&u>=0?this.encodePickingColor(u):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),s=i?i.getNeedsRedraw(e):!1;if(t=t||s,t)for(const a of this.props.extensions)a.onNeedsRedraw.call(this,a);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Ls.defaultProps=Hk;Ls.layerName="Layer";const jk="compositeLayer.renderLayers";class gp extends Ls{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||t}getSubLayerRow(e,t,i){return e.__source={parent:this,object:t,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(i,s)=>i&&i.__source?(t.index=i.__source.index,e(i.__source.object,t)):e(i,s)}return e}getSubLayerProps(e={}){var ce;const{opacity:t,pickable:i,visible:s,parameters:a,getPolygonOffset:l,highlightedObjectIndex:u,autoHighlight:h,highlightColor:d,coordinateSystem:p,coordinateOrigin:_,wrapLongitude:y,positionFormat:v,modelMatrix:A,extensions:R,fetch:C,operation:z,_subLayerProps:H}=this.props,M={id:"",updateTriggers:{},opacity:t,pickable:i,visible:s,parameters:a,getPolygonOffset:l,highlightedObjectIndex:u,autoHighlight:h,highlightColor:d,coordinateSystem:p,coordinateOrigin:_,wrapLongitude:y,positionFormat:v,modelMatrix:A,extensions:R,fetch:C,operation:z},k=H&&e.id&&H[e.id],L=k&&k.updateTriggers,X=e.id||"sublayer";if(k){const re=this.props[Qi],ne=e.type?e.type._propTypes:{};for(const he in k){const te=ne[he]||re[he];te&&te.type==="accessor"&&(k[he]=this.getSubLayerAccessor(k[he]))}}Object.assign(M,e,k),M.id=`${this.props.id}-${X}`,M.updateTriggers={all:(ce=this.props.updateTriggers)==null?void 0:ce.all,...e.updateTriggers,...L};for(const re of R){const ne=re.getSubLayerProps.call(this,re);ne&&Object.assign(M,ne,{updateTriggers:Object.assign(M.updateTriggers,ne.updateTriggers)})}return M}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let i=this.internalState.subLayers;const s=!i||this.needsUpdate();if(s){const a=this.renderLayers();i=rp(a,Boolean),this.internalState.subLayers=i}Dt(jk,this,s,i);for(const a of i)a.parent=this}}gp.layerName="CompositeLayer";const Wk=typeof window<"u"?J.useLayoutEffect:J.useEffect;function Kc(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const $k={position:"absolute",zIndex:-1};function $1(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>$1(t,e));if(Cu(n)){if(Xk(n))return e.style=$k,J.cloneElement(n,e);if(Yk(n))return J.cloneElement(n,e)}return n}function Cu(n){return n&&typeof n=="object"&&"type"in n||!1}function Xk(n){var e;return(e=n.props)==null?void 0:e.mapStyle}function Yk(n){const e=n.type;return e&&e.deckGLViewProps}function Rg(n){if(typeof n=="function")return J.createElement(Gr,{},n);if(Array.isArray(n))return n.map(Rg);if(Cu(n)){if(n.type===J.Fragment)return Rg(n.props.children);if(Kc(n.type,Gr))return n}return n}function qk({children:n,layers:e=[],views:t=null}){const i=[],s=[],a={};return J.Children.forEach(Rg(n),l=>{if(Cu(l)){const u=l.type;if(Kc(u,Ls)){const h=Kk(u,l.props);s.push(h)}else i.push(l);if(Kc(u,Gr)&&u!==Gr&&l.props.id){const h=new u(l.props);a[h.id]=h}}else l&&i.push(l)}),Object.keys(a).length>0&&(Array.isArray(t)?t.forEach(l=>{a[l.id]=l}):t&&(a[t.id]=t),t=Object.values(a)),e=s.length>0?[...s,...e]:e,{layers:e,children:i,views:t}}function Kk(n,e){const t={},i=n.defaultProps||{};for(const s in e)i[s]!==e[s]&&(t[s]=e[s]);return new n(t)}const Zk=J.createContext();function Qk({children:n,deck:e,ContextProvider:t=Zk.Provider}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const s={},a=i.views[0].id;for(const l of n){let u=a,h=l;Cu(l)&&Kc(l.type,Gr)&&(u=l.props.id||a,h=l.props.children);const d=i.getViewport(u),p=i.getViewState(u);if(d){p.padding=d.padding;const{x:_,y,width:v,height:A}=d;h=$1(h,{x:_,y,width:v,height:A,viewport:d,viewState:p}),s[u]||(s[u]={viewport:d,children:[]}),s[u].children.push(h)}}return Object.keys(s).map(l=>{const{viewport:u,children:h}=s[l],{x:d,y:p,width:_,height:y}=u,v={position:"absolute",left:d,top:p,width:_,height:y},A=`view-${l}`,R=J.createElement("div",{key:A,id:A,style:v},...h),C={deck:e,viewport:u,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:H=>{H.viewId=l,e._onViewStateChange(H)},widgets:[]},z=`view-${l}-context`;return J.createElement(t,{key:z,value:C},R)})}const Gk={mixBlendMode:null};function Jk({width:n,height:e,style:t}){const i={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},s={left:0,top:0};if(t)for(const a in t)a in Gk?s[a]=t[a]:i[a]=t[a];return{containerStyle:i,canvasStyle:s}}function e6(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function X1(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function t6(n,e,t){var s,a,l;const i=new e({...t,_customRender:((l=(a=(s=t.deviceProps)==null?void 0:s.adapters)==null?void 0:a[0])==null?void 0:l.type)==="webgpu"?void 0:u=>{n.redrawReason=u;const h=i.getViewports();n.lastRenderedViewports!==h?n.forceUpdate():X1(n)}});return i}function n6(n,e){const[t,i]=J.useState(0),a=J.useRef({control:null,version:t,forceUpdate:()=>i(L=>L+1)}).current,l=J.useRef(null),u=J.useRef(null),h=J.useMemo(()=>qk(n),[n.layers,n.views,n.children]);let d=!0;const p=L=>{var X;return d&&n.viewState?(a.viewStateUpdateRequested=L,null):(a.viewStateUpdateRequested=null,(X=n.onViewStateChange)==null?void 0:X.call(n,L))},_=L=>{var X;d?a.interactionStateUpdateRequested=L:(a.interactionStateUpdateRequested=null,(X=n.onInteractionStateChange)==null||X.call(n,L))},y=J.useMemo(()=>{const L={widgets:[],...n,style:null,width:"100%",height:"100%",parent:l.current,canvas:u.current,layers:h.layers,views:h.views,onViewStateChange:p,onInteractionStateChange:_};return delete L._customRender,a.deck&&a.deck.setProps(L),L},[n]);J.useEffect(()=>{const L=n.Deck||fp;return a.deck=t6(a,L,{...y,parent:l.current,canvas:u.current}),()=>{var X;return(X=a.deck)==null?void 0:X.finalize()}},[]),Wk(()=>{X1(a);const{viewStateUpdateRequested:L,interactionStateUpdateRequested:X}=a;L&&p(L),X&&_(X)}),J.useImperativeHandle(e,()=>e6(a),[]);const v=a.deck&&a.deck.isInitialized?a.deck.getViewports():void 0,{ContextProvider:A,width:R="100%",height:C="100%",id:z,style:H}=n,{containerStyle:M,canvasStyle:k}=J.useMemo(()=>Jk({width:R,height:C,style:H}),[R,C,H]);if(!a.viewStateUpdateRequested&&a.lastRenderedViewports===v||a.version!==t){a.lastRenderedViewports=v,a.version=t;const L=Qk({children:h.children,deck:a.deck,ContextProvider:A}),X=J.createElement("canvas",{key:"canvas",id:z||"deckgl-overlay",ref:u,style:k});a.control=J.createElement("div",{id:`${z||"deckgl"}-wrapper`,ref:l,style:M},[X,L])}return d=!1,a.control}const i6=J.forwardRef(n6),Pv=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,s6={name:"scatterplot",vs:Pv,fs:Pv,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},r6=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,a6=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,o6=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,Dv=[0,0,0,255],l6={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Dv},getLineColor:{type:"accessor",value:Dv},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class pp extends Ls{getShaders(){return super.getShaders({vs:r6,fs:a6,source:o6,modules:[Do,i1,s6]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var t;super.updateState(e),e.changeFlags.extensionsChanged&&((t=this.state.model)==null||t.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:i,radiusMinPixels:s,radiusMaxPixels:a,stroked:l,filled:u,billboard:h,antialiasing:d,lineWidthUnits:p,lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:v}=this.props,A={stroked:l,filled:u,billboard:h,antialiasing:d,radiusUnits:Ji[t],radiusScale:i,radiusMinPixels:s,radiusMaxPixels:a,lineWidthUnits:Ji[p],lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:v},R=this.state.model;R.shaderInputs.setProps({scatterplot:A}),R.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Wn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new h1({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}pp.defaultProps=l6;pp.layerName="ScatterplotLayer";const c6={COUNTER_CLOCKWISE:-1};function u6(n,e,t={}){return f6(n,t)!==e?(d6(n,t),!0):!1}function f6(n,e={}){return Math.sign(h6(n,e))}const kv={x:0,y:1,z:2};function h6(n,e={}){const{start:t=0,end:i=n.length,plane:s="xy"}=e,a=e.size||2;let l=0;const u=kv[s[0]],h=kv[s[1]];for(let d=t,p=i-a;d<i;d+=a)l+=(n[d+u]-n[p+u])*(n[d+h]+n[p+h]),p=d;return l/2}function d6(n,e){const{start:t=0,end:i=n.length,size:s=2}=e,a=(i-t)/s,l=Math.floor(a/2);for(let u=0;u<l;++u){const h=t+u*s,d=t+(a-1-u)*s;for(let p=0;p<s;++p){const _=n[h+p];n[h+p]=n[d+p],n[d+p]=_}}}class g6 extends h1{constructor(e){const{indices:t,attributes:i}=p6(e);super({...e,indices:t,attributes:i})}}function p6(n){const{radius:e,height:t=1,nradial:i=10}=n;let{vertices:s}=n;s&&(Fe.assert(s.length>=i),s=s.flatMap(v=>[v[0],v[1]]),u6(s,c6.COUNTER_CLOCKWISE));const a=t>0,l=i+1,u=a?l*3+1:i,h=Math.PI*2/i,d=new Uint16Array(a?i*3*2:0),p=new Float32Array(u*3),_=new Float32Array(u*3);let y=0;if(a){for(let v=0;v<l;v++){const A=v*h,R=v%i,C=Math.sin(A),z=Math.cos(A);for(let H=0;H<2;H++)p[y+0]=s?s[R*2]:z*e,p[y+1]=s?s[R*2+1]:C*e,p[y+2]=(1/2-H)*t,_[y+0]=s?s[R*2]:z,_[y+1]=s?s[R*2+1]:C,y+=3}p[y+0]=p[y-3],p[y+1]=p[y-2],p[y+2]=p[y-1],y+=3}for(let v=a?0:1;v<l;v++){const A=Math.floor(v/2)*Math.sign(.5-v%2),R=A*h,C=(A+i)%i,z=Math.sin(R),H=Math.cos(R);p[y+0]=s?s[C*2]:H*e,p[y+1]=s?s[C*2+1]:z*e,p[y+2]=t/2,_[y+2]=1,y+=3}if(a){let v=0;for(let A=0;A<i;A++)d[v++]=A*2+0,d[v++]=A*2+2,d[v++]=A*2+0,d[v++]=A*2+1,d[v++]=A*2+1,d[v++]=A*2+3}return{indices:d,attributes:{POSITION:{size:3,value:p},NORMAL:{size:3,value:_}}}}const Uv=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,m6={name:"column",vs:Uv,fs:Uv,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}},_6=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,y6=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Zc=[0,0,0,255],b6={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:n=>n.position},getFillColor:{type:"accessor",value:Zc},getLineColor:{type:"accessor",value:Zc},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class mp extends Ls{getShaders(){const e={},{flatShading:t}=this.props;return t&&(e.FLAT_SHADING=1),super.getShaders({vs:_6,fs:y6,defines:e,modules:[Do,t?V2:F2,i1,m6]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:Zc},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:Zc},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){var u;super.updateState(e);const{props:t,oldProps:i,changeFlags:s}=e,a=s.extensionsChanged||t.flatShading!==i.flatShading;a&&((u=this.state.models)==null||u.forEach(h=>h.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const l=this.getNumInstances();this.state.fillModel.setInstanceCount(l),this.state.wireframeModel.setInstanceCount(l),(a||t.diskResolution!==i.diskResolution||t.vertices!==i.vertices||(t.extruded||t.stroked)!==(i.extruded||i.stroked))&&this._updateGeometry(t)}getGeometry(e,t,i){const s=new g6({radius:1,height:i?2:0,vertices:t,nradial:e});let a=0;if(t)for(let l=0;l<e;l++){const u=t[l],h=Math.sqrt(u[0]*u[0]+u[1]*u[1]);a+=h/e}else a=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*a}),s}_getModels(){const e=this.getShaders(),t=this.getAttributeManager().getBufferLayouts(),i=new Wn(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:t,isInstanced:!0}),s=new Wn(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:t,isInstanced:!0});return{fillModel:i,wireframeModel:s,models:[s,i]}}_updateGeometry({diskResolution:e,vertices:t,extruded:i,stroked:s}){const a=this.getGeometry(e,t,i||s);this.setState({fillVertexCount:a.attributes.POSITION.value.length/3});const l=this.state.fillModel,u=this.state.wireframeModel;l.setGeometry(a),l.setTopology("triangle-strip"),l.setIndexBuffer(null),u.setGeometry(a),u.setTopology("line-list")}draw({uniforms:e}){const{lineWidthUnits:t,lineWidthScale:i,lineWidthMinPixels:s,lineWidthMaxPixels:a,radiusUnits:l,elevationScale:u,extruded:h,filled:d,stroked:p,wireframe:_,offset:y,coverage:v,radius:A,angle:R}=this.props,C=this.state.fillModel,z=this.state.wireframeModel,{fillVertexCount:H,edgeDistance:M}=this.state,k={radius:A,angle:R/180*Math.PI,offset:y,extruded:h,stroked:p,coverage:v,elevationScale:u,edgeDistance:M,radiusUnits:Ji[l],widthUnits:Ji[t],widthScale:i,widthMinPixels:s,widthMaxPixels:a};h&&_&&(z.shaderInputs.setProps({column:{...k,isStroke:!0}}),z.draw(this.context.renderPass)),d&&(C.setVertexCount(H),C.shaderInputs.setProps({column:{...k,isStroke:!1}}),C.draw(this.context.renderPass)),!h&&p&&(C.setVertexCount(H*2/3),C.shaderInputs.setProps({column:{...k,isStroke:!0}}),C.draw(this.context.renderPass))}}mp.layerName="ColumnLayer";mp.defaultProps=b6;function v6({pointCount:n,getBinId:e}){const t=new Map;for(let i=0;i<n;i++){const s=e(i);if(s===null)continue;let a=t.get(String(s));a?a.points.push(i):(a={id:s,index:t.size,points:[i]},t.set(String(s),a))}return Array.from(t.values())}function T6({bins:n,dimensions:e,target:t}){const i=n.length*e;(!t||t.length<i)&&(t=new Float32Array(i));for(let s=0;s<n.length;s++){const{id:a}=n[s];Array.isArray(a)?t.set(a,s*e):t[s]=a}return t}const x6=n=>n.length,Y1=(n,e)=>{let t=0;for(const i of n)t+=e(i);return t},S6=(n,e)=>n.length===0?NaN:Y1(n,e)/n.length,A6=(n,e)=>{let t=1/0;for(const i of n){const s=e(i);s<t&&(t=s)}return t},w6=(n,e)=>{let t=-1/0;for(const i of n){const s=e(i);s>t&&(t=s)}return t},E6={COUNT:x6,SUM:Y1,MEAN:S6,MIN:A6,MAX:w6};function R6({bins:n,getValue:e,operation:t,target:i}){(!i||i.length<n.length)&&(i=new Float32Array(n.length));let s=1/0,a=-1/0;for(let l=0;l<n.length;l++){const{points:u}=n[l];i[l]=t(u,e),i[l]<s&&(s=i[l]),i[l]>a&&(a=i[l])}return{value:i,domain:[s,a]}}function Bv(n,e,t){const i={};for(const a of n.sources||[]){const l=e[a];if(l)i[a]=C6(l);else throw new Error(`Cannot find attribute ${a}`)}const s={};return a=>{for(const l in i)s[l]=i[l](a);return n.getValue(s,a,t)}}function C6(n){const e=n.value,{offset:t=0,stride:i,size:s}=n.getAccessor(),a=e.BYTES_PER_ELEMENT,l=t/a,u=i?i/a:s;if(s===1)return n.isConstant?()=>e[0]:d=>{const p=l+u*d;return e[p]};let h;return n.isConstant?(h=Array.from(e),()=>h):(h=new Array(s),d=>{const p=l+u*d;for(let _=0;_<s;_++)h[_]=e[p+_];return h})}class M6{constructor(e){this.bins=[],this.binIds=null,this.results=[],this.dimensions=e.dimensions,this.channelCount=e.getValue.length,this.props={...e,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(e)}destroy(){}get binCount(){return this.bins.length}setProps(e){const t=this.props;if(e.binOptions&&(jt(e.binOptions,t.binOptions,2)||this.setNeedsUpdate()),e.operations)for(let i=0;i<this.channelCount;i++)e.operations[i]!==t.operations[i]&&this.setNeedsUpdate(i);if(e.customOperations)for(let i=0;i<this.channelCount;i++)!!e.customOperations[i]!=!!t.customOperations[i]&&this.setNeedsUpdate(i);e.pointCount!==void 0&&e.pointCount!==t.pointCount&&this.setNeedsUpdate(),e.attributes&&(e.attributes={...t.attributes,...e.attributes}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[e]=!0)}update(){var e,t,i,s;if(this.needsUpdate===!0){this.bins=v6({pointCount:this.props.pointCount,getBinId:Bv(this.props.getBin,this.props.attributes,this.props.binOptions)});const a=T6({bins:this.bins,dimensions:this.dimensions,target:(e=this.binIds)==null?void 0:e.value});this.binIds={value:a,type:"float32",size:this.dimensions}}for(let a=0;a<this.channelCount;a++)if(this.needsUpdate===!0||this.needsUpdate[a]){const l=this.props.customOperations[a]||E6[this.props.operations[a]],{value:u,domain:h}=R6({bins:this.bins,getValue:Bv(this.props.getValue[a],this.props.attributes,void 0),operation:l,target:(t=this.results[a])==null?void 0:t.value});this.results[a]={value:u,domain:h,type:"float32",size:1},(s=(i=this.props).onUpdate)==null||s.call(i,{channel:a})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(e){return this.results[e]}getResultDomain(e){var t;return((t=this.results[e])==null?void 0:t.domain)??[1/0,-1/0]}getBin(e){const t=this.bins[e];if(!t)return null;const i=new Array(this.channelCount);for(let s=0;s<i.length;s++){const a=this.results[s];i[s]=a==null?void 0:a.value[e]}return{id:t.id,value:i,count:t.points.length,pointIndices:t.points}}}function q1(n,e,t){return n.createFramebuffer({width:e,height:t,colorAttachments:[n.createTexture({width:e,height:t,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}const O6=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,I6={name:"binSorter",vs:O6,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}},K1=[1,2,4,8],N6=3e38,P6={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},vc=1024;class D6{constructor(e,t){this.binsFBO=null,this.device=e,this.model=U6(e,t)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){var e,t;this.model.destroy(),(e=this.binsFBO)==null||e.colorAttachments[0].texture.destroy(),(t=this.binsFBO)==null||t.destroy()}getBinValues(e){if(!this.binsFBO)return null;const t=e%vc,i=Math.floor(e/vc),s=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:t,sourceY:i,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(s)}setDimensions(e,t){var l,u;const i=vc,s=Math.ceil(e/i);this.binsFBO?this.binsFBO.height<s&&this.binsFBO.resize({width:i,height:s}):this.binsFBO=q1(this.device,i,s);const a={binIdRange:[t[0][0],t[0][1],((l=t[1])==null?void 0:l[0])||0,((u=t[1])==null?void 0:u[1])||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:a})}setModelProps(e){const t=this.model;e.attributes&&t.setAttributes(e.attributes),e.constantAttributes&&t.setConstantAttributes(e.constantAttributes),e.vertexCount!==void 0&&t.setVertexCount(e.vertexCount),e.shaderModuleProps&&t.shaderInputs.setProps(e.shaderModuleProps)}update(e){if(!this.binsFBO)return;const t=k6(e);this._updateBins("SUM",t.SUM+t.MEAN),this._updateBins("MIN",t.MIN),this._updateBins("MAX",t.MAX)}_updateBins(e,t){if(t===0)return;t|=K1[3];const i=this.model,s=this.binsFBO,a=e==="MAX"?-3e38:e==="MIN"?N6:0,l=this.device.beginRenderPass({id:`gpu-aggregation-${e}`,framebuffer:s,parameters:{viewport:[0,0,s.width,s.height],colorMask:t},clearColor:[a,a,a,0],clearDepth:!1,clearStencil:!1});i.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:e==="MAX"?"max":e==="MIN"?"min":"add",blendAlphaOperation:"add"}),i.draw(l),l.end()}}function k6(n){const e={...P6};for(let t=0;t<n.length;t++){const i=n[t];i&&(e[i]+=K1[t])}return e}function U6(n,e){let t=e.vs;e.dimensions===2&&(t+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);const i=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${t}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,s=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new Wn(n,{bufferLayout:e.bufferLayout,modules:[...e.modules||[],I6],defines:{...e.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:e.channelCount},isInstanced:!1,vs:i,fs:s,topology:"point-list",disableWarnings:!0})}const B6=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,L6={name:"aggregatorTransform",vs:B6,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};class F6{constructor(e,t){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=e,this.channelCount=t.channelCount,this.transform=V6(e,t),this.domainFBO=q1(e,2,1)}destroy(){var e,t;this.transform.destroy(),(e=this.binBuffer)==null||e.destroy(),(t=this.valueBuffer)==null||t.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){const e=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,t=new Float32Array(e);this._domains=[[-t[4],t[0]],[-t[5],t[1]],[-t[6],t[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(e,t){var h,d,p,_;const{model:i,transformFeedback:s}=this.transform;i.setVertexCount(e);const a={binIdRange:[t[0][0],t[0][1],((h=t[1])==null?void 0:h[0])||0,((d=t[1])==null?void 0:d[1])||0]};i.shaderInputs.setProps({aggregatorTransform:a});const l=e*t.length*4;(!this.binBuffer||this.binBuffer.byteLength<l)&&((p=this.binBuffer)==null||p.destroy(),this.binBuffer=this.device.createBuffer({byteLength:l}),s.setBuffer("binIds",this.binBuffer));const u=e*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<u)&&((_=this.valueBuffer)==null||_.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:u}),s.setBuffer("values",this.valueBuffer))}update(e,t){if(!e)return;const i=this.transform,s=this.domainFBO,a=[0,1,2].map(h=>t[h]==="COUNT"?1:0),l=[0,1,2].map(h=>t[h]==="MEAN"?1:0),u={isCount:a,isMean:l,bins:e};i.model.shaderInputs.setProps({aggregatorTransform:u}),i.run({id:"gpu-aggregation-domain",framebuffer:s,parameters:{viewport:[0,0,2,1]},clearColor:[-3e38,-3e38,-3e38,0],clearDepth:!1,clearStencil:!1}),this._domains=null}}function V6(n,e){const t=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,i=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new Qr(n,{vs:t,fs:i,topology:"point-list",modules:[L6],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:e.dimensions,NUM_CHANNELS:e.channelCount,SAMPLER_WIDTH:vc},varyings:["binIds","values"],disableWarnings:!0})}class Lv{static isSupported(e){return e.features.has("float32-renderable-webgl")&&e.features.has("texture-blend-float-webgl")}constructor(e,t){this.binCount=0,this.binIds=null,this.results=[],this.device=e,this.dimensions=t.dimensions,this.channelCount=t.channelCount,this.props={...t,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new D6(e,t),this.aggregationTransform=new F6(e,t),this.setProps(t)}getBins(){var t;const e=this.aggregationTransform.binBuffer;return e?(((t=this.binIds)==null?void 0:t.buffer)!==e&&(this.binIds={buffer:e,type:"float32",size:this.dimensions}),this.binIds):null}getResult(e){var i;const t=this.aggregationTransform.valueBuffer;return!t||e>=this.channelCount?null:(((i=this.results[e])==null?void 0:i.buffer)!==t&&(this.results[e]={buffer:t,type:"float32",size:1,stride:this.channelCount*4,offset:e*4}),this.results[e])}getResultDomain(e){return this.aggregationTransform.domains[e]}getBin(e){if(e<0||e>=this.binCount)return null;const{binIdRange:t}=this.props;let i;if(this.dimensions===1)i=[e+t[0][0]];else{const[[u,h],[d]]=t,p=h-u;i=[e%p+u,Math.floor(e/p)+d]}const s=this.binSorter.getBinValues(e);if(!s)return null;const a=s[3],l=[];for(let u=0;u<this.channelCount;u++){const h=this.props.operations[u];h==="COUNT"?l[u]=a:a===0?l[u]=NaN:l[u]=h==="MEAN"?s[u]/a:s[u]}return{id:i,value:l,count:a}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(e){const t=this.props;if("binIdRange"in e&&!jt(e.binIdRange,t.binIdRange,2)){const i=e.binIdRange;if(Fe.assert(i.length===this.dimensions),this.dimensions===1){const[[s,a]]=i;this.binCount=a-s}else{const[[s,a],[l,u]]=i;this.binCount=(a-s)*(u-l)}this.binSorter.setDimensions(this.binCount,i),this.aggregationTransform.setDimensions(this.binCount,i),this.setNeedsUpdate()}if(e.operations)for(let i=0;i<this.channelCount;i++)e.operations[i]!==t.operations[i]&&this.setNeedsUpdate(i);if(e.pointCount!==void 0&&e.pointCount!==t.pointCount&&(this.binSorter.setModelProps({vertexCount:e.pointCount}),this.setNeedsUpdate()),e.binOptions&&(jt(e.binOptions,t.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:e.binOptions})),e.attributes){const i={},s={};for(const a of Object.values(e.attributes))for(const[l,u]of Object.entries(a.getValue()))ArrayBuffer.isView(u)?s[l]=u:u&&(i[l]=u);this.binSorter.setModelProps({attributes:i,constantAttributes:s})}e.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:e.shaderModuleProps}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate.fill(!0):this.needsUpdate[e]=!0}update(){}preDraw(){var i,s;if(!this.needsUpdate.some(Boolean))return;const{operations:e}=this.props,t=this.needsUpdate.map((a,l)=>a?e[l]:null);this.binSorter.update(t),this.aggregationTransform.update(this.binSorter.texture,e);for(let a=0;a<this.channelCount;a++)this.needsUpdate[a]&&(this.needsUpdate[a]=!1,(s=(i=this.props).onUpdate)==null||s.call(i,{channel:a}))}}let Z1=class extends gp{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(e){var i,s;super.updateState(e);const t=this.getAggregatorType();if(e.changeFlags.extensionsChanged||this.state.aggregatorType!==t){(i=this.state.aggregator)==null||i.destroy();const a=this.createAggregator(t);return a.setProps({attributes:(s=this.getAttributeManager())==null?void 0:s.attributes}),this.setState({aggregator:a,aggregatorType:t}),!0}return!1}finalizeState(e){super.finalizeState(e),this.state.aggregator.destroy()}updateAttributes(e){const{aggregator:t}=this.state;t.setProps({attributes:e});for(const i in e)this.onAttributeChange(i);t.update()}draw({shaderModuleProps:e}){const{aggregator:t}=this.state;t.setProps({shaderModuleProps:e}),t.preDraw()}_getAttributeManager(){return new Eu(this.context.device,{id:this.props.id,stats:this.context.stats})}};Z1.layerName="AggregationLayer";const Q1=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function G1(n,e=!1,t=Float32Array){let i;if(Number.isFinite(n[0]))i=new t(n);else{i=new t(n.length*4);let s=0;for(let a=0;a<n.length;a++){const l=n[a];i[s++]=l[0],i[s++]=l[1],i[s++]=l[2],i[s++]=Number.isFinite(l[3])?l[3]:255}}if(e)for(let s=0;s<i.length;s++)i[s]/=255;return i}const Qc={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function z6(n,e){n.setSampler({minFilter:Qc[e],magFilter:Qc[e]})}function H6(n,e,t="linear"){const i=G1(e,!1,Uint8Array);return n.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:Qc[t],magFilter:Qc[t],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:i,width:i.length/4,height:1})}class Fv{constructor(e,t){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=e,this.inputLength=t,this.attribute=e}getScalePercentile(){if(!this._percentile){const e=Vv(this.input,this.inputLength);this._percentile=W6(e)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){const e=Vv(this.input,this.inputLength);this._ordinal=j6(e)}return this._ordinal}getCutoff({scaleType:e,lowerPercentile:t,upperPercentile:i}){if(e==="quantile")return[t,i-1];if(t>0||i<100){const{domain:s}=this.getScalePercentile();let a=s[Math.floor(t)-1]??-1/0,l=s[Math.floor(i)-1]??1/0;if(e==="ordinal"){const{domain:u}=this.getScaleOrdinal();a=u.findIndex(h=>h>=a),l=u.findIndex(h=>h>l)-1,l===-2&&(l=u.length-1)}return[a,l]}return null}update(e){const t=this.props;if(e.scaleType!==t.scaleType)switch(e.scaleType){case"quantile":{const{attribute:i}=this.getScalePercentile();this.attribute=i,this.domain=[0,99];break}case"ordinal":{const{attribute:i,domain:s}=this.getScaleOrdinal();this.attribute=i,this.domain=[0,s.length-1];break}default:this.attribute=this.input,this.domain=null}return(e.scaleType!==t.scaleType||e.lowerPercentile!==t.lowerPercentile||e.upperPercentile!==t.upperPercentile)&&(this.cutoff=this.getCutoff(e)),this.props=e,this}}function j6(n){const e=new Set;for(const s of n)Number.isFinite(s)&&e.add(s);const t=Array.from(e).sort(),i=new Map;for(let s=0;s<t.length;s++)i.set(t[s],s);return{attribute:{value:n.map(s=>Number.isFinite(s)?i.get(s):NaN),type:"float32",size:1},domain:t}}function W6(n,e=100){const t=Array.from(n).filter(Number.isFinite).sort($6);let i=0;const s=Math.max(1,e),a=new Array(s-1);for(;++i<s;)a[i-1]=X6(t,i/s);return{attribute:{value:n.map(l=>Number.isFinite(l)?Y6(a,l):NaN),type:"float32",size:1},domain:a}}function Vv(n,e){var l;const t=(n.stride??4)/4,i=(n.offset??0)/4;let s=n.value;if(!s){const u=(l=n.buffer)==null?void 0:l.readSyncWebGL(0,t*4*e);u&&(s=new Float32Array(u.buffer),n.value=s)}if(t===1)return s.subarray(0,e);const a=new Float32Array(e);for(let u=0;u<e;u++)a[u]=s[u*t+i];return a}function $6(n,e){return n-e}function X6(n,e){const t=n.length;if(e<=0||t<2)return n[0];if(e>=1)return n[t-1];const i=(t-1)*e,s=Math.floor(i),a=n[s],l=n[s+1];return a+(l-a)*(i-s)}function Y6(n,e){let t=0,i=n.length;for(;t<i;){const s=t+i>>>1;n[s]>e?i=s:t=s+1}return t}function q6({dataBounds:n,getBinId:e,padding:t=0}){const i=[n[0],n[1],[n[0][0],n[1][1]],[n[1][0],n[0][1]]].map(h=>e(h)),s=Math.min(...i.map(h=>h[0]))-t,a=Math.min(...i.map(h=>h[1]))-t,l=Math.max(...i.map(h=>h[0]))+t+1,u=Math.max(...i.map(h=>h[1]))+t+1;return[[s,l],[a,u]]}const J1=Math.PI/3,Mu=2*Math.sin(J1),Ou=1.5,K6=Array.from({length:6},(n,e)=>{const t=e*J1;return[Math.sin(t),-Math.cos(t)]});function Od([n,e],t){let i=Math.round(e=e/t/Ou),s=Math.round(n=n/t/Mu-(i&1)/2);const a=e-i;if(Math.abs(a)*3>1){const l=n-s,u=s+(n<s?-1:1)/2,h=i+(e<i?-1:1),d=n-u,p=e-h;l*l+a*a>d*d+p*p&&(s=u+(i&1?1:-1)/2,i=h)}return[s,i]}const Z6=`
const vec2 DIST = vec2(${Mu}, ${Ou});

ivec2 pointToHexbin(vec2 p, float radius) {
  p /= radius * DIST;
  float pj = round(p.y);
  float pjm2 = mod(pj, 2.0);
  p.x -= pjm2 * 0.5;
  float pi = round(p.x);
  vec2 d1 = p - vec2(pi, pj);

  if (abs(d1.y) * 3. > 1.) {
    vec2 v2 = step(0.0, d1) - 0.5;
    v2.y *= 2.0;
    vec2 d2 = d1 - v2;
    if (dot(d1, d1) > dot(d2, d2)) {
      pi += v2.x + pjm2 - 0.5;
      pj += v2.y;
    }
  }
  return ivec2(pi, pj);
}
`;function zv([n,e],t){return[(n+(e&1)/2)*t*Mu,e*t*Ou]}const Q6=`
const vec2 DIST = vec2(${Mu}, ${Ou});

vec2 hexbinCentroid(vec2 binId, float radius) {
  binId.x += fract(binId.y * 0.5);
  return binId * DIST * radius;
}
`,G6=`#version 300 es
#define SHADER_NAME hexagon-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
${Q6}
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < hexagon.colorDomain.z ||
instanceColorValues > hexagon.colorDomain.w ||
instanceElevationValues < hexagon.elevationDomain.z ||
instanceElevationValues > hexagon.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);
commonPosition += positions.xy * column.radius * column.coverage;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,J6=`uniform hexagonUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
} hexagon;
`,eU={name:"hexagon",vs:J6,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};class eT extends mp{getShaders(){const e=super.getShaders();return e.modules.push(eU),{...e,vs:G6}}initializeState(){super.initializeState();const e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){var a;super.updateState(e);const{props:t,oldProps:i}=e,s=this.state.fillModel;if(i.colorRange!==t.colorRange){(a=this.state.colorTexture)==null||a.destroy(),this.state.colorTexture=H6(this.context.device,t.colorRange,t.colorScaleType);const l={colorRange:this.state.colorTexture};s.shaderInputs.setProps({hexagon:l})}else i.colorScaleType!==t.colorScaleType&&z6(this.state.colorTexture,t.colorScaleType)}finalizeState(e){var t;super.finalizeState(e),(t=this.state.colorTexture)==null||t.destroy()}draw({uniforms:e}){const{radius:t,hexOriginCommon:i,elevationRange:s,elevationScale:a,extruded:l,coverage:u,colorDomain:h,elevationDomain:d}=this.props,p=this.props.colorCutoff||[-1/0,1/0],_=this.props.elevationCutoff||[-1/0,1/0],y=this.state.fillModel;y.vertexArray.indexBuffer&&y.setIndexBuffer(null),y.setVertexCount(this.state.fillVertexCount);const v={colorDomain:[Math.max(h[0],p[0]),Math.min(h[1],p[1]),Math.max(h[0]-1,p[0]),Math.min(h[1]+1,p[1])],elevationDomain:[Math.max(d[0],_[0]),Math.min(d[1],_[1]),Math.max(d[0]-1,_[0]),Math.min(d[1]+1,_[1])],elevationRange:[s[0]*a,s[1]*a],originCommon:i};y.shaderInputs.setProps({column:{extruded:l,coverage:u,radius:t},hexagon:v}),y.draw(this.context.renderPass)}}eT.layerName="HexagonCellLayer";const tU=`uniform binOptionsUniforms {
  vec2 hexOriginCommon;
  float radiusCommon;
} binOptions;
`,nU={name:"binOptions",vs:tU,uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function Hv(){}const iU={gpuAggregation:!0,colorDomain:null,colorRange:Q1,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:Hv,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:Hv,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:n=>n.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0};class _p extends Z1{getAggregatorType(){const{gpuAggregation:e,hexagonAggregator:t,getColorValue:i,getElevationValue:s}=this.props;return e&&(t||i||s)?(Fe.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&Lv.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){const{hexagonAggregator:t,radius:i}=this.props;return new M6({dimensions:2,getBin:{sources:["positions"],getValue:({positions:s},a,l)=>{if(t)return t(s,i);const h=this.state.aggregatorViewport.projectPosition(s),{radiusCommon:d,hexOriginCommon:p}=l;return Od([h[0]-p[0],h[1]-p[1]],d)}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:s})=>s},{sources:["elevationWeights"],getValue:({elevationWeights:s})=>s}]})}return new Lv(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[Do,nU],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;
  
  ${Z6}

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){const t=super.updateState(e),{props:i,oldProps:s,changeFlags:a}=e,{aggregator:l}=this.state;if((a.dataChanged||!this.state.dataAsArray)&&(i.getColorValue||i.getElevationValue)&&(this.state.dataAsArray=Array.from(P1(i.data).iterable)),t||a.dataChanged||i.radius!==s.radius||i.getColorValue!==s.getColorValue||i.getElevationValue!==s.getElevationValue||i.colorAggregation!==s.colorAggregation||i.elevationAggregation!==s.elevationAggregation){this._updateBinOptions();const{radiusCommon:u,hexOriginCommon:h,binIdRange:d,dataAsArray:p}=this.state;if(l.setProps({binIdRange:d,pointCount:this.getNumInstances(),operations:[i.colorAggregation,i.elevationAggregation],binOptions:{radiusCommon:u,hexOriginCommon:h},onUpdate:this._onAggregationUpdate.bind(this)}),p){const{getColorValue:_,getElevationValue:y}=this.props;l.setProps({customOperations:[_&&(v=>_(v.map(A=>p[A]),{indices:v,data:i.data})),y&&(v=>y(v.map(A=>p[A]),{indices:v,data:i.data}))]})}}return a.updateTriggersChanged&&a.updateTriggersChanged.getColorValue&&l.setNeedsUpdate(0),a.updateTriggersChanged&&a.updateTriggersChanged.getElevationValue&&l.setNeedsUpdate(1),t}_updateBinOptions(){const e=this.getBounds();let t=1,i=[0,0],s=[[0,1],[0,1]],a=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let l=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2];const{radius:u}=this.props,{unitsPerMeter:h}=a.getDistanceScales(l);t=h[0]*u;const d=Od(a.projectFlat(l),t);l=a.unprojectFlat(zv(d,t));const p=a.constructor;a=a.isGeospatial?new p({longitude:l[0],latitude:l[1],zoom:12}):new ta({position:[l[0],l[1],0],zoom:12}),i=[Math.fround(a.center[0]),Math.fround(a.center[1])],s=q6({dataBounds:e,getBinId:_=>{const y=a.projectFlat(_);return y[0]-=i[0],y[1]-=i[1],Od(y,t)},padding:1})}this.setState({radiusCommon:t,hexOriginCommon:i,binIdRange:s,aggregatorViewport:a})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){const t=this.getCurrentLayer().props,{aggregator:i}=this.state;if(e===0){const s=i.getResult(0);this.setState({colors:new Fv(s,i.binCount)}),t.onSetColorDomain(i.getResultDomain(0))}else if(e===1){const s=i.getResult(1);this.setState({elevations:new Fv(s,i.binCount)}),t.onSetElevationDomain(i.getResultDomain(1))}}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate(),this._updateBinOptions();const{radiusCommon:i,hexOriginCommon:s,binIdRange:a}=this.state;t.setProps({binIdRange:a,binOptions:{radiusCommon:i,hexOriginCommon:s}});break;case"colorWeights":t.setNeedsUpdate(0);break;case"elevationWeights":t.setNeedsUpdate(1);break}}renderLayers(){var ce,re;const{aggregator:e,radiusCommon:t,hexOriginCommon:i}=this.state,{elevationScale:s,colorRange:a,elevationRange:l,extruded:u,coverage:h,material:d,transitions:p,colorScaleType:_,lowerPercentile:y,upperPercentile:v,colorDomain:A,elevationScaleType:R,elevationLowerPercentile:C,elevationUpperPercentile:z,elevationDomain:H}=this.props,M=this.getSubLayerClass("cells",eT),k=e.getBins(),L=(ce=this.state.colors)==null?void 0:ce.update({scaleType:_,lowerPercentile:y,upperPercentile:v}),X=(re=this.state.elevations)==null?void 0:re.update({scaleType:R,lowerPercentile:C,upperPercentile:z});return!L||!X?null:new M(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:k,getColorValue:L.attribute,getElevationValue:X.attribute}},dataComparator:(ne,he)=>ne.length===he.length,updateTriggers:{getBin:[k],getColorValue:[L.attribute],getElevationValue:[X.attribute]},diskResolution:6,vertices:K6,radius:t,hexOriginCommon:i,elevationScale:s,colorRange:a,colorScaleType:_,elevationRange:l,extruded:u,coverage:h,material:d,colorDomain:L.domain||A||e.getResultDomain(0),elevationDomain:X.domain||H||e.getResultDomain(1),colorCutoff:L.cutoff,elevationCutoff:X.cutoff,transitions:p&&{getFillColor:p.getColorValue||p.getColorWeight,getElevation:p.getElevationValue||p.getElevationWeight},extensions:[]})}getPickingInfo(e){const t=e.info,{index:i}=t;if(i>=0){const s=this.state.aggregator.getBin(i);let a;if(s){const l=zv(s.id,this.state.radiusCommon),u=this.context.viewport.unprojectFlat(l);a={col:s.id[0],row:s.id[1],position:u,colorValue:s.value[0],elevationValue:s.value[1],count:s.count},s.pointIndices&&(a.pointIndices=s.pointIndices,a.points=Array.isArray(this.props.data)?s.pointIndices.map(h=>this.props.data[h]):[])}t.object=a}return t}}_p.layerName="HexagonLayer";_p.defaultProps=iU;function sU(n){const e=n.map(u=>u[0]),t=n.map(u=>u[1]),i=Math.min.apply(null,e),s=Math.max.apply(null,e),a=Math.min.apply(null,t),l=Math.max.apply(null,t);return[i,a,s,l]}function rU(n,e){return e[0]>=n[0]&&e[2]<=n[2]&&e[1]>=n[1]&&e[3]<=n[3]}const jv=new Float32Array(12);function Wv(n,e=2){let t=0;for(const i of n)for(let s=0;s<e;s++)jv[t++]=i[s]||0;return jv}function aU(n,e,t){const[i,s,a,l]=n,u=a-i,h=l-s;let d=u,p=h;u/h<e/t?d=e/t*h:p=t/e*u,d<e&&(d=e,p=t);const _=(a+i)/2,y=(l+s)/2;return[_-d/2,y-p/2,_+d/2,y+p/2]}function oU(n,e){const[t,i,s,a]=e;return[(n[0]-t)/(s-t),(n[1]-i)/(a-i)]}const lU=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`,cU=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`,$v=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,uU={name:"triangle",vs:$v,fs:$v,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class tT extends Ls{getShaders(){return super.getShaders({vs:lU,fs:cU,modules:[Do,uU]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){const{vertexCount:t,data:i}=this.props;return new Wn(e,{...this.getShaders(),id:this.props.id,attributes:i.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:t})}draw(){const{model:e}=this.state,{aggregationMode:t,colorDomain:i,intensity:s,threshold:a,colorTexture:l,maxTexture:u,weightsTexture:h}=this.props,d={aggregationMode:t,colorDomain:i,intensity:s,threshold:a,colorTexture:l,maxTexture:u,weightsTexture:h};e.shaderInputs.setProps({triangle:d}),e.draw(this.context.renderPass)}}tT.layerName="TriangleLayer";function fU(n,e){const t={};for(const i in n)e.includes(i)||(t[i]=n[i]);return t}class nT extends gp{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:fU(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){const i=this.getShaders({});i&&i.defines&&(i.defines.NON_INSTANCED_MODEL=1),this.updateShaders(i)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:t,device:i}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:t,picking:{isActive:0},devicePixelRatio:i.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,t={}){const{props:i,oldProps:s,changeFlags:a}=e,{compareAll:l=!1,dimension:u}=t,{ignoreProps:h}=this.state,{props:d,accessors:p=[]}=u,{updateTriggersChanged:_}=a;if(a.dataChanged)return!0;if(_){if(_.all)return!0;for(const y of p)if(_[y])return!0}if(l)return a.extensionsChanged?!0:hp({oldProps:s,newProps:i,ignoreProps:h,propTypes:this.constructor._propTypes});for(const y of d)if(i[y]!==s[y])return!0;return!1}isAttributeChanged(e){const{changedAttributes:t}=this.state;return e?t&&t[e]!==void 0:!hU(t)}_getAttributeManager(){return new Eu(this.context.device,{id:this.props.id,stats:this.context.stats})}}nT.layerName="AggregationLayer";function hU(n){let e=!0;for(const t in n){e=!1;break}return e}const Xv=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,Yv=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,dU=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,gU=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,pU=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,mU={name:"weight",vs:pU,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},_U={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}},yU=2,Id={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},qv=[0,0],bU={SUM:0,MEAN:1},vU={getPosition:{type:"accessor",value:n=>n.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:Q1,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},TU=["float32-renderable-webgl","texture-blend-float-webgl"],xU={data:{props:["radiusPixels"]}};class yp extends nT{getShaders(e){let t=[Do];return e.modules&&(t=[...t,...e.modules]),super.getShaders({...e,modules:t})}initializeState(){super.initializeAggregationLayer(xU),this.setState({colorDomain:qv}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){const{props:t,oldProps:i}=e,s=this._getChangeFlags(e);(s.dataChanged||s.viewportChanged)&&(s.boundsChanged=this._updateBounds(s.dataChanged),this._updateTextureRenderingBounds()),s.dataChanged||s.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):s.viewportZoomChanged&&this._debouncedUpdateWeightmap(),t.colorRange!==i.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){const{weightsTexture:e,triPositionBuffer:t,triTexCoordBuffer:i,maxWeightsTexture:s,colorTexture:a,colorDomain:l}=this.state,{updateTriggers:u,intensity:h,threshold:d,aggregation:p}=this.props,_=this.getSubLayerClass("triangle",tT);return new _(this.getSubLayerProps({id:"triangle-layer",updateTriggers:u}),{coordinateSystem:Ie.DEFAULT,data:{attributes:{positions:t,texCoords:i}},vertexCount:4,maxTexture:s,colorTexture:a,aggregationMode:bU[p]||0,weightsTexture:e,intensity:h,threshold:d,colorDomain:l})}finalizeState(e){super.finalizeState(e);const{weightsTransform:t,weightsTexture:i,maxWeightTransform:s,maxWeightsTexture:a,triPositionBuffer:l,triTexCoordBuffer:u,colorTexture:h,updateTimer:d}=this.state;t==null||t.destroy(),i==null||i.destroy(),s==null||s.destroy(),a==null||a.destroy(),l==null||l.destroy(),u==null||u.destroy(),h==null||h.destroy(),d&&clearTimeout(d)}_getAttributeManager(){return new Eu(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const t={},{dimensions:i}=this.state;t.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:i.data})&&"aggregation is dirty",t.viewportChanged=e.changeFlags.viewportChanged;const{zoom:s}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==s)&&(t.viewportZoomChanged=!0),t}_createTextures(){const{textureSize:e,format:t}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...Id,width:e,height:e,format:t}),maxWeightsTexture:this.context.device.createTexture({...Id,width:1,height:1,format:t})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:e}=this.context,{weightsTextureSize:t}=this.props,i=Math.min(t,e.limits.maxTextureDimension2D),s=TU.every(u=>e.features.has(u)),a=s?"rgba32float":"rgba8unorm",l=s?1:1/255;this.setState({textureSize:i,format:a,weightsScale:l}),s||Fe.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:t}=this.state;const{weightsTexture:i}=this.state,s=this.getAttributeManager();t==null||t.destroy(),t=new nv(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:s.getBufferLayouts(),vertexCount:1,targetTexture:i,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,mU]}),this.setState({weightsTransform:t})}_setupResources(){this._createTextures();const{device:e}=this.context,{textureSize:t,weightsTexture:i,maxWeightsTexture:s}=this.state,a=this.getShaders({vs:Xv,fs:Yv});this._createWeightsTransform(a);const l=this.getShaders({vs:dU,fs:gU,modules:[_U]}),u=new nv(e,{id:`${this.id}-max-weights-transform`,targetTexture:s,...l,vertexCount:t*t,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),h={inTexture:i,textureSize:t};u.model.shaderInputs.setProps({maxWeight:h}),this.setState({weightsTexture:i,maxWeightsTexture:s,maxWeightTransform:u,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:Xv,fs:Yv,...e})}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){const{viewport:t}=this.context,i=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])].map(u=>u.map(Math.fround)),s=sU(i),a={visibleWorldBounds:s,viewportCorners:i};let l=!1;if(e||!this.state.worldBounds||!rU(this.state.worldBounds,s)){const u=this._worldToCommonBounds(s),h=this._commonToWorldBounds(u);this.props.coordinateSystem===Ie.LNGLAT&&(h[1]=Math.max(h[1],-85.051129),h[3]=Math.min(h[3],85.051129),h[0]=Math.max(h[0],-360),h[2]=Math.min(h[2],360));const d=this._worldToCommonBounds(h);a.worldBounds=h,a.normalizedCommonBounds=d,l=!0}return this.setState(a),l}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:t,normalizedCommonBounds:i,viewportCorners:s}=this.state,{viewport:a}=this.context;e.write(Wv(s,3));const l=s.map(u=>oU(a.projectPosition(u),i));t.write(Wv(l,2))}_updateColorTexture(e){const{colorRange:t}=e.props;let{colorTexture:i}=this.state;const s=G1(t,!1,Uint8Array);i&&(i==null?void 0:i.width)===t.length?i.setTexture2DData({data:s}):(i==null||i.destroy(),i=this.context.device.createTexture({...Id,data:s,width:t.length,height:1})),this.setState({colorTexture:i})}_updateWeightmap(){const{radiusPixels:e,colorDomain:t,aggregation:i}=this.props,{worldBounds:s,textureSize:a,weightsScale:l,weightsTexture:u}=this.state,h=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const d=this._worldToCommonBounds(s,{useLayerCoordinateSystem:!0});if(t&&i==="SUM"){const{viewport:M}=this.context,k=M.distanceScales.metersPerUnit[2]*(d[2]-d[0])/a;this.state.colorDomain=t.map(L=>L*k*l)}else this.state.colorDomain=t||qv;const _=this.getAttributeManager().getAttributes(),y=this.getModuleSettings();this._setModelAttributes(h.model,_),h.model.setVertexCount(this.getNumInstances());const v={radiusPixels:e,commonBounds:d,textureWidth:a,weightsScale:l,weightsTexture:u},{viewport:A,devicePixelRatio:R,coordinateSystem:C,coordinateOrigin:z}=y,{modelMatrix:H}=this.props;h.model.shaderInputs.setProps({project:{viewport:A,devicePixelRatio:R,modelMatrix:H,coordinateSystem:C,coordinateOrigin:z},weight:v}),h.run({parameters:{viewport:[0,0,a,a]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:t}=this.state;const{debounceTimeout:i}=this.props;e?(t=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(t),t=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),i)),this.setState({updateTimer:t})}_worldToCommonBounds(e,t={}){const{useLayerCoordinateSystem:i=!1}=t,[s,a,l,u]=e,{viewport:h}=this.context,{textureSize:d}=this.state,{coordinateSystem:p}=this.props,_=i&&(p===Ie.LNGLAT_OFFSETS||p===Ie.METER_OFFSETS),y=_?h.projectPosition(this.props.coordinateOrigin):[0,0],v=d*yU/h.scale;let A,R;return i&&!_?(A=this.projectPosition([s,a,0]),R=this.projectPosition([l,u,0])):(A=h.projectPosition([s,a,0]),R=h.projectPosition([l,u,0])),aU([A[0]-y[0],A[1]-y[1],R[0]-y[0],R[1]-y[1]],v,v)}_commonToWorldBounds(e){const[t,i,s,a]=e,{viewport:l}=this.context,u=l.unprojectPosition([t,i]),h=l.unprojectPosition([s,a]);return u.slice(0,2).concat(h.slice(0,2))}}yp.layerName="HeatmapLayer";yp.defaultProps=vU;const SU=new s1({color:[12,204,238,250],intensity:1}),AU=new sp({color:[255,255,255,155],intensity:2.2,position:[-.144528,49.739968,1e5]}),wU=new sp({color:[70,130,230],intensity:1,position:[-3.807751,54.104682,8e4]}),EU=new sp({color:[130,225,255],intensity:.5,position:[5,52.5,6e5]}),RU=new dg({color:[255,255,255],direction:[0,0,-1],intensity:1}),CU=new ip({ambientLight:SU,pointLight1:AU,pointLight2:wU,pointLight3:EU,directionalLight:RU});function Tc(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function MU(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function iT(n){let e,t,i;n.length!==2?(e=Tc,t=(u,h)=>Tc(n(u),h),i=(u,h)=>n(u)-h):(e=n===Tc||n===MU?n:OU,t=n,i=n);function s(u,h,d=0,p=u.length){if(d<p){if(e(h,h)!==0)return p;do{const _=d+p>>>1;t(u[_],h)<0?d=_+1:p=_}while(d<p)}return d}function a(u,h,d=0,p=u.length){if(d<p){if(e(h,h)!==0)return p;do{const _=d+p>>>1;t(u[_],h)<=0?d=_+1:p=_}while(d<p)}return d}function l(u,h,d=0,p=u.length){const _=s(u,h,d,p-1);return _>d&&i(u[_-1],h)>-i(u[_],h)?_-1:_}return{left:s,center:l,right:a}}function OU(){return 0}function IU(n){return n===null?NaN:+n}const NU=iT(Tc),PU=NU.right;iT(IU).center;const DU=Math.sqrt(50),kU=Math.sqrt(10),UU=Math.sqrt(2);function Gc(n,e,t){const i=(e-n)/Math.max(0,t),s=Math.floor(Math.log10(i)),a=i/Math.pow(10,s),l=a>=DU?10:a>=kU?5:a>=UU?2:1;let u,h,d;return s<0?(d=Math.pow(10,-s)/l,u=Math.round(n*d),h=Math.round(e*d),u/d<n&&++u,h/d>e&&--h,d=-d):(d=Math.pow(10,s)*l,u=Math.round(n/d),h=Math.round(e/d),u*d<n&&++u,h*d>e&&--h),h<u&&.5<=t&&t<2?Gc(n,e,t*2):[u,h,d]}function BU(n,e,t){if(e=+e,n=+n,t=+t,!(t>0))return[];if(n===e)return[n];const i=e<n,[s,a,l]=i?Gc(e,n,t):Gc(n,e,t);if(!(a>=s))return[];const u=a-s+1,h=new Array(u);if(i)if(l<0)for(let d=0;d<u;++d)h[d]=(a-d)/-l;else for(let d=0;d<u;++d)h[d]=(a-d)*l;else if(l<0)for(let d=0;d<u;++d)h[d]=(s+d)/-l;else for(let d=0;d<u;++d)h[d]=(s+d)*l;return h}function Cg(n,e,t){return e=+e,n=+n,t=+t,Gc(n,e,t)[2]}function LU(n,e,t){e=+e,n=+n,t=+t;const i=e<n,s=i?Cg(e,n,t):Cg(n,e,t);return(i?-1:1)*(s<0?1/-s:s)}function FU(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function bp(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function sT(n,e){var t=Object.create(n.prototype);for(var i in e)t[i]=e[i];return t}function ko(){}var Eo=.7,Jc=1/Eo,Hr="\\s*([+-]?\\d+)\\s*",Ro="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",zn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",VU=/^#([0-9a-f]{3,8})$/,zU=new RegExp(`^rgb\\(${Hr},${Hr},${Hr}\\)$`),HU=new RegExp(`^rgb\\(${zn},${zn},${zn}\\)$`),jU=new RegExp(`^rgba\\(${Hr},${Hr},${Hr},${Ro}\\)$`),WU=new RegExp(`^rgba\\(${zn},${zn},${zn},${Ro}\\)$`),$U=new RegExp(`^hsl\\(${Ro},${zn},${zn}\\)$`),XU=new RegExp(`^hsla\\(${Ro},${zn},${zn},${Ro}\\)$`),Kv={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};bp(ko,Co,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:Zv,formatHex:Zv,formatHex8:YU,formatHsl:qU,formatRgb:Qv,toString:Qv});function Zv(){return this.rgb().formatHex()}function YU(){return this.rgb().formatHex8()}function qU(){return rT(this).formatHsl()}function Qv(){return this.rgb().formatRgb()}function Co(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=VU.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?Gv(e):t===3?new Wt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?fc(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?fc(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=zU.exec(n))?new Wt(e[1],e[2],e[3],1):(e=HU.exec(n))?new Wt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=jU.exec(n))?fc(e[1],e[2],e[3],e[4]):(e=WU.exec(n))?fc(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=$U.exec(n))?t3(e[1],e[2]/100,e[3]/100,1):(e=XU.exec(n))?t3(e[1],e[2]/100,e[3]/100,e[4]):Kv.hasOwnProperty(n)?Gv(Kv[n]):n==="transparent"?new Wt(NaN,NaN,NaN,0):null}function Gv(n){return new Wt(n>>16&255,n>>8&255,n&255,1)}function fc(n,e,t,i){return i<=0&&(n=e=t=NaN),new Wt(n,e,t,i)}function KU(n){return n instanceof ko||(n=Co(n)),n?(n=n.rgb(),new Wt(n.r,n.g,n.b,n.opacity)):new Wt}function Mg(n,e,t,i){return arguments.length===1?KU(n):new Wt(n,e,t,i??1)}function Wt(n,e,t,i){this.r=+n,this.g=+e,this.b=+t,this.opacity=+i}bp(Wt,Mg,sT(ko,{brighter(n){return n=n==null?Jc:Math.pow(Jc,n),new Wt(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Eo:Math.pow(Eo,n),new Wt(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Wt(Os(this.r),Os(this.g),Os(this.b),eu(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Jv,formatHex:Jv,formatHex8:ZU,formatRgb:e3,toString:e3}));function Jv(){return`#${ws(this.r)}${ws(this.g)}${ws(this.b)}`}function ZU(){return`#${ws(this.r)}${ws(this.g)}${ws(this.b)}${ws((isNaN(this.opacity)?1:this.opacity)*255)}`}function e3(){const n=eu(this.opacity);return`${n===1?"rgb(":"rgba("}${Os(this.r)}, ${Os(this.g)}, ${Os(this.b)}${n===1?")":`, ${n})`}`}function eu(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Os(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function ws(n){return n=Os(n),(n<16?"0":"")+n.toString(16)}function t3(n,e,t,i){return i<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Rn(n,e,t,i)}function rT(n){if(n instanceof Rn)return new Rn(n.h,n.s,n.l,n.opacity);if(n instanceof ko||(n=Co(n)),!n)return new Rn;if(n instanceof Rn)return n;n=n.rgb();var e=n.r/255,t=n.g/255,i=n.b/255,s=Math.min(e,t,i),a=Math.max(e,t,i),l=NaN,u=a-s,h=(a+s)/2;return u?(e===a?l=(t-i)/u+(t<i)*6:t===a?l=(i-e)/u+2:l=(e-t)/u+4,u/=h<.5?a+s:2-a-s,l*=60):u=h>0&&h<1?0:l,new Rn(l,u,h,n.opacity)}function QU(n,e,t,i){return arguments.length===1?rT(n):new Rn(n,e,t,i??1)}function Rn(n,e,t,i){this.h=+n,this.s=+e,this.l=+t,this.opacity=+i}bp(Rn,QU,sT(ko,{brighter(n){return n=n==null?Jc:Math.pow(Jc,n),new Rn(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Eo:Math.pow(Eo,n),new Rn(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,i=t+(t<.5?t:1-t)*e,s=2*t-i;return new Wt(Nd(n>=240?n-240:n+120,s,i),Nd(n,s,i),Nd(n<120?n+240:n-120,s,i),this.opacity)},clamp(){return new Rn(n3(this.h),hc(this.s),hc(this.l),eu(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=eu(this.opacity);return`${n===1?"hsl(":"hsla("}${n3(this.h)}, ${hc(this.s)*100}%, ${hc(this.l)*100}%${n===1?")":`, ${n})`}`}}));function n3(n){return n=(n||0)%360,n<0?n+360:n}function hc(n){return Math.max(0,Math.min(1,n||0))}function Nd(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const vp=n=>()=>n;function GU(n,e){return function(t){return n+t*e}}function JU(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(i){return Math.pow(n+i*e,t)}}function eB(n){return(n=+n)==1?aT:function(e,t){return t-e?JU(e,t,n):vp(isNaN(e)?t:e)}}function aT(n,e){var t=e-n;return t?GU(n,t):vp(isNaN(n)?e:n)}const i3=function n(e){var t=eB(e);function i(s,a){var l=t((s=Mg(s)).r,(a=Mg(a)).r),u=t(s.g,a.g),h=t(s.b,a.b),d=aT(s.opacity,a.opacity);return function(p){return s.r=l(p),s.g=u(p),s.b=h(p),s.opacity=d(p),s+""}}return i.gamma=n,i}(1);function tB(n,e){e||(e=[]);var t=n?Math.min(e.length,n.length):0,i=e.slice(),s;return function(a){for(s=0;s<t;++s)i[s]=n[s]*(1-a)+e[s]*a;return i}}function nB(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function iB(n,e){var t=e?e.length:0,i=n?Math.min(t,n.length):0,s=new Array(i),a=new Array(t),l;for(l=0;l<i;++l)s[l]=Tp(n[l],e[l]);for(;l<t;++l)a[l]=e[l];return function(u){for(l=0;l<i;++l)a[l]=s[l](u);return a}}function sB(n,e){var t=new Date;return n=+n,e=+e,function(i){return t.setTime(n*(1-i)+e*i),t}}function tu(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}function rB(n,e){var t={},i={},s;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in n?t[s]=Tp(n[s],e[s]):i[s]=e[s];return function(a){for(s in t)i[s]=t[s](a);return i}}var Og=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Pd=new RegExp(Og.source,"g");function aB(n){return function(){return n}}function oB(n){return function(e){return n(e)+""}}function lB(n,e){var t=Og.lastIndex=Pd.lastIndex=0,i,s,a,l=-1,u=[],h=[];for(n=n+"",e=e+"";(i=Og.exec(n))&&(s=Pd.exec(e));)(a=s.index)>t&&(a=e.slice(t,a),u[l]?u[l]+=a:u[++l]=a),(i=i[0])===(s=s[0])?u[l]?u[l]+=s:u[++l]=s:(u[++l]=null,h.push({i:l,x:tu(i,s)})),t=Pd.lastIndex;return t<e.length&&(a=e.slice(t),u[l]?u[l]+=a:u[++l]=a),u.length<2?h[0]?oB(h[0].x):aB(e):(e=h.length,function(d){for(var p=0,_;p<e;++p)u[(_=h[p]).i]=_.x(d);return u.join("")})}function Tp(n,e){var t=typeof e,i;return e==null||t==="boolean"?vp(e):(t==="number"?tu:t==="string"?(i=Co(e))?(e=i,i3):lB:e instanceof Co?i3:e instanceof Date?sB:nB(e)?tB:Array.isArray(e)?iB:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?rB:tu)(n,e)}function cB(n,e){return n=+n,e=+e,function(t){return Math.round(n*(1-t)+e*t)}}function uB(n){return function(){return n}}function fB(n){return+n}var s3=[0,1];function Fr(n){return n}function Ig(n,e){return(e-=n=+n)?function(t){return(t-n)/e}:uB(isNaN(e)?NaN:.5)}function hB(n,e){var t;return n>e&&(t=n,n=e,e=t),function(i){return Math.max(n,Math.min(e,i))}}function dB(n,e,t){var i=n[0],s=n[1],a=e[0],l=e[1];return s<i?(i=Ig(s,i),a=t(l,a)):(i=Ig(i,s),a=t(a,l)),function(u){return a(i(u))}}function gB(n,e,t){var i=Math.min(n.length,e.length)-1,s=new Array(i),a=new Array(i),l=-1;for(n[i]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++l<i;)s[l]=Ig(n[l],n[l+1]),a[l]=t(e[l],e[l+1]);return function(u){var h=PU(n,u,1,i)-1;return a[h](s[h](u))}}function pB(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function mB(){var n=s3,e=s3,t=Tp,i,s,a,l=Fr,u,h,d;function p(){var y=Math.min(n.length,e.length);return l!==Fr&&(l=hB(n[0],n[y-1])),u=y>2?gB:dB,h=d=null,_}function _(y){return y==null||isNaN(y=+y)?a:(h||(h=u(n.map(i),e,t)))(i(l(y)))}return _.invert=function(y){return l(s((d||(d=u(e,n.map(i),tu)))(y)))},_.domain=function(y){return arguments.length?(n=Array.from(y,fB),p()):n.slice()},_.range=function(y){return arguments.length?(e=Array.from(y),p()):e.slice()},_.rangeRound=function(y){return e=Array.from(y),t=cB,p()},_.clamp=function(y){return arguments.length?(l=y?!0:Fr,p()):l!==Fr},_.interpolate=function(y){return arguments.length?(t=y,p()):t},_.unknown=function(y){return arguments.length?(a=y,_):a},function(y,v){return i=y,s=v,p()}}function _B(){return mB()(Fr,Fr)}function yB(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function nu(n,e){if((t=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var t,i=n.slice(0,t);return[i.length>1?i[0]+i.slice(2):i,+n.slice(t+1)]}function ea(n){return n=nu(Math.abs(n)),n?n[1]:NaN}function bB(n,e){return function(t,i){for(var s=t.length,a=[],l=0,u=n[0],h=0;s>0&&u>0&&(h+u+1>i&&(u=Math.max(1,i-h)),a.push(t.substring(s-=u,s+u)),!((h+=u+1)>i));)u=n[l=(l+1)%n.length];return a.reverse().join(e)}}function vB(n){return function(e){return e.replace(/[0-9]/g,function(t){return n[+t]})}}var TB=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function iu(n){if(!(e=TB.exec(n)))throw new Error("invalid format: "+n);var e;return new xp({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}iu.prototype=xp.prototype;function xp(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}xp.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function xB(n){e:for(var e=n.length,t=1,i=-1,s;t<e;++t)switch(n[t]){case".":i=s=t;break;case"0":i===0&&(i=t),s=t;break;default:if(!+n[t])break e;i>0&&(i=0);break}return i>0?n.slice(0,i)+n.slice(s+1):n}var oT;function SB(n,e){var t=nu(n,e);if(!t)return n+"";var i=t[0],s=t[1],a=s-(oT=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,l=i.length;return a===l?i:a>l?i+new Array(a-l+1).join("0"):a>0?i.slice(0,a)+"."+i.slice(a):"0."+new Array(1-a).join("0")+nu(n,Math.max(0,e+a-1))[0]}function r3(n,e){var t=nu(n,e);if(!t)return n+"";var i=t[0],s=t[1];return s<0?"0."+new Array(-s).join("0")+i:i.length>s+1?i.slice(0,s+1)+"."+i.slice(s+1):i+new Array(s-i.length+2).join("0")}const a3={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:yB,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>r3(n*100,e),r:r3,s:SB,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function o3(n){return n}var l3=Array.prototype.map,c3=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function AB(n){var e=n.grouping===void 0||n.thousands===void 0?o3:bB(l3.call(n.grouping,Number),n.thousands+""),t=n.currency===void 0?"":n.currency[0]+"",i=n.currency===void 0?"":n.currency[1]+"",s=n.decimal===void 0?".":n.decimal+"",a=n.numerals===void 0?o3:vB(l3.call(n.numerals,String)),l=n.percent===void 0?"%":n.percent+"",u=n.minus===void 0?"":n.minus+"",h=n.nan===void 0?"NaN":n.nan+"";function d(_){_=iu(_);var y=_.fill,v=_.align,A=_.sign,R=_.symbol,C=_.zero,z=_.width,H=_.comma,M=_.precision,k=_.trim,L=_.type;L==="n"?(H=!0,L="g"):a3[L]||(M===void 0&&(M=12),k=!0,L="g"),(C||y==="0"&&v==="=")&&(C=!0,y="0",v="=");var X=R==="$"?t:R==="#"&&/[boxX]/.test(L)?"0"+L.toLowerCase():"",ce=R==="$"?i:/[%p]/.test(L)?l:"",re=a3[L],ne=/[defgprs%]/.test(L);M=M===void 0?6:/[gprs]/.test(L)?Math.max(1,Math.min(21,M)):Math.max(0,Math.min(20,M));function he(te){var me=X,Ae=ce,_e,Be,Y;if(L==="c")Ae=re(te)+Ae,te="";else{te=+te;var ie=te<0||1/te<0;if(te=isNaN(te)?h:re(Math.abs(te),M),k&&(te=xB(te)),ie&&+te==0&&A!=="+"&&(ie=!1),me=(ie?A==="("?A:u:A==="-"||A==="("?"":A)+me,Ae=(L==="s"?c3[8+oT/3]:"")+Ae+(ie&&A==="("?")":""),ne){for(_e=-1,Be=te.length;++_e<Be;)if(Y=te.charCodeAt(_e),48>Y||Y>57){Ae=(Y===46?s+te.slice(_e+1):te.slice(_e))+Ae,te=te.slice(0,_e);break}}}H&&!C&&(te=e(te,1/0));var de=me.length+te.length+Ae.length,we=de<z?new Array(z-de+1).join(y):"";switch(H&&C&&(te=e(we+te,we.length?z-Ae.length:1/0),we=""),v){case"<":te=me+te+Ae+we;break;case"=":te=me+we+te+Ae;break;case"^":te=we.slice(0,de=we.length>>1)+me+te+Ae+we.slice(de);break;default:te=we+me+te+Ae;break}return a(te)}return he.toString=function(){return _+""},he}function p(_,y){var v=d((_=iu(_),_.type="f",_)),A=Math.max(-8,Math.min(8,Math.floor(ea(y)/3)))*3,R=Math.pow(10,-A),C=c3[8+A/3];return function(z){return v(R*z)+C}}return{format:d,formatPrefix:p}}var dc,lT,cT;wB({thousands:",",grouping:[3],currency:["$",""]});function wB(n){return dc=AB(n),lT=dc.format,cT=dc.formatPrefix,dc}function EB(n){return Math.max(0,-ea(Math.abs(n)))}function RB(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(ea(e)/3)))*3-ea(Math.abs(n)))}function CB(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,ea(e)-ea(n))+1}function MB(n,e,t,i){var s=LU(n,e,t),a;switch(i=iu(i??",f"),i.type){case"s":{var l=Math.max(Math.abs(n),Math.abs(e));return i.precision==null&&!isNaN(a=RB(s,l))&&(i.precision=a),cT(i,l)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(a=CB(s,Math.max(Math.abs(n),Math.abs(e))))&&(i.precision=a-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(a=EB(s))&&(i.precision=a-(i.type==="%")*2);break}}return lT(i)}function OB(n){var e=n.domain;return n.ticks=function(t){var i=e();return BU(i[0],i[i.length-1],t??10)},n.tickFormat=function(t,i){var s=e();return MB(s[0],s[s.length-1],t??10,i)},n.nice=function(t){t==null&&(t=10);var i=e(),s=0,a=i.length-1,l=i[s],u=i[a],h,d,p=10;for(u<l&&(d=l,l=u,u=d,d=s,s=a,a=d);p-- >0;){if(d=Cg(l,u,t),d===h)return i[s]=l,i[a]=u,e(i);if(d>0)l=Math.floor(l/d)*d,u=Math.ceil(u/d)*d;else if(d<0)l=Math.ceil(l*d)/d,u=Math.floor(u*d)/d;else break;h=d}return n},n}function Uo(){var n=_B();return n.copy=function(){return pB(n,Uo())},FU.apply(n,arguments),OB(n)}const gn=[1,25e4,5e5,7e5,9e5,15e5,2e6],uT=[[26,35,126,250],[40,53,147,250],[48,63,159,250],[57,73,171,250],[67,160,71,250],[139,195,74,250]],fT=[[247,37,133,250],[114,9,183,250],[58,12,163,250],[67,97,238,250],[76,201,240,250],[136,220,235,250]],hT=[[105,47,221,250],[79,37,151,250],[158,0,89,250],[255,0,84,250],[255,84,0,250],[255,189,0,250]],dT=[[106,90,156,250],[145,101,202,250],[113,104,168,250],[141,137,184,250],[169,180,202,250],[202,196,217,250]],fi={BrightSpectrum:[[1,152,189,180],[73,227,206,180],[216,254,181,180],[254,237,177,180],[254,173,84,180],[209,55,78,180]],DeepMauve:[[221,28,119,250],[152,0,67,250],[223,101,176,250],[201,148,199,250],[212,185,218,250],[241,238,246,250]],TwilightBlue:[[136,86,167,250],[129,15,124,250],[140,150,198,250],[158,188,218,250],[191,211,230,250],[237,248,251,250]],MarineTeal:[[37,52,148,250],[44,127,184,250],[65,182,196,250],[127,205,187,250],[199,233,180,250],[255,255,204,250]]},Ng=Uo().domain(gn).range(uT),gT=Uo().domain(gn).range(fT),pT=Uo().domain(gn).range(hT),mT=Uo().domain(gn).range(dT),Ir={ElectricViolet:{displayName:"Speed Cinema",domain:gn,colorRange:uT,scaleFunction:Ng,layerType:"scatterplot"},VividGem:{displayName:"Vivid Gem",domain:gn,colorRange:fT,scaleFunction:gT,layerType:"scatterplot"},InfernoLava:{displayName:"Inferno Lava",domain:gn,colorRange:hT,scaleFunction:pT,layerType:"scatterplot"},MutedStone:{displayName:"Muted Stone",domain:gn,colorRange:dT,scaleFunction:mT,layerType:"scatterplot"},BrightSpectrum:{displayName:"Bright Spectrum",domain:gn,colorRange:fi.BrightSpectrum,layerType:"hexagon-heatmap"},DeepMauve:{displayName:"Deep Mauve",domain:gn,colorRange:fi.DeepMauve,layerType:"hexagon-heatmap"},TwilightBlue:{displayName:"Twilight Blue",domain:gn,colorRange:fi.TwilightBlue,layerType:"hexagon-heatmap"},MarineTeal:{displayName:"Marine Teal",domain:gn,colorRange:fi.MarineTeal,layerType:"hexagon-heatmap"}},IB=()=>J.useMemo(()=>{const n="https://raw.githubusercontent.com/Kirman442/deckgl/main/ookla/";return[`${n}austria_data_zstd10.parquet`,`${n}france_data_zstd10.parquet`,`${n}germany_data_zstd10.parquet`,`${n}iceland_data_zstd10.parquet`,`${n}ireland_data_zstd10.parquet`,`${n}italy_data_zstd10.parquet`,`${n}liechtenstein_data_zstd10.parquet`,`${n}norway_data_zstd10.parquet`,`${n}switzerland_data_zstd10.parquet`,`${n}turkiye_data_zstd10.parquet`,`${n}united_kingdom_data_zstd10.parquet`]},[]);class NB{constructor(e,t=navigator.hardwareConcurrency-1||3,i={}){this.taskQueue=[],this.workers=[],this.poolSize=Math.max(2,t),this.workerScript=e,this.workerOptions=i,this.taskPromises=new Map,this.nextTaskId=0,this.initialize()}initialize(){for(let e=0;e<this.poolSize;e++){const t=new Worker(this.workerScript,this.workerOptions);this.workers.push({worker:t,busy:!1,id:`worker-${e}`}),t.onmessage=i=>{const{taskId:s,success:a,data:l,error:u}=i.data,h=this.taskPromises.get(s);if(h){this.taskPromises.delete(s),a?h.resolve({success:!0,data:l}):h.reject(new Error(u||`Worker task ${s} failed without specific error.`));const d=this.workers.find(p=>p.worker===t);d&&(d.busy=!1,this.processNextTask())}else console.warn(`Worker ${this.workers.find(d=>d.worker===t).id} sent message for unknown or completed task ID: ${s}`,i.data)},t.onerror=i=>{console.error(`Fatal Error in worker ${this.workers.find(a=>a.worker===t).id}:`,i);const s=this.workers.find(a=>a.worker===t);s&&(s.busy=!1,this.processNextTask())}}}enqueueTask(e){return new Promise((t,i)=>{const s=this.nextTaskId++;this.taskQueue.push({taskId:s,data:e,resolve:t,reject:i}),this.taskPromises.set(s,{resolve:t,reject:i}),this.processNextTask()})}processNextTask(){if(this.taskQueue.length===0)return;const e=this.workers.find(i=>!i.busy);if(!e)return;const t=this.taskQueue.shift();e.busy=!0,e.worker.postMessage({taskId:t.taskId,data:t.data})}async processFile(e,t,i=!1){if(i){const a=[],l=e.data.length;for(let h=0;h<l;h+=8e4)a.push({parquetData:e,fileName:t,isLargeFile:!0,chunkStart:h,chunkEnd:Math.min(h+8e4,l)});const u=await Promise.all(a.map(h=>this.enqueueTask(h)));return{features:u.flatMap(h=>h.features),fileName:t,processingTime:u.reduce((h,d)=>h+(d.processingTime||0),0),processedRowsCount:u.reduce((h,d)=>h+(d.processedRowsCount||0),0),success:u.every(h=>h.success)}}else return this.enqueueTask({parquetData:e,fileName:t,isLargeFile:i})}terminate(){this.workers.forEach(({worker:e})=>e.terminate()),this.workers=[],this.taskQueue=[],this.taskPromises.clear()}}var Dd={exports:{}},kd,u3;function PB(){if(u3)return kd;u3=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return kd=n,kd}var Ud,f3;function DB(){if(f3)return Ud;f3=1;var n=PB();function e(){}function t(){}return t.resetWarningCache=e,Ud=function(){function i(l,u,h,d,p,_){if(_!==n){var y=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw y.name="Invariant Violation",y}}i.isRequired=i;function s(){return i}var a={array:i,bigint:i,bool:i,func:i,number:i,object:i,string:i,symbol:i,any:i,arrayOf:s,element:i,elementType:i,instanceOf:s,node:i,objectOf:s,oneOf:s,oneOfType:s,shape:s,exact:s,checkPropTypes:t,resetWarningCache:e};return a.PropTypes=a,a},Ud}var h3;function kB(){return h3||(h3=1,Dd.exports=DB()()),Dd.exports}var UB=kB();const oi=g3(UB),_T=({schemeDefinition:n,activeLayerKey:e})=>{if(!n||!n.domain||!n.colorRange||n.domain.length!==n.colorRange.length+1)return null;const{displayName:t,domain:i,colorRange:s}=n;let a="Legend";(e==="scatterplot"||e==="hexagon"||e==="heatmap")&&(a="Speed Gradient");const u=`linear-gradient(to right, ${s.map((h,d)=>{const p=h&&h.length>3?h[3]/255:1,_=`rgba(${h[0]}, ${h[1]}, ${h[2]}, ${p})`,y=d/(s.length-1)*100;return`${_} ${y}%`}).join(", ")})`;return xe.jsxs("div",{className:"color-legend",children:[" ",xe.jsxs("p",{className:"dataset text-center",children:[a," - ",t]})," ",xe.jsxs("div",{className:"legend-bar-container",children:[xe.jsx("div",{className:"legend-gradient-bar",style:{background:u}}),xe.jsxs("span",{className:"legend-label-min",children:[i[0]," Mb"]})," ",xe.jsxs("span",{className:"legend-label-max",children:[i[i.length-1]/1e3," Mb"]})," "]})]})};_T.propTypes={schemeDefinition:oi.shape({displayName:oi.string,domain:oi.arrayOf(oi.number).isRequired,colorRange:oi.arrayOf(oi.arrayOf(oi.number)).isRequired,layerType:oi.string}),activeLayerKey:oi.string};const BB=({mapStyle:n,setMapStyle:e,activeColorSchemeKey:t,setActiveColorSchemeKey:i,activeColorHexagonSchemeKey:s,setActiveColorHexagonSchemeKey:a,activeLayerKey:l,setActiveLayerKey:u,totalDataLenght:h})=>{const[d,p]=J.useState(!0),[_,y]=J.useState(!1),v=ne=>ne?ne>=1e3?`${(ne/1e3).toFixed(1)}K`:ne.toString():"0",A=["hexagon","heatmap","scatterplot"],R=()=>xe.jsx("div",{className:"color-scheme-buttons",children:A.map(ne=>xe.jsx("button",{className:`legend-button ${l===ne?"active":""}`,onClick:()=>H(ne),children:ne.charAt(0).toUpperCase()+ne.slice(1)},ne))}),C=()=>{p(!d),d||y(!1)},z=()=>{y(!_),_||p(!1)},H=ne=>{u(ne)};let M=[],k=null,L=null;l==="scatterplot"?(M=Object.keys(Ir).filter(ne=>Ir[ne].layerType==="scatterplot"),k=i,L=t):(l==="hexagon"||l==="heatmap")&&(M=Object.keys(Ir).filter(ne=>Ir[ne].layerType==="hexagon-heatmap"),k=a,L=s);const X=()=>M.length===0?null:xe.jsx("div",{className:"color-scheme-buttons",children:M.map(ne=>{const he=Ir[ne];return he?xe.jsx("button",{className:`legend-button ${L===ne?"active":""}`,onClick:()=>k(ne),children:he.displayName},ne):null})});let ce=null;l==="scatterplot"?ce=t:(l==="hexagon"||l==="heatmap")&&(ce=s);const re=Ir[ce];return xe.jsxs("div",{className:"panel-container",children:[xe.jsxs("div",{className:"panel-block",children:[xe.jsxs("div",{className:"panel-header",onClick:C,children:[xe.jsx("div",{className:"panel-title",children:"Internet Speed Map"}),xe.jsx("div",{className:"panel-expander",children:d?"":"i"})]}),d&&xe.jsxs("div",{className:"panel-content",children:[xe.jsxs("div",{className:"stat-item",children:[xe.jsx("div",{className:"stat-label",children:"Total number of measurements "}),xe.jsx("div",{className:"stat-value",children:v(h)})]}),xe.jsxs("div",{className:"description-block",children:[xe.jsx("p",{className:"dataset text-center",children:"Change color map palette:"}),X(),xe.jsx("p",{className:"dataset text-center",children:"Select the layer:"}),R(),xe.jsx("p",{className:"dataset text-center",children:"Select a map style:"}),xe.jsx("button",{className:"legend-button button-center mb-10",onClick:()=>e(!n),children:n?"With Labels":"No Labels"}),xe.jsx(_T,{schemeDefinition:re,activeLayerKey:l})]})]})]}),xe.jsxs("div",{className:"panel-block",children:[xe.jsxs("div",{className:"panel-header",onClick:z,children:[xe.jsx("div",{className:"panel-title",children:"Infos zum Datensatz"}),xe.jsx("div",{className:"panel-expander",children:_?"":"i"})]}),_&&xe.jsx("div",{className:"panel-content",children:xe.jsxs("div",{className:"description-block",children:[xe.jsx("h4",{children:"ber den Datensatz"}),xe.jsxs("p",{className:"dataset",children:["Dieser Datensatz enthlt Leistungskennzahlen fr globale mobile Breitbandnetze in Form von Mercator-Kacheln auf Skalenebene 16 (etwa 610,8 Meter mal 610,8 Meter am quator). Upload- und Download-Geschwindigkeiten sowie Latenzzeiten werden mit den Speedtest by Ookla-Apps fr Android und iOS erfasst und fr jede Kachel gemittelt. Die Messungen werden gefiltert, um Ergebnisse mit einer Standortgenauigkeit in GPS-Qualitt zu erhalten.",xe.jsx("br",{}),xe.jsx("br",{})," "]}),xe.jsxs("p",{children:["Datenquelle: ",xe.jsx("a",{href:"https://github.com/teamookla/ookla-open-data",target:"_blank",rel:"noopener noreferrer",children:"Ookla Global Mobile Network"})]})]})})]})]})},LB={longitude:15.1,latitude:48.9,zoom:4,maxZoom:12,minZoom:4,pitch:30,bearing:0};function FB(){const[n,e]=J.useState(!0),[t,i]=J.useState(!0),[s,a]=J.useState([]),[l,u]=J.useState(!0),[h,d]=J.useState(0),[p,_]=J.useState(0),[y,v]=J.useState(null),[A,R]=J.useState(0),[C,z]=J.useState(!0),[H,M]=J.useState("scatterplot"),[k,L]=J.useState("ElectricViolet"),[X,ce]=J.useState("BrightSpectrum"),[re,ne]=J.useState(),he=J.useRef(!0),te=J.useRef(!1),me=IB(),Ae=J.useRef(null),_e=J.useRef({src:new Float32Array(0),length:0}),Be="https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",Y="https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json",ie=J.useMemo(()=>n?Y:Be,[n]);J.useEffect(()=>{},[me]);const de=J.useMemo(()=>{const ge={ElectricViolet:Ng,VividGem:gT,InfernoLava:pT,MutedStone:mT}[k];return ge||(console.warn(`Unknown color scheme key: ${k}. Using the default 'blues' scheme.`),Ng)},[k]),we=J.useMemo(()=>{const ge={BrightSpectrum:fi.BrightSpectrum,DeepMauve:fi.DeepMauve,TwilightBlue:fi.TwilightBlue,MarineTeal:fi.MarineTeal}[X];return ge||(console.warn(`Unknown color scheme key: ${X}. Using the default 'blues' scheme.`),fi.MarineTeal)},[X]),O=J.useMemo(()=>{if(s.length===0||s[0].length===0)return[];const oe={data:s[0],getPosition:(fe,{index:Je,data:De,target:_t})=>(_t[0]=De.src[Je*6],_t[1]=De.src[Je*6+1],_t[2]=0,_t),colorRange:we,updateTriggers:{elevationScale:[A],colorRange:we}},ge=[];return H==="hexagon"?ge.push(new _p({id:"hexagon-layer",...oe,coverage:.9,gpuAggregation:!0,radius:1e3,upperPercentile:1e3,material:{ambient:.94,diffuse:.4,shininess:32}})):H==="heatmap"?ge.push(new yp({id:"heatmap-layer",...oe,radiusPixels:3,intensity:.7,threshold:.5})):H==="scatterplot"&&ge.push(new pp({id:"scatterplot-layer",...oe,gpuAggregation:!0,filled:!0,opacity:1,radiusScale:200,parameters:{depthTest:!1},getFillColor:(fe,{index:Je,data:De,target:_t})=>(_t[0]=De.src[Je*6+3],de(_t*5)),updateTriggers:{getFillColor:[oe.data,de]}})),ge},[s,A,H,de,we]),G=J.useCallback((oe,ge)=>{if(!ge||ge.length===0)return oe;if(oe.length===0)return ge;const fe=oe.length+ge.length,Je=new Float32Array(fe*6);return Je.set(oe.src),Je.set(ge.src,oe.length*6),ne(fe),{src:Je,length:fe}},[]);J.useEffect(()=>{if(te.current){console.log("Data loading already started, skipping.");return}async function oe(){te.current=!0,console.log("Starting data loading process"),d(0),_(me.length),u(!0),v(null),i(!0);const fe=new URL("data:text/javascript;base64,Ly8g0JLRgNC10LzQtdC90L3QvjogTWluaW1hbCBwYXJxdWV0V29ya2VyLmpzIGZvciB0ZXN0aW5nDQpzZWxmLm9uZXJyb3IgPSBmdW5jdGlvbiAoZSkgew0KICAgIGNvbnNvbGUuZXJyb3IoJy0tLSBNaW5pbWFsIFdvcmtlcjogRXJyb3IgY2F1Z2h0IGJ5IG9uZXJyb3I6JywgZSk7DQp9Ow0KY29uc29sZS5sb2coJy0tLSBNaW5pbWFsIFdvcmtlcjogU2NyaXB0IHN0YXJ0ZWQhJyk7DQoNCnNlbGYub25tZXNzYWdlID0gZnVuY3Rpb24gKGUpIHsNCiAgICBjb25zb2xlLmxvZygnLS0tIE1pbmltYWwgV29ya2VyOiBSZWNlaXZlZCBtZXNzYWdlIGluIG1pbmltYWwgd29ya2VyOicsIGUuZGF0YSk7DQogICAgLy8g0J3QtSDQtNC10LvQsNC10Lwg0L3QuNGH0LXQs9C+INGB0LvQvtC20L3QvtCz0L4sINC90LUg0LjQvNC/0L7RgNGC0LjRgNGD0LXQvCDQsdC40LHQu9C40L7RgtC10LrQuCwg0L3QtSDRhNC10YLRh9C40LwNCiAgICBzZWxmLnBvc3RNZXNzYWdlKHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogJ01pbmltYWwgd29ya2VyIHJlY2VpdmVkIG1lc3NhZ2UnIH0pOw0KfTsNCi8vINCa0L7QvdC10YYgTWluaW1hbCBwYXJxdWV0V29ya2VyLmpz",import.meta.url);Ae.current=new NB(fe,10,{type:"module"}),_e.current={src:new Float32Array(0),length:0},console.time(" Full Feature Load Time"),await le(me),console.timeEnd(" Full Feature Load Time"),he.current&&u(!1)}oe();const ge=setTimeout(()=>R(50),2500);return()=>{console.log("Component unmounted"),clearTimeout(ge),he.current=!1,Ae.current&&Ae.current.terminate()}},[me]);const le=J.useCallback(async oe=>{for(let fe=0;fe<oe.length;fe+=10){const De=oe.slice(fe,fe+10).map($t=>Ae.current.enqueueTask({url:$t}).then(es=>he.current?(d(ts=>ts+1),es.data):null).catch(es=>(he.current&&(d(ts=>ts+1),console.error(`Failed to process file ${$t}:`,es)),null))),_t=await Promise.all(De);let gi={src:new Float32Array(0),length:0};for(const $t of _t)$t&&(gi=G(gi,$t));if(gi.length>0&&he.current){const $t=G(_e.current,gi);_e.current=$t,a([$t])}}},[G,he,d]);J.useCallback(({index:oe})=>{if(oe===-1||!s.length)return null;const{src:ge}=s[0],fe=oe*6;return fe+5>=ge.length?null:{html:`
        <div class="custom-tooltip">
          <b>Download:</b> ${(ge[fe+3]/1e3).toFixed(2)} Mbps<br>
          <b>Upload:</b>  ${(ge[fe+4]/1e3).toFixed(2)} Mbps<br>
          <b>Country Code:</b> ${ge[fe+5]}
        </div>
      `,style:{backgroundColor:"#1a1a1a",fontSize:"14px",padding:"10px",borderRadius:"4px"}}},[s]);const ae=J.useMemo(()=>({initialViewState:LB,controller:!0,layers:O,useDevicePixels:!1}),[O]);return xe.jsxs("div",{children:[t&&xe.jsxs(i6,{...ae,effects:[CU],children:[" ",xe.jsx(hA,{mapStyle:ie}),xe.jsxs("div",{className:"rotate-shift",children:["Hold down shift to rotate ",xe.jsx("br",{}),"Zum Drehen Umschalttaste gedrckt halten"]}),xe.jsx(BB,{showHex:C,setShowHex:z,mapStyle:n,setMapStyle:e,activeColorHexagonSchemeKey:X,setActiveColorHexagonSchemeKey:ce,activeColorSchemeKey:k,setActiveColorSchemeKey:L,activeLayerKey:H,setActiveLayerKey:M,totalDataLenght:re})]}),l&&xe.jsxs("div",{style:{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",background:"rgba(0,0,0,0.7)",color:"white",padding:"10px",borderRadius:"5px",zIndex:100},children:["Downloaded ",h," of ",p," files (",Math.round(h/p*100),"%)"]}),y&&xe.jsxs("div",{style:{position:"absolute",bottom:"10px",left:"10px",background:"rgba(255,0,0,0.7)",color:"white",padding:"10px",borderRadius:"4px",zIndex:10},children:["Loading Error: ",y.message]})]})}function VB(){return xe.jsx(FB,{})}const zB=QS.createRoot(document.getElementById("root"));zB.render(xe.jsx(VB,{}));export{g3 as g};
